---
title: Analyse du domaine pour les microservices
description: Analyse du domaine pour les microservices
author: MikeWasson
ms.date: 12/08/2017
ms.openlocfilehash: c3c353a6b30507369357af4b520a51f8afc2fb8d
ms.sourcegitcommit: 3d6dba524cc7661740bdbaf43870de7728d60a01
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/11/2018
---
# <a name="designing-microservices-domain-analysis"></a><span data-ttu-id="15ad6-103">Conception des microservices : Analyse du domaine</span><span class="sxs-lookup"><span data-stu-id="15ad6-103">Designing microservices: Domain analysis</span></span> 

<span data-ttu-id="15ad6-104">L’un des plus grandes problématiques des microservices est la définition des limites de chacun des services isolés.</span><span class="sxs-lookup"><span data-stu-id="15ad6-104">One of the biggest challenges of microservices is to define the boundaries of individual services.</span></span> <span data-ttu-id="15ad6-105">Le principe de base est qu’un service doit exécuter « une action » &mdash; ; toutefois, l’application concrète de cette règle nécessite une réflexion approfondie.</span><span class="sxs-lookup"><span data-stu-id="15ad6-105">The general rule is that a service should do "one thing" &mdash; but putting that rule into practice requires careful thought.</span></span> <span data-ttu-id="15ad6-106">Aucun processus mécanique ne produira la conception idéale.</span><span class="sxs-lookup"><span data-stu-id="15ad6-106">There is no mechanical process that will produce the "right" design.</span></span> <span data-ttu-id="15ad6-107">Vous devez analyser en profondeur le domaine, les exigences et les objectifs de votre entreprise.</span><span class="sxs-lookup"><span data-stu-id="15ad6-107">You have to think deeply about your business domain, requirements, and goals.</span></span> <span data-ttu-id="15ad6-108">Sinon, vous pouvez avoir à gérer une conception incohérente présentant des caractéristiques indésirables, comme des dépendances masquées entre les services, un couplage étroit ou des interfaces mal développées.</span><span class="sxs-lookup"><span data-stu-id="15ad6-108">Otherwise, you can end up with a haphazard design that exhibits some undesirable characteristics, such as hidden dependencies between services, tight coupling, or poorly designed interfaces.</span></span> <span data-ttu-id="15ad6-109">Dans ce chapitre, nous appliquons une approche orientée domaine de la conception des microservices.</span><span class="sxs-lookup"><span data-stu-id="15ad6-109">In this chapter, we take a domain-driven approach to designing microservices.</span></span> 

<span data-ttu-id="15ad6-110">Les microservices doivent être alignés sur les activités commerciales, pas développés comme des couches horizontales de données, telles que l’accès aux données ou la messagerie.</span><span class="sxs-lookup"><span data-stu-id="15ad6-110">Microservices should be designed around business capabilities, not horizontal layers such as data access or messaging.</span></span> <span data-ttu-id="15ad6-111">Par ailleurs, ils doivent présenter un couplage souple et une haute cohérence fonctionnelle.</span><span class="sxs-lookup"><span data-stu-id="15ad6-111">In addition, they should have loose coupling and high functional cohesion.</span></span> <span data-ttu-id="15ad6-112">Les microservices sont *couplés souplement* si vous êtes en mesure de modifier un service sans avoir à mettre à jour d’autres services au même moment.</span><span class="sxs-lookup"><span data-stu-id="15ad6-112">Microservices are *loosely coupled* if you can change one service without requiring other services to be updated at the same time.</span></span> <span data-ttu-id="15ad6-113">Un microservice est *cohérent* s’il a une vocation unique et précisément définie, comme la gestion des comptes utilisateurs ou le suivi de l’historique de livraison.</span><span class="sxs-lookup"><span data-stu-id="15ad6-113">A microservice is *cohesive* if it has a single, well-defined purpose, such as managing user accounts or tracking delivery history.</span></span> <span data-ttu-id="15ad6-114">Un service a vocation à encapsuler la connaissance du domaine et à extraire cette connaissance des clients.</span><span class="sxs-lookup"><span data-stu-id="15ad6-114">A service should encapsulate domain knowledge and abstract that knowledge from clients.</span></span> <span data-ttu-id="15ad6-115">Par exemple, un client doit pouvoir programmer un drone sans connaître en détail l’algorithme de programmation ni maîtriser la gestion de la flotte de drones.</span><span class="sxs-lookup"><span data-stu-id="15ad6-115">For example, a client should be able to schedule a drone without knowing the details of the scheduling algorithm or how the drone fleet is managed.</span></span>

<span data-ttu-id="15ad6-116">La conception pilotée par domaine fournit une infrastructure constituant la base d’un ensemble efficacement organisé de microservices.</span><span class="sxs-lookup"><span data-stu-id="15ad6-116">Domain-driven design (DDD) provides a framework that can get you most of the way to a set of well-designed microservices.</span></span> <span data-ttu-id="15ad6-117">Cette approche comporte deux phases distinctes, l’une stratégique, l’autre tactique.</span><span class="sxs-lookup"><span data-stu-id="15ad6-117">DDD has two distinct phases, strategic and tactical.</span></span> <span data-ttu-id="15ad6-118">Dans la phase stratégique de la conception pilotée par domaine, vous définissez la structure à grande échelle du système.</span><span class="sxs-lookup"><span data-stu-id="15ad6-118">In strategic DDD, you are defining the large-scale structure of the system.</span></span> <span data-ttu-id="15ad6-119">Cette phase garantit que votre architecture demeure axée sur les fonctionnalités commerciales.</span><span class="sxs-lookup"><span data-stu-id="15ad6-119">Strategic DDD helps to ensure that your architecture remains focused on business capabilities.</span></span> <span data-ttu-id="15ad6-120">La phase tactique, quant à elle, offre un jeu de modèles de conception à valoriser pour créer le modèle du domaine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-120">Tactical DDD provides a set of design patterns that you can use to create the domain model.</span></span> <span data-ttu-id="15ad6-121">Ces modèles comprennent les entités, les agrégats et les services de domaine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-121">These patterns include entities, aggregates, and domain services.</span></span> <span data-ttu-id="15ad6-122">Ces modèles tactiques vous aident à concevoir des microservices à la fois cohérents et souplement couplés.</span><span class="sxs-lookup"><span data-stu-id="15ad6-122">These tactical patterns will help you to design microservices that are both loosely coupled and cohesive.</span></span>

![](./images/ddd-process.png)

<span data-ttu-id="15ad6-123">Dans ce chapitre et dans le suivant, nous allons nous intéresser aux phases suivantes, en les exécutant avec l’application Drone Delivery :</span><span class="sxs-lookup"><span data-stu-id="15ad6-123">In this chapter and the next, we'll walk through the following steps, applying them to the Drone Delivery application:</span></span> 

1. <span data-ttu-id="15ad6-124">Commencez par analyser le domaine d’entreprise afin d’appréhender les exigences fonctionnelles de l’application.</span><span class="sxs-lookup"><span data-stu-id="15ad6-124">Start by analyzing the business domain to understand the application's functional requirements.</span></span> <span data-ttu-id="15ad6-125">Cette étape produit une description informelle du domaine, qui peut être affinée en un jeu plus formel de modèles de domaine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-125">The output of this step is an informal description of the domain, which can be refined into a more formal set of domain models.</span></span> 

2. <span data-ttu-id="15ad6-126">Ensuite, définissez les *limites de contexte* du domaine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-126">Next, define the *bounded contexts* of the domain.</span></span> <span data-ttu-id="15ad6-127">Chaque limite de contexte comporte un modèle de domaine représentant un sous-domaine spécifique de l’application dans son ensemble.</span><span class="sxs-lookup"><span data-stu-id="15ad6-127">Each bounded context contains a domain model that represents a particular subdomain of the larger application.</span></span> 

3. <span data-ttu-id="15ad6-128">Au sein d’une limite de contexte, appliquez des modèles tactiques de la conception pilotée par domaine afin de définir les entités, les agrégats et les services de domaine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-128">Within a bounded context, apply tactical DDD patterns to define entities, aggregates, and domain services.</span></span> 
 
4. <span data-ttu-id="15ad6-129">Utilisez les résultats de l’étape précédente pour identifier les microservices dans votre application.</span><span class="sxs-lookup"><span data-stu-id="15ad6-129">Use the results from the previous step to identify the microservices in your application.</span></span>

<span data-ttu-id="15ad6-130">Dans ce chapitre, nous abordons les trois premières étapes, qui sont principalement liées à la conception pilotée par domaine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-130">In this chapter, we cover the first three steps, which are primarily concerned with DDD.</span></span> <span data-ttu-id="15ad6-131">Dans le chapitre suivant, nous identifierons les microservices.</span><span class="sxs-lookup"><span data-stu-id="15ad6-131">In the next chapter, we will identify the microservices.</span></span> <span data-ttu-id="15ad6-132">Toutefois, il est essentiel de se rappeler que la conception pilotée par domaine est un processus continu, itératif.</span><span class="sxs-lookup"><span data-stu-id="15ad6-132">However, it's important to remember that DDD is an iterative, ongoing process.</span></span> <span data-ttu-id="15ad6-133">Les limites de services ne sont pas fixes.</span><span class="sxs-lookup"><span data-stu-id="15ad6-133">Service boundaries aren't fixed in stone.</span></span> <span data-ttu-id="15ad6-134">À mesure de l’évolution d’une application, vous pouvez décider de décomposer un service en sous-services de taille plus réduite.</span><span class="sxs-lookup"><span data-stu-id="15ad6-134">As an application evolves, you may decide to break apart a service into several smaller services.</span></span>

> [!NOTE]
> <span data-ttu-id="15ad6-135">Ce chapitre n’a pas vocation à apporter une analyse complète et exhaustive du domaine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-135">This chapter is not meant to show a complete and comprehensive domain analysis.</span></span> <span data-ttu-id="15ad6-136">Nous tâcherons d’apporter un exemple concis, illustrant les points principaux.</span><span class="sxs-lookup"><span data-stu-id="15ad6-136">We deliberately kept the example brief, in order to illustrate the main points.</span></span> <span data-ttu-id="15ad6-137">Pour plus d’informations sur la conception pilotée par domaine, nous vous recommandons de lire l’ouvrage d’Eric Evans, *Domain-Driven Design* (Conception pilotée par domaine), dans lequel le concept fut pour la première fois évoqué.</span><span class="sxs-lookup"><span data-stu-id="15ad6-137">For more background on DDD, we recommend Eric Evans' *Domain-Driven Design*, the book that first introduced the term.</span></span> <span data-ttu-id="15ad6-138">Une autre référence importante est le livre *Implementing Domain-Driven Design* (Implémentation de la conception pilotée par domaine) de Vaughn Vernon.</span><span class="sxs-lookup"><span data-stu-id="15ad6-138">Another good reference is *Implementing Domain-Driven Design* by Vaughn Vernon.</span></span> 

## <a name="analyze-the-domain"></a><span data-ttu-id="15ad6-139">Analyser le domaine</span><span class="sxs-lookup"><span data-stu-id="15ad6-139">Analyze the domain</span></span>

<span data-ttu-id="15ad6-140">L’application d’une approche de conception pilotée par domaine vous permet de configurer des microservices de manière à ce que chacune des composantes constitue une niche dédiée à une exigence fonctionnelle de l’entreprise.</span><span class="sxs-lookup"><span data-stu-id="15ad6-140">Using a DDD approach will help you to design microservices so that every service forms a natural fit to a functional business requirement.</span></span> <span data-ttu-id="15ad6-141">Cela peut vous aider à éviter le piège consistant à développer une conception dictée par les limites organisationnelles ou les choix technologiques.</span><span class="sxs-lookup"><span data-stu-id="15ad6-141">It can help you to avoid the trap of letting organizational boundaries or technology choices dictate your design.</span></span>

<span data-ttu-id="15ad6-142">Avant d’écrire le code, vous devez bénéficier d’une visibilité exhaustive sur le système en cours de création.</span><span class="sxs-lookup"><span data-stu-id="15ad6-142">Before writing any code, you need a bird's eye view of the system that you are creating.</span></span> <span data-ttu-id="15ad6-143">La conception pilotée par domaine vise dans un premier temps à modeler le domaine d’entreprise et à créer un *modèle de domaine*.</span><span class="sxs-lookup"><span data-stu-id="15ad6-143">DDD starts by modeling the business domain and creating a *domain model*.</span></span> <span data-ttu-id="15ad6-144">Le modèle de domaine est un modèle théorique du modèle d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="15ad6-144">The domain model is an abstract model of the business domain.</span></span> <span data-ttu-id="15ad6-145">Il répartit et organise la connaissance du domaine, en fournissant un langage commun pour les développeurs et les experts du domaine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-145">It distills and organizes domain knowledge, and provides a common language for developers and domain experts.</span></span> 

<span data-ttu-id="15ad6-146">Commencez par mapper l’ensemble des fonctions d’entreprise et leurs connexions.</span><span class="sxs-lookup"><span data-stu-id="15ad6-146">Start by mapping all of the business functions and their connections.</span></span> <span data-ttu-id="15ad6-147">Il s’agira probablement d’un travail collaboratif impliquant les experts du domaine, les architectes logiciels et d’autres parties prenantes.</span><span class="sxs-lookup"><span data-stu-id="15ad6-147">This will likely be a collaborative effort that involves domain experts, software architects, and other stakeholders.</span></span> <span data-ttu-id="15ad6-148">Il n’est pas nécessaire de recourir à aucun formalisme particulier.</span><span class="sxs-lookup"><span data-stu-id="15ad6-148">You don't need to use any particular formalism.</span></span>  <span data-ttu-id="15ad6-149">Dessinez un schéma ou établissez une esquisse sur tableau blanc.</span><span class="sxs-lookup"><span data-stu-id="15ad6-149">Sketch a diagram or draw on whiteboard.</span></span>

<span data-ttu-id="15ad6-150">À mesure que vous enrichissez le schéma, vous pouvez commencer à identifier des sous-domaines distincts.</span><span class="sxs-lookup"><span data-stu-id="15ad6-150">As you fill in the diagram, you may start to identify discrete subdomains.</span></span> <span data-ttu-id="15ad6-151">Quelles fonctions sont étroitement liées ?</span><span class="sxs-lookup"><span data-stu-id="15ad6-151">Which functions are closely related?</span></span> <span data-ttu-id="15ad6-152">Quelles sont les fonctions au cœur de l’entreprise, quelles sont celles prenant en charge les services auxiliaires ?</span><span class="sxs-lookup"><span data-stu-id="15ad6-152">Which functions are core to the business, and which provide ancillary services?</span></span> <span data-ttu-id="15ad6-153">À quoi ressemble le graphique de dépendance ?</span><span class="sxs-lookup"><span data-stu-id="15ad6-153">What is the dependency graph?</span></span> <span data-ttu-id="15ad6-154">Durant cette phase initiale, vous ne vous intéressez pas aux technologies ni aux détails de l’implémentation.</span><span class="sxs-lookup"><span data-stu-id="15ad6-154">During this initial phase, you aren't concerned with technologies or implementation details.</span></span> <span data-ttu-id="15ad6-155">Ceci dit, vous devez identifier l’emplacement d’intégration de l’application avec les systèmes externes, tel que le processus CRM, le système de traitement des paiements ou les architectures de facturation.</span><span class="sxs-lookup"><span data-stu-id="15ad6-155">That said, you should note the place where the application will need to integrate with external systems, such as CRM, payment processing, or billing systems.</span></span> 

## <a name="drone-delivery-analyzing-the-business-domain"></a><span data-ttu-id="15ad6-156">Drone Delivery : Analyse du domaine d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="15ad6-156">Drone Delivery: Analyzing the business domain.</span></span>

<span data-ttu-id="15ad6-157">Après quelques activités d’analyse initiale de domaine, l’équipe Fabrikam est parvenue à établir une esquisse brute décrivant le domaine de l’application Drone Delivery.</span><span class="sxs-lookup"><span data-stu-id="15ad6-157">After some initial domain analysis, the Fabrikam team came up with a rough sketch that depicts the Drone Delivery domain.</span></span>

![](./images/ddd1.svg) 

- <span data-ttu-id="15ad6-158">L’**Expédition**, au cœur de l’activité, est placée au centre du schéma.</span><span class="sxs-lookup"><span data-stu-id="15ad6-158">**Shipping** is placed in the center of the diagram, because it's core to the business.</span></span> <span data-ttu-id="15ad6-159">Elle est tributaire de l’ensemble des autres éléments du schéma.</span><span class="sxs-lookup"><span data-stu-id="15ad6-159">Everything else in the diagram exists to enable this functionality.</span></span>
- <span data-ttu-id="15ad6-160">La **Gestion des drones** est également cruciale.</span><span class="sxs-lookup"><span data-stu-id="15ad6-160">**Drone management** is also core to the business.</span></span> <span data-ttu-id="15ad6-161">Une fonctionnalité étroitement liée à la gestion des drones est la **réparation des drones** ; combinée à l’**analyse prédictive**, elle permet d’établir un échéancier des périodes d’entretien et de maintenance des drones.</span><span class="sxs-lookup"><span data-stu-id="15ad6-161">Functionality that is closely related to drone management includes **drone repair** and using **predictive analysis** to predict when drones need servicing and maintenance.</span></span> 
- <span data-ttu-id="15ad6-162">L’**analyse de l’heure prévue** fournit des estimations des horaires de collecte et de livraison.</span><span class="sxs-lookup"><span data-stu-id="15ad6-162">**ETA analysis** provides time estimates for pickup and delivery.</span></span> 
- <span data-ttu-id="15ad6-163">Le modèle de **transport tiers** permet à l’application de planifier des modes de transport alternatifs en cas d’incapacité du drone à livrer l’intégralité d’un colis.</span><span class="sxs-lookup"><span data-stu-id="15ad6-163">**Third-party transportation** will enable the application to schedule alternative transportation methods if a package cannot be shipped entirely by drone.</span></span>
- <span data-ttu-id="15ad6-164">Le **partage de drones** est une extension possible de l’activité principale.</span><span class="sxs-lookup"><span data-stu-id="15ad6-164">**Drone sharing** is a possible extension of the core business.</span></span> <span data-ttu-id="15ad6-165">La société peut disposer d’une capacité supérieure de drones sur des intervalles spécifiques, et louer des appareils qui seraient inutilisés sans sa sollicitation.</span><span class="sxs-lookup"><span data-stu-id="15ad6-165">The company may have excess drone capacity during certain hours, and could rent out drones that would otherwise be idle.</span></span> <span data-ttu-id="15ad6-166">Cette fonctionnalité ne sera pas disponible dans la version initiale.</span><span class="sxs-lookup"><span data-stu-id="15ad6-166">This feature will not be in the initial release.</span></span>
- <span data-ttu-id="15ad6-167">La **surveillance vidéo** est un autre secteur que l’entreprise pourrait choisir de développer à l’avenir.</span><span class="sxs-lookup"><span data-stu-id="15ad6-167">**Video surveillance** is another area that the company might expand into later.</span></span>
- <span data-ttu-id="15ad6-168">Les **comptes utilisateurs**, la **facturation** et le **centre d’appels** sont des sous-domaines qui prennent en charge l’activité fondamentale.</span><span class="sxs-lookup"><span data-stu-id="15ad6-168">**User accounts**, **Invoicing**, and **Call center** are subdomains that support the core business.</span></span>
 
<span data-ttu-id="15ad6-169">Notez qu’à ce stade du processus, nous n’avons encore pris aucune décision ayant trait à l’implémentation ou aux technologies.</span><span class="sxs-lookup"><span data-stu-id="15ad6-169">Notice that at this point in the process, we haven't made any decisions about implementation or technologies.</span></span> <span data-ttu-id="15ad6-170">Certains des sous-systèmes peuvent recourir à des systèmes logiciels externes ou des services tiers.</span><span class="sxs-lookup"><span data-stu-id="15ad6-170">Some of the subsystems may involve external software systems or third-party services.</span></span> <span data-ttu-id="15ad6-171">Même dans ce cas, l’application doit interagir avec ces systèmes et services. Aussi, il est important de les inclure dans le modèle de domaine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-171">Even so, the application needs to interact with these systems and services, so it's important to include them in the domain model.</span></span> 

> [!NOTE]
> <span data-ttu-id="15ad6-172">Lorsqu’une application dépend d’un système externe, il existe un risque que le schéma de données ou l’API de ce dernier soient répercutés dans votre application, et compromettent le cas échéant la conception architecturale.</span><span class="sxs-lookup"><span data-stu-id="15ad6-172">When an application depends on an external system, there is a risk that the external system's data schema or API will leak into your application, ultimately compromising the architectural design.</span></span> <span data-ttu-id="15ad6-173">Ce cas de figure est recensé en particulier avec les systèmes hérités ne respectant pas forcément les meilleures pratiques modernes et pouvant valoriser des schémas de données complexes ou des API obsolètes.</span><span class="sxs-lookup"><span data-stu-id="15ad6-173">This is particularly true with legacy systems that may not follow modern best practices, and may use convoluted data schemas or obsolete APIs.</span></span> <span data-ttu-id="15ad6-174">Dans ce cas, il est important de définir une limite précise entre ces systèmes externes et l’application.</span><span class="sxs-lookup"><span data-stu-id="15ad6-174">In that case, it's important to have a well-defined boundary between these external systems and the application.</span></span> <span data-ttu-id="15ad6-175">Ici, vous pouvez envisager le recours au [modèle d’étranglement](../patterns/strangler.md) ou au [modèle de couche de lutte contre la corruption](../patterns/anti-corruption-layer.md).</span><span class="sxs-lookup"><span data-stu-id="15ad6-175">Consider using the [Strangler Pattern](../patterns/strangler.md) or the [Anti-Corruption Layer Pattern](../patterns/anti-corruption-layer.md) for this purpose.</span></span>

## <a name="define-bounded-contexts"></a><span data-ttu-id="15ad6-176">Définir les limites de contexte</span><span class="sxs-lookup"><span data-stu-id="15ad6-176">Define bounded contexts</span></span>

<span data-ttu-id="15ad6-177">Le modèle de domaine comprend des représentations des composantes réelles (utilisateurs, drones, colis, etc.).</span><span class="sxs-lookup"><span data-stu-id="15ad6-177">The domain model will include representations of real things in the world &mdash; users, drones, packages, and so forth.</span></span> <span data-ttu-id="15ad6-178">Cela ne signifie pas pour autant que chacune des portions du système doive utiliser la même représentation pour une composante donnée.</span><span class="sxs-lookup"><span data-stu-id="15ad6-178">But that doesn't mean that every part of the system needs to use the same representations for the same things.</span></span> 

<span data-ttu-id="15ad6-179">Par exemple, les sous-systèmes dédiés à la réparation des drones et à l’analyse prédictive doivent représenter de nombreuses caractéristiques physiques des drones, comme l’historique de maintenance, le kilométrage, l’âge, le numéro de modèle, les caractéristiques de performance, etc.</span><span class="sxs-lookup"><span data-stu-id="15ad6-179">For example, subsystems that handle drone repair and predictive analysis will need to represent many physical characteristics drones, such as their maintenance history, mileage, age, model number, performance characteristics, and so on.</span></span> <span data-ttu-id="15ad6-180">Toutefois, lors de la planification d’une livraison, ces éléments importent peu.</span><span class="sxs-lookup"><span data-stu-id="15ad6-180">But when it's time to schedule a delivery, we don't care about those things.</span></span> <span data-ttu-id="15ad6-181">Le sous-système de planification doit simplement connaître la disponibilité des drones, ainsi que les horaires prévus de collecte et de livraison.</span><span class="sxs-lookup"><span data-stu-id="15ad6-181">The scheduling subsystem only needs to know whether a drone is available, and the ETA for pickup and delivery.</span></span> 

<span data-ttu-id="15ad6-182">Si nous essayions de développer un modèle unique pour chacun de ces sous-systèmes, cela pourrait s’avérer inutilement complexe.</span><span class="sxs-lookup"><span data-stu-id="15ad6-182">If we tried to create a single model for both of these subsystems, it would be unnecessarily complex.</span></span> <span data-ttu-id="15ad6-183">Par ailleurs, l’évolution au fil du temps du modèle serait ralentie, dans la mesure où les modifications devraient être validées par plusieurs équipes travaillant sur des sous-systèmes séparés.</span><span class="sxs-lookup"><span data-stu-id="15ad6-183">It would also become harder for the model to evolve over time, because any changes will need to satisfy multiple teams working on separate subsystems.</span></span> <span data-ttu-id="15ad6-184">Par conséquent, il est souvent préférable de concevoir des modèles séparés qui représentent la même entité réelle (dans ce cas, un drone) dans deux contextes différents.</span><span class="sxs-lookup"><span data-stu-id="15ad6-184">Therefore, it's often better to design separate models that represent the same real-world entity (in this case, a drone) in two different contexts.</span></span> <span data-ttu-id="15ad6-185">Chaque modèle comporte les fonctions et attributs qui sont nécessaires au sein du contexte considéré.</span><span class="sxs-lookup"><span data-stu-id="15ad6-185">Each model contains only the features and attributes that are relevant within its particular context.</span></span>

<span data-ttu-id="15ad6-186">C’est là que le concept de *limites de contexte* de la conception pilotée par domaine entre en jeu.</span><span class="sxs-lookup"><span data-stu-id="15ad6-186">This is where the DDD concept of *bounded contexts* comes into play.</span></span> <span data-ttu-id="15ad6-187">Une limite de contexte correspond tout simplement au périmètre, au sein d’un domaine, dans lequel s’applique un modèle de domaine particulier.</span><span class="sxs-lookup"><span data-stu-id="15ad6-187">A bounded context is simply the boundary within a domain where a particular domain model applies.</span></span> <span data-ttu-id="15ad6-188">En considérant le schéma précédent, nous pouvons rassembler les fonctionnalités par modèle de domaine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-188">Looking at the previous diagram, we can group functionality according to whether various functions will share a single domain model.</span></span> 

![](./images/ddd2.svg) 
 
<span data-ttu-id="15ad6-189">Les limites de contexte ne sont pas forcément isolées les unes des autres.</span><span class="sxs-lookup"><span data-stu-id="15ad6-189">Bounded contexts are not necessarily isolated from one another.</span></span> <span data-ttu-id="15ad6-190">Dans ce schéma, les lignes pleines reliant les limites de contexte représentent les points d’interaction entre deux limites de contexte.</span><span class="sxs-lookup"><span data-stu-id="15ad6-190">In this diagram, the solid lines connecting the bounded contexts represent places where two bounded contexts interact.</span></span> <span data-ttu-id="15ad6-191">Par exemple, l’Expédition dépend des Comptes utilisateur au niveau de la collecte des informations sur les clients, et de la Gestion des drones en matière de sollicitation des drones disponibles de la flotte.</span><span class="sxs-lookup"><span data-stu-id="15ad6-191">For example, Shipping depends on User Accounts to get information about customers, and on Drone Management to schedule drones from the fleet.</span></span>

<span data-ttu-id="15ad6-192">Dans son ouvrage *Domain Driven Design* (Conception pilotée par domaine), Eric Evans décrit plusieurs approches utilisées pour maintenir l’intégrité d’un modèle de domaine interagissant avec une autre limite de contexte.</span><span class="sxs-lookup"><span data-stu-id="15ad6-192">In the book *Domain Driven Design*, Eric Evans describes several patterns for maintaining the integrity of a domain model when it interacts with another bounded context.</span></span> <span data-ttu-id="15ad6-193">L’un des principes fondamentaux des microservices concerne la communication des services, qui s’effectue via des API précisément définies.</span><span class="sxs-lookup"><span data-stu-id="15ad6-193">One of the main principles of microservices is that services communicate through well-defined APIs.</span></span> <span data-ttu-id="15ad6-194">Cette approche correspond à deux modèles que M. Evans appelle Open Host Service (Service hôte ouvert) et Published Language (Langage publié).</span><span class="sxs-lookup"><span data-stu-id="15ad6-194">This approach corresponds to two patterns that Evans calls Open Host Service and Published Language.</span></span> <span data-ttu-id="15ad6-195">L’idée derrière le Service hôte ouvert, c’est qu’un sous-système définit un protocole formel (API) valorisé par les autres sous-systèmes souhaitant communiquer avec lui.</span><span class="sxs-lookup"><span data-stu-id="15ad6-195">The idea of Open Host Service is that a subsystem defines a formal protocol (API) for other subsystems to communicate with it.</span></span> <span data-ttu-id="15ad6-196">Le modèle de Langage publié prolonge cette philosophie. Il consiste en la publication de l’API dans une forme que d’autres équipes peuvent utiliser pour écrire aux clients.</span><span class="sxs-lookup"><span data-stu-id="15ad6-196">Published Language extends this idea by publishing the API in a form that other teams can use to write clients.</span></span> <span data-ttu-id="15ad6-197">Dans le chapitre sur la [Conception d’API](./api-design.md), nous évoquons l’utilisation de la [Spécification OpenAPI](https://www.openapis.org/specification/repo) (auparavant connue en tant que Swagger) pour définir les descriptions d’interface indépendantes du langage pour les API REST, exprimées au format JSON ou YAML.</span><span class="sxs-lookup"><span data-stu-id="15ad6-197">In the chapter on [API Design](./api-design.md), we discuss using [OpenAPI Specification](https://www.openapis.org/specification/repo) (formerly known as Swagger) to define language-agnostic interface descriptions for REST APIs, expressed in JSON or YAML format.</span></span>

<span data-ttu-id="15ad6-198">Pour le reste de cette activité, nous nous intéresserons à la limite de contexte Expédition.</span><span class="sxs-lookup"><span data-stu-id="15ad6-198">For the rest of this journey, we will focus on the Shipping bounded context.</span></span> 

## <a name="tactical-ddd"></a><span data-ttu-id="15ad6-199">Phase tactique de la conception pilotée par domaine</span><span class="sxs-lookup"><span data-stu-id="15ad6-199">Tactical DDD</span></span>

<span data-ttu-id="15ad6-200">Pendant la phase stratégique de la conception, vous mappez le domaine d’entreprise et définissez les limites de contexte de vos modèles de domaine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-200">During the strategic phase of DDD, you are mapping out the business domain and defining bounded contexts for your domain models.</span></span> <span data-ttu-id="15ad6-201">La phase tactique consiste à définir vos modèles de domaine avec davantage de précision.</span><span class="sxs-lookup"><span data-stu-id="15ad6-201">Tactical DDD is when you define your domain models with more precision.</span></span> <span data-ttu-id="15ad6-202">Les modèles tactiques sont appliqués au sein d’une seule limite de contexte.</span><span class="sxs-lookup"><span data-stu-id="15ad6-202">The tactical patterns are applied within a single bounded context.</span></span> <span data-ttu-id="15ad6-203">Au sein d’une architecture de microservices, nous nous intéressons particulièrement aux modèles d’entités et d’agrégats.</span><span class="sxs-lookup"><span data-stu-id="15ad6-203">In a microservices architecture, we are particularly interested in the entity and aggregate patterns.</span></span> <span data-ttu-id="15ad6-204">En appliquant ces modèles, nous nous donnons les moyens d’identifier les limites naturelles des services au sein de notre application (voir le [chapitre suivant](./microservice-boundaries.md)).</span><span class="sxs-lookup"><span data-stu-id="15ad6-204">Applying these patterns will help us to identify natural boundaries for the services in our application (see [next chapter](./microservice-boundaries.md)).</span></span> <span data-ttu-id="15ad6-205">En règle générale, un microservice doit être plus petit qu’un agrégat, et pas plus grand qu’une limite de contexte.</span><span class="sxs-lookup"><span data-stu-id="15ad6-205">As a general principle, a microservice should be no smaller than an aggregate, and no larger than a bounded context.</span></span> <span data-ttu-id="15ad6-206">Nous allons dans un premier temps examiner les modèles tactiques.</span><span class="sxs-lookup"><span data-stu-id="15ad6-206">First, we'll review the tactical patterns.</span></span> <span data-ttu-id="15ad6-207">Ensuite, nous les appliquerons à la limite du contexte Expédition dans l’application Drone Delivery.</span><span class="sxs-lookup"><span data-stu-id="15ad6-207">Then we'll apply them to the Shipping bounded context in the Drone Delivery application.</span></span> 

### <a name="overview-of-the-tactical-patterns"></a><span data-ttu-id="15ad6-208">Vue d’ensemble des modèles tactiques</span><span class="sxs-lookup"><span data-stu-id="15ad6-208">Overview of the tactical patterns</span></span>

<span data-ttu-id="15ad6-209">Cette section propose une brève synthèse des modèles tactiques de la conception pilotée par domaine. Aussi, si vous maîtrisez bien cette solution, vous pouvez passer cette section.</span><span class="sxs-lookup"><span data-stu-id="15ad6-209">This section provides a brief summary of the tactical DDD patterns, so if you are already familiar with DDD, you can probably skip this section.</span></span> <span data-ttu-id="15ad6-210">Les modèles sont décrits en détail dans les chapitres 5 &ndash; 6 de l’ouvrage d’Eric Evans, et dans le livre *Implementing Domain-Driven Design* (Implémentation de la conception pilotée par domaine) de Vaughn Vernon.</span><span class="sxs-lookup"><span data-stu-id="15ad6-210">The patterns are described in more detail in chapters 5 &ndash; 6 of Eric Evans' book, and in *Implementing Domain-Driven Design* by Vaughn Vernon.</span></span> 

![](./images/ddd-patterns.png)

<span data-ttu-id="15ad6-211">**Entités**.</span><span class="sxs-lookup"><span data-stu-id="15ad6-211">**Entities**.</span></span> <span data-ttu-id="15ad6-212">Une entité est un objet présentant une identité unique et permanente.</span><span class="sxs-lookup"><span data-stu-id="15ad6-212">An entity is an object with a unique identity that persists over time.</span></span> <span data-ttu-id="15ad6-213">Par exemple, dans une application bancaire, les clients et les comptes sont des entités.</span><span class="sxs-lookup"><span data-stu-id="15ad6-213">For example, in a banking application, customers and accounts would be entities.</span></span> 

- <span data-ttu-id="15ad6-214">Une entité présente un identifiant unique dans le système, pouvant être utilisé pour la rechercher ou la récupérer.</span><span class="sxs-lookup"><span data-stu-id="15ad6-214">An entity has a unique identifier in the system, which can be used to look up or retrieve the entity.</span></span> <span data-ttu-id="15ad6-215">Cela ne signifie pas que les identifiants sont toujours exposés directement aux utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="15ad6-215">That doesn't mean the identifier is always exposed directly to users.</span></span> <span data-ttu-id="15ad6-216">Il peut s’agit d’un GUID ou de la clé primaire dans une base de données.</span><span class="sxs-lookup"><span data-stu-id="15ad6-216">It could be a GUID or a primary key in a database.</span></span> 
- <span data-ttu-id="15ad6-217">Une identité peut être associée à plusieurs limites de contexte et persister au-delà de la durée de vie de l’application.</span><span class="sxs-lookup"><span data-stu-id="15ad6-217">An identity may span multiple bounded contexts, and may endure beyond the lifetime of the application.</span></span> <span data-ttu-id="15ad6-218">Par exemple, les numéros de comptes bancaires ou les numéros d’identification nationaux n’arrivent pas à expiration à la disparition d’une application spécifique.</span><span class="sxs-lookup"><span data-stu-id="15ad6-218">For example, bank account numbers or government-issued IDs are not tied to the lifetime of a particular application.</span></span>
- <span data-ttu-id="15ad6-219">Les attributs d’une entité peuvent évoluer au cours du temps.</span><span class="sxs-lookup"><span data-stu-id="15ad6-219">The attributes of an entity may change over time.</span></span> <span data-ttu-id="15ad6-220">Par exemple, le nom ou l’adresse d’une personne peuvent évoluer.</span><span class="sxs-lookup"><span data-stu-id="15ad6-220">For example, a person's name or address might change, but they are still the same person.</span></span> 
- <span data-ttu-id="15ad6-221">Une entité peut comporter des références à d’autres entités.</span><span class="sxs-lookup"><span data-stu-id="15ad6-221">An entity can hold references to other entities.</span></span>
 
<span data-ttu-id="15ad6-222">**Objets de valeur**.</span><span class="sxs-lookup"><span data-stu-id="15ad6-222">**Value objects**.</span></span> <span data-ttu-id="15ad6-223">Un objet de valeur n’a aucune identité.</span><span class="sxs-lookup"><span data-stu-id="15ad6-223">A value object has no identity.</span></span> <span data-ttu-id="15ad6-224">Il est défini uniquement par les valeurs de ses attributs.</span><span class="sxs-lookup"><span data-stu-id="15ad6-224">It is defined only by the values of its attributes.</span></span> <span data-ttu-id="15ad6-225">Les objets de valeur sont également immuables.</span><span class="sxs-lookup"><span data-stu-id="15ad6-225">Value objects are also immutable.</span></span> <span data-ttu-id="15ad6-226">Pour modifier un objet de valeur, vous devez toujours créer une nouvelle instance de remplacement.</span><span class="sxs-lookup"><span data-stu-id="15ad6-226">To update a value object, you always create a new instance to replace the old one.</span></span> <span data-ttu-id="15ad6-227">Les objets de valeur peuvent comporter des méthodes encapsulant la logique du domaine. Toutefois, ces méthodes ne doivent avoir aucun effet sur l’état de l’objet.</span><span class="sxs-lookup"><span data-stu-id="15ad6-227">Value objects can have methods that encapsulate domain logic, but those methods should have no side-effects on the object's state.</span></span> <span data-ttu-id="15ad6-228">Comme exemples typiques des objets de valeur, citons les couleurs, les dates et les heures, ainsi que les valeurs de devise.</span><span class="sxs-lookup"><span data-stu-id="15ad6-228">Typical examples of value objects include colors, dates and times, and currency values.</span></span> 

<span data-ttu-id="15ad6-229">**Agrégats**.</span><span class="sxs-lookup"><span data-stu-id="15ad6-229">**Aggregates**.</span></span> <span data-ttu-id="15ad6-230">Un agrégat définit la limite de cohérence autour d’une ou plusieurs entités.</span><span class="sxs-lookup"><span data-stu-id="15ad6-230">An aggregate defines a consistency boundary around one or more entities.</span></span> <span data-ttu-id="15ad6-231">Une seule des entités d’un agrégat est la racine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-231">Exactly one entity in an aggregate is the root.</span></span> <span data-ttu-id="15ad6-232">La recherche s’effectue à l’aide de l’identifiant de l’entité racine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-232">Lookup is done using the root entity's identifier.</span></span> <span data-ttu-id="15ad6-233">Toutes les autres entités de l’agrégat sont des enfants de la racine ; elles sont référencées en suivant les pointeurs de la racine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-233">Any other entities in the aggregate are children of the root, and are referenced by following pointers from the root.</span></span> 

<span data-ttu-id="15ad6-234">La finalité d’un agrégat est de modéliser les éléments transactionnels invariants.</span><span class="sxs-lookup"><span data-stu-id="15ad6-234">The purpose of an aggregate is to model transactional invariants.</span></span> <span data-ttu-id="15ad6-235">Les composantes du monde réel présentent des réseaux complexes de relations.</span><span class="sxs-lookup"><span data-stu-id="15ad6-235">Things in the real world have complex webs of relationships.</span></span> <span data-ttu-id="15ad6-236">Les clients créent des commandes, les commandes contiennent des produits, les produits ont des fournisseurs, etc.</span><span class="sxs-lookup"><span data-stu-id="15ad6-236">Customers create orders, orders contain products, products have suppliers, and so on.</span></span> <span data-ttu-id="15ad6-237">Si l’application modifie plusieurs objets connexes, comment garantit-elle la cohérence ?</span><span class="sxs-lookup"><span data-stu-id="15ad6-237">If the application modifies several related objects, how does it guarantee consistency?</span></span> <span data-ttu-id="15ad6-238">Comment effectuer le suivi des éléments invariants ? Comment les appliquer ?</span><span class="sxs-lookup"><span data-stu-id="15ad6-238">How do we keep track of invariants and enforce them?</span></span>  

<span data-ttu-id="15ad6-239">Les applications traditionnelles ont bien souvent valorisé les transactions de base de données pour garantir les principes de cohérence.</span><span class="sxs-lookup"><span data-stu-id="15ad6-239">Traditional applications have often used database transactions to enforce consistency.</span></span> <span data-ttu-id="15ad6-240">Dans une application distribuée, toutefois, ce n’est pas toujours possible.</span><span class="sxs-lookup"><span data-stu-id="15ad6-240">In a distributed application, however, that's often not feasible.</span></span> <span data-ttu-id="15ad6-241">Une seule transaction commerciale peut être associée à plusieurs magasins de données, peut être à long terme ou encore impliquer le recours à des services tiers.</span><span class="sxs-lookup"><span data-stu-id="15ad6-241">A single business transaction may span multiple data stores, or may be long running, or may involve third-party services.</span></span> <span data-ttu-id="15ad6-242">Finalement, c’est à l’application, non à la couche de données, d’appliquer les éléments invariants requis pour le domaine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-242">Ultimately it's up to the application, not the data layer, to enforce the invariants required for the domain.</span></span> <span data-ttu-id="15ad6-243">C’est ce que les agrégats ont vocation à modéliser.</span><span class="sxs-lookup"><span data-stu-id="15ad6-243">That's what aggregates are meant to model.</span></span>

> [!NOTE]
> <span data-ttu-id="15ad6-244">Un agrégat peut être constitué d’une entité unique, sans entité enfant.</span><span class="sxs-lookup"><span data-stu-id="15ad6-244">An aggregate might consist of a single entity, without child entities.</span></span> <span data-ttu-id="15ad6-245">Il s’agit d’un agrégat parce qu’une limite transactionnelle est identifiée.</span><span class="sxs-lookup"><span data-stu-id="15ad6-245">What makes it an aggregate is the transactional boundary.</span></span>

<span data-ttu-id="15ad6-246">**Services de domaine et d’application**.</span><span class="sxs-lookup"><span data-stu-id="15ad6-246">**Domain and application services**.</span></span> <span data-ttu-id="15ad6-247">Dans la terminologie de la conception pilotée par domaine, un service est un objet implémentant une certaine logique sans avoir aucun effet sur l’état.</span><span class="sxs-lookup"><span data-stu-id="15ad6-247">In DDD terminology, a service is an object that implements some logic without holding any state.</span></span> <span data-ttu-id="15ad6-248">Evans fait la différence entre les *services de domaine*, qui encapsulent la logique du domaine, et les *services d’application*, qui offrent une fonctionnalité technique, comme l’authentification utilisateur ou l’envoi d’un message SMS.</span><span class="sxs-lookup"><span data-stu-id="15ad6-248">Evans distinguishes between *domain services*, which encapsulate domain logic, and *application services*, which provide technical functionality, such as user authentication or sending an SMS message.</span></span> <span data-ttu-id="15ad6-249">Les services de domaine sont souvent utilisés pour modéliser un comportement valable sur plusieurs entités.</span><span class="sxs-lookup"><span data-stu-id="15ad6-249">Domain services are often used to model behavior that spans multiple entities.</span></span> 

> [!NOTE]
> <span data-ttu-id="15ad6-250">Le terme *service* présente plusieurs significations en développement logiciel.</span><span class="sxs-lookup"><span data-stu-id="15ad6-250">The term *service* is overloaded in software development.</span></span> <span data-ttu-id="15ad6-251">Ici, la définition n’est pas directement liée aux microservices.</span><span class="sxs-lookup"><span data-stu-id="15ad6-251">The definition here is not directly related to microservices.</span></span>

<span data-ttu-id="15ad6-252">**Événements de domaine**.</span><span class="sxs-lookup"><span data-stu-id="15ad6-252">**Domain events**.</span></span> <span data-ttu-id="15ad6-253">Les événements de domaine peuvent servir à communiquer des signalements à d’autres composantes du système.</span><span class="sxs-lookup"><span data-stu-id="15ad6-253">Domain events can be used to notify other parts of the system when something happens.</span></span> <span data-ttu-id="15ad6-254">Comme le nom le suggère, les événements de domaine sont liés au déroulé des opérations au sein du domaine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-254">As the name suggests, domain events should mean something within the domain.</span></span> <span data-ttu-id="15ad6-255">Par exemple, « un enregistrement a été inséré dans un tableau » n’est pas un événement de domaine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-255">For example, "a record was inserted into a table" is not a domain event.</span></span> <span data-ttu-id="15ad6-256">« Une livraison a été annulée » est un événement de domaine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-256">"A delivery was cancelled" is a domain event.</span></span> <span data-ttu-id="15ad6-257">Les événements de domaine sont particulièrement pertinents au sein d’une architecture de microservices.</span><span class="sxs-lookup"><span data-stu-id="15ad6-257">Domain events are especially relevant in a microservices architecture.</span></span> <span data-ttu-id="15ad6-258">Les microservices étant distribués sans partager de magasins de données, ils tirent parti des événements de domaine pour se coordonner entre eux.</span><span class="sxs-lookup"><span data-stu-id="15ad6-258">Because microservices are distributed and don't share data stores, domain events provide a way for microservices to coordinate with each other.</span></span> <span data-ttu-id="15ad6-259">Le chapitre [Communication interservice](./interservice-communication.md) évoque plus en détail la messagerie asynchrone.</span><span class="sxs-lookup"><span data-stu-id="15ad6-259">The chapter [Interservice communication](./interservice-communication.md) discusses asynchronous messaging in more detail.</span></span>
 
<span data-ttu-id="15ad6-260">Il existe plusieurs modèles de conception pilotée par domaine non répertoriés ici, comme les fabriques, les référentiels et les modules.</span><span class="sxs-lookup"><span data-stu-id="15ad6-260">There are a few other DDD patterns not listed here, including factories, repositories, and modules.</span></span> <span data-ttu-id="15ad6-261">Si ces modèles peuvent s’avérer utiles lors de l’implémentation d’un microservice, ils sont moins intéressants au moment de la conception des limites entre les microservices.</span><span class="sxs-lookup"><span data-stu-id="15ad6-261">These can be useful patterns for when you are implementing a microservice, but they are less relevant when designing the boundaries between microservice.</span></span>

## <a name="drone-delivery-applying-the-patterns"></a><span data-ttu-id="15ad6-262">Drone Delivery : Application des modèles</span><span class="sxs-lookup"><span data-stu-id="15ad6-262">Drone delivery: Applying the patterns</span></span>

<span data-ttu-id="15ad6-263">Nous allons commencer par les scénarios devant être pris en charge par la limite de contexte Expédition.</span><span class="sxs-lookup"><span data-stu-id="15ad6-263">We start with the scenarios that the Shipping bounded context must handle.</span></span>

- <span data-ttu-id="15ad6-264">Un client peut demander qu’un drone collecte des marchandises au sein d’une entreprise enregistrée auprès du service de livraison par drone.</span><span class="sxs-lookup"><span data-stu-id="15ad6-264">A customer can request a drone to pick up goods from a business that is registered with the drone delivery service.</span></span>
- <span data-ttu-id="15ad6-265">L’expéditeur génère une balise (un code-barres ou une carte RFID) qu’il place sur le colis.</span><span class="sxs-lookup"><span data-stu-id="15ad6-265">The sender generates a tag (barcode or RFID) to put on the package.</span></span> 
- <span data-ttu-id="15ad6-266">Un drone récupère le colis à l’emplacement source et le dépose à sa destination finale.</span><span class="sxs-lookup"><span data-stu-id="15ad6-266">A drone will pick up and deliver a package from the source location to the destination location.</span></span>
- <span data-ttu-id="15ad6-267">Lorsqu’un client planifie une livraison, le système communique un horaire prévu en fonction des données d’itinéraire, des conditions météorologiques et des données d’historique.</span><span class="sxs-lookup"><span data-stu-id="15ad6-267">When a customer schedules a delivery, the system provides an ETA based on route information, weather conditions, and historical data.</span></span> 
- <span data-ttu-id="15ad6-268">Lorsque le drone est en vol, un utilisateur peut effectuer le suivi de son parcours et s’informer de l’horaire prévu actualisé.</span><span class="sxs-lookup"><span data-stu-id="15ad6-268">When the drone is in flight, a user can track the current location and the latest ETA.</span></span> 
- <span data-ttu-id="15ad6-269">Jusqu’à ce que le drone collecte le colis, le client peut annuler une livraison.</span><span class="sxs-lookup"><span data-stu-id="15ad6-269">Until a drone has picked up the package, the customer can cancel a delivery.</span></span>
- <span data-ttu-id="15ad6-270">Le client est informé de la remise du colis.</span><span class="sxs-lookup"><span data-stu-id="15ad6-270">The customer is notified when the delivery is completed.</span></span>
- <span data-ttu-id="15ad6-271">L’expéditeur peut demander la confirmation de la livraison au client, sous la forme d’une signature par écrit ou par empreinte digitale.</span><span class="sxs-lookup"><span data-stu-id="15ad6-271">The sender can request delivery confirmation from the customer, in the form of a signature or finger print.</span></span>
- <span data-ttu-id="15ad6-272">Les utilisateurs peuvent rechercher l’historique d’une livraison effectuée.</span><span class="sxs-lookup"><span data-stu-id="15ad6-272">Users can look up the history of a completed delivery.</span></span>

<span data-ttu-id="15ad6-273">Pour ces scénarios, l’équipe de développement a identifié les **entités** suivantes.</span><span class="sxs-lookup"><span data-stu-id="15ad6-273">From these scenarios, the development team identified the following **entities**.</span></span>

- <span data-ttu-id="15ad6-274">Livraison</span><span class="sxs-lookup"><span data-stu-id="15ad6-274">Delivery</span></span>
- <span data-ttu-id="15ad6-275">Package</span><span class="sxs-lookup"><span data-stu-id="15ad6-275">Package</span></span>
- <span data-ttu-id="15ad6-276">Drone</span><span class="sxs-lookup"><span data-stu-id="15ad6-276">Drone</span></span>
- <span data-ttu-id="15ad6-277">Compte</span><span class="sxs-lookup"><span data-stu-id="15ad6-277">Account</span></span>
- <span data-ttu-id="15ad6-278">Confirmation</span><span class="sxs-lookup"><span data-stu-id="15ad6-278">Confirmation</span></span>
- <span data-ttu-id="15ad6-279">Notification</span><span class="sxs-lookup"><span data-stu-id="15ad6-279">Notification</span></span>
- <span data-ttu-id="15ad6-280">Tag</span><span class="sxs-lookup"><span data-stu-id="15ad6-280">Tag</span></span>

<span data-ttu-id="15ad6-281">Les quatre premiers éléments,associés à la livraison, au colis, au drone et au compte sont tous des **agrégats** représentant des limites de cohérence transactionnelles.</span><span class="sxs-lookup"><span data-stu-id="15ad6-281">The first four, Delivery, Package, Drone, and Account, are all **aggregates** that represent transactional consistency boundaries.</span></span> <span data-ttu-id="15ad6-282">Les confirmations et les notifications sont des entités enfants des livraisons, tandis que les balises sont des entités enfants des colis.</span><span class="sxs-lookup"><span data-stu-id="15ad6-282">Confirmations and Notifications are child entities of Deliveries, and Tags are child entities of Packages.</span></span> 

<span data-ttu-id="15ad6-283">Les **objets de valeur** de cette conception sont l’emplacement, l’horaire prévu, le poids du colis et la taille du colis.</span><span class="sxs-lookup"><span data-stu-id="15ad6-283">The **value objects** in this design include Location, ETA, PackageWeight, and PackageSize.</span></span> 

<span data-ttu-id="15ad6-284">À titre d’illustration, voici un diagramme UML de l’agrégat de livraison.</span><span class="sxs-lookup"><span data-stu-id="15ad6-284">To illustrate, here is a UML diagram of the Delivery aggregate.</span></span> <span data-ttu-id="15ad6-285">Notez qu’il comporte des références à d’autres agrégats, dont le compte, le colis et le drone.</span><span class="sxs-lookup"><span data-stu-id="15ad6-285">Notice that it holds references to other aggregates, including Account, Package, and Drone.</span></span>

![](./images/delivery-entity.png)

<span data-ttu-id="15ad6-286">Il existe deux événements de domaine :</span><span class="sxs-lookup"><span data-stu-id="15ad6-286">There are two domain events:</span></span>

- <span data-ttu-id="15ad6-287">Lorsqu’un drone est en vol, l’entité Drone transmet l’événement DroneStatus qui décrit l’emplacement du drone et son état (en vol, à terre).</span><span class="sxs-lookup"><span data-stu-id="15ad6-287">While a drone is in flight, the Drone entity sends DroneStatus events that describe the drone's location and status (in-flight, landed).</span></span>

- <span data-ttu-id="15ad6-288">L’entité de livraison transmet les événements DeliveryTracking à chaque changement d’étape de la livraison.</span><span class="sxs-lookup"><span data-stu-id="15ad6-288">The Delivery entity sends DeliveryTracking events whenever the stage of a delivery changes.</span></span> <span data-ttu-id="15ad6-289">Il peut par exemple s’agir d’une création de livraison, d’un report, d’une échéance proche ou d’une fin de mission (DeliveryCreated, DeliveryRescheduled, DeliveryHeadedToDropoff et DeliveryCompleted, respectivement).</span><span class="sxs-lookup"><span data-stu-id="15ad6-289">These include DeliveryCreated, DeliveryRescheduled, DeliveryHeadedToDropoff, and DeliveryCompleted.</span></span> 

<span data-ttu-id="15ad6-290">Notez que ces événements décrivent les éléments importants du modèle de domaine.</span><span class="sxs-lookup"><span data-stu-id="15ad6-290">Notice that these events describe things that are meaningful within the domain model.</span></span> <span data-ttu-id="15ad6-291">Ils ont trait à une situation au sein du domaine, et ne sont liés à aucune construction particulière de langage de programmation.</span><span class="sxs-lookup"><span data-stu-id="15ad6-291">They describe something about the domain, and aren't tied to a particular programming language construct.</span></span>

<span data-ttu-id="15ad6-292">L’équipe en charge du développement a identifié un domaine supplémentaire de fonctionnalités qui ne peut être pris en compte dans aucune des entités décrites jusqu’à présent.</span><span class="sxs-lookup"><span data-stu-id="15ad6-292">The development team identified one more area of functionality, which doesn't fit neatly into any of the entities described so far.</span></span> <span data-ttu-id="15ad6-293">Une partie du système doit coordonner l’ensemble des étapes associées à la planification et à la mise à jour d’une livraison.</span><span class="sxs-lookup"><span data-stu-id="15ad6-293">Some part of the system must coordinate all of the steps involved in scheduling or updating a delivery.</span></span> <span data-ttu-id="15ad6-294">En conséquence, l’équipe de développement a ajouté deux **services de domaine** à la livraison : un *Planificateur* en charge de la coordination des étapes et un *Superviseur* qui surveille l’état de chaque étape, afin de détecter les défaillances ou les échéances. Il s’agit d’une variante du [modèle de superviseur de l’agent planificateur](../patterns/scheduler-agent-supervisor.md).</span><span class="sxs-lookup"><span data-stu-id="15ad6-294">Therefore, the development team added two **domain services** to the design: a *Scheduler* that coordinates the steps, and a *Supervisor* that monitors the status of each step, in order to detect whether any steps have failed or timed out. This is a variation of the [Scheduler Agent Supervisor pattern](../patterns/scheduler-agent-supervisor.md).</span></span>

![](./images/drone-ddd.png)

> [!div class="nextstepaction"]
> [<span data-ttu-id="15ad6-295">Identification des limites de microservice</span><span class="sxs-lookup"><span data-stu-id="15ad6-295">Identifying microservice boundaries</span></span>](./microservice-boundaries.md)
