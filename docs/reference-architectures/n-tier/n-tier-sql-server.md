---
title: Application multiniveau avec SQL Server
description: Découvrez comment implémenter une architecture multiniveau dans Azure, pour la disponibilité, la sécurité, l’extensibilité et la facilité de gestion.
author: MikeWasson
ms.date: 06/23/2018
ms.openlocfilehash: 050ea9b3104a2dc9af4cdaad3b4540cd75434e9d
ms.sourcegitcommit: 767c8570d7ab85551c2686c095b39a56d813664b
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/24/2018
ms.locfileid: "36746670"
---
# <a name="n-tier-application-with-sql-server"></a><span data-ttu-id="d508b-103">Application multiniveau avec SQL Server</span><span class="sxs-lookup"><span data-stu-id="d508b-103">N-tier application with SQL Server</span></span>

<span data-ttu-id="d508b-104">Cette architecture de référence montre comment déployer des machines virtuelles et un réseau virtuel configuré pour une application multiniveau à l’aide de SQL Server sur Windows pour la couche Données.</span><span class="sxs-lookup"><span data-stu-id="d508b-104">This reference architecture shows how to deploy VMs and a virtual network configured for an N-tier application, using SQL Server on Windows for the data tier.</span></span> [<span data-ttu-id="d508b-105">**Déployez cette solution**.</span><span class="sxs-lookup"><span data-stu-id="d508b-105">**Deploy this solution**.</span></span>](#deploy-the-solution) 

<span data-ttu-id="d508b-106">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="d508b-106">![[0]][0]</span></span>

<span data-ttu-id="d508b-107">*Téléchargez un [fichier Visio][visio-download] de cette architecture.*</span><span class="sxs-lookup"><span data-stu-id="d508b-107">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="d508b-108">Architecture</span><span class="sxs-lookup"><span data-stu-id="d508b-108">Architecture</span></span> 

<span data-ttu-id="d508b-109">Elle comporte les composants suivants :</span><span class="sxs-lookup"><span data-stu-id="d508b-109">The architecture has the following components:</span></span>

* <span data-ttu-id="d508b-110">**Groupe de ressources.**</span><span class="sxs-lookup"><span data-stu-id="d508b-110">**Resource group.**</span></span> <span data-ttu-id="d508b-111">Les [groupes de ressources][resource-manager-overview] servent à regrouper des ressources afin de pouvoir les gérer en fonction de la durée de vie, du propriétaire ou d’autres critères.</span><span class="sxs-lookup"><span data-stu-id="d508b-111">[Resource groups][resource-manager-overview] are used to group resources so they can be managed by lifetime, owner, or other criteria.</span></span>

* <span data-ttu-id="d508b-112">**Réseau virtuel (VNet) et sous-réseaux.**</span><span class="sxs-lookup"><span data-stu-id="d508b-112">**Virtual network (VNet) and subnets.**</span></span> <span data-ttu-id="d508b-113">Chaque machine virtuelle Azure est déployée dans un réseau virtuel qui peut être segmenté en plusieurs sous-réseaux.</span><span class="sxs-lookup"><span data-stu-id="d508b-113">Every Azure VM is deployed into a VNet that can be segmented into multiple subnets.</span></span> <span data-ttu-id="d508b-114">Créez un sous-réseau distinct pour chaque niveau.</span><span class="sxs-lookup"><span data-stu-id="d508b-114">Create a separate subnet for each tier.</span></span> 

* <span data-ttu-id="d508b-115">**Groupes de sécurité réseau.**</span><span class="sxs-lookup"><span data-stu-id="d508b-115">**NSGs.**</span></span> <span data-ttu-id="d508b-116">Utilisez des [groupes de sécurité réseau][nsg] pour limiter le trafic réseau au sein du réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="d508b-116">Use [network security groups][nsg] (NSGs) to restrict network traffic within the VNet.</span></span> <span data-ttu-id="d508b-117">Par exemple, dans l’architecture à 3 niveaux illustrée ici, le niveau base de données n’accepte pas le trafic en provenance du frontend web, mais uniquement du niveau Business et du sous-réseau de gestion.</span><span class="sxs-lookup"><span data-stu-id="d508b-117">For example, in the 3-tier architecture shown here, the database tier does not accept traffic from the web front end, only from the business tier and the management subnet.</span></span>

* <span data-ttu-id="d508b-118">**Machines virtuelles**.</span><span class="sxs-lookup"><span data-stu-id="d508b-118">**Virtual machines**.</span></span> <span data-ttu-id="d508b-119">Pour obtenir des suggestions sur la configuration des machines virtuelles, consultez [Exécuter une machine virtuelle Windows sur Azure](./windows-vm.md) et [Exécuter une machine virtuelle Linux sur Azure](./linux-vm.md).</span><span class="sxs-lookup"><span data-stu-id="d508b-119">For recommendations on configuring VMs, see [Run a Windows VM on Azure](./windows-vm.md) and [Run a Linux VM on Azure](./linux-vm.md).</span></span>

* <span data-ttu-id="d508b-120">**Groupes à haute disponibilité.**</span><span class="sxs-lookup"><span data-stu-id="d508b-120">**Availability sets.**</span></span> <span data-ttu-id="d508b-121">Créez un [groupe à haute disponibilité][azure-availability-sets] pour chaque niveau et configurez au moins deux machines virtuelles dans chaque niveau.</span><span class="sxs-lookup"><span data-stu-id="d508b-121">Create an [availability set][azure-availability-sets] for each tier, and provision at least two VMs in each tier.</span></span> <span data-ttu-id="d508b-122">Cela rend les machines virtuelles éligibles pour un [niveau contrat de service (SLA)][vm-sla] plus élevé.</span><span class="sxs-lookup"><span data-stu-id="d508b-122">This makes the VMs eligible for a higher [service level agreement (SLA)][vm-sla] for VMs.</span></span> 

* <span data-ttu-id="d508b-123">**Groupe identique de machines virtuelles** (non affichée).</span><span class="sxs-lookup"><span data-stu-id="d508b-123">**VM scale set** (not shown).</span></span> <span data-ttu-id="d508b-124">Un [groupe identique de machines virtuelles][vmss] est une alternative à l’utilisation d’un groupe à haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="d508b-124">A [VM scale set][vmss] is an alternative to using an availability set.</span></span> <span data-ttu-id="d508b-125">Un groupe identique simplifie l’augmentation de taille des instances de la machine virtuelle dans un niveau, manuellement ou automatiquement à partir de règles prédéfinies.</span><span class="sxs-lookup"><span data-stu-id="d508b-125">A scale sets makes it easy to scale out the VMs in a tier, either manually or automatically based on predefined rules.</span></span>

* <span data-ttu-id="d508b-126">**Équilibreurs de charge Azure.**</span><span class="sxs-lookup"><span data-stu-id="d508b-126">**Azure Load balancers.**</span></span> <span data-ttu-id="d508b-127">Les [équilibreurs de charge][load-balancer] distribuent les demandes Internet entrantes aux instances de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="d508b-127">The [load balancers][load-balancer] distribute incoming Internet requests to the VM instances.</span></span> <span data-ttu-id="d508b-128">Utilisez un [équilibreur de charge public][load-balancer-external] pour distribuer le trafic Internet entrant vers le niveau Web et un [équilibreur de charge interne][load-balancer-internal] pour distribuer le trafic réseau du niveau Web vers le niveau Business.</span><span class="sxs-lookup"><span data-stu-id="d508b-128">Use a [public load balancer][load-balancer-external] to distribute incoming Internet traffic to the web tier, and an [internal load balancer][load-balancer-internal] to distribute network traffic from the web tier to the business tier.</span></span>

* <span data-ttu-id="d508b-129">**Adresse IP publique**.</span><span class="sxs-lookup"><span data-stu-id="d508b-129">**Public IP address**.</span></span> <span data-ttu-id="d508b-130">Une adresse IP publique est nécessaire pour que l’équilibreur de charge public puisse recevoir le trafic Internet.</span><span class="sxs-lookup"><span data-stu-id="d508b-130">A public IP address is needed for the public load balancer to receive Internet traffic.</span></span>

* <span data-ttu-id="d508b-131">**Serveur de rebond (jumpbox).**</span><span class="sxs-lookup"><span data-stu-id="d508b-131">**Jumpbox.**</span></span> <span data-ttu-id="d508b-132">Également appelée [hôte bastion].</span><span class="sxs-lookup"><span data-stu-id="d508b-132">Also called a [bastion host].</span></span> <span data-ttu-id="d508b-133">Machine virtuelle sécurisée sur le réseau, utilisée par les administrateurs pour se connecter aux autres machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="d508b-133">A secure VM on the network that administrators use to connect to the other VMs.</span></span> <span data-ttu-id="d508b-134">Le serveur de rebond a un groupe de sécurité réseau qui autorise le trafic distant provenant uniquement d’adresses IP publiques figurant sur une liste verte.</span><span class="sxs-lookup"><span data-stu-id="d508b-134">The jumpbox has an NSG that allows remote traffic only from public IP addresses on a safe list.</span></span> <span data-ttu-id="d508b-135">Le groupe de sécurité réseau doit autoriser le trafic RDP (Bureau à distance).</span><span class="sxs-lookup"><span data-stu-id="d508b-135">The NSG should permit remote desktop (RDP) traffic.</span></span>

* <span data-ttu-id="d508b-136">**Groupe de disponibilité SQL Server AlwaysOn.**</span><span class="sxs-lookup"><span data-stu-id="d508b-136">**SQL Server Always On Availability Group.**</span></span> <span data-ttu-id="d508b-137">Fournit une haute disponibilité du niveau Données, en activant la réplication et le basculement.</span><span class="sxs-lookup"><span data-stu-id="d508b-137">Provides high availability at the data tier, by enabling replication and failover.</span></span> <span data-ttu-id="d508b-138">Il utilise la technologie du WSFC (Cluster de basculement Windows Server) pour le basculement.</span><span class="sxs-lookup"><span data-stu-id="d508b-138">It uses Windows Server Failover Cluster (WSFC) technology for failover.</span></span>

* <span data-ttu-id="d508b-139">**Serveurs AD DS (Active Directory Domain Services)**.</span><span class="sxs-lookup"><span data-stu-id="d508b-139">**Active Directory Domain Services (AD DS) Servers**.</span></span> <span data-ttu-id="d508b-140">Les objets ordinateur pour le cluster de basculement et ses rôles en cluster associés sont créés dans AD DS (Active Directory Domain Services).</span><span class="sxs-lookup"><span data-stu-id="d508b-140">The computer objects for the failover cluster and its associated clustered roles are created in Active Directory Domain Services (AD DS).</span></span>

* <span data-ttu-id="d508b-141">**Témoin de cloud**.</span><span class="sxs-lookup"><span data-stu-id="d508b-141">**Cloud Witness**.</span></span> <span data-ttu-id="d508b-142">Un cluster de basculement nécessite plus de la moitié de ses nœuds pour fonctionner, on dit alors qu’il a un quorum.</span><span class="sxs-lookup"><span data-stu-id="d508b-142">A failover cluster requires more than half of its nodes to be running, which is known as having quorum.</span></span> <span data-ttu-id="d508b-143">Si le cluster possède seulement deux nœuds, une partition de réseau peut mener chaque nœud à penser qu’il est le nœud principal.</span><span class="sxs-lookup"><span data-stu-id="d508b-143">If the cluster has just two nodes, a network partition could cause each node to think it's the master node.</span></span> <span data-ttu-id="d508b-144">Dans ce cas, vous avez besoin d’un *témoin* pour arbitrer et établir le quorum.</span><span class="sxs-lookup"><span data-stu-id="d508b-144">In that case, you need a *witness* to break ties and establish quorum.</span></span> <span data-ttu-id="d508b-145">Un témoin est une ressource telle qu’un disque partagé qui peut arbitrer pour établir le quorum.</span><span class="sxs-lookup"><span data-stu-id="d508b-145">A witness is a resource such as a shared disk that can act as a tie breaker to establish quorum.</span></span> <span data-ttu-id="d508b-146">Le témoin de cloud est un type de témoin qui utilise le stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="d508b-146">Cloud Witness is a type of witness that uses Azure Blob Storage.</span></span> <span data-ttu-id="d508b-147">Pour en savoir plus sur le concept de quorum, consultez [Comprendre les quorums de cluster et de pool](/windows-server/storage/storage-spaces/understand-quorum).</span><span class="sxs-lookup"><span data-stu-id="d508b-147">To learn more about the concept of quorum, see [Understanding cluster and pool quorum](/windows-server/storage/storage-spaces/understand-quorum).</span></span> <span data-ttu-id="d508b-148">Pour plus d’informations sur les témoins de cloud, consultez [Déployer un témoin de cloud pour un cluster de basculement](/windows-server/failover-clustering/deploy-cloud-witness).</span><span class="sxs-lookup"><span data-stu-id="d508b-148">For more information about Cloud Witness, see [Deploy a Cloud Witness for a Failover Cluster](/windows-server/failover-clustering/deploy-cloud-witness).</span></span> 

* <span data-ttu-id="d508b-149">**Azure DNS**.</span><span class="sxs-lookup"><span data-stu-id="d508b-149">**Azure DNS**.</span></span> <span data-ttu-id="d508b-150">[Azure DNS][azure-dns] est un service d’hébergement pour les domaines DNS qui offre une résolution de noms à l’aide de l’infrastructure Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="d508b-150">[Azure DNS][azure-dns] is a hosting service for DNS domains, providing name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="d508b-151">En hébergeant vos domaines dans Azure, vous pouvez gérer vos enregistrements DNS avec les mêmes informations d’identification, les mêmes API, les mêmes outils et la même facturation que vos autres services Azure.</span><span class="sxs-lookup"><span data-stu-id="d508b-151">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>

## <a name="recommendations"></a><span data-ttu-id="d508b-152">Recommandations</span><span class="sxs-lookup"><span data-stu-id="d508b-152">Recommendations</span></span>

<span data-ttu-id="d508b-153">Vos exigences peuvent différer de celles de l’architecture décrite ici.</span><span class="sxs-lookup"><span data-stu-id="d508b-153">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="d508b-154">Utilisez ces recommandations comme point de départ.</span><span class="sxs-lookup"><span data-stu-id="d508b-154">Use these recommendations as a starting point.</span></span> 

### <a name="vnet--subnets"></a><span data-ttu-id="d508b-155">Réseau virtuel / sous-réseaux</span><span class="sxs-lookup"><span data-stu-id="d508b-155">VNet / Subnets</span></span>

<span data-ttu-id="d508b-156">Quand vous créez le réseau virtuel, déterminez le nombre d’adresses IP dont vos ressources sur chaque sous-réseau ont besoin.</span><span class="sxs-lookup"><span data-stu-id="d508b-156">When you create the VNet, determine how many IP addresses your resources in each subnet require.</span></span> <span data-ttu-id="d508b-157">Spécifiez un masque de sous-réseau et une plage d’adresses de réseau virtuel suffisamment large pour les adresse IP requises, à l’aide de la notation [CIDR].</span><span class="sxs-lookup"><span data-stu-id="d508b-157">Specify a subnet mask and a VNet address range large enough for the required IP addresses, using [CIDR] notation.</span></span> <span data-ttu-id="d508b-158">Utilisez un espace d’adressage qui se trouve dans les [blocs d’adresses IP privées][private-ip-space] standard, à savoir 10.0.0.0/8, 172.16.0.0/12 et 192.168.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="d508b-158">Use an address space that falls within the standard [private IP address blocks][private-ip-space], which are 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16.</span></span>

<span data-ttu-id="d508b-159">Choisissez une plage d’adresses qui ne chevauche pas votre réseau local, au cas où vous devriez configurer ultérieurement une passerelle entre le réseau virtuel et votre réseau local.</span><span class="sxs-lookup"><span data-stu-id="d508b-159">Choose an address range that does not overlap with your on-premises network, in case you need to set up a gateway between the VNet and your on-premise network later.</span></span> <span data-ttu-id="d508b-160">Une fois le réseau virtuel créé, vous ne pouvez plus modifier la plage d’adresses.</span><span class="sxs-lookup"><span data-stu-id="d508b-160">Once you create the VNet, you can't change the address range.</span></span>

<span data-ttu-id="d508b-161">Concevez les sous-réseaux en tenant compte des exigences en matière de sécurité et de fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="d508b-161">Design subnets with functionality and security requirements in mind.</span></span> <span data-ttu-id="d508b-162">Toutes les machines virtuelles du même niveau ou rôle doivent être placées sur le même sous-réseau, qui peut constituer une limite de sécurité.</span><span class="sxs-lookup"><span data-stu-id="d508b-162">All VMs within the same tier or role should go into the same subnet, which can be a security boundary.</span></span> <span data-ttu-id="d508b-163">Pour plus d’informations sur la conception des réseaux virtuels et des sous-réseaux, consultez [Planifier et concevoir des réseaux virtuels Azure][plan-network].</span><span class="sxs-lookup"><span data-stu-id="d508b-163">For more information about designing VNets and subnets, see [Plan and design Azure Virtual Networks][plan-network].</span></span>

### <a name="load-balancers"></a><span data-ttu-id="d508b-164">Équilibreurs de charge</span><span class="sxs-lookup"><span data-stu-id="d508b-164">Load balancers</span></span>

<span data-ttu-id="d508b-165">N’exposez pas les machines virtuelles directement à Internet. Attribuez plutôt à chaque machine virtuelle une adresse IP privée.</span><span class="sxs-lookup"><span data-stu-id="d508b-165">Do not expose the VMs directly to the Internet, but instead give each VM a private IP address.</span></span> <span data-ttu-id="d508b-166">Les clients se connectent à l’aide de l’adresse IP de l’équilibreur de charge public.</span><span class="sxs-lookup"><span data-stu-id="d508b-166">Clients connect using the IP address of the public load balancer.</span></span>

<span data-ttu-id="d508b-167">Définissez des règles d’équilibreur de charge pour diriger le trafic réseau vers les machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="d508b-167">Define load balancer rules to direct network traffic to the VMs.</span></span> <span data-ttu-id="d508b-168">Par exemple, pour activer le trafic HTTP, créez une règle qui mappe le port 80 de la configuration frontend au port 80 dans le pool d’adresses backend.</span><span class="sxs-lookup"><span data-stu-id="d508b-168">For example, to enable HTTP traffic, create a rule that maps port 80 from the front-end configuration to port 80 on the back-end address pool.</span></span> <span data-ttu-id="d508b-169">Quand un client envoie une requête HTTP au port 80, l’équilibreur de charge sélectionne une adresse IP backend en utilisant un [algorithme de hachage][load-balancer-hashing] qui inclut l’adresse IP source.</span><span class="sxs-lookup"><span data-stu-id="d508b-169">When a client sends an HTTP request to port 80, the load balancer selects a back-end IP address by using a [hashing algorithm][load-balancer-hashing] that includes the source IP address.</span></span> <span data-ttu-id="d508b-170">Ainsi, les requêtes des clients sont réparties entre toutes les machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="d508b-170">In that way, client requests are distributed across all the VMs.</span></span>

### <a name="network-security-groups"></a><span data-ttu-id="d508b-171">Groupes de sécurité réseau</span><span class="sxs-lookup"><span data-stu-id="d508b-171">Network security groups</span></span>

<span data-ttu-id="d508b-172">Utilisez des règles de groupe de sécurité réseau pour limiter le trafic entre les niveaux.</span><span class="sxs-lookup"><span data-stu-id="d508b-172">Use NSG rules to restrict traffic between tiers.</span></span> <span data-ttu-id="d508b-173">Par exemple, dans l’architecture à 3 niveaux ci-dessus, le niveau Web ne communique pas directement avec le niveau Base de données.</span><span class="sxs-lookup"><span data-stu-id="d508b-173">For example, in the 3-tier architecture shown above, the web tier does not communicate directly with the database tier.</span></span> <span data-ttu-id="d508b-174">Pour appliquer cette recommandation, le niveau Base de données doit bloquer le trafic entrant provenant du sous-réseau du niveau Web.</span><span class="sxs-lookup"><span data-stu-id="d508b-174">To enforce this, the database tier should block incoming traffic from the web tier subnet.</span></span>  

1. <span data-ttu-id="d508b-175">Interdisez tout le trafic entrant provenant du réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="d508b-175">Deny all inbound traffic from the VNet.</span></span> <span data-ttu-id="d508b-176">(Utilisez la balise `VIRTUAL_NETWORK` dans la règle.)</span><span class="sxs-lookup"><span data-stu-id="d508b-176">(Use the `VIRTUAL_NETWORK` tag in the rule.)</span></span> 
2. <span data-ttu-id="d508b-177">Autorisez le trafic entrant à partir du sous-réseau du niveau Business.</span><span class="sxs-lookup"><span data-stu-id="d508b-177">Allow inbound traffic from the business tier subnet.</span></span>  
3. <span data-ttu-id="d508b-178">Autorisez le trafic entrant à partir du sous-réseau du niveau Base de données.</span><span class="sxs-lookup"><span data-stu-id="d508b-178">Allow inbound traffic from the database tier subnet itself.</span></span> <span data-ttu-id="d508b-179">Cette règle autorise la communication entre les machines virtuelles de la base de données, qui est nécessaire pour la réplication de base de données et le basculement.</span><span class="sxs-lookup"><span data-stu-id="d508b-179">This rule allows communication between the database VMs, which is needed for database replication and failover.</span></span>
4. <span data-ttu-id="d508b-180">Autorisez le trafic RDP (port 3389) à partir du sous-réseau du serveur de rebond.</span><span class="sxs-lookup"><span data-stu-id="d508b-180">Allow RDP traffic (port 3389) from the jumpbox subnet.</span></span> <span data-ttu-id="d508b-181">Cette règle permet aux administrateurs de se connecter au niveau Base de données à partir du serveur de rebond.</span><span class="sxs-lookup"><span data-stu-id="d508b-181">This rule lets administrators connect to the database tier from the jumpbox.</span></span>

<span data-ttu-id="d508b-182">Créer des règles de 2 &ndash; 4 avec une priorité plus élevée que la première règle, afin qu’elles la remplacent.</span><span class="sxs-lookup"><span data-stu-id="d508b-182">Create rules 2 &ndash; 4 with higher priority than the first rule, so they override it.</span></span>


### <a name="sql-server-always-on-availability-groups"></a><span data-ttu-id="d508b-183">Groupes de disponibilité SQL Server Always On</span><span class="sxs-lookup"><span data-stu-id="d508b-183">SQL Server Always On Availability Groups</span></span>

<span data-ttu-id="d508b-184">Nous vous recommandons d’utiliser des [groupes de disponibilité AlwaysOn][sql-alwayson] pour la haute disponibilité de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d508b-184">We recommend [Always On Availability Groups][sql-alwayson] for SQL Server high availability.</span></span> <span data-ttu-id="d508b-185">Avec les versions antérieures à Windows Server 2016, les groupes de disponibilité AlwaysOn nécessitent un contrôleur de domaine et tous les nœuds du groupe de disponibilité doivent être dans le même domaine Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d508b-185">Prior to Windows Server 2016, Always On Availability Groups require a domain controller, and all nodes in the availability group must be in the same AD domain.</span></span>

<span data-ttu-id="d508b-186">Les autres niveaux se connectent à la base de données par le biais d’un [écouteur de groupe de disponibilité][sql-alwayson-listeners].</span><span class="sxs-lookup"><span data-stu-id="d508b-186">Other tiers connect to the database through an [availability group listener][sql-alwayson-listeners].</span></span> <span data-ttu-id="d508b-187">L’écouteur permet à un client SQL de se connecter sans connaître le nom de l’instance physique de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d508b-187">The listener enables a SQL client to connect without knowing the name of the physical instance of SQL Server.</span></span> <span data-ttu-id="d508b-188">Les machines virtuelles qui accèdent à la base de données doivent être jointes au domaine.</span><span class="sxs-lookup"><span data-stu-id="d508b-188">VMs that access the database must be joined to the domain.</span></span> <span data-ttu-id="d508b-189">Le client (dans ce cas, un autre niveau) utilise le système DNS pour résoudre le nom du réseau virtuel de l’écouteur en adresses IP.</span><span class="sxs-lookup"><span data-stu-id="d508b-189">The client (in this case, another tier) uses DNS to resolve the listener's virtual network name into IP addresses.</span></span>

<span data-ttu-id="d508b-190">Configurez le groupe de disponibilité SQL Server AlwaysOn comme suit :</span><span class="sxs-lookup"><span data-stu-id="d508b-190">Configure the SQL Server Always On Availability Group as follows:</span></span>

1. <span data-ttu-id="d508b-191">Créez un cluster WSFC (clustering de basculement Windows Server), un groupe de disponibilité SQL Server AlwaysOn et un réplica principal.</span><span class="sxs-lookup"><span data-stu-id="d508b-191">Create a Windows Server Failover Clustering (WSFC) cluster, a SQL Server Always On Availability Group, and a primary replica.</span></span> <span data-ttu-id="d508b-192">Pour plus d’informations, consultez [Bien démarrer avec les groupes de disponibilité AlwaysOn][sql-alwayson-getting-started].</span><span class="sxs-lookup"><span data-stu-id="d508b-192">For more information, see [Getting Started with Always On Availability Groups][sql-alwayson-getting-started].</span></span> 
2. <span data-ttu-id="d508b-193">Créez un équilibreur de charge interne avec une adresse IP privée statique.</span><span class="sxs-lookup"><span data-stu-id="d508b-193">Create an internal load balancer with a static private IP address.</span></span>
3. <span data-ttu-id="d508b-194">Créez un écouteur de groupe de disponibilité et mappez le nom DNS de l’écouteur à l’adresse IP d’un équilibreur de charge interne.</span><span class="sxs-lookup"><span data-stu-id="d508b-194">Create an availability group listener, and map the listener's DNS name to the IP address of an internal load balancer.</span></span> 
4. <span data-ttu-id="d508b-195">Créez une règle d’équilibreur de charge pour le port d’écoute SQL Server (port TCP 1433 par défaut).</span><span class="sxs-lookup"><span data-stu-id="d508b-195">Create a load balancer rule for the SQL Server listening port (TCP port 1433 by default).</span></span> <span data-ttu-id="d508b-196">La règle d’équilibreur de charge doit activer *l’adresse IP flottante*, également appelé Retour direct du serveur.</span><span class="sxs-lookup"><span data-stu-id="d508b-196">The load balancer rule must enable *floating IP*, also called Direct Server Return.</span></span> <span data-ttu-id="d508b-197">Cela force la machine virtuelle à répondre directement au client, ce qui permet de bénéficier d’une connexion directe au réplica principal.</span><span class="sxs-lookup"><span data-stu-id="d508b-197">This causes the VM to reply directly to the client, which enables a direct connection to the primary replica.</span></span>
  
   > [!NOTE]
   > <span data-ttu-id="d508b-198">Quand l’adresse IP flottante est activée, le numéro de port frontend doit être identique au numéro de port backend dans la règle d’équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="d508b-198">When floating IP is enabled, the front-end port number must be the same as the back-end port number in the load balancer rule.</span></span>
   > 
   > 

<span data-ttu-id="d508b-199">Quand un client SQL tente de se connecter, l’équilibreur de charge achemine la demande de connexion au réplica principal.</span><span class="sxs-lookup"><span data-stu-id="d508b-199">When a SQL client tries to connect, the load balancer routes the connection request to the primary replica.</span></span> <span data-ttu-id="d508b-200">En cas de basculement vers un autre réplica, l’équilibreur de charge achemine automatiquement les demandes suivantes à un nouveau réplica principal.</span><span class="sxs-lookup"><span data-stu-id="d508b-200">If there is a failover to another replica, the load balancer automatically routes subsequent requests to a new primary replica.</span></span> <span data-ttu-id="d508b-201">Pour plus d’informations, consultez [Configurer un écouteur à équilibrage de charge interne pour des groupes de disponibilité SQL Server AlwaysOn][sql-alwayson-ilb].</span><span class="sxs-lookup"><span data-stu-id="d508b-201">For more information, see [Configure an ILB listener for SQL Server Always On Availability Groups][sql-alwayson-ilb].</span></span>

<span data-ttu-id="d508b-202">Lors d’un basculement, les connexions clientes existantes sont fermées.</span><span class="sxs-lookup"><span data-stu-id="d508b-202">During a failover, existing client connections are closed.</span></span> <span data-ttu-id="d508b-203">Une fois le basculement terminé, les nouvelles connexions sont acheminées vers le nouveau réplica principal.</span><span class="sxs-lookup"><span data-stu-id="d508b-203">After the failover completes, new connections will be routed to the new primary replica.</span></span>

<span data-ttu-id="d508b-204">Si votre application effectue beaucoup plus de lectures que d’écritures, vous pouvez décharger certaines des requêtes en lecture seule vers un réplica secondaire.</span><span class="sxs-lookup"><span data-stu-id="d508b-204">If your application makes significantly more reads than writes, you can offload some of the read-only queries to a secondary replica.</span></span> <span data-ttu-id="d508b-205">Voir [Utilisation d’un écouteur pour se connecter à un réplica secondaire en lecture seule (routage en lecture seule)][sql-alwayson-read-only-routing].</span><span class="sxs-lookup"><span data-stu-id="d508b-205">See [Using a Listener to Connect to a Read-Only Secondary Replica (Read-Only Routing)][sql-alwayson-read-only-routing].</span></span>

<span data-ttu-id="d508b-206">Testez votre déploiement en [forçant un basculement manuel][sql-alwayson-force-failover] du groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="d508b-206">Test your deployment by [forcing a manual failover][sql-alwayson-force-failover] of the availability group.</span></span>

### <a name="jumpbox"></a><span data-ttu-id="d508b-207">Serveur de rebond</span><span class="sxs-lookup"><span data-stu-id="d508b-207">Jumpbox</span></span>

<span data-ttu-id="d508b-208">N’autorisez pas l’accès RDP à partir de l’Internet public aux machines virtuelles qui exécutent la charge de travail d’application.</span><span class="sxs-lookup"><span data-stu-id="d508b-208">Do not allow RDP access from the public Internet to the VMs that run the application workload.</span></span> <span data-ttu-id="d508b-209">Au lieu de cela, tout l’accès RDP à ces machines virtuelles doit transiter par le serveur de rebond.</span><span class="sxs-lookup"><span data-stu-id="d508b-209">Instead, all RDP access to these VMs must come through the jumpbox.</span></span> <span data-ttu-id="d508b-210">Un administrateur se connecte au serveur de rebond, puis se connecte à l’autre machine virtuelle à partir du serveur de rebond.</span><span class="sxs-lookup"><span data-stu-id="d508b-210">An administrator logs into the jumpbox, and then logs into the other VM from the jumpbox.</span></span> <span data-ttu-id="d508b-211">Le serveur de rebond autorise le trafic SSH à partir d’Internet, mais uniquement à partir d’adresses IP connues et sûres.</span><span class="sxs-lookup"><span data-stu-id="d508b-211">The jumpbox allows RDP traffic from the Internet, but only from known, safe IP addresses.</span></span>

<span data-ttu-id="d508b-212">Le serveur de rebond a des exigences de performances minimales, donc sélectionnez une machine virtuelle de petite taille.</span><span class="sxs-lookup"><span data-stu-id="d508b-212">The jumpbox has minimal performance requirements, so select a small VM size.</span></span> <span data-ttu-id="d508b-213">Créez-lui une [adresse IP publique].</span><span class="sxs-lookup"><span data-stu-id="d508b-213">Create a [public IP address] for the jumpbox.</span></span> <span data-ttu-id="d508b-214">Placez-le sur le même réseau virtuel que les autres machines virtuelles, mais sur un sous-réseau de gestion distinct.</span><span class="sxs-lookup"><span data-stu-id="d508b-214">Place the jumpbox in the same VNet as the other VMs, but in a separate management subnet.</span></span>

<span data-ttu-id="d508b-215">Pour sécuriser le serveur de rebond, ajoutez une règle de groupe de sécurité réseau qui autorise les connexions RDP provenant uniquement d’un ensemble sûr d’adresses IP publiques.</span><span class="sxs-lookup"><span data-stu-id="d508b-215">To secure the jumpbox, add an NSG rule that allows RDP connections only from a safe set of public IP addresses.</span></span> <span data-ttu-id="d508b-216">Configurez les groupes de sécurité réseau pour les autres sous-réseaux de façon à autoriser le trafic RDP provenant du sous-réseau de gestion.</span><span class="sxs-lookup"><span data-stu-id="d508b-216">Configure the NSGs for the other subnets to allow RDP traffic from the management subnet.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="d508b-217">Considérations relatives à l’extensibilité</span><span class="sxs-lookup"><span data-stu-id="d508b-217">Scalability considerations</span></span>

<span data-ttu-id="d508b-218">[Les groupes de machines virtuelles identiques][vmss] vous aident à déployer et à gérer un ensemble de machines virtuelles identiques.</span><span class="sxs-lookup"><span data-stu-id="d508b-218">[VM scale sets][vmss] help you to deploy and manage a set of identical VMs.</span></span> <span data-ttu-id="d508b-219">Les groupes identiques prennent en charge la mise à l’échelle automatique basée sur des métriques de performances.</span><span class="sxs-lookup"><span data-stu-id="d508b-219">Scale sets support autoscaling based on performance metrics.</span></span> <span data-ttu-id="d508b-220">À mesure que la charge sur les machines virtuelles augmente, des machines virtuelles supplémentaires sont ajoutées automatiquement à l’équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="d508b-220">As the load on the VMs increases, additional VMs are automatically added to the load balancer.</span></span> <span data-ttu-id="d508b-221">Les groupes identiques sont parfaits si vous devez rapidement faire monter en puissance des machines virtuelles, ou si vous avez besoin d’une mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="d508b-221">Consider scale sets if you need to quickly scale out VMs, or need to autoscale.</span></span>

<span data-ttu-id="d508b-222">Il existe deux façons de configurer des machines virtuelles déployées dans un groupe identique :</span><span class="sxs-lookup"><span data-stu-id="d508b-222">There are two basic ways to configure VMs deployed in a scale set:</span></span>

- <span data-ttu-id="d508b-223">Utiliser des extensions pour configurer la machine virtuelle après son provisionnement.</span><span class="sxs-lookup"><span data-stu-id="d508b-223">Use extensions to configure the VM after it is provisioned.</span></span> <span data-ttu-id="d508b-224">Avec cette approche, le démarrage des nouvelles instances de machine virtuelle peut être plus long que pour une machine virtuelle sans extension.</span><span class="sxs-lookup"><span data-stu-id="d508b-224">With this approach, new VM instances may take longer to start up than a VM with no extensions.</span></span>

- <span data-ttu-id="d508b-225">Déployer un [disque managé](/azure/storage/storage-managed-disks-overview) avec une image de disque personnalisée.</span><span class="sxs-lookup"><span data-stu-id="d508b-225">Deploy a [managed disk](/azure/storage/storage-managed-disks-overview) with a custom disk image.</span></span> <span data-ttu-id="d508b-226">Cette option peut être plus rapide à déployer.</span><span class="sxs-lookup"><span data-stu-id="d508b-226">This option may be quicker to deploy.</span></span> <span data-ttu-id="d508b-227">Toutefois, elle vous oblige à tenir l’image à jour.</span><span class="sxs-lookup"><span data-stu-id="d508b-227">However, it requires you to keep the image up to date.</span></span>

<span data-ttu-id="d508b-228">Pour plus d’informations, consultez [Considérations relatives à la conception des groupes de machines virtuelles identiques][vmss-design].</span><span class="sxs-lookup"><span data-stu-id="d508b-228">For additional considerations, see [Design considerations for scale sets][vmss-design].</span></span>

> [!TIP]
> <span data-ttu-id="d508b-229">Quand vous utilisez une solution de mise à l’échelle automatique, testez-la bien à l’avance avec des charges de travail de niveau production.</span><span class="sxs-lookup"><span data-stu-id="d508b-229">When using any autoscale solution, test it with production-level workloads well in advance.</span></span>

<span data-ttu-id="d508b-230">Chaque abonnement Azure a des limites par défaut, notamment une quantité maximale de machines virtuelles par région.</span><span class="sxs-lookup"><span data-stu-id="d508b-230">Each Azure subscription has default limits in place, including a maximum number of VMs per region.</span></span> <span data-ttu-id="d508b-231">Vous pouvez augmenter la limite en créant une demande de support.</span><span class="sxs-lookup"><span data-stu-id="d508b-231">You can increase the limit by filing a support request.</span></span> <span data-ttu-id="d508b-232">Pour plus d’informations, consultez [Abonnement Azure et limites, quotas et contraintes de service][subscription-limits].</span><span class="sxs-lookup"><span data-stu-id="d508b-232">For more information, see [Azure subscription and service limits, quotas, and constraints][subscription-limits].</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="d508b-233">Considérations relatives à la disponibilité</span><span class="sxs-lookup"><span data-stu-id="d508b-233">Availability considerations</span></span>

<span data-ttu-id="d508b-234">Si vous n’utilisez pas de groupes identiques de machines virtuelles, placez les machines virtuelles dans le même niveau au sein d’un groupe à haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="d508b-234">If you are not using VM scale sets, put VMs in the same tier into an availability set.</span></span> <span data-ttu-id="d508b-235">Créez au moins deux machines virtuelles dans le groupe à haute disponibilité, afin de prendre en charge le [contrat SLA de disponibilité pour les machines virtuelles Azure][vm-sla].</span><span class="sxs-lookup"><span data-stu-id="d508b-235">Create at least two VMs in the availability set to support the [availability SLA for Azure VMs][vm-sla].</span></span> <span data-ttu-id="d508b-236">Pour plus d’informations, consultez [Gestion de la disponibilité des machines virtuelles][availability-set].</span><span class="sxs-lookup"><span data-stu-id="d508b-236">For more information, see [Manage the availability of virtual machines][availability-set].</span></span> 

<span data-ttu-id="d508b-237">L’équilibreur de charge utilise des [sondes d’intégrité][health-probes] pour surveiller la disponibilité des instances de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="d508b-237">The load balancer uses [health probes][health-probes] to monitor the availability of VM instances.</span></span> <span data-ttu-id="d508b-238">Si une sonde ne peut pas atteindre une instance dans le délai imparti, l’équilibreur de charge cesse d’envoyer le trafic vers cette machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="d508b-238">If a probe cannot reach an instance within a timeout period, the load balancer stops sending traffic to that VM.</span></span> <span data-ttu-id="d508b-239">Toutefois, il continue à sonder, et si la machine virtuelle redevient disponible il reprend l’envoi du trafic vers cette machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="d508b-239">However, the load balancer will continue to probe, and if the VM becomes available again, the load balancer resumes sending traffic to that VM.</span></span>

<span data-ttu-id="d508b-240">Voici quelques recommandations concernant les sondes d’intégrité d’équilibreur de charge :</span><span class="sxs-lookup"><span data-stu-id="d508b-240">Here are some recommendations on load balancer health probes:</span></span>

* <span data-ttu-id="d508b-241">Les sondes peuvent tester le protocole TCP ou HTTP.</span><span class="sxs-lookup"><span data-stu-id="d508b-241">Probes can test either HTTP or TCP.</span></span> <span data-ttu-id="d508b-242">Si vos machines virtuelles exécutent un serveur HTTP, créez une sonde HTTP.</span><span class="sxs-lookup"><span data-stu-id="d508b-242">If your VMs run an HTTP server, create an HTTP probe.</span></span> <span data-ttu-id="d508b-243">Sinon, créez une sonde TCP.</span><span class="sxs-lookup"><span data-stu-id="d508b-243">Otherwise create a TCP probe.</span></span>
* <span data-ttu-id="d508b-244">Pour une sonde HTTP, spécifiez le chemin d’un point de terminaison HTTP.</span><span class="sxs-lookup"><span data-stu-id="d508b-244">For an HTTP probe, specify the path to an HTTP endpoint.</span></span> <span data-ttu-id="d508b-245">La sonde vérifie la présence d’une réponse HTTP 200 à partir de ce chemin.</span><span class="sxs-lookup"><span data-stu-id="d508b-245">The probe checks for an HTTP 200 response from this path.</span></span> <span data-ttu-id="d508b-246">Il peut s’agir du chemin racine (« / ») ou d’un point de terminaison de surveillance de l’intégrité qui implémente une logique personnalisée afin de vérifier l’intégrité de l’application.</span><span class="sxs-lookup"><span data-stu-id="d508b-246">This can be the root path ("/"), or a health-monitoring endpoint that implements some custom logic to check the health of the application.</span></span> <span data-ttu-id="d508b-247">Le point de terminaison doit autoriser les requêtes HTTP anonymes.</span><span class="sxs-lookup"><span data-stu-id="d508b-247">The endpoint must allow anonymous HTTP requests.</span></span>
* <span data-ttu-id="d508b-248">La sonde est envoyée à partir d’une [adresse IP connue][health-probe-ip], 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="d508b-248">The probe is sent from a [known IP address][health-probe-ip], 168.63.129.16.</span></span> <span data-ttu-id="d508b-249">Veillez à ne bloquer le trafic vers ou à partir de cette adresse IP dans aucune stratégie de pare-feu ou règle de groupe de sécurité réseau.</span><span class="sxs-lookup"><span data-stu-id="d508b-249">Make sure you don't block traffic to or from this IP address in any firewall policies or network security group (NSG) rules.</span></span>
* <span data-ttu-id="d508b-250">Utilisez des [journaux de sonde d’intégrité][health-probe-log] pour afficher l’état des sondes d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="d508b-250">Use [health probe logs][health-probe-log] to view the status of the health probes.</span></span> <span data-ttu-id="d508b-251">Activez la journalisation dans le portail Azure pour chaque équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="d508b-251">Enable logging in the Azure portal for each load balancer.</span></span> <span data-ttu-id="d508b-252">Les journaux sont écrits dans le Stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="d508b-252">Logs are written to Azure Blob storage.</span></span> <span data-ttu-id="d508b-253">Ils indiquent combien de machines virtuelles du côté backend ne reçoivent pas de trafic réseau à cause d’échecs de réponses de sonde.</span><span class="sxs-lookup"><span data-stu-id="d508b-253">The logs show how many VMs on the back end are not receiving network traffic due to failed probe responses.</span></span>

<span data-ttu-id="d508b-254">Si vous avez besoin d’une plus grande disponibilité que celle offerte par le [contrat SLA Azure pour les machines virtuelles][vm-sla], envisagez la réplication de l’application dans deux régions en utilisant Azure Traffic Manager pour le basculement.</span><span class="sxs-lookup"><span data-stu-id="d508b-254">If you need higher availability than the [Azure SLA for VMs][vm-sla] provides, consider replication the application across two regions, using Azure Traffic Manager for failover.</span></span> <span data-ttu-id="d508b-255">Pour plus d’informations, consultez [Application multiniveau multirégion pour une haute disponibilité][multi-dc].</span><span class="sxs-lookup"><span data-stu-id="d508b-255">For more information, see [Multi-region N-tier application for high availability][multi-dc].</span></span>  

## <a name="security-considerations"></a><span data-ttu-id="d508b-256">Considérations relatives à la sécurité</span><span class="sxs-lookup"><span data-stu-id="d508b-256">Security considerations</span></span>

<span data-ttu-id="d508b-257">Les réseaux virtuels sont une limite d’isolation du trafic dans Azure.</span><span class="sxs-lookup"><span data-stu-id="d508b-257">Virtual networks are a traffic isolation boundary in Azure.</span></span> <span data-ttu-id="d508b-258">Les machines virtuelles d’un réseau virtuel ne peuvent pas communiquer directement avec celles d’un autre réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="d508b-258">VMs in one VNet cannot communicate directly with VMs in a different VNet.</span></span> <span data-ttu-id="d508b-259">Les machines virtuelles situées sur un même réseau virtuel peuvent communiquer, sauf si vous créez des [groupes de sécurité réseau][nsg] pour limiter le trafic.</span><span class="sxs-lookup"><span data-stu-id="d508b-259">VMs within the same VNet can communicate, unless you create [network security groups][nsg] (NSGs) to restrict traffic.</span></span> <span data-ttu-id="d508b-260">Pour plus d’informations, consultez [Services cloud Microsoft et sécurité réseau][network-security].</span><span class="sxs-lookup"><span data-stu-id="d508b-260">For more information, see [Microsoft cloud services and network security][network-security].</span></span>

<span data-ttu-id="d508b-261">Pour le trafic Internet entrant, les règles d’équilibreur de charge définissent le trafic qui peut atteindre le backend.</span><span class="sxs-lookup"><span data-stu-id="d508b-261">For incoming Internet traffic, the load balancer rules define which traffic can reach the back end.</span></span> <span data-ttu-id="d508b-262">Toutefois, les règles d’équilibreur de charge ne prennent pas en charge les listes de sécurité IP. Par conséquent, si vous souhaitez ajouter certaines adresses IP publiques à une liste verte, ajoutez un groupe de sécurité réseau au sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="d508b-262">However, load balancer rules don't support IP safe lists, so if you want to add certain public IP addresses to a safe list, add an NSG to the subnet.</span></span>

<span data-ttu-id="d508b-263">Ajoutez une appliance virtuelle réseau (NVA) pour créer un réseau de périmètre (DMZ) entre Internet et le réseau virtuel Azure.</span><span class="sxs-lookup"><span data-stu-id="d508b-263">Consider adding a network virtual appliance (NVA) to create a DMZ between the Internet and the Azure virtual network.</span></span> <span data-ttu-id="d508b-264">NVA est un terme générique décrivant une appliance virtuelle qui peut effectuer des tâches liées au réseau, telles que pare-feu, inspection des paquets, audit et routage personnalisé.</span><span class="sxs-lookup"><span data-stu-id="d508b-264">NVA is a generic term for a virtual appliance that can perform network-related tasks, such as firewall, packet inspection, auditing, and custom routing.</span></span> <span data-ttu-id="d508b-265">Pour plus d’informations, consultez [Implémentation d’une zone DMZ entre Azure et Internet][dmz].</span><span class="sxs-lookup"><span data-stu-id="d508b-265">For more information, see [Implementing a DMZ between Azure and the Internet][dmz].</span></span>

<span data-ttu-id="d508b-266">Chiffrez les données sensibles au repos et utilisez [Azure Key Vault][azure-key-vault] pour gérer les clés de chiffrement de base de données.</span><span class="sxs-lookup"><span data-stu-id="d508b-266">Encrypt sensitive data at rest and use [Azure Key Vault][azure-key-vault] to manage the database encryption keys.</span></span> <span data-ttu-id="d508b-267">Key Vault peut stocker des clés de chiffrement dans des modules de sécurité matériel (HSM).</span><span class="sxs-lookup"><span data-stu-id="d508b-267">Key Vault can store encryption keys in hardware security modules (HSMs).</span></span> <span data-ttu-id="d508b-268">Pour plus d’informations, consultez [Configurer l’intégration d’Azure Key Vault pour SQL Server sur des machines virtuelles Azure][sql-keyvault].</span><span class="sxs-lookup"><span data-stu-id="d508b-268">For more information, see [Configure Azure Key Vault Integration for SQL Server on Azure VMs][sql-keyvault].</span></span> <span data-ttu-id="d508b-269">Il est également recommandé pour stocker des secrets de l’application, comme des chaînes de connexion de base de données, dans le coffre de clés.</span><span class="sxs-lookup"><span data-stu-id="d508b-269">It's also recommended to store application secrets, such as database connection strings, in Key Vault.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="d508b-270">Déployer la solution</span><span class="sxs-lookup"><span data-stu-id="d508b-270">Deploy the solution</span></span>

<span data-ttu-id="d508b-271">Un déploiement pour cette architecture de référence est disponible sur [GitHub][github-folder].</span><span class="sxs-lookup"><span data-stu-id="d508b-271">A deployment for this reference architecture is available on [GitHub][github-folder].</span></span> <span data-ttu-id="d508b-272">Notez que la totalité du déploiement peut prendre jusqu'à deux heures, ce qui inclut l’exécution des scripts pour configurer AD DS, le cluster de basculement Windows Server et le groupe de disponibilité de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d508b-272">Note that the entire deployment can take up to two hours, which includes running the scripts to configure AD DS, the Windows Server failover cluster, and the SQL Server availability group.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="d508b-273">Prérequis</span><span class="sxs-lookup"><span data-stu-id="d508b-273">Prerequisites</span></span>

1. <span data-ttu-id="d508b-274">Clonez, dupliquez ou téléchargez le fichier zip pour le référentiel GitHub des [architectures de référence][ref-arch-repo].</span><span class="sxs-lookup"><span data-stu-id="d508b-274">Clone, fork, or download the zip file for the [reference architectures][ref-arch-repo] GitHub repository.</span></span>

2. <span data-ttu-id="d508b-275">Installez [Azure CLI 2.0][azure-cli-2].</span><span class="sxs-lookup"><span data-stu-id="d508b-275">Install [Azure CLI 2.0][azure-cli-2].</span></span>

3. <span data-ttu-id="d508b-276">Installez le package npm des [modules Azure][azbb].</span><span class="sxs-lookup"><span data-stu-id="d508b-276">Install the [Azure building blocks][azbb] npm package.</span></span>

   ```bash
   npm install -g @mspnp/azure-building-blocks
   ```

4. <span data-ttu-id="d508b-277">À partir d’une invite de commandes, d’une invite bash ou de l’invite de commandes PowerShell, connectez-vous à votre compte Azure à l’aide de la commande ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="d508b-277">From a command prompt, bash prompt, or PowerShell prompt, login to your Azure account by using the command below.</span></span>

   ```bash
   az login
   ```

### <a name="deploy-the-solution"></a><span data-ttu-id="d508b-278">Déployer la solution</span><span class="sxs-lookup"><span data-stu-id="d508b-278">Deploy the solution</span></span> 

1. <span data-ttu-id="d508b-279">Exécutez la commande suivante pour créer un groupe de ressources.</span><span class="sxs-lookup"><span data-stu-id="d508b-279">Run the following command to create a resource group.</span></span>

    ```bash
    az group create --location <location> --name <resource-group-name>
    ```

2. <span data-ttu-id="d508b-280">Exécutez la commande suivante pour créer un compte de stockage pour le témoin de cloud.</span><span class="sxs-lookup"><span data-stu-id="d508b-280">Run the following command to create a Storage account for the Cloud Witness.</span></span>

    ```bash
    az storage account create --location <location> \
      --name <storage-account-name> \
      --resource-group <resource-group-name> \
      --sku Standard_LRS
    ```

3. <span data-ttu-id="d508b-281">Accédez au dossier `virtual-machines\n-tier-windows` du référentiel GitHub des architectures de référence.</span><span class="sxs-lookup"><span data-stu-id="d508b-281">Navigate to the `virtual-machines\n-tier-windows` folder of the reference architectures GitHub repository.</span></span>

4. <span data-ttu-id="d508b-282">Ouvrez le fichier `n-tier-windows.json` .</span><span class="sxs-lookup"><span data-stu-id="d508b-282">Open the `n-tier-windows.json` file.</span></span> 

5. <span data-ttu-id="d508b-283">Recherchez toutes les instances de « witnessStorageBlobEndPoint » et remplacez le texte d’espace réservé par le nom du compte de stockage de l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="d508b-283">Search for all instances of "witnessStorageBlobEndPoint" and replace the placeholder text with the name of the Storage account from step 2.</span></span>

    ```json
    "witnessStorageBlobEndPoint": "https://[replace-with-storageaccountname].blob.core.windows.net",
    ```

6. <span data-ttu-id="d508b-284">Exécutez la commande suivante pour répertorier les clés de compte pour le compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="d508b-284">Run the following command to list the account keys for the storage account.</span></span>

    ```bash
    az storage account keys list \
      --account-name <storage-account-name> \
      --resource-group <resource-group-name>
    ```

    <span data-ttu-id="d508b-285">La sortie doit se présenter comme suit.</span><span class="sxs-lookup"><span data-stu-id="d508b-285">The output should look like the following.</span></span> <span data-ttu-id="d508b-286">Copiez la valeur de `key1`.</span><span class="sxs-lookup"><span data-stu-id="d508b-286">Copy the value of `key1`.</span></span>

    ```json
    [
    {
        "keyName": "key1",
        "permissions": "Full",
        "value": "..."
    },
    {
        "keyName": "key2",
        "permissions": "Full",
        "value": "..."
    }
    ]
    ```

7. <span data-ttu-id="d508b-287">Dans le fichier `n-tier-windows.json`, recherchez toutes les instances de « witnessStorageAccountKey » et collez la clé de compte.</span><span class="sxs-lookup"><span data-stu-id="d508b-287">In the `n-tier-windows.json` file, search for all instances of "witnessStorageAccountKey" and paste in the account key.</span></span>

    ```json
    "witnessStorageAccountKey": "[replace-with-storagekey]"
    ```

8. <span data-ttu-id="d508b-288">Dans le fichier `n-tier-windows.json`, recherchez toutes les instances de `testPassw0rd!23`, `test$!Passw0rd111` et `AweS0me@SQLServicePW`.</span><span class="sxs-lookup"><span data-stu-id="d508b-288">In the `n-tier-windows.json` file, search for all instances `testPassw0rd!23`, `test$!Passw0rd111`, and `AweS0me@SQLServicePW`.</span></span> <span data-ttu-id="d508b-289">Remplacez-les par vos propres mots de passe et enregistrez le fichier.</span><span class="sxs-lookup"><span data-stu-id="d508b-289">Replace them with your own passwords and save the file.</span></span>

    > [!NOTE]
    > <span data-ttu-id="d508b-290">Si vous modifiez le nom d’utilisateur de l’administrateur, vous devez également mettre à jour les blocs `extensions` dans le fichier JSON.</span><span class="sxs-lookup"><span data-stu-id="d508b-290">If you change the adminstrator user name, you must also update the `extensions` blocks in the JSON file.</span></span> 

9. <span data-ttu-id="d508b-291">Exécutez la commande suivante pour déployer l’architecture.</span><span class="sxs-lookup"><span data-stu-id="d508b-291">Run the following command to deploy the architecture.</span></span>

    ```bash
    azbb -s <your subscription_id> -g <resource_group_name> -l <location> -p n-tier-windows.json --deploy
    ```

<span data-ttu-id="d508b-292">Pour plus d’informations sur le déploiement de cet exemple d’architecture de référence à l’aide des blocs de construction Azure, visitez notre [référentiel GitHub][git].</span><span class="sxs-lookup"><span data-stu-id="d508b-292">For more information on deploying this sample reference architecture using Azure Building Blocks, visit the [GitHub repository][git].</span></span>


<!-- links -->
[dmz]: ../dmz/secure-vnet-dmz.md
[multi-dc]: multi-region-sql-server.md
[n-tier]: n-tier.md
[azbb]: https://github.com/mspnp/template-building-blocks/wiki/Install-Azure-Building-Blocks
[azure-administration]: /azure/automation/automation-intro
[azure-availability-sets]: /azure/virtual-machines/virtual-machines-windows-manage-availability#configure-each-application-tier-into-separate-availability-sets
[azure-cli]: /azure/virtual-machines-command-line-tools
[azure-cli-2]: https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest
[azure-dns]: /azure/dns/dns-overview
[azure-key-vault]: https://azure.microsoft.com/services/key-vault
[hôte bastion]: https://en.wikipedia.org/wiki/Bastion_host
[bastion host]: https://en.wikipedia.org/wiki/Bastion_host
[cidr]: https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing
[chef]: https://www.chef.io/solutions/azure/
[git]: https://github.com/mspnp/template-building-blocks
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/n-tier-windows
[lb-external-create]: /azure/load-balancer/load-balancer-get-started-internet-portal
[lb-internal-create]: /azure/load-balancer/load-balancer-get-started-ilb-arm-portal
[load-balancer-external]: /azure/load-balancer/load-balancer-internet-overview
[load-balancer-internal]: /azure/load-balancer/load-balancer-internal-overview
[nsg]: /azure/virtual-network/virtual-networks-nsg
[operations-management-suite]: https://www.microsoft.com/server-cloud/operations-management-suite/overview.aspx
[plan-network]: /azure/virtual-network/virtual-network-vnet-plan-design-arm
[private-ip-space]: https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces
[adresse IP publique]: /azure/virtual-network/virtual-network-ip-addresses-overview-arm
[public IP address]: /azure/virtual-network/virtual-network-ip-addresses-overview-arm
[puppet]: https://puppetlabs.com/blog/managing-azure-virtual-machines-puppet
[ref-arch-repo]: https://github.com/mspnp/reference-architectures
[sql-alwayson]: https://msdn.microsoft.com/library/hh510230.aspx
[sql-alwayson-force-failover]: https://msdn.microsoft.com/library/ff877957.aspx
[sql-alwayson-getting-started]: https://msdn.microsoft.com/library/gg509118.aspx
[sql-alwayson-ilb]: /azure/virtual-machines/windows/sql/virtual-machines-windows-portal-sql-alwayson-int-listener
[sql-alwayson-listeners]: https://msdn.microsoft.com/library/hh213417.aspx
[sql-alwayson-read-only-routing]: https://technet.microsoft.com/library/hh213417.aspx#ConnectToSecondary
[sql-keyvault]: /azure/virtual-machines/virtual-machines-windows-ps-sql-keyvault
[vm-sla]: https://azure.microsoft.com/support/legal/sla/virtual-machines
[vnet faq]: /azure/virtual-network/virtual-networks-faq
[wsfc-whats-new]: https://technet.microsoft.com/windows-server-docs/failover-clustering/whats-new-in-failover-clustering
[Nagios]: https://www.nagios.org/
[Zabbix]: http://www.zabbix.com/
[Icinga]: http://www.icinga.org/
[visio-download]: https://archcenter.blob.core.windows.net/cdn/vm-reference-architectures.vsdx
[0]: ./images/n-tier-sql-server.png "Architecture multiniveau à l’aide de Microsoft Azure"
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview 
[vmss]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
[load-balancer]: /azure/load-balancer/load-balancer-get-started-internet-arm-cli
[load-balancer-hashing]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[vmss-design]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-design-overview
[subscription-limits]: /azure/azure-subscription-service-limits
[availability-set]: /azure/virtual-machines/virtual-machines-windows-manage-availability
[health-probes]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[health-probe-log]: /azure/load-balancer/load-balancer-monitor-log
[health-probe-ip]: /azure/virtual-network/virtual-networks-nsg#special-rules
[network-security]: /azure/best-practices-network-security
