---
title: "Clé de valet"
description: "Utilisez un jeton ou une clé qui fournissent aux clients un accès direct limité à une ressource ou à un service spécifique."
keywords: "modèle de conception"
author: dragon119
ms.date: 06/23/2017
pnp.series.title: Cloud Design Patterns
pnp.pattern.categories:
- data-management
- security
ms.openlocfilehash: 791132eabf926cc285567454c60f894efa286433
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/14/2017
---
# <a name="valet-key-pattern"></a><span data-ttu-id="9631c-104">Modèle de clé de valet</span><span class="sxs-lookup"><span data-stu-id="9631c-104">Valet Key pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="9631c-105">Utilisez un jeton qui fournit aux clients un accès direct limité à une ressource spécifique, afin de décharger le transfert de données depuis l’application.</span><span class="sxs-lookup"><span data-stu-id="9631c-105">Use a token that provides clients with restricted direct access to a specific resource, in order to offload data transfer from the application.</span></span> <span data-ttu-id="9631c-106">Cela est particulièrement utile dans les applications qui utilisent des files d’attente ou des systèmes de stockage hébergés sur le cloud, et permet de réduire les coûts et d’optimiser l’extensibilité et les performances.</span><span class="sxs-lookup"><span data-stu-id="9631c-106">This is particularly useful in applications that use cloud-hosted storage systems or queues, and can minimize cost and maximize scalability and performance.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="9631c-107">Contexte et problème</span><span class="sxs-lookup"><span data-stu-id="9631c-107">Context and problem</span></span>

<span data-ttu-id="9631c-108">Les navigateurs web et les programmes clients ont souvent besoin de fichiers de lecture et d’écriture ou de flux de données en provenance ou à destination du stockage d’une application.</span><span class="sxs-lookup"><span data-stu-id="9631c-108">Client programs and web browsers often need to read and write files or data streams to and from an application’s storage.</span></span> <span data-ttu-id="9631c-109">En règle générale, l’application traitera le déplacement des données &mdash; soit en les extrayant du stockage et en les transmettant au client, soit en lisant le flux chargé depuis le client et en le stockant dans le magasin de données.</span><span class="sxs-lookup"><span data-stu-id="9631c-109">Typically, the application will handle the movement of the data &mdash; either by fetching it from storage and streaming it to the client, or by reading the uploaded stream from the client and storing it in the data store.</span></span> <span data-ttu-id="9631c-110">Toutefois, cette approche consomme des ressources précieuses comme des ressources de calcul, de la mémoire et de la bande passante.</span><span class="sxs-lookup"><span data-stu-id="9631c-110">However, this approach absorbs valuable resources such as compute, memory, and bandwidth.</span></span>

<span data-ttu-id="9631c-111">Les magasins de données ont la possibilité de gérer directement le chargement et le téléchargement des données sans que l’application ait besoin d’effectuer de traitement particulier pour déplacer ces données.</span><span class="sxs-lookup"><span data-stu-id="9631c-111">Data stores have the ability to handle upload and download of data directly, without requiring that the application perform any processing to move this data.</span></span> <span data-ttu-id="9631c-112">Toutefois, cela requiert généralement que le client ait accès aux informations d’identification de sécurité du magasin.</span><span class="sxs-lookup"><span data-stu-id="9631c-112">But, this typically requires the client to have access to the security credentials for the store.</span></span> <span data-ttu-id="9631c-113">Cette technique peut être utile pour réduire les coûts inhérents au transfert de données et la nécessité d’augmenter la taille des instances de l’application, ainsi que pour accroître les performances.</span><span class="sxs-lookup"><span data-stu-id="9631c-113">This can be a useful technique to minimize data transfer costs and the requirement to scale out the application, and to maximize performance.</span></span> <span data-ttu-id="9631c-114">Cela signifie néanmoins que l’application n’est plus en mesure de gérer la sécurité des données.</span><span class="sxs-lookup"><span data-stu-id="9631c-114">It means, though, that the application is no longer able to manage the security of the data.</span></span> <span data-ttu-id="9631c-115">Une fois que le client dispose d’une connexion au magasin de données pour l’accès direct, l’application ne peut pas agir en tant qu’opérateur de contrôle.</span><span class="sxs-lookup"><span data-stu-id="9631c-115">After the client has a connection to the data store for direct access, the application can't act as the gatekeeper.</span></span> <span data-ttu-id="9631c-116">Elle ne contrôle plus le processus et ne peut pas empêcher les chargements et téléchargements suivants depuis le magasin de données.</span><span class="sxs-lookup"><span data-stu-id="9631c-116">It's no longer in control of the process and can't prevent subsequent uploads or downloads from the data store.</span></span>

<span data-ttu-id="9631c-117">Cette approche n’est pas réaliste dans des systèmes distribués devant traiter des clients non approuvés.</span><span class="sxs-lookup"><span data-stu-id="9631c-117">This isn't a realistic approach in distributed systems that need to serve untrusted clients.</span></span> <span data-ttu-id="9631c-118">Au lieu de cela, les applications doivent être en mesure de contrôler en toute sécurité l’accès aux données de façon précise tout en réduisant la charge sur le serveur en configurant cette connexion, puis en autorisant le client à communiquer directement avec le magasin de données pour effectuer les opérations de lecture ou d’écriture requises.</span><span class="sxs-lookup"><span data-stu-id="9631c-118">Instead, applications must be able to securely control access to data in a granular way, but still reduce the load on the server by setting up this connection and then allowing the client to communicate directly with the data store to perform the required read or write operations.</span></span>

## <a name="solution"></a><span data-ttu-id="9631c-119">Solution</span><span class="sxs-lookup"><span data-stu-id="9631c-119">Solution</span></span>

<span data-ttu-id="9631c-120">Vous devez résoudre le problème de contrôle d’accès à un magasin de données quand le magasin ne peut pas gérer l’authentification et l’autorisation des clients.</span><span class="sxs-lookup"><span data-stu-id="9631c-120">You need to resolve the problem of controlling access to a data store where the store can't manage authentication and authorization of clients.</span></span> <span data-ttu-id="9631c-121">Une solution classique consiste à limiter l’accès à la connexion publique du magasin de données et à fournir au client une clé ou un jeton que le magasin de données peut valider.</span><span class="sxs-lookup"><span data-stu-id="9631c-121">One typical solution is to restrict access to the data store’s public connection and provide the client with a key or token that the data store can validate.</span></span>

<span data-ttu-id="9631c-122">Cette clé ou ce jeton est généralement appelé clé de valet.</span><span class="sxs-lookup"><span data-stu-id="9631c-122">This key or token is usually referred to as a valet key.</span></span> <span data-ttu-id="9631c-123">Il fournit un accès limité dans le temps à des ressources spécifiques et autorise uniquement des opérations prédéfinies telles que la lecture et l’écriture dans le stockage ou les files d’attente, ou le chargement et le téléchargement dans un navigateur web.</span><span class="sxs-lookup"><span data-stu-id="9631c-123">It provides time-limited access to specific resources and allows only predefined operations such as reading and writing to storage or queues, or uploading and downloading in a web browser.</span></span> <span data-ttu-id="9631c-124">Les applications peuvent rapidement et facilement créer et émettre des clés de valet pour les appareils clients et les navigateurs web, ce qui permet aux clients d’effectuer les opérations requises sans que l’application ait besoin de traiter directement le transfert de données.</span><span class="sxs-lookup"><span data-stu-id="9631c-124">Applications can create and issue valet keys to client devices and web browsers quickly and easily, allowing clients to perform the required operations without requiring the application to directly handle the data transfer.</span></span> <span data-ttu-id="9631c-125">Cela supprime la surcharge de traitement, ainsi que l’impact sur les performances et l’extensibilité, de l’application et du serveur.</span><span class="sxs-lookup"><span data-stu-id="9631c-125">This removes the processing overhead, and the impact on performance and scalability, from the application and the server.</span></span>

<span data-ttu-id="9631c-126">Le client utilise ce jeton pour accéder à une ressource spécifique du magasin de données pour une période particulière uniquement et avec certaines restrictions sur les autorisations d’accès, comme indiqué dans la figure.</span><span class="sxs-lookup"><span data-stu-id="9631c-126">The client uses this token to access a specific resource in the data store for only a specific period, and with specific restrictions on access permissions, as shown in the figure.</span></span> <span data-ttu-id="9631c-127">Après la période spécifiée, la clé n’est plus valide et ne permettra pas d’accéder à la ressource.</span><span class="sxs-lookup"><span data-stu-id="9631c-127">After the specified period, the key becomes invalid and won't allow access to the resource.</span></span>

![Figure 1 - Vue d’ensemble du modèle](./_images/valet-key-pattern.png)

<span data-ttu-id="9631c-129">Vous avez également la possibilité de configurer une clé possédant d’autres dépendances, comme l’étendue des données.</span><span class="sxs-lookup"><span data-stu-id="9631c-129">It's also possible to configure a key that has other dependencies, such as the scope of the data.</span></span> <span data-ttu-id="9631c-130">Par exemple, selon les fonctionnalités du magasin de données, la clé peut spécifier une table complète dans un magasin de données ou uniquement des lignes spécifiques d’une table.</span><span class="sxs-lookup"><span data-stu-id="9631c-130">For example, depending on the data store capabilities, the key can specify a complete table in a data store, or only specific rows in a table.</span></span> <span data-ttu-id="9631c-131">Dans les systèmes de stockage cloud, la clé peut spécifier un conteneur, ou simplement un élément particulier d’un conteneur.</span><span class="sxs-lookup"><span data-stu-id="9631c-131">In cloud storage systems the key can specify a container, or just a specific item within a container.</span></span>

<span data-ttu-id="9631c-132">La clé peut également être rendue. non valide par l’application.</span><span class="sxs-lookup"><span data-stu-id="9631c-132">The key can also be invalidated by the application.</span></span> <span data-ttu-id="9631c-133">Cette approche se révèle utile si le client informe le serveur de la fin de l’opération de transfert de données.</span><span class="sxs-lookup"><span data-stu-id="9631c-133">This is a useful approach if the client notifies the server that the data transfer operation is complete.</span></span> <span data-ttu-id="9631c-134">Le serveur peut alors rendre cette clé non valide pour empêcher que d’autres opérations soient effectuées.</span><span class="sxs-lookup"><span data-stu-id="9631c-134">The server can then invalidate that key to prevent further.</span></span>

<span data-ttu-id="9631c-135">L’utilisation de ce modèle peut simplifier la gestion de l’accès aux ressources, car vous n’avez plus de besoin de créer et d’authentifier un utilisateur, d’accorder des autorisations, puis de supprimer à nouveau l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="9631c-135">Using this pattern can simplify managing access to resources because there's no requirement to create and authenticate a user, grant permissions, and then remove the user again.</span></span> <span data-ttu-id="9631c-136">Cela permet également de limiter l’emplacement, l’autorisation et la période de validité&mdash;le tout en générant simplement une clé lors de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="9631c-136">It also makes it easy to limit the location, the permission, and the validity period&mdash;all by simply generating a key at runtime.</span></span> <span data-ttu-id="9631c-137">Les facteurs importants consistent à limiter autant que possible la période de validité, et particulièrement l’emplacement de la ressource, pour que le destinataire puisse uniquement utiliser la clé pour le but prévu.</span><span class="sxs-lookup"><span data-stu-id="9631c-137">The important factors are to limit the validity period, and especially the location of the resource, as tightly as possible so that the recipient can only use it for the intended purpose.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="9631c-138">Problèmes et considérations</span><span class="sxs-lookup"><span data-stu-id="9631c-138">Issues and considerations</span></span>

<span data-ttu-id="9631c-139">Prenez en compte les points suivants lorsque vous choisissez comment implémenter ce modèle :</span><span class="sxs-lookup"><span data-stu-id="9631c-139">Consider the following points when deciding how to implement this pattern:</span></span>

<span data-ttu-id="9631c-140">**Gestion de l’état et de la période de validité de la clé**.</span><span class="sxs-lookup"><span data-stu-id="9631c-140">**Manage the validity status and period of the key**.</span></span> <span data-ttu-id="9631c-141">En cas de divulgation ou de compromission, la clé déverrouille l’élément cible et celui-ci peut faire l’objet d’utilisations malveillantes pendant la période de validité.</span><span class="sxs-lookup"><span data-stu-id="9631c-141">If leaked or compromised, the key effectively unlocks the target item and makes it available for malicious use during the validity period.</span></span> <span data-ttu-id="9631c-142">Une clé peut généralement être révoquée ou désactivée, selon la façon dont elle a été émise.</span><span class="sxs-lookup"><span data-stu-id="9631c-142">A key can usually be revoked or disabled, depending on how it was issued.</span></span> <span data-ttu-id="9631c-143">Les stratégies côté serveur peuvent être modifiées, ou la clé du serveur avec laquelle la connexion a été effectuée peut être rendue non valide.</span><span class="sxs-lookup"><span data-stu-id="9631c-143">Server-side policies can be changed or, the server key it was signed with can be invalidated.</span></span> <span data-ttu-id="9631c-144">Spécifiez une période de validité courte pour réduire le risque que des opérations non autorisées se produisent sur le magasin de données.</span><span class="sxs-lookup"><span data-stu-id="9631c-144">Specify a short validity period to minimize the risk of allowing unauthorized operations to take place against the data store.</span></span> <span data-ttu-id="9631c-145">Toutefois, si la période de validité est trop courte, le client peut ne pas être en mesure de terminer l’opération avant l’expiration de la clé.</span><span class="sxs-lookup"><span data-stu-id="9631c-145">However, if the validity period is too short, the client might not be able to complete the operation before the key expires.</span></span> <span data-ttu-id="9631c-146">Permettez aux utilisateurs autorisés de renouveler la clé avant l’expiration de la période de validité si plusieurs accès à la ressource protégée sont requis.</span><span class="sxs-lookup"><span data-stu-id="9631c-146">Allow authorized users to renew the key before the validity period expires if multiple accesses to the protected resource are required.</span></span>

<span data-ttu-id="9631c-147">**Contrôle du niveau d’accès fourni par la clé**.</span><span class="sxs-lookup"><span data-stu-id="9631c-147">**Control the level of access the key will provide**.</span></span> <span data-ttu-id="9631c-148">En règle générale, la clé doit autoriser l’utilisateur à effectuer uniquement les actions nécessaires pour terminer l’opération, telles que l’accès en lecture seule si le client ne doit pas être en mesure de charger des données dans le magasin de données.</span><span class="sxs-lookup"><span data-stu-id="9631c-148">Typically, the key should allow the user to only perform the actions necessary to complete the operation, such as read-only access if the client shouldn't be able to upload data to the data store.</span></span> <span data-ttu-id="9631c-149">Pour les chargements de fichiers, il est courant de spécifier une clé qui fournit une autorisation en écriture seule, ainsi que l’emplacement et la période de validité.</span><span class="sxs-lookup"><span data-stu-id="9631c-149">For file uploads, it's common to specify a key that provides write-only permission, as well as the location and the validity period.</span></span> <span data-ttu-id="9631c-150">Il est essentiel de spécifier précisément la ressource ou l’ensemble de ressources auxquels s’applique la clé.</span><span class="sxs-lookup"><span data-stu-id="9631c-150">It's critical to accurately specify the resource or the set of resources to which the key applies.</span></span>

<span data-ttu-id="9631c-151">**Détermination de la façon de contrôler le comportement des utilisateurs**.</span><span class="sxs-lookup"><span data-stu-id="9631c-151">**Consider how to control users’ behavior**.</span></span> <span data-ttu-id="9631c-152">Implémenter ce modèle signifie que vous perdrez un certain degré de contrôle sur les ressources auxquelles les utilisateurs ont le droit d’accéder.</span><span class="sxs-lookup"><span data-stu-id="9631c-152">Implementing this pattern means some loss of control over the resources users are granted access to.</span></span> <span data-ttu-id="9631c-153">Le niveau de contrôle pouvant être exercé est limité par les capacités des stratégies et des autorisations disponibles pour le service ou le magasin de données cible.</span><span class="sxs-lookup"><span data-stu-id="9631c-153">The level of control that can be exerted is limited by the capabilities of the policies and permissions available for the service or the target data store.</span></span> <span data-ttu-id="9631c-154">Par exemple, il est généralement impossible de créer une clé qui limite la taille des données à écrire dans le stockage ou le nombre de fois où la clé peut être utilisée pour accéder à un fichier.</span><span class="sxs-lookup"><span data-stu-id="9631c-154">For example, it's usually not possible to create a key that limits the size of the data to be written to storage, or the number of times the key can be used to access a file.</span></span> <span data-ttu-id="9631c-155">Cela peut entraîner des coûts imprévus considérables pour le transfert de données, même en cas d’utilisation par le client prévu et peut être dû à une erreur dans le code qui provoque un chargement ou un téléchargement répétés.</span><span class="sxs-lookup"><span data-stu-id="9631c-155">This can result in huge unexpected costs for data transfer, even when used by the intended client, and might be caused by an error in the code that causes repeated upload or download.</span></span> <span data-ttu-id="9631c-156">Pour limiter le nombre de fois où un fichier peut être chargé, lorsque cela est possible, forcez le client à informer l’application lorsqu’une opération est terminée.</span><span class="sxs-lookup"><span data-stu-id="9631c-156">To limit the number of times a file can be uploaded, where possible, force the client to notify the application when one operation has completed.</span></span> <span data-ttu-id="9631c-157">Par exemple, certains magasins de données déclenchent des événements que le code d’application peut utiliser pour surveiller les opérations et contrôler le comportement de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="9631c-157">For example, some data stores raise events the application code can use to monitor operations and control user behavior.</span></span> <span data-ttu-id="9631c-158">Toutefois, il est difficile d’appliquer des quotas pour les utilisateurs individuels dans un scénario multi-locataire dans lequel la même clé est utilisée par tous les utilisateurs d’un seul locataire.</span><span class="sxs-lookup"><span data-stu-id="9631c-158">However, it's hard to enforce quotas for individual users in a multi-tenant scenario where the same key is used by all the users from one tenant.</span></span>

<span data-ttu-id="9631c-159">**Validation (et assainissement éventuel) de toutes les données chargées**.</span><span class="sxs-lookup"><span data-stu-id="9631c-159">**Validate, and optionally sanitize, all uploaded data**.</span></span> <span data-ttu-id="9631c-160">Un utilisateur malveillant qui accède à la clé peut charger des données conçues pour compromettre le système.</span><span class="sxs-lookup"><span data-stu-id="9631c-160">A malicious user that gains access to the key could upload data designed to compromise the system.</span></span> <span data-ttu-id="9631c-161">Des utilisateurs autorisés peuvent également charger des données non valides qui, une fois traitées, peuvent entraîner une erreur ou une panne dans le système.</span><span class="sxs-lookup"><span data-stu-id="9631c-161">Alternatively, authorized users might upload data that's invalid and, when processed, could result in an error or system failure.</span></span> <span data-ttu-id="9631c-162">Pour vous protéger contre cela, assurez-vous que toutes les données chargées sont validées et qu’elles ne contiennent pas de contenus malveillants avant des utiliser.</span><span class="sxs-lookup"><span data-stu-id="9631c-162">To protect against this, ensure that all uploaded data is validated and checked for malicious content before use.</span></span>

<span data-ttu-id="9631c-163">**Audit de toutes les opérations**.</span><span class="sxs-lookup"><span data-stu-id="9631c-163">**Audit all operations**.</span></span> <span data-ttu-id="9631c-164">De nombreux mécanismes basés sur une clé peuvent journaliser des opérations comme des chargements, des téléchargements et des échecs.</span><span class="sxs-lookup"><span data-stu-id="9631c-164">Many key-based mechanisms can log operations such as uploads, downloads, and failures.</span></span> <span data-ttu-id="9631c-165">Ces journaux peuvent généralement être intégrés à un processus d’audit et utilisés pour la facturation si l’utilisateur est facturé en fonction du volume de données ou de la taille de fichiers.</span><span class="sxs-lookup"><span data-stu-id="9631c-165">These logs can usually be incorporated into an audit process, and also used for billing if the user is charged based on file size or data volume.</span></span> <span data-ttu-id="9631c-166">Utilisez les journaux pour détecter des échecs d’authentification qui peuvent être dus à des problèmes avec le fournisseur de clés ou une suppression accidentelle d’une stratégie d’accès stockée.</span><span class="sxs-lookup"><span data-stu-id="9631c-166">Use the logs to detect authentication failures that might be caused by issues with the key provider, or accidental removal of a stored access policy.</span></span>

<span data-ttu-id="9631c-167">**Distribution sécurisée de la clé**.</span><span class="sxs-lookup"><span data-stu-id="9631c-167">**Deliver the key securely**.</span></span> <span data-ttu-id="9631c-168">Elle peut être incorporée dans une URL que l’utilisateur active sur une page web, ou elle peut être utilisée dans une opération de redirection du serveur afin que le téléchargement se produise automatiquement.</span><span class="sxs-lookup"><span data-stu-id="9631c-168">It can be embedded in a URL that the user activates in a web page, or it can be used in a server redirection operation so that the download occurs automatically.</span></span> <span data-ttu-id="9631c-169">Utilisez toujours le protocole HTTPS pour distribuer la clé sur un canal sécurisé.</span><span class="sxs-lookup"><span data-stu-id="9631c-169">Always use HTTPS to deliver the key over a secure channel.</span></span>

<span data-ttu-id="9631c-170">**Protection des données sensibles en transit**.</span><span class="sxs-lookup"><span data-stu-id="9631c-170">**Protect sensitive data in transit**.</span></span> <span data-ttu-id="9631c-171">Les données sensibles distribuées via l’application le seront généralement à l’aide des protocoles SSL ou TLS, et cela doit être appliqué pour les clients qui accèdent directement au magasin de données.</span><span class="sxs-lookup"><span data-stu-id="9631c-171">Sensitive data delivered through the application will usually take place using SSL or TLS, and this should be enforced for clients accessing the data store directly.</span></span>

<span data-ttu-id="9631c-172">Les autres problèmes à connaître lors de l’implémentation de ce modèle sont :</span><span class="sxs-lookup"><span data-stu-id="9631c-172">Other issues to be aware of when implementing this pattern are:</span></span>

- <span data-ttu-id="9631c-173">Si le client n’informe pas, ou ne peut pas informer, le serveur de la fin de l’opération et que la seule limite est la période d’expiration de la clé, l’application ne sera pas en mesure d’effectuer des opérations d’audit comme compter le nombre de chargements ou téléchargements ou empêcher plusieurs chargements ou téléchargements.</span><span class="sxs-lookup"><span data-stu-id="9631c-173">If the client doesn't, or can't, notify the server of completion of the operation, and the only limit is the expiration period of the key, the application won't be able to perform auditing operations such as counting the number of uploads or downloads, or preventing multiple uploads or downloads.</span></span>

- <span data-ttu-id="9631c-174">La flexibilité des stratégies de clé pouvant être générées peut se trouver limitée.</span><span class="sxs-lookup"><span data-stu-id="9631c-174">The flexibility of key policies that can be generated might be limited.</span></span> <span data-ttu-id="9631c-175">Par exemple, certains mécanismes autorisent uniquement l’utilisation d’une période d’expiration horodatée.</span><span class="sxs-lookup"><span data-stu-id="9631c-175">For example, some mechanisms only allow the use of a timed expiration period.</span></span> <span data-ttu-id="9631c-176">D’autres ne sont pas en mesure de spécifier une granularité suffisante pour les autorisations de lecture/d’écriture.</span><span class="sxs-lookup"><span data-stu-id="9631c-176">Others aren't able to specify a sufficient granularity of read/write permissions.</span></span>

- <span data-ttu-id="9631c-177">Si l’heure de début de la période de validité du jeton ou de la clé est spécifiée, vérifiez qu’elle est légèrement antérieure à l’heure actuelle du serveur pour que les clients dont les horloges sont légèrement en dehors de la synchronisation puissent quand même utiliser le jeton ou la clé.</span><span class="sxs-lookup"><span data-stu-id="9631c-177">If the start time for the key or token validity period is specified, ensure that it's a little earlier than the current server time to allow for client clocks that might be slightly out of synchronization.</span></span> <span data-ttu-id="9631c-178">La valeur par défaut, si elle n’est pas spécifiée, est généralement l’heure actuelle du serveur.</span><span class="sxs-lookup"><span data-stu-id="9631c-178">The default, if not specified, is usually the current server time.</span></span>

- <span data-ttu-id="9631c-179">L’URL qui contient la clé sera enregistrée dans les fichiers journaux du serveur.</span><span class="sxs-lookup"><span data-stu-id="9631c-179">The URL containing the key will be recorded in server log files.</span></span> <span data-ttu-id="9631c-180">Alors que la clé aura généralement expiré avant que les fichiers journaux soient utilisés pour l’analyse, assurez-vous de limiter l’accès à ces derniers.</span><span class="sxs-lookup"><span data-stu-id="9631c-180">While the key will typically have expired before the log files are used for analysis, ensure that you limit access to them.</span></span> <span data-ttu-id="9631c-181">Si les données du journal sont transmises à un système de surveillance ou stockées dans un autre emplacement, envisagez d’implémenter un délai pour éviter toute divulgation de clés après l’expiration de la période de validité.</span><span class="sxs-lookup"><span data-stu-id="9631c-181">If log data is transmitted to a monitoring system or stored in another location, consider implementing a delay to prevent leakage of keys until after their validity period has expired.</span></span>

- <span data-ttu-id="9631c-182">Si le code du client s’exécute dans un navigateur web, le navigateur peut devoir prendre en charge le partage des ressources cross-origin (CORS) pour permettre au code qui s’exécute dans le navigateur web d’accéder aux données dans un domaine différent de celui qui a traité la page.</span><span class="sxs-lookup"><span data-stu-id="9631c-182">If the client code runs in a web browser, the browser might need to support cross-origin resource sharing (CORS) to enable code that executes within the web browser to access data in a different domain from the one that served the page.</span></span> <span data-ttu-id="9631c-183">Certains navigateurs plus anciens et magasins de données ne prennent pas en charge le CORS, et le code qui s’exécute dans ces navigateurs peut être en mesure d’utiliser une clé de valet pour fournir un accès aux données dans un domaine différent, tel qu’un compte de stockage cloud.</span><span class="sxs-lookup"><span data-stu-id="9631c-183">Some older browsers and some data stores don't support CORS, and code that runs in these browsers might be able to use a valet key to provide access to data in a different domain, such as a cloud storage account.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="9631c-184">Quand utiliser ce modèle</span><span class="sxs-lookup"><span data-stu-id="9631c-184">When to use this pattern</span></span>

<span data-ttu-id="9631c-185">Ce modèle est utile dans les situations suivantes :</span><span class="sxs-lookup"><span data-stu-id="9631c-185">This pattern is useful for the following situations:</span></span>

- <span data-ttu-id="9631c-186">Pour réduire le chargement des ressources et optimiser les performances et l’extensibilité.</span><span class="sxs-lookup"><span data-stu-id="9631c-186">To minimize resource loading and maximize performance and scalability.</span></span> <span data-ttu-id="9631c-187">L’utilisation d’une clé de valet ne nécessite pas que la ressource soit verrouillée, que d’appel soit passé au serveur distant, n’implique pas de limite en termes de nombre de clés de valet pouvant être émises, et permet d’éviter qu’un point de défaillance unique résultant de l’exécution du transfert de données via le code d’application.</span><span class="sxs-lookup"><span data-stu-id="9631c-187">Using a valet key doesn't require the resource to be locked, no remote server call is required, there's no limit on the number of valet keys that can be issued, and it avoids a single point of failure resulting from performing the data transfer through the application code.</span></span> <span data-ttu-id="9631c-188">La création d’une clé de valet est généralement une simple opération de chiffrement de signature d’une chaîne avec une clé.</span><span class="sxs-lookup"><span data-stu-id="9631c-188">Creating a valet key is typically a simple cryptographic operation of signing a string with a key.</span></span>

- <span data-ttu-id="9631c-189">Pour réduire les coûts d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="9631c-189">To minimize operational cost.</span></span> <span data-ttu-id="9631c-190">Activer l’accès direct aux magasins et files d’attente permet d’économiser de l’argent et des ressources, peut réduire les allers-retours réseau et permettre de diminuer le nombre de ressources de calcul nécessaires.</span><span class="sxs-lookup"><span data-stu-id="9631c-190">Enabling direct access to stores and queues is resource and cost efficient, can result in fewer network round trips, and might allow for a reduction in the number of compute resources required.</span></span>

- <span data-ttu-id="9631c-191">Lorsque des clients chargent ou téléchargent régulièrement des données, notamment en cas de volume important ou quand chaque opération implique de gros fichiers.</span><span class="sxs-lookup"><span data-stu-id="9631c-191">When clients regularly upload or download data, particularly where there's a large volume or when each operation involves large files.</span></span>

- <span data-ttu-id="9631c-192">Lorsque l’application a des ressources de calcul disponibles limitées, en raison de limitations d’hébergement ou de considérations en termes de coûts.</span><span class="sxs-lookup"><span data-stu-id="9631c-192">When the application has limited compute resources available, either due to hosting limitations or cost considerations.</span></span> <span data-ttu-id="9631c-193">Dans ce scénario, le modèle est encore plus utile s’il existe plusieurs chargements ou téléchargements de données simultanés, car il libère l’application de la gestion du transfert de données.</span><span class="sxs-lookup"><span data-stu-id="9631c-193">In this scenario, the pattern is even more helpful if there are many concurrent data uploads or downloads because it relieves the application from handling the data transfer.</span></span>

- <span data-ttu-id="9631c-194">Lorsque les données sont stockées dans un magasin de données distant ou dans un autre centre de données.</span><span class="sxs-lookup"><span data-stu-id="9631c-194">When the data is stored in a remote data store or a different datacenter.</span></span> <span data-ttu-id="9631c-195">Si vous avez demandé à l’application d’agir en tant qu’opérateur de contrôle, des coûts peuvent s’appliquer pour la bande passante supplémentaire liée au transfert de données entre les centres de données, ou sur des réseaux publics ou privés entre le client et l’application, puis entre l’application et le magasin de données.</span><span class="sxs-lookup"><span data-stu-id="9631c-195">If the application was required to act as a gatekeeper, there might be a charge for the additional bandwidth of transferring the data between datacenters, or across public or private networks between the client and the application, and then between the application and the data store.</span></span>

<span data-ttu-id="9631c-196">Ce modèle peut s’avérer inutile dans les situations suivantes :</span><span class="sxs-lookup"><span data-stu-id="9631c-196">This pattern might not be useful in the following situations:</span></span>

- <span data-ttu-id="9631c-197">Si l’application doit effectuer certaines tâches sur les données avant leur stockage ou leur envoi au client.</span><span class="sxs-lookup"><span data-stu-id="9631c-197">If the application must perform some task on the data before it's stored or before it's sent to the client.</span></span> <span data-ttu-id="9631c-198">Par exemple, si l’application doit effectuer des opérations de validation, d’accès au journal ou d’exécution d’une transformation sur les données.</span><span class="sxs-lookup"><span data-stu-id="9631c-198">For example, if the application needs to perform validation, log access success, or execute a transformation on the data.</span></span> <span data-ttu-id="9631c-199">Toutefois, certains magasins de données et clients sont en mesure de négocier et d’effectuer des transformations simples telles que la compression et la décompression (par exemple, un navigateur web peut généralement traiter les formats GZip).</span><span class="sxs-lookup"><span data-stu-id="9631c-199">However, some data stores and clients are able to negotiate and carry out simple transformations such as compression and decompression (for example, a web browser can usually handle GZip formats).</span></span>

- <span data-ttu-id="9631c-200">Si la conception d’une application existante complique l’incorporation du modèle.</span><span class="sxs-lookup"><span data-stu-id="9631c-200">If the design of an existing application makes it difficult to incorporate the pattern.</span></span> <span data-ttu-id="9631c-201">L’utilisation de ce modèle nécessite généralement une approche architecturale distincte pour transmettre et recevoir des données.</span><span class="sxs-lookup"><span data-stu-id="9631c-201">Using this pattern typically requires a different architectural approach for delivering and receiving data.</span></span>

- <span data-ttu-id="9631c-202">S’il est nécessaire de conserver les journaux d’audit ou de contrôler le nombre de fois où une opération de transfert de données est exécutée, et si le mécanisme de clé de valet utilisé ne prend pas en charge les notifications que le serveur peut utiliser pour gérer ces opérations.</span><span class="sxs-lookup"><span data-stu-id="9631c-202">If it's necessary to maintain audit trails or control the number of times a data transfer operation is executed, and the valet key mechanism in use doesn't support notifications that the server can use to manage these operations.</span></span>

- <span data-ttu-id="9631c-203">S’il est nécessaire de limiter la taille des données, en particulier au cours des opérations de chargement.</span><span class="sxs-lookup"><span data-stu-id="9631c-203">If it's necessary to limit the size of the data, especially during upload operations.</span></span> <span data-ttu-id="9631c-204">La seule solution à ce problème consiste à ce que l’application vérifie la taille des données une fois l’opération terminée, ou qu’elle vérifie la taille des chargements après une période spécifiée ou selon une planification.</span><span class="sxs-lookup"><span data-stu-id="9631c-204">The only solution to this is for the application to check the data size after the operation is complete, or check the size of uploads after a specified period or on a scheduled basis.</span></span>

## <a name="example"></a><span data-ttu-id="9631c-205">Exemple</span><span class="sxs-lookup"><span data-stu-id="9631c-205">Example</span></span>

<span data-ttu-id="9631c-206">Azure prend en charge des signatures d’accès partagé sur le stockage Azure pour le contrôle d’accès granulaire aux données dans les objets blob, tables et files d’attente et pour les rubriques et files d’attente Service Bus.</span><span class="sxs-lookup"><span data-stu-id="9631c-206">Azure supports shared access signatures on Azure Storage for granular access control to data in blobs, tables, and queues, and for Service Bus queues and topics.</span></span> <span data-ttu-id="9631c-207">Un jeton de signature d’accès partagé peut être configuré pour fournir des droits d’accès spécifiques telles que la lecture, l’écriture, la mise à jour et la suppression d’une table spécifique ; un groupe de clés dans une table ; une file d’attente ; un objet blob ; ou un conteneur d’objets blob.</span><span class="sxs-lookup"><span data-stu-id="9631c-207">A shared access signature token can be configured to provide specific access rights such as read, write, update, and delete to a specific table; a key range within a table; a queue; a blob; or a blob container.</span></span> <span data-ttu-id="9631c-208">La validité peut être une période spécifiée ou n’avoir aucune limite de temps.</span><span class="sxs-lookup"><span data-stu-id="9631c-208">The validity can be a specified time period or with no time limit.</span></span>

<span data-ttu-id="9631c-209">Les signatures d’accès partagé Azure prennent également en charge les stratégies d’accès stockées sur serveur qui peuvent être associées à une ressource spécifique comme une table ou un objet blob.</span><span class="sxs-lookup"><span data-stu-id="9631c-209">Azure shared access signatures also support server-stored access policies that can be associated with a specific resource such as a table or blob.</span></span> <span data-ttu-id="9631c-210">Cette fonctionnalité offre davantage de contrôle et de flexibilité par rapport aux jetons de signature d’accès partagé générés par l’application et doit être utilisée chaque fois que cela est possible.</span><span class="sxs-lookup"><span data-stu-id="9631c-210">This feature provides additional control and flexibility compared to application-generated shared access signature tokens, and should be used whenever possible.</span></span> <span data-ttu-id="9631c-211">Les paramètres définis dans une stratégie stockée sur serveur peuvent être modifiés et sont reflétés dans le jeton sans qu’un nouveau jeton doive être émis, mais les paramètres définis dans le jeton ne peuvent pas être modifiés sans émettre un nouveau jeton.</span><span class="sxs-lookup"><span data-stu-id="9631c-211">Settings defined in a server-stored policy can be changed and are reflected in the token without requiring a new token to be issued, but settings defined in the token can't be changed without issuing a new token.</span></span> <span data-ttu-id="9631c-212">Cette approche permet également de révoquer un jeton de signature d’accès partagé valide avant son expiration.</span><span class="sxs-lookup"><span data-stu-id="9631c-212">This approach also makes it possible to revoke a valid shared access signature token before it's expired.</span></span>

> <span data-ttu-id="9631c-213">Pour plus d’informations, consultez [Introducing Table SAS (Shared Access Signature), Queue SAS and update to Blob SAS](https://blogs.msdn.microsoft.com/windowsazurestorage/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas/) (Présentation de la SAP (signature d’accès partagé) de table, de la SAP de file d’attente et de la mise à jour vers la SAP d’objet blob) et [Utilisation des signatures d’accès partagé (SAP)](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/) sur MSDN.</span><span class="sxs-lookup"><span data-stu-id="9631c-213">For more information see [Introducing Table SAS (Shared Access Signature), Queue SAS and update to Blob SAS](https://blogs.msdn.microsoft.com/windowsazurestorage/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas/) and [Using Shared Access Signatures](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/) on MSDN.</span></span>

<span data-ttu-id="9631c-214">Le code suivant montre comment créer un jeton de signature d’accès partagé valide pendant cinq minutes.</span><span class="sxs-lookup"><span data-stu-id="9631c-214">The following code shows how to create a shared access signature token that's valid for five minutes.</span></span> <span data-ttu-id="9631c-215">La méthode `GetSharedAccessReferenceForUpload` renvoie un jeton de signatures d’accès partagé qui peut être utilisé pour charger un fichier dans le stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="9631c-215">The `GetSharedAccessReferenceForUpload` method returns a shared access signatures token that can be used to upload a file to Azure Blob Storage.</span></span>

```csharp
public class ValuesController : ApiController
{
  private readonly CloudStorageAccount account;
  private readonly string blobContainer;
  ...
  /// <summary>
  /// Return a limited access key that allows the caller to upload a file
  /// to this specific destination for a defined period of time.
  /// </summary>
  private StorageEntitySas GetSharedAccessReferenceForUpload(string blobName)
  {
    var blobClient = this.account.CreateCloudBlobClient();
    var container = blobClient.GetContainerReference(this.blobContainer);

    var blob = container.GetBlockBlobReference(blobName);

    var policy = new SharedAccessBlobPolicy
    {
      Permissions = SharedAccessBlobPermissions.Write,

      // Specify a start time five minutes earlier to allow for client clock skew.
      SharedAccessStartTime = DateTime.UtcNow.AddMinutes(-5),

      // Specify a validity period of five minutes starting from now.
      SharedAccessExpiryTime = DateTime.UtcNow.AddMinutes(5)
    };

    // Create the signature.
    var sas = blob.GetSharedAccessSignature(policy);

    return new StorageEntitySas
    {
      BlobUri = blob.Uri,
      Credentials = sas,
      Name = blobName
    };
  }

  public struct StorageEntitySas
  {
    public string Credentials;
    public Uri BlobUri;
    public string Name;
  }
}
```

> <span data-ttu-id="9631c-216">L’exemple complet est disponible dans la solution ValetKey disponible au téléchargement sur [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/valet-key).</span><span class="sxs-lookup"><span data-stu-id="9631c-216">The complete sample is available in the ValetKey solution available for download from [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/valet-key).</span></span> <span data-ttu-id="9631c-217">Le projet ValetKey.Web de cette solution contient une application web qui inclut la classe `ValuesController` présentée ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="9631c-217">The ValetKey.Web project in this solution contains a web application that includes the `ValuesController` class shown above.</span></span> <span data-ttu-id="9631c-218">Un exemple d’application cliente qui utilise cette application web pour récupérer une clé de signatures d’accès partagé et charger un fichier dans le stockage d’objets blob est disponible dans le projet ValetKey.Client.</span><span class="sxs-lookup"><span data-stu-id="9631c-218">A sample client application that uses this web application to retrieve a shared access signatures key and upload a file to blob storage is available in the ValetKey.Client project.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9631c-219">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="9631c-219">Next steps</span></span>

<span data-ttu-id="9631c-220">Les modèles et les conseils suivants peuvent aussi présenter un intérêt quand il s’agit d’implémenter ce modèle :</span><span class="sxs-lookup"><span data-stu-id="9631c-220">The following patterns and guidance might also be relevant when implementing this pattern:</span></span>
- <span data-ttu-id="9631c-221">Un exemple illustrant ce modèle est disponible sur [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/valet-key).</span><span class="sxs-lookup"><span data-stu-id="9631c-221">A sample that demonstrates this pattern is available on [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/valet-key).</span></span>
- <span data-ttu-id="9631c-222">[Modèle d’opérateur de contrôle](gatekeeper.md).</span><span class="sxs-lookup"><span data-stu-id="9631c-222">[Gatekeeper pattern](gatekeeper.md).</span></span> <span data-ttu-id="9631c-223">Ce modèle peut être utilisé avec le modèle de clé de valet pour protéger les applications et services à l’aide d’une instance d’hôte dédiée qui agit comme un répartiteur entre les clients et l’application ou le service.</span><span class="sxs-lookup"><span data-stu-id="9631c-223">This pattern can be used in conjunction with the Valet Key pattern to protect applications and services by using a dedicated host instance that acts as a broker between clients and the application or service.</span></span> <span data-ttu-id="9631c-224">L’opérateur de contrôle valide et assainit les requêtes, et transmet les requêtes et les données entre le client et l’application.</span><span class="sxs-lookup"><span data-stu-id="9631c-224">The gatekeeper validates and sanitizes requests, and passes requests and data between the client and the application.</span></span> <span data-ttu-id="9631c-225">Il peut fournir une couche supplémentaire de sécurité et réduire la surface d’attaque du système.</span><span class="sxs-lookup"><span data-stu-id="9631c-225">Can provide an additional layer of security, and reduce the attack surface of the system.</span></span>
- <span data-ttu-id="9631c-226">[Modèle d’hébergement de contenu statique](static-content-hosting.md).</span><span class="sxs-lookup"><span data-stu-id="9631c-226">[Static Content Hosting pattern](static-content-hosting.md).</span></span> <span data-ttu-id="9631c-227">Décrit comment déployer des ressources statiques dans un service de stockage cloud qui peut fournir ces ressources directement au client afin de réduire le besoin d’instances de calcul coûteuses.</span><span class="sxs-lookup"><span data-stu-id="9631c-227">Describes how to deploy static resources to a cloud-based storage service that can deliver these resources directly to the client to reduce the requirement for expensive compute instances.</span></span> <span data-ttu-id="9631c-228">Lorsque les ressources ne sont pas destinées à être publiquement disponibles, le modèle de clé de valet peut être utilisé afin de les sécuriser.</span><span class="sxs-lookup"><span data-stu-id="9631c-228">Where the resources aren't intended to be publicly available, the Valet Key pattern can be used to secure them.</span></span>
- <span data-ttu-id="9631c-229">[Introducing Table SAS (Shared Access Signature), Queue SAS and update to Blob SAS](https://blogs.msdn.microsoft.com/windowsazurestorage/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas/) (Présentation de la SAP (signature d’accès partagé) de table, de la SAP de file d’attente et de la mise à jour vers la SAP d’objet blob)</span><span class="sxs-lookup"><span data-stu-id="9631c-229">[Introducing Table SAS (Shared Access Signature), Queue SAS and update to Blob SAS](https://blogs.msdn.microsoft.com/windowsazurestorage/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas/)</span></span>
- [<span data-ttu-id="9631c-230">Utilisation des signatures d’accès partagé (SAP)</span><span class="sxs-lookup"><span data-stu-id="9631c-230">Using Shared Access Signatures</span></span>](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/)
- [<span data-ttu-id="9631c-231">Authentification par signature d’accès partagé avec Service Bus</span><span class="sxs-lookup"><span data-stu-id="9631c-231">Shared Access Signature Authentication with Service Bus</span></span>](https://azure.microsoft.com/documentation/articles/service-bus-shared-access-signature-authentication/)
