---
title: Stratégies de partitionnement de données
titleSuffix: Best practices for cloud applications
description: Aide sur le fractionnement de partitions de données pour une gestion et un accès distincts.
author: dragon119
ms.date: 11/04/2018
ms.topic: best-practice
ms.service: architecture-center
ms.subservice: cloud-fundamentals
ms.custom: seodec18
ms.openlocfilehash: 4f973a6173e882d6ae839833bd3c5bf86f8d7fb6
ms.sourcegitcommit: 273e690c0cfabbc3822089c7d8bc743ef41d2b6e
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/08/2019
ms.locfileid: "55898134"
---
# <a name="data-partitioning-strategies"></a><span data-ttu-id="4b239-103">Stratégies de partitionnement de données</span><span class="sxs-lookup"><span data-stu-id="4b239-103">Data partitioning strategies</span></span>

<span data-ttu-id="4b239-104">Cet article décrit certaines stratégies utilisées pour le partitionnement des données dans divers magasins de données Azure.</span><span class="sxs-lookup"><span data-stu-id="4b239-104">This article describes some strategies for partitioning data in various Azure data stores.</span></span> <span data-ttu-id="4b239-105">Pour obtenir des instructions générales concernant le meilleur moment et les meilleures pratiques pour partitionner les données, consultez [Partitionnement des données](./data-partitioning.md)</span><span class="sxs-lookup"><span data-stu-id="4b239-105">For general guidance about when to partition data and best practices, see [Data partitioning](./data-partitioning.md)</span></span>

## <a name="partitioning-azure-sql-database"></a><span data-ttu-id="4b239-106">Partitionnement d’Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="4b239-106">Partitioning Azure SQL Database</span></span>

<span data-ttu-id="4b239-107">Une base de données SQL est limitée quant au volume de données qu’elle peut contenir.</span><span class="sxs-lookup"><span data-stu-id="4b239-107">A single SQL database has a limit to the volume of data that it can contain.</span></span> <span data-ttu-id="4b239-108">Le débit est limité par des facteurs architecturaux et par le nombre de connexions simultanées prises en charge.</span><span class="sxs-lookup"><span data-stu-id="4b239-108">Throughput is constrained by architectural factors and the number of concurrent connections that it supports.</span></span>

<span data-ttu-id="4b239-109">Les [pools élastiques](/azure/sql-database/sql-database-elastic-pool) prennent en charge la mise à l’échelle horizontale d’une base de données SQL.</span><span class="sxs-lookup"><span data-stu-id="4b239-109">[Elastic pools](/azure/sql-database/sql-database-elastic-pool) support horizontal scaling for a SQL database.</span></span> <span data-ttu-id="4b239-110">En les utilisant, vous pouvez partitionner vos données sur des partitions réparties sur plusieurs bases de données SQL.</span><span class="sxs-lookup"><span data-stu-id="4b239-110">Using elastic pools, you can partition your data into shards that are spread across multiple SQL databases.</span></span> <span data-ttu-id="4b239-111">Vous pouvez également ajouter ou supprimer des partitions à mesure que le volume de données que vous devez gérer augmente ou diminue.</span><span class="sxs-lookup"><span data-stu-id="4b239-111">You can also add or remove shards as the volume of data that you need to handle grows and shrinks.</span></span> <span data-ttu-id="4b239-112">Les pools élastiques permettent également de réduire la contention en répartissant la charge parmi les bases de données.</span><span class="sxs-lookup"><span data-stu-id="4b239-112">Elastic pools can also help reduce contention by distributing the load across databases.</span></span>

<span data-ttu-id="4b239-113">Chaque partition est mise en œuvre sous forme de base de données SQL.</span><span class="sxs-lookup"><span data-stu-id="4b239-113">Each shard is implemented as a SQL database.</span></span> <span data-ttu-id="4b239-114">Une partition peut contenir plusieurs jeux de données (nommés *shardlets*).</span><span class="sxs-lookup"><span data-stu-id="4b239-114">A shard can hold more than one dataset (called a *shardlet*).</span></span> <span data-ttu-id="4b239-115">Chaque base de données tient à jour des métadonnées qui décrivent les shardlets qu’elle contient.</span><span class="sxs-lookup"><span data-stu-id="4b239-115">Each database maintains metadata that describes the shardlets that it contains.</span></span> <span data-ttu-id="4b239-116">Un shardlet peut correspondre à un seul élément de données ou à un groupe d’éléments partageant la même clé de shardlet.</span><span class="sxs-lookup"><span data-stu-id="4b239-116">A shardlet can be a single data item, or a group of items that share the same shardlet key.</span></span> <span data-ttu-id="4b239-117">Par exemple, au sein d’une application mutualisée, la clé de shardlet peut correspondre à l’ID client, et toutes les données relatives à un client seront stockées au sein du même shardlet.</span><span class="sxs-lookup"><span data-stu-id="4b239-117">For example, in a multitenant application, the shardlet key can be the tenant ID, and all data for a tenant can be held in the same shardlet.</span></span>

<span data-ttu-id="4b239-118">Les applications clientes sont chargées de l’association d’un jeu de données avec une clé de shardlet.</span><span class="sxs-lookup"><span data-stu-id="4b239-118">Client applications are responsible for associating a dataset with a shardlet key.</span></span> <span data-ttu-id="4b239-119">Une base de données SQL distincte fonctionne comme un gestionnaire global des cartes des partitions.</span><span class="sxs-lookup"><span data-stu-id="4b239-119">A separate SQL database acts as a global shard map manager.</span></span> <span data-ttu-id="4b239-120">Cette base de données possède une liste de l’ensemble des partitions et shardlets dans le système.</span><span class="sxs-lookup"><span data-stu-id="4b239-120">This database has a list of all the shards and shardlets in the system.</span></span> <span data-ttu-id="4b239-121">L’application se connecte à la base de données du gestionnaire des cartes de partitions afin d’obtenir une copie des cartes de partitions.</span><span class="sxs-lookup"><span data-stu-id="4b239-121">The application connects to the shard map manager database to obtain a copy of the shard map.</span></span> <span data-ttu-id="4b239-122">Il met la carte de partitions en cache en local et utilise le mappage pour acheminer les requêtes de données vers la partition appropriée.</span><span class="sxs-lookup"><span data-stu-id="4b239-122">It caches the shard map locally, and uses the map to route data requests to the appropriate shard.</span></span> <span data-ttu-id="4b239-123">Cette fonctionnalité est masquée derrière une série d’API présentes dans la [Bibliothèque de client de base de données élastique](/azure/sql-database/sql-database-elastic-database-client-library), qui est disponible pour Java et .NET.</span><span class="sxs-lookup"><span data-stu-id="4b239-123">This functionality is hidden behind a series of APIs that are contained in the [Elastic Database client library](/azure/sql-database/sql-database-elastic-database-client-library), which is available for Java and .NET.</span></span>

<span data-ttu-id="4b239-124">Pour en savoir plus sur les pools élastiques, consultez la rubrique [Montée en charge avec Azure SQL Database](/azure/sql-database/sql-database-elastic-scale-introduction).</span><span class="sxs-lookup"><span data-stu-id="4b239-124">For more information about elastic pools, see [Scaling out with Azure SQL Database](/azure/sql-database/sql-database-elastic-scale-introduction).</span></span>

<span data-ttu-id="4b239-125">Pour réduire la latence et améliorer la disponibilité, vous pouvez répliquer la base de données du gestionnaire global des cartes des partitions.</span><span class="sxs-lookup"><span data-stu-id="4b239-125">To reduce latency and improve availability, you can replicate the global shard map manager database.</span></span> <span data-ttu-id="4b239-126">À l’aide de l’un des niveaux tarifaires Premium, vous pouvez configurer la géoréplication active pour copier des données en continu dans des bases de données présentes dans différentes régions.</span><span class="sxs-lookup"><span data-stu-id="4b239-126">With the Premium pricing tiers, you can configure active geo-replication to continuously copy data to databases in different regions.</span></span>

<span data-ttu-id="4b239-127">Une autre approche consiste à utiliser le [Azure SQL Data Sync](/azure/sql-database/sql-database-sync-data) ou [Azure Data Factory](/azure/data-factory/) pour répliquer la base de données du gestionnaire des cartes des partitions dans les différentes régions.</span><span class="sxs-lookup"><span data-stu-id="4b239-127">Alternatively, use [Azure SQL Data Sync](/azure/sql-database/sql-database-sync-data) or [Azure Data Factory](/azure/data-factory/) to replicate the shard map manager database across regions.</span></span> <span data-ttu-id="4b239-128">Cette forme de réplication s’exécute périodiquement et est plus appropriée si la carte des partitions change peu fréquemment. Elle n’exige pas le niveau Premium.</span><span class="sxs-lookup"><span data-stu-id="4b239-128">This form of replication runs periodically and is more suitable if the shard map changes infrequently, and does not require Premium tier.</span></span>

<span data-ttu-id="4b239-129">La fonction Base de données élastique présente deux schémas de mappage des données vers les shardlets et de stockage dans ces derniers :</span><span class="sxs-lookup"><span data-stu-id="4b239-129">Elastic Database provides two schemes for mapping data to shardlets and storing them in shards:</span></span>

- <span data-ttu-id="4b239-130">Une **carte de partitions de liste** associe une clé unique à un shardlet.</span><span class="sxs-lookup"><span data-stu-id="4b239-130">A **list shard map** associates a single key to a shardlet.</span></span> <span data-ttu-id="4b239-131">Par exemple, dans un système mutualisé, les données relatives à chaque client peuvent être associées à une clé unique et stockées dans leur propre shardlet.</span><span class="sxs-lookup"><span data-stu-id="4b239-131">For example, in a multitenant system, the data for each tenant can be associated with a unique key and stored in its own shardlet.</span></span> <span data-ttu-id="4b239-132">Pour garantir l’isolation, chaque shardlet peut être stocké dans sa propre partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-132">To guarantee isolation, each shardlet can be held within its own shard.</span></span>

    ![Utilisation d’une carte de partitions de liste pour stocker les données d’un client dans des partitions distinctes](./images/data-partitioning/PointShardlet.png)

- <span data-ttu-id="4b239-134">Une **carte de partitions de plage** associe un jeu de valeurs de clés contiguës à un shardlet.</span><span class="sxs-lookup"><span data-stu-id="4b239-134">A **range shard map** associates a set of contiguous key values to a shardlet.</span></span> <span data-ttu-id="4b239-135">Par exemple, vous pouvez regrouper les données d’un ensemble de clients (chacun présentant sa propre clé) au sein du même shardlet.</span><span class="sxs-lookup"><span data-stu-id="4b239-135">For example, you can group the data for a set of tenants (each with their own key) within the same shardlet.</span></span> <span data-ttu-id="4b239-136">Ce schéma est moins onéreux que le premier, étant donné que les clients partagent le stockage de données, mais l’isolation des données est moins bonne.</span><span class="sxs-lookup"><span data-stu-id="4b239-136">This scheme is less expensive than the first, because tenants share data storage, but has less isolation.</span></span>

    ![Utilisation d’une carte de partitions de plage pour stocker des données relatives à une plage de clients dans une partition](./images/data-partitioning/RangeShardlet.png)

<span data-ttu-id="4b239-138">Une même partition peut comporter des données relatives à plusieurs shardlets.</span><span class="sxs-lookup"><span data-stu-id="4b239-138">A single shard can contain the data for several shardlets.</span></span> <span data-ttu-id="4b239-139">Par exemple, vous pouvez utiliser des  shardlets de liste pour stocker des données relatives à différents clients non contigus dans la même partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-139">For example, you can use list shardlets to store data for different non-contiguous tenants in the same shard.</span></span> <span data-ttu-id="4b239-140">Vous pouvez aussi associer des shardlets de plage et des shardlets de liste dans une même partition, bien qu’ils soient interrogés par le biais de différentes cartes.</span><span class="sxs-lookup"><span data-stu-id="4b239-140">You can also mix range shardlets and list shardlets in the same shard, although they will be addressed through different maps.</span></span> <span data-ttu-id="4b239-141">Le diagramme qui suit montre cette approche :</span><span class="sxs-lookup"><span data-stu-id="4b239-141">The following diagram shows this approach:</span></span>

![Implémentation de plusieurs cartes des partitions](./images/data-partitioning/MultipleShardMaps.png)

<span data-ttu-id="4b239-143">Les pools élastiques permettent d’ajouter et de supprimer des partitions à mesure que le volume de données augmente et diminue.</span><span class="sxs-lookup"><span data-stu-id="4b239-143">Elastic pools makes it possible to add and remove shards as the volume of data shrinks and grows.</span></span> <span data-ttu-id="4b239-144">Les applications clientes peuvent créer et supprimer des partitions de façon dynamique et mettre à jour le gestionnaire de cartes de partitions en toute transparence.</span><span class="sxs-lookup"><span data-stu-id="4b239-144">Client applications can create and delete shards dynamically, and transparently update the shard map manager.</span></span> <span data-ttu-id="4b239-145">Toutefois, la suppression d’une partition est une opération destructive qui nécessite également la suppression de toutes les données présentes dans cette partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-145">However, removing a shard is a destructive operation that also requires deleting all the data in that shard.</span></span>

<span data-ttu-id="4b239-146">Si une application doit fractionner une partition en deux partitions distinctes ou combiner des partitions, utilisez [l’outil de fractionnement et de fusion](/azure/sql-database/sql-database-elastic-scale-overview-split-and-merge).</span><span class="sxs-lookup"><span data-stu-id="4b239-146">If an application needs to split a shard into two separate shards or combine shards, use the [split-merge tool](/azure/sql-database/sql-database-elastic-scale-overview-split-and-merge).</span></span> <span data-ttu-id="4b239-147">Cet outil s’exécute comme un service web Azure et effectue une migration des données sécurisée entre les partitions.</span><span class="sxs-lookup"><span data-stu-id="4b239-147">This tool runs as an Azure web service, and migrates data safely between shards.</span></span>

<span data-ttu-id="4b239-148">Le schéma de partition peut considérablement affecter les performances de votre système.</span><span class="sxs-lookup"><span data-stu-id="4b239-148">The partitioning scheme can significantly impact the performance of your system.</span></span> <span data-ttu-id="4b239-149">Il peut également affecter la vitesse à laquelle les partitions doivent être ajoutées ou supprimées, celle à laquelle les données doivent être repartitionnées entre les partitions.</span><span class="sxs-lookup"><span data-stu-id="4b239-149">It can also affect the rate at which shards have to be added or removed, or that data must be repartitioned across shards.</span></span> <span data-ttu-id="4b239-150">Observez les points suivants :</span><span class="sxs-lookup"><span data-stu-id="4b239-150">Consider the following points:</span></span>

- <span data-ttu-id="4b239-151">Regroupez les données utilisées conjointement dans une même partition et évitez les opérations qui ont un accès à des données présentes dans plusieurs partitions.</span><span class="sxs-lookup"><span data-stu-id="4b239-151">Group data that is used together in the same shard, and avoid operations that access data from multiple shards.</span></span> <span data-ttu-id="4b239-152">Une partition est une base de données SQL à part entière et les jonctions entre plusieurs bases de données doivent être effectuées du côté client.</span><span class="sxs-lookup"><span data-stu-id="4b239-152">A shard is a SQL database in its own right, and cross-database joins must be performed on the client side.</span></span>

    <span data-ttu-id="4b239-153">Bien que SQL Database ne prenne pas en charge les jointures entre les bases de données, vous pouvez utiliser les outils de bases de données élastiques pour effectuer des [requêtes multi-partitions](/azure/sql-database/sql-database-elastic-scale-multishard-querying).</span><span class="sxs-lookup"><span data-stu-id="4b239-153">Although SQL Database does not support cross-database joins, you can use the Elastic Database tools to perform [mutli-shard queries](/azure/sql-database/sql-database-elastic-scale-multishard-querying).</span></span> <span data-ttu-id="4b239-154">Une requête multi-partitions envoie des requêtes individuelles à chaque base de données et fusionne les résultats.</span><span class="sxs-lookup"><span data-stu-id="4b239-154">A multi-shard query sends individual queries to each database and merges the results.</span></span>

- <span data-ttu-id="4b239-155">Ne créez pas un système présentant des dépendances entre les partitions.</span><span class="sxs-lookup"><span data-stu-id="4b239-155">Don't design a system that has dependencies between shards.</span></span> <span data-ttu-id="4b239-156">Les contraintes d’intégrité référentielle, les déclencheurs et les procédures stockées dans une base de données ne peuvent pas faire référence à des objets présents dans une seconde base de données.</span><span class="sxs-lookup"><span data-stu-id="4b239-156">Referential integrity constraints, triggers, and stored procedures in one database cannot reference objects in another.</span></span>

- <span data-ttu-id="4b239-157">Si vous avez des données de référence fréquemment utilisées par les requêtes, envisagez de répliquer ces données sur les partitions.</span><span class="sxs-lookup"><span data-stu-id="4b239-157">If you have reference data that is frequently used by queries, consider replicating this data across shards.</span></span> <span data-ttu-id="4b239-158">Cette approche peut prévenir la nécessité de joindre des données sur des bases de données.</span><span class="sxs-lookup"><span data-stu-id="4b239-158">This approach can remove the need to join data across databases.</span></span> <span data-ttu-id="4b239-159">Dans l’idéal, ces données doivent être statiques ou lentes afin de réduire les efforts de réplication et de diminuer le risque qu’elles deviennent obsolètes.</span><span class="sxs-lookup"><span data-stu-id="4b239-159">Ideally, such data should be static or slow-moving, to minimize the replication effort and reduce the chances of it becoming stale.</span></span>

- <span data-ttu-id="4b239-160">Des shardlets appartenant à la même carte des partitions doivent présenter le même schéma.</span><span class="sxs-lookup"><span data-stu-id="4b239-160">Shardlets that belong to the same shard map should have the same schema.</span></span> <span data-ttu-id="4b239-161">Cette règle n’est pas indispensable pour SQL Database, mais la gestion et l’interrogation des données deviennent très complexes si chaque shardlet présente un schéma différent.</span><span class="sxs-lookup"><span data-stu-id="4b239-161">This rule is not enforced by SQL Database, but data management and querying becomes very complex if each shardlet has a different schema.</span></span> <span data-ttu-id="4b239-162">Créez plutôt des cartes de partitions distinctes pour chaque schéma.</span><span class="sxs-lookup"><span data-stu-id="4b239-162">Instead, create separate shard maps for each schema.</span></span> <span data-ttu-id="4b239-163">N’oubliez pas que des données appartenant à différents shardlets peuvent être stockées au sein de la même partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-163">Remember that data belonging to different shardlets can be stored in the same shard.</span></span>

- <span data-ttu-id="4b239-164">Les opérations transactionnelles sont prises en charge uniquement pour les données stockées dans une partition, et non dans des partitions différentes.</span><span class="sxs-lookup"><span data-stu-id="4b239-164">Transactional operations are only supported for data within a shard, and not across shards.</span></span> <span data-ttu-id="4b239-165">Les transactions peuvent être stockées au sein de différents shardlets tant qu’elles font partie de la même partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-165">Transactions can span shardlets as long as they are part of the same shard.</span></span> <span data-ttu-id="4b239-166">Par conséquent, si votre logique professionnelle nécessite la réalisation de transactions, stockez les données au sein de la même partition ou mettez en œuvre la cohérence finale.</span><span class="sxs-lookup"><span data-stu-id="4b239-166">Therefore, if your business logic needs to perform transactions, either store the data in the same shard or implement eventual consistency.</span></span>

- <span data-ttu-id="4b239-167">Disposez les partitions à proximité des utilisateurs qui accèdent aux données stockées dans ces partitions.</span><span class="sxs-lookup"><span data-stu-id="4b239-167">Place shards close to the users that access the data in those shards.</span></span> <span data-ttu-id="4b239-168">Cette stratégie aide à réduire la latence.</span><span class="sxs-lookup"><span data-stu-id="4b239-168">This strategy helps reduce latency.</span></span>

- <span data-ttu-id="4b239-169">Évitez de disposer de diverses partitions très actives et de partitions relativement inactives.</span><span class="sxs-lookup"><span data-stu-id="4b239-169">Avoid having a mixture of highly active and relatively inactive shards.</span></span> <span data-ttu-id="4b239-170">Essayez de répartir la charge de manière homogène parmi les partitions.</span><span class="sxs-lookup"><span data-stu-id="4b239-170">Try to spread the load evenly across shards.</span></span> <span data-ttu-id="4b239-171">Cela peut nécessiter un hachage des clés de sharding.</span><span class="sxs-lookup"><span data-stu-id="4b239-171">This might require hashing the sharding keys.</span></span> <span data-ttu-id="4b239-172">Si vous géolocalisez des partitions, assurez-vous que la carte des clés hachées renvoie vers les shardlets stockés au sein des partitions stockées à proximité des utilisateurs qui accèdent à ces données.</span><span class="sxs-lookup"><span data-stu-id="4b239-172">If you are geo-locating shards, make sure that the hashed keys map to shardlets held in shards stored close to the users that access that data.</span></span>

### <a name="partitioning-azure-table-storage"></a><span data-ttu-id="4b239-173">Partitionner le stockage de tables Azure</span><span class="sxs-lookup"><span data-stu-id="4b239-173">Partitioning Azure table storage</span></span>

<span data-ttu-id="4b239-174">Le stockage de tables Azure est un magasin de clés-valeurs conçue pour le partitionnement.</span><span class="sxs-lookup"><span data-stu-id="4b239-174">Azure table storage is a key-value store that's designed around partitioning.</span></span> <span data-ttu-id="4b239-175">Toutes les entités sont stockées au sein d’une partition et les partitions sont gérées en interne par le stockage de tables Azure.</span><span class="sxs-lookup"><span data-stu-id="4b239-175">All entities are stored in a partition, and partitions are managed internally by Azure table storage.</span></span> <span data-ttu-id="4b239-176">Chaque entité stockée dans une table doit présenter une clé en deux parties comprenant :</span><span class="sxs-lookup"><span data-stu-id="4b239-176">Each entity stored in a table must provide a two-part key that includes:</span></span>

- <span data-ttu-id="4b239-177">**La clé de partition**.</span><span class="sxs-lookup"><span data-stu-id="4b239-177">**The partition key**.</span></span> <span data-ttu-id="4b239-178">Il s’agit d’une valeur de chaîne qui détermine la partition dans laquelle le stockage de tables Azure placera l’entité.</span><span class="sxs-lookup"><span data-stu-id="4b239-178">This is a string value that determines the partition where Azure table storage will place the entity.</span></span> <span data-ttu-id="4b239-179">Toutes les entités avec la même clé de partition sont stockées au sein de la même partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-179">All entities with the same partition key are stored in the same partition.</span></span>

- <span data-ttu-id="4b239-180">**La clé de ligne**.</span><span class="sxs-lookup"><span data-stu-id="4b239-180">**The row key**.</span></span> <span data-ttu-id="4b239-181">Il s’agit d’une valeur de chaîne qui identifie l’entité au sein de la partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-181">This is a string value that identifies the entity within the partition.</span></span> <span data-ttu-id="4b239-182">Toutes les entités présentes au sein d’une partition sont triées par ordre croissant lexical selon cette clé.</span><span class="sxs-lookup"><span data-stu-id="4b239-182">All entities within a partition are sorted lexically, in ascending order, by this key.</span></span> <span data-ttu-id="4b239-183">La combinaison de la clé de partition et de la clé de ligne doit être unique pour chaque entité, et sa longueur ne peut pas dépasser 1 Ko.</span><span class="sxs-lookup"><span data-stu-id="4b239-183">The partition key/row key combination must be unique for each entity and cannot exceed 1 KB in length.</span></span>

<span data-ttu-id="4b239-184">Si une entité est ajoutée à une table avec une clé de partition précédemment inutilisée, le stockage de tables Azure crée une partition pour cette entité.</span><span class="sxs-lookup"><span data-stu-id="4b239-184">If an entity is added to a table with a previously unused partition key, Azure table storage creates a new partition for this entity.</span></span> <span data-ttu-id="4b239-185">Les autres entités présentant la même clé de partition sont stockées au sein de la même partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-185">Other entities with the same partition key will be stored in the same partition.</span></span>

<span data-ttu-id="4b239-186">Ce mécanisme met efficacement en œuvre une stratégie de montée en puissance automatique.</span><span class="sxs-lookup"><span data-stu-id="4b239-186">This mechanism effectively implements an automatic scale-out strategy.</span></span> <span data-ttu-id="4b239-187">Chaque partition est stockée sur le même serveur dans un centre de données Azure pour s’assurer que les requêtes qui récupèrent des données à partir d’une partition unique s’exécutent rapidement.</span><span class="sxs-lookup"><span data-stu-id="4b239-187">Each partition is stored on the same server in an Azure datacenter to help ensure that queries that retrieve data from a single partition run quickly.</span></span>

<span data-ttu-id="4b239-188">Microsoft a publié des [objectifs d’extensibilité] pour Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="4b239-188">Microsoft has published [scalability targets] for Azure Storage.</span></span> <span data-ttu-id="4b239-189">Si votre système est susceptible de dépasser ces limites, envisagez de fractionner les entités en plusieurs tables.</span><span class="sxs-lookup"><span data-stu-id="4b239-189">If your system is likely to exceed these limits, consider splitting entities into multiple tables.</span></span> <span data-ttu-id="4b239-190">Utilisez le partitionnement vertical pour diviser les champs dans les groupes qui sont le plus susceptibles d’être sollicités ensemble.</span><span class="sxs-lookup"><span data-stu-id="4b239-190">Use vertical partitioning to divide the fields into the groups that are most likely to be accessed together.</span></span>

<span data-ttu-id="4b239-191">Le diagramme suivant illustre la structure logique d’un exemple de compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="4b239-191">The following diagram shows the logical structure of an example storage account.</span></span> <span data-ttu-id="4b239-192">Le compte de stockage contient trois tables : Informations relatives aux clients, informations relatives aux produits et informations relatives aux commandes.</span><span class="sxs-lookup"><span data-stu-id="4b239-192">The storage account contains three tables: Customer Info, Product Info, and Order Info.</span></span>

![Tables et partitions dans un exemple de compte de stockage](./images/data-partitioning/TableStorage.png)

<span data-ttu-id="4b239-194">Chaque table a plusieurs partitions.</span><span class="sxs-lookup"><span data-stu-id="4b239-194">Each table has multiple partitions.</span></span>

- <span data-ttu-id="4b239-195">Dans la table des informations relatives aux clients, les données sont partitionnées en fonction de la ville où se trouve le client.</span><span class="sxs-lookup"><span data-stu-id="4b239-195">In the Customer Info table, the data is partitioned according to the city where the customer is located.</span></span> <span data-ttu-id="4b239-196">La clé de ligne contient l’ID client.</span><span class="sxs-lookup"><span data-stu-id="4b239-196">The row key contains the customer ID.</span></span>
- <span data-ttu-id="4b239-197">Dans la table des informations relatives aux produits, les produits sont partitionnés par catégorie et la clé de ligne contient le numéro du produit.</span><span class="sxs-lookup"><span data-stu-id="4b239-197">In the Product Info table, products are partitioned by product category, and the row key contains the product number.</span></span>
- <span data-ttu-id="4b239-198">Dans la table des informations relatives aux commandes, les commandes sont partitionnées en fonction de la date de commande et la clé de ligne indique l’horaire de réception de la commande.</span><span class="sxs-lookup"><span data-stu-id="4b239-198">In the Order Info table, the orders are partitioned by order date, and the row key specifies the time the order was received.</span></span> <span data-ttu-id="4b239-199">Remarquez que toutes les données sont classées en fonction de la clé de ligne au sein de chaque partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-199">Note that all data is ordered by the row key in each partition.</span></span>

<span data-ttu-id="4b239-200">Considérez les points suivants quand vous concevez vos entités pour le stockage de tables Azure :</span><span class="sxs-lookup"><span data-stu-id="4b239-200">Consider the following points when you design your entities for Azure table storage:</span></span>

- <span data-ttu-id="4b239-201">Sélectionnez une clé de partition et une clé de ligne en fonction de comment accéder aux données.</span><span class="sxs-lookup"><span data-stu-id="4b239-201">Select a partition key and row key by how the data is accessed.</span></span> <span data-ttu-id="4b239-202">Choisissez une combinaison de clé de partition et de clé de ligne qui prend en charge la plupart de vos requêtes.</span><span class="sxs-lookup"><span data-stu-id="4b239-202">Choose a partition key/row key combination that supports the majority of your queries.</span></span> <span data-ttu-id="4b239-203">Les requêtes les plus efficaces récupèrent les données en spécifiant la clé de partition et la clé de ligne.</span><span class="sxs-lookup"><span data-stu-id="4b239-203">The most efficient queries retrieve data by specifying the partition key and the row key.</span></span> <span data-ttu-id="4b239-204">Les requêtes qui spécifient une clé de partition et une plage de clés de ligne peuvent être effectuées en analysant une seule partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-204">Queries that specify a partition key and a range of row keys can be completed by scanning a single partition.</span></span> <span data-ttu-id="4b239-205">Cette opération est relativement rapide, car les données sont conservées par ordre de clé de ligne.</span><span class="sxs-lookup"><span data-stu-id="4b239-205">This is relatively fast because the data is held in row key order.</span></span> <span data-ttu-id="4b239-206">Si les requêtes ne précisent pas quelle partition doit être analysée, il faut toutes les analyser.</span><span class="sxs-lookup"><span data-stu-id="4b239-206">If queries don't specify which partition to scan, every partition must be scanned.</span></span>

- <span data-ttu-id="4b239-207">Si une entité présente une clé naturelle, utilisez-la alors en tant que clé de partition et spécifiez une chaîne vide en tant que clé de ligne.</span><span class="sxs-lookup"><span data-stu-id="4b239-207">If an entity has one natural key, then use it as the partition key and specify an empty string as the row key.</span></span> <span data-ttu-id="4b239-208">Si une entité présente une clé composite de deux propriétés, sélectionnez la propriété variable la plus lente en tant que clé de partition et l’autre en tant que clé de ligne.</span><span class="sxs-lookup"><span data-stu-id="4b239-208">If an entity has a composite key consisting of two properties, select the slowest changing property as the partition key and the other as the row key.</span></span> <span data-ttu-id="4b239-209">Si une entité présente plus de deux propriétés de clé, utilisez une concaténation des propriétés pour spécifier les clés de partition et de ligne.</span><span class="sxs-lookup"><span data-stu-id="4b239-209">If an entity has more than two key properties, use a concatenation of properties to provide the partition and row keys.</span></span>

- <span data-ttu-id="4b239-210">Si vous effectuez régulièrement des requêtes pour rechercher des données à l’aide de champs autres que les clés de partition et de ligne, implémentez le [modèle de table d’index](../patterns/index-table.md) ou utilisez plutôt un autre magasin de données prenant en charge l’indexation, tel que Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4b239-210">If you regularly perform queries that look up data by using fields other than the partition and row keys, consider implementing the [Index Table pattern](../patterns/index-table.md), or consider using a different data store that supports indexing, such as Cosmos DB.</span></span>

- <span data-ttu-id="4b239-211">Si vous générez des clés de partition à l’aide d’une séquence incrémentielle unitone (par exemple, « 0001 », « 0002 », « 0003 ») et que chaque partition contient uniquement une quantité limitée de données, le stockage de tables Azure peut regrouper physiquement ces partitions sur le même serveur.</span><span class="sxs-lookup"><span data-stu-id="4b239-211">If you generate partition keys by using a monotonic sequence (such as "0001", "0002", "0003") and each partition only contains a limited amount of data, Azure table storage can physically group these partitions together on the same server.</span></span> <span data-ttu-id="4b239-212">Le stockage Azure suppose que l’application est plus susceptible d’effectuer des requêtes sur une plage contiguë de partitions (requêtes de plage) et est optimisée pour cet usage.</span><span class="sxs-lookup"><span data-stu-id="4b239-212">Azure Storage assumes that the application is most likely to perform queries across a contiguous range of partitions (range queries) and is optimized for this case.</span></span> <span data-ttu-id="4b239-213">Cependant, cette approche peut conduire à la présence de zones réactives, car toutes les insertions de nouvelles entités seront probablement concentrées sur l’une des extrémités de la plage contiguë.</span><span class="sxs-lookup"><span data-stu-id="4b239-213">However, this approach can lead to hotspots, because all insertions of new entities are likely to be concentrated at one end the contiguous range.</span></span> <span data-ttu-id="4b239-214">Elle peut également réduire l’évolutivité.</span><span class="sxs-lookup"><span data-stu-id="4b239-214">It can also reduce scalability.</span></span> <span data-ttu-id="4b239-215">Pour répartir la charge de manière plus homogène, il peut être nécessaire de hacher la clé de partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-215">To spread the load more evenly, consider hashing the partition key.</span></span>

- <span data-ttu-id="4b239-216">Le stockage de tables Azure prend en charge les opérations transactionnelles pour les entités appartenant à la même partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-216">Azure table storage supports transactional operations for entities that belong to the same partition.</span></span> <span data-ttu-id="4b239-217">Une application peut effectuer plusieurs opérations d’insertion, de mise à jour, de suppression, de remplacement ou de fusion sous forme d’unité atomique tant que la transaction ne comporte pas plus de 100 entités et que la charge utile de la requête ne dépasse pas 4 Mo.</span><span class="sxs-lookup"><span data-stu-id="4b239-217">An application can perform multiple insert, update, delete, replace, or merge operations as an atomic unit, as long as the transaction doesn't include more than 100 entities and the payload of the request doesn't exceed 4 MB.</span></span> <span data-ttu-id="4b239-218">Les opérations qui chevauchent plusieurs partitions ne sont pas transactionnelles et peuvent vous obliger à implémenter la cohérence finale.</span><span class="sxs-lookup"><span data-stu-id="4b239-218">Operations that span multiple partitions are not transactional, and might require you to implement eventual consistency.</span></span> <span data-ttu-id="4b239-219">Pour plus d’informations sur le stockage de tables et les transactions, consultez la page [Exécution de transactions de groupe d’entités].</span><span class="sxs-lookup"><span data-stu-id="4b239-219">For more information about table storage and transactions, see [Performing entity group transactions].</span></span>

- <span data-ttu-id="4b239-220">Prenez en compte la granularité de la clé de partition :</span><span class="sxs-lookup"><span data-stu-id="4b239-220">Consider the granularity of the partition key:</span></span>

  - <span data-ttu-id="4b239-221">Utiliser la même clé de partition pour chaque entité a conduit à la création d’une unique partition sur un seul serveur.</span><span class="sxs-lookup"><span data-stu-id="4b239-221">Using the same partition key for every entity results in a single partition that's held on one server.</span></span> <span data-ttu-id="4b239-222">Cela empêche la montée en charge de la partition et restreint la charge à un seul serveur.</span><span class="sxs-lookup"><span data-stu-id="4b239-222">This prevents the partition from scaling out and focuses the load on a single server.</span></span> <span data-ttu-id="4b239-223">Par conséquent, cette approche convient uniquement pour stocker un nombre restreint d’entités.</span><span class="sxs-lookup"><span data-stu-id="4b239-223">As a result, this approach is only suitable for storing a small number of entities.</span></span> <span data-ttu-id="4b239-224">Cependant, elle garantit que toutes les entités puissent participer aux transactions relatives à des groupes d’entités.</span><span class="sxs-lookup"><span data-stu-id="4b239-224">However, it does ensure that all entities can participate in entity group transactions.</span></span>

  - <span data-ttu-id="4b239-225">Le fait d’utiliser une clé de partition unique pour chaque entité conduit le service de stockage de tables à créer une partition distincte pour chaque entité, ce qui peut mener à la création d’un grand nombre de petites partitions.</span><span class="sxs-lookup"><span data-stu-id="4b239-225">Using a unique partition key for every entity causes the table storage service to create a separate partition for each entity, possibly resulting in a large number of small partitions.</span></span> <span data-ttu-id="4b239-226">Cette approche est plus extensible que l’utilisation d’une clé de partition unique, mais les transactions de groupe d’entités ne sont pas possibles.</span><span class="sxs-lookup"><span data-stu-id="4b239-226">This approach is more scalable than using a single partition key, but entity group transactions are not possible.</span></span> <span data-ttu-id="4b239-227">De plus, les requêtes qui extraient plusieurs entités peuvent impliquer la lecture à partir de plusieurs serveurs.</span><span class="sxs-lookup"><span data-stu-id="4b239-227">Also, queries that fetch more than one entity might involve reading from more than one server.</span></span> <span data-ttu-id="4b239-228">Cependant, si l’application effectue des requêtes de plage, l’utilisation d’une séquence unitone pour les clés de partition peut permettre d’optimiser ces requêtes.</span><span class="sxs-lookup"><span data-stu-id="4b239-228">However, if the application performs range queries, then using a monotonic sequence for the partition keys might help to optimize these queries.</span></span>

  - <span data-ttu-id="4b239-229">Le fait de partager la clé de partition au sein d’un sous-ensemble d’entités permet de regrouper les entités associées au sein de la même partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-229">Sharing the partition key across a subset of entities makes it possible to group related entities in the same partition.</span></span> <span data-ttu-id="4b239-230">Les opérations qui impliquent des entités associées peuvent être effectuées à l’aide de transactions relatives à des groupes d’entités et les requêtes intervenant sur un jeu d’entités associées peuvent être traitées en accédant à un seul serveur.</span><span class="sxs-lookup"><span data-stu-id="4b239-230">Operations that involve related entities can be performed by using entity group transactions, and queries that fetch a set of related entities can be satisfied by accessing a single server.</span></span>

<span data-ttu-id="4b239-231">Pour plus d’informations, consultez le [Guide de conception de table de stockage Azure].</span><span class="sxs-lookup"><span data-stu-id="4b239-231">For more information, see [Azure storage table design guide].</span></span>

## <a name="partitioning-azure-blob-storage"></a><span data-ttu-id="4b239-232">Partitionner le stockage d’objets blob Azure </span><span class="sxs-lookup"><span data-stu-id="4b239-232">Partitioning Azure blob storage</span></span>

<span data-ttu-id="4b239-233">Le stockage d’objets blob Azure permet de stocker des objets binaires volumineux.</span><span class="sxs-lookup"><span data-stu-id="4b239-233">Azure blob storage makes it possible to hold large binary objects.</span></span> <span data-ttu-id="4b239-234">Utilisez des objets blob de blocs lorsque vous devez charger ou télécharger rapidement d’importants volumes de données.</span><span class="sxs-lookup"><span data-stu-id="4b239-234">Use block blobs in scenarios when you need to upload or download large volumes of data quickly.</span></span> <span data-ttu-id="4b239-235">Utilisez des objets blob de pages pour les applications nécessitant un accès aléatoire plutôt qu’en série à certaines parties des données.</span><span class="sxs-lookup"><span data-stu-id="4b239-235">Use page blobs for applications that require random rather than serial access to parts of the data.</span></span>

<span data-ttu-id="4b239-236">Chaque objet blob (de blocs ou de pages) est stocké au sein d’un conteneur dans un compte de stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="4b239-236">Each blob (either block or page) is held in a container in an Azure storage account.</span></span> <span data-ttu-id="4b239-237">Vous pouvez utiliser des conteneurs pour regrouper des blobs associés présentant les mêmes exigences de sécurité.</span><span class="sxs-lookup"><span data-stu-id="4b239-237">You can use containers to group related blobs that have the same security requirements.</span></span> <span data-ttu-id="4b239-238">Ce regroupement est logique, et non physique.</span><span class="sxs-lookup"><span data-stu-id="4b239-238">This grouping is logical rather than physical.</span></span> <span data-ttu-id="4b239-239">Dans un conteneur, chaque objet blob a un nom unique.</span><span class="sxs-lookup"><span data-stu-id="4b239-239">Inside a container, each blob has a unique name.</span></span>

<span data-ttu-id="4b239-240">La clé de partition d’un blob est le nom du compte + le nom du conteneur + le nom du blob.</span><span class="sxs-lookup"><span data-stu-id="4b239-240">The partition key for a blob is account name + container name + blob name.</span></span> <span data-ttu-id="4b239-241">La clé de partition sert à partitionner les données en plages, et la charge de ces plages est équilibrée sur l’ensemble du système.</span><span class="sxs-lookup"><span data-stu-id="4b239-241">The partition key is used to partition data into ranges and these ranges are load-balanced across the system.</span></span> <span data-ttu-id="4b239-242">Les blobs peuvent être répartis sur plusieurs serveurs afin d’offrir un accès horizontal. Toutefois, un blob donné ne peut être servi que par un seul serveur.</span><span class="sxs-lookup"><span data-stu-id="4b239-242">Blobs can be distributed across many servers in order to scale out access to them, but a single blob can only be served by a single server.</span></span>

<span data-ttu-id="4b239-243">Si votre schéma d’affectation de noms utilise des timestamp ou des identificateurs numériques, cela peut entraîner un trafic excessif vers une partition, limitant l’efficacité du système à équilibrer la charge.</span><span class="sxs-lookup"><span data-stu-id="4b239-243">If your naming scheme uses timestamps or numerical identifiers, it can lead to excessive traffic going to one partition, limiting the system from effectively load balancing.</span></span> <span data-ttu-id="4b239-244">Par exemple, si vos opérations quotidiennes utilisent un objet blob avec un timestamp comme *yyyy-mm-dd*, tout le trafic pour cette opération est alors dirigé vers un serveur de partition unique.</span><span class="sxs-lookup"><span data-stu-id="4b239-244">For instance, if you have daily operations that use a blob object with a timestamp such as *yyyy-mm-dd*, all the traffic for that operation would go to a single partition server.</span></span> <span data-ttu-id="4b239-245">Envisagez plutôt d’ajouter un préfixe au nom avec un hachage à 3 chiffres.</span><span class="sxs-lookup"><span data-stu-id="4b239-245">Instead, consider prefixing the name with a 3-digit hash.</span></span> <span data-ttu-id="4b239-246">Pour plus d’informations, consultez [Convention de nommage des partitions](/azure/storage/common/storage-performance-checklist#subheading47)</span><span class="sxs-lookup"><span data-stu-id="4b239-246">For more information, see [Partition Naming Convention](/azure/storage/common/storage-performance-checklist#subheading47)</span></span>

<span data-ttu-id="4b239-247">Les actions d’écriture d’un seul bloc ou d’une seule page sont atomiques, mais pas les opérations intervenant sur des blocs, des pages ou des objets blob.</span><span class="sxs-lookup"><span data-stu-id="4b239-247">The actions of writing a single block or page are atomic, but operations that span blocks, pages, or blobs are not.</span></span> <span data-ttu-id="4b239-248">S’il vous faut garantir la cohérence quand vous réalisez des opérations d’écriture entre des blocs, des pages et des objets blob, désactivez un verrou d’écriture à l’aide d’un bail d’objet blob.</span><span class="sxs-lookup"><span data-stu-id="4b239-248">If you need to ensure consistency when performing write operations across blocks, pages, and blobs, take out a write lock by using a blob lease.</span></span>

## <a name="partitioning-azure-storage-queues"></a><span data-ttu-id="4b239-249">Partitionner les files d’attente de stockage</span><span class="sxs-lookup"><span data-stu-id="4b239-249">Partitioning Azure storage queues</span></span>

<span data-ttu-id="4b239-250">Les files d’attente de stockage Azure vous permettent de mettre en œuvre une messagerie asynchrone entre les processus.</span><span class="sxs-lookup"><span data-stu-id="4b239-250">Azure storage queues enable you to implement asynchronous messaging between processes.</span></span> <span data-ttu-id="4b239-251">Un compte de stockage Azure peut contenir un nombre illimité de files d’attente, et chaque file d’attente peut contenir un nombre illimité de messages.</span><span class="sxs-lookup"><span data-stu-id="4b239-251">An Azure storage account can contain any number of queues, and each queue can contain any number of messages.</span></span> <span data-ttu-id="4b239-252">La seule limite concerne l’espace disponible dans le compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="4b239-252">The only limitation is the space that's available in the storage account.</span></span> <span data-ttu-id="4b239-253">La taille maximale d’un message est de 64 Ko.</span><span class="sxs-lookup"><span data-stu-id="4b239-253">The maximum size of an individual message is 64 KB.</span></span> <span data-ttu-id="4b239-254">Si vous devez utiliser des messages dont la taille est supérieure, envisagez plutôt d’utiliser des files d’attente Service Bus Azure.</span><span class="sxs-lookup"><span data-stu-id="4b239-254">If you require messages bigger than this, then consider using Azure Service Bus queues instead.</span></span>

<span data-ttu-id="4b239-255">Chaque file d’attente de stockage a un nom unique au sein du compte de stockage qui la contient.</span><span class="sxs-lookup"><span data-stu-id="4b239-255">Each storage queue has a unique name within the storage account that contains it.</span></span> <span data-ttu-id="4b239-256">Azure partitionne les files d’attente en fonction du nom.</span><span class="sxs-lookup"><span data-stu-id="4b239-256">Azure partitions queues based on the name.</span></span> <span data-ttu-id="4b239-257">Tous les messages de la même file d’attente sont stockés dans la même partition, qui est contrôlée par un serveur unique.</span><span class="sxs-lookup"><span data-stu-id="4b239-257">All messages for the same queue are stored in the same partition, which is controlled by a single server.</span></span> <span data-ttu-id="4b239-258">Différentes files d’attente peuvent être gérées par différents serveurs afin d’équilibrer la charge.</span><span class="sxs-lookup"><span data-stu-id="4b239-258">Different queues can be managed by different servers to help balance the load.</span></span> <span data-ttu-id="4b239-259">La répartition des files d’attente entre les serveurs est transparente pour les applications et les utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="4b239-259">The allocation of queues to servers is transparent to applications and users.</span></span>

<span data-ttu-id="4b239-260">Dans une application à grande échelle, n’utilisez pas la même file d’attente de stockage pour toutes les instances de l’application, car cette approche peut transformer le serveur qui héberge la file d’attente en zone sensible.</span><span class="sxs-lookup"><span data-stu-id="4b239-260">In a large-scale application, don't use the same storage queue for all instances of the application because this approach might cause the server that's hosting the queue to become a hotspot.</span></span> <span data-ttu-id="4b239-261">Utilisez plutôt différentes files d’attente pour les différentes zones fonctionnelles de l’application.</span><span class="sxs-lookup"><span data-stu-id="4b239-261">Instead, use different queues for different functional areas of the application.</span></span> <span data-ttu-id="4b239-262">Les files d’attente de stockage Azure ne prennent pas en charge les transactions. Ainsi, le fait de diriger les messages vers différentes files d’attente ne présente que des répercussions limitées sur la cohérence de la messagerie.</span><span class="sxs-lookup"><span data-stu-id="4b239-262">Azure storage queues do not support transactions, so directing messages to different queues should have little impact on messaging consistency.</span></span>

<span data-ttu-id="4b239-263">Une file d’attente de stockage Azure peut gérer jusqu’à 2 000 messages par seconde.</span><span class="sxs-lookup"><span data-stu-id="4b239-263">An Azure storage queue can handle up to 2,000 messages per second.</span></span> <span data-ttu-id="4b239-264">Si vous devez traiter les messages à une vitesse supérieure, créez plusieurs files d’attente.</span><span class="sxs-lookup"><span data-stu-id="4b239-264">If you need to process messages at a greater rate than this, consider creating multiple queues.</span></span> <span data-ttu-id="4b239-265">Par exemple, dans une application globale, créez des files d’attente de stockage distinctes dans des comptes de stockage distincts pour gérer les instances de l’application en cours d’exécution dans chaque région.</span><span class="sxs-lookup"><span data-stu-id="4b239-265">For example, in a global application, create separate storage queues in separate storage accounts to handle application instances that are running in each region.</span></span>

## <a name="partitioning-azure-service-bus"></a><span data-ttu-id="4b239-266">Partitionnement Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="4b239-266">Partitioning Azure Service Bus</span></span>

<span data-ttu-id="4b239-267">Azure Service Bus utilise un courtier de messages pour gérer les messages envoyés à une file d’attente ou une rubrique Service Bus.</span><span class="sxs-lookup"><span data-stu-id="4b239-267">Azure Service Bus uses a message broker to handle messages that are sent to a Service Bus queue or topic.</span></span> <span data-ttu-id="4b239-268">Par défaut, tous les messages envoyés à une file d’attente ou une rubrique sont gérés par le même processus de courtier de messages.</span><span class="sxs-lookup"><span data-stu-id="4b239-268">By default, all messages that are sent to a queue or topic are handled by the same message broker process.</span></span> <span data-ttu-id="4b239-269">Cette architecture peut imposer une limite concernant le débit global de la file d’attente des messages.</span><span class="sxs-lookup"><span data-stu-id="4b239-269">This architecture can place a limitation on the overall throughput of the message queue.</span></span> <span data-ttu-id="4b239-270">Toutefois, vous pouvez également partitionner une file d’attente ou une rubrique quand elle est créée.</span><span class="sxs-lookup"><span data-stu-id="4b239-270">However, you can also partition a queue or topic when it is created.</span></span> <span data-ttu-id="4b239-271">Pour cela, affectez la valeur *true* à la propriété *EnablePartitioning* de la description de file d’attente ou de rubrique.</span><span class="sxs-lookup"><span data-stu-id="4b239-271">You do this by setting the *EnablePartitioning* property of the queue or topic description to *true*.</span></span>

<span data-ttu-id="4b239-272">Une file d’attente ou une rubrique partitionnée est divisée en plusieurs fragments, chacun d’eux étant secondé par une banque de messages et un courtier de messages distincts.</span><span class="sxs-lookup"><span data-stu-id="4b239-272">A partitioned queue or topic is divided into multiple fragments, each of which is backed by a separate message store and message broker.</span></span> <span data-ttu-id="4b239-273">Service Bus prend en charge la création et la gestion de ces fragments.</span><span class="sxs-lookup"><span data-stu-id="4b239-273">Service Bus takes responsibility for creating and managing these fragments.</span></span> <span data-ttu-id="4b239-274">Lorsqu’une application publie un message à destination d’une file d’attente ou d’une rubrique partitionnée, Service Bus attribue ce message à un fragment de cette file d’attente ou rubrique.</span><span class="sxs-lookup"><span data-stu-id="4b239-274">When an application posts a message to a partitioned queue or topic, Service Bus assigns the message to a fragment for that queue or topic.</span></span> <span data-ttu-id="4b239-275">Lorsqu’une application reçoit un message à partir d’une file d’attente ou d’un abonnement, Service Bus vérifie chaque fragment pour identifier le message suivant disponible et le transmet ensuite à l’application pour le traiter.</span><span class="sxs-lookup"><span data-stu-id="4b239-275">When an application receives a message from a queue or subscription, Service Bus checks each fragment for the next available message and then passes it to the application for processing.</span></span>

<span data-ttu-id="4b239-276">Cette structure permet de répartir la charge parmi les courtiers de messages et les banques de messages, ce qui améliore l’extensibilité et la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="4b239-276">This structure helps distribute the load across message brokers and message stores, increasing scalability and improving availability.</span></span> <span data-ttu-id="4b239-277">Si la banque de messages ou le courtier de messages pour un fragment est temporairement indisponible, Service Bus peut récupérer des messages à partir de l’un des fragments restants disponibles.</span><span class="sxs-lookup"><span data-stu-id="4b239-277">If the message broker or message store for one fragment is temporarily unavailable, Service Bus can retrieve messages from one of the remaining available fragments.</span></span>

<span data-ttu-id="4b239-278">Service Bus attribue un message à un fragment comme suit :</span><span class="sxs-lookup"><span data-stu-id="4b239-278">Service Bus assigns a message to a fragment as follows:</span></span>

- <span data-ttu-id="4b239-279">Si le message appartient à une session, tous les messages présentant la même valeur pour la propriété *SessionId* sont envoyés au même fragment.</span><span class="sxs-lookup"><span data-stu-id="4b239-279">If the message belongs to a session, all messages with the same value for the *SessionId*  property are sent to the same fragment.</span></span>

- <span data-ttu-id="4b239-280">Si le message n’appartient pas à une session, mais que l’expéditeur a spécifié une valeur pour la propriété *PartitionKey*, tous les messages ayant la même valeur *PartitionKey* sont envoyés au même fragment.</span><span class="sxs-lookup"><span data-stu-id="4b239-280">If the message does not belong to a session, but the sender has specified a value for the *PartitionKey* property, then all messages with the same *PartitionKey* value are sent to the same fragment.</span></span>

  > [!NOTE]
  > <span data-ttu-id="4b239-281">Si les propriétés *SessionId* et *PartitionKey* sont toutes deux spécifiées, elles doivent être définies sur la même valeur, sinon le message est rejeté.</span><span class="sxs-lookup"><span data-stu-id="4b239-281">If the *SessionId* and *PartitionKey* properties are both specified, then they must be set to the same value or the message will be rejected.</span></span>

- <span data-ttu-id="4b239-282">Si les propriétés *SessionId* et *PartitionKey* d’un message ne sont pas spécifiées, mais que la détection des doublons est activée, la propriété *MessageId* est utilisée.</span><span class="sxs-lookup"><span data-stu-id="4b239-282">If the *SessionId* and *PartitionKey* properties for a message are not specified, but duplicate detection is enabled, the *MessageId* property will be used.</span></span> <span data-ttu-id="4b239-283">Tous les messages présentant la même propriété *MessageId* sont dirigés vers le même fragment.</span><span class="sxs-lookup"><span data-stu-id="4b239-283">All messages with the same *MessageId* will be directed to the same fragment.</span></span>

- <span data-ttu-id="4b239-284">Si des messages ne présentent aucune propriété *SessionId, PartitionKey* ou *MessageId*, Service Bus les attribue aux fragments de manière séquentielle.</span><span class="sxs-lookup"><span data-stu-id="4b239-284">If messages do not include a *SessionId, PartitionKey,* or *MessageId* property, then Service Bus assigns messages to fragments sequentially.</span></span> <span data-ttu-id="4b239-285">Si un fragment n’est pas disponible, Service Bus passe au suivant.</span><span class="sxs-lookup"><span data-stu-id="4b239-285">If a fragment is unavailable, Service Bus will move on to the next.</span></span> <span data-ttu-id="4b239-286">Ainsi, une défaillance temporaire de l’infrastructure de messagerie n’entraîne pas de défaillance de l’opération d’envoi des messages.</span><span class="sxs-lookup"><span data-stu-id="4b239-286">This means that a temporary fault in the messaging infrastructure does not cause the message-send operation to fail.</span></span>

<span data-ttu-id="4b239-287">Considérez les points suivants quand vous décidez ou non de partitionner une rubrique ou une file d’attente de messages Service Bus, et à l’aide de quelle méthode :</span><span class="sxs-lookup"><span data-stu-id="4b239-287">Consider the following points when deciding if or how to partition a Service Bus message queue or topic:</span></span>

- <span data-ttu-id="4b239-288">Les rubriques et files d’attente Service Bus sont créées dans l’étendue d’un espace de noms Service Bus.</span><span class="sxs-lookup"><span data-stu-id="4b239-288">Service Bus queues and topics are created within the scope of a Service Bus namespace.</span></span> <span data-ttu-id="4b239-289">Service Bus permet actuellement de disposer jusqu’à 100 rubriques ou files d’attente par espace de noms.</span><span class="sxs-lookup"><span data-stu-id="4b239-289">Service Bus currently allows up to 100 partitioned queues or topics per namespace.</span></span>

- <span data-ttu-id="4b239-290">Chaque espace de noms Service Bus impose des quotas sur les ressources disponibles, telles que le nombre d’abonnements par rubrique, le nombre d’envois et de réceptions simultanés de demandes par seconde, et le nombre maximal de connexions simultanées pouvant être établies.</span><span class="sxs-lookup"><span data-stu-id="4b239-290">Each Service Bus namespace imposes quotas on the available resources, such as the number of subscriptions per topic, the number of concurrent send and receive requests per second, and the maximum number of concurrent connections that can be established.</span></span> <span data-ttu-id="4b239-291">Ces quotas sont décrits dans [Quotas Service Bus].</span><span class="sxs-lookup"><span data-stu-id="4b239-291">These quotas are documented in [Service Bus quotas].</span></span> <span data-ttu-id="4b239-292">Si vous pensez dépasser ces valeurs, créez des espaces de nom supplémentaires disposant de leurs propres rubriques et files d’attente, puis répartissez le travail entre ces espaces de nom.</span><span class="sxs-lookup"><span data-stu-id="4b239-292">If you expect to exceed these values, then create additional namespaces with their own queues and topics, and spread the work across these namespaces.</span></span> <span data-ttu-id="4b239-293">Par exemple, au sein d’une application globale, créez des espaces de noms distincts dans chaque région et configurez les instances applicatives pour utiliser les rubriques et les files d’attente présentes au sein de l’espace de nom le plus proche.</span><span class="sxs-lookup"><span data-stu-id="4b239-293">For example, in a global application, create separate namespaces in each region and configure application instances to use the queues and topics in the nearest namespace.</span></span>

- <span data-ttu-id="4b239-294">Les messages envoyés dans le cadre d’une transaction doivent spécifier une clé de partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-294">Messages that are sent as part of a transaction must specify a partition key.</span></span> <span data-ttu-id="4b239-295">Il peut s’agir d’une propriété *SessionId*, *PartitionKey* ou *MessageId*.</span><span class="sxs-lookup"><span data-stu-id="4b239-295">This can be a *SessionId*, *PartitionKey*, or *MessageId* property.</span></span> <span data-ttu-id="4b239-296">Tous les messages envoyés dans le cadre de la même transaction doivent spécifier la même clé de partition, car ils doivent être gérés par le même processus Broker de messages.</span><span class="sxs-lookup"><span data-stu-id="4b239-296">All messages that are sent as part of the same transaction must specify the same partition key because they must be handled by the same message broker process.</span></span> <span data-ttu-id="4b239-297">Vous ne pouvez pas envoyer des messages à différentes files d’attente ou rubriques au sein de la même transaction.</span><span class="sxs-lookup"><span data-stu-id="4b239-297">You cannot send messages to different queues or topics within the same transaction.</span></span>

- <span data-ttu-id="4b239-298">Vous ne pouvez pas configurer les rubriques et les files d’attente partitionnées pour qu’elles soient supprimées automatiquement quand elles deviennent inactives.</span><span class="sxs-lookup"><span data-stu-id="4b239-298">Partitioned queues and topics can't be configured to be automatically deleted when they become idle.</span></span>

- <span data-ttu-id="4b239-299">Actuellement, vous ne pouvez pas utiliser des files d’attente et des rubriques partitionnées avec le protocole AMQP (Advanced Message Queueing Protocol) si vous créez des solutions interplateformes ou hybrides.</span><span class="sxs-lookup"><span data-stu-id="4b239-299">Partitioned queues and topics can't currently be used with the Advanced Message Queuing Protocol (AMQP) if you are building cross-platform or hybrid solutions.</span></span>

## <a name="partitioning-cosmos-db"></a><span data-ttu-id="4b239-300">Partitionnement Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="4b239-300">Partitioning Cosmos DB</span></span>

<span data-ttu-id="4b239-301">Azure Cosmos DB est une base de données NoSQL pouvant stocker des documents JSON à l’aide de [l’API SQL Azure Cosmos DB][cosmosdb-sql-api].</span><span class="sxs-lookup"><span data-stu-id="4b239-301">Azure Cosmos DB is a NoSQL database that can store JSON documents using the [Azure Cosmos DB SQL API][cosmosdb-sql-api].</span></span> <span data-ttu-id="4b239-302">Un document de base de données Cosmos DB correspond à une représentation sérialisée JSON d’un objet ou autre élément de données.</span><span class="sxs-lookup"><span data-stu-id="4b239-302">A document in a Cosmos DB database is a JSON-serialized representation of an object or other piece of data.</span></span> <span data-ttu-id="4b239-303">Aucun schéma fixe n’est appliqué, mais chaque document doit contenir un ID unique.</span><span class="sxs-lookup"><span data-stu-id="4b239-303">No fixed schemas are enforced except that every document must contain a unique ID.</span></span>

<span data-ttu-id="4b239-304">Les documents sont organisés en collections.</span><span class="sxs-lookup"><span data-stu-id="4b239-304">Documents are organized into collections.</span></span> <span data-ttu-id="4b239-305">Vous pouvez regrouper des documents connexes dans une collection.</span><span class="sxs-lookup"><span data-stu-id="4b239-305">You can group related documents together in a collection.</span></span> <span data-ttu-id="4b239-306">Par exemple, dans un système gérant des publications de blog, vous pouvez stocker le contenu de chaque publication de blog sous forme de document dans une collection.</span><span class="sxs-lookup"><span data-stu-id="4b239-306">For example, in a system that maintains blog postings, you can store the contents of each blog post as a document in a collection.</span></span> <span data-ttu-id="4b239-307">Vous pouvez également créer des collections pour chaque type d’objet.</span><span class="sxs-lookup"><span data-stu-id="4b239-307">You can also create collections for each subject type.</span></span> <span data-ttu-id="4b239-308">Sinon, dans une application mutualisée (telle qu’un système dans lequel différents auteurs contrôlent et gèrent leurs propres publications de blog), vous pouvez partitionner les blogs par auteur et créer des collections distinctes pour chaque auteur.</span><span class="sxs-lookup"><span data-stu-id="4b239-308">Alternatively, in a multitenant application, such as a system where different authors control and manage their own blog posts, you can partition blogs by author and create separate collections for each author.</span></span> <span data-ttu-id="4b239-309">L’espace de stockage alloué aux collections est flexible et peut évoluer à la hausse ou à la baisse en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="4b239-309">The storage space that's allocated to collections is elastic and can shrink or grow as needed.</span></span>

<span data-ttu-id="4b239-310">Cosmos DB prend en charge le partitionnement automatique des données d’après une clé de partition définie au niveau de l’application.</span><span class="sxs-lookup"><span data-stu-id="4b239-310">Cosmos DB supports automatic partitioning of data based on an application-defined partition key.</span></span> <span data-ttu-id="4b239-311">Une *partition logique* est une partition qui stocke toutes les données associées à une valeur de clé de partition unique.</span><span class="sxs-lookup"><span data-stu-id="4b239-311">A *logical partition* is a partition that stores all the data for a single partition key value.</span></span> <span data-ttu-id="4b239-312">Tous les documents qui partagent la même valeur de clé de partition sont placés dans la même partition logique.</span><span class="sxs-lookup"><span data-stu-id="4b239-312">All documents that share the same value for the partition key are placed within the same logical partition.</span></span> <span data-ttu-id="4b239-313">Cosmos DB distribue les valeurs en fonction du hachage de la clé de partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-313">Cosmos DB distributes values according to hash of the partition key.</span></span> <span data-ttu-id="4b239-314">Une partition logique présente une taille maximale de 10 Go.</span><span class="sxs-lookup"><span data-stu-id="4b239-314">A logical partition has a maximum size of 10 GB.</span></span> <span data-ttu-id="4b239-315">Pour cette raison, le choix de la clé de partition est une décision importante que vous devrez prendre au moment de la conception.</span><span class="sxs-lookup"><span data-stu-id="4b239-315">Therefore, the choice of the partition key is an important decision at design time.</span></span> <span data-ttu-id="4b239-316">Choisissez une propriété avec une large gamme de valeurs, voire des modèles d’accès.</span><span class="sxs-lookup"><span data-stu-id="4b239-316">Choose a property with a wide range of values and even access patterns.</span></span> <span data-ttu-id="4b239-317">Pour en savoir plus, voir [Partitionner et mettre à l’échelle dans Azure Cosmos DB](/azure/cosmos-db/partition-data).</span><span class="sxs-lookup"><span data-stu-id="4b239-317">For more information, see [Partition and scale in Azure Cosmos DB](/azure/cosmos-db/partition-data).</span></span>

> [!NOTE]
> <span data-ttu-id="4b239-318">Chaque base de données Cosmos DB présente un *niveau de performances* qui détermine la quantité de ressources obtenue.</span><span class="sxs-lookup"><span data-stu-id="4b239-318">Each Cosmos DB database has a *performance level* that determines the amount of resources it gets.</span></span> <span data-ttu-id="4b239-319">À chaque niveau de performance est associé un taux limite d’*unités de demande*.</span><span class="sxs-lookup"><span data-stu-id="4b239-319">A performance level is associated with a *request unit* (RU) rate limit.</span></span> <span data-ttu-id="4b239-320">Le taux limite d’unités de demande spécifie le volume de ressources réservé et disponible exclusivement pour cette collection.</span><span class="sxs-lookup"><span data-stu-id="4b239-320">The RU rate limit specifies the volume of resources that's reserved and available for exclusive use by that collection.</span></span> <span data-ttu-id="4b239-321">Le coût d’une collection dépend du niveau de performances sélectionné pour cette collection.</span><span class="sxs-lookup"><span data-stu-id="4b239-321">The cost of a collection depends on the performance level that's selected for that collection.</span></span> <span data-ttu-id="4b239-322">Plus le niveau de performances (et le taux limite d’unités de demande) est élevé, plus la charge est élevée.</span><span class="sxs-lookup"><span data-stu-id="4b239-322">The higher the performance level (and RU rate limit) the higher the charge.</span></span> <span data-ttu-id="4b239-323">Vous pouvez régler le niveau de performance d’une collection à l’aide du portail Azure.</span><span class="sxs-lookup"><span data-stu-id="4b239-323">You can adjust the performance level of a collection by using the Azure portal.</span></span> <span data-ttu-id="4b239-324">Pour en savoir plus, voir [Unités de requête dans Azure Cosmos DB][cosmos-db-ru].</span><span class="sxs-lookup"><span data-stu-id="4b239-324">For more information, see [Request Units in Azure Cosmos DB][cosmos-db-ru].</span></span>

<span data-ttu-id="4b239-325">Si le mécanisme de partitionnement Cosmos DB offre n’est pas suffisant, vous devrez peut-être partitionner les données au niveau de l’application.</span><span class="sxs-lookup"><span data-stu-id="4b239-325">If the partitioning mechanism that Cosmos DB provides is not sufficient, you may need to shard the data at the application level.</span></span> <span data-ttu-id="4b239-326">Les collections de documents fournissent un mécanisme naturel permettant de partitionner des données dans une base de données unique.</span><span class="sxs-lookup"><span data-stu-id="4b239-326">Document collections provide a natural mechanism for partitioning data within a single database.</span></span> <span data-ttu-id="4b239-327">La méthode la plus simple permettant de mettre en œuvre le partitionnement consiste à créer une collection pour chaque partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-327">The simplest way to implement sharding is to create a collection for each shard.</span></span> <span data-ttu-id="4b239-328">Les conteneurs sont des ressources logiques. Ils peuvent s’étendre sur un ou plusieurs serveurs.</span><span class="sxs-lookup"><span data-stu-id="4b239-328">Containers are logical resources and can span one or more servers.</span></span> <span data-ttu-id="4b239-329">Les conteneurs de taille fixe ont une limite maximale de 10 Go et de 10 000 RU/s de débit.</span><span class="sxs-lookup"><span data-stu-id="4b239-329">Fixed-size containers have a maximum limit of 10 GB and 10,000 RU/s throughput.</span></span> <span data-ttu-id="4b239-330">Un nombre illimité de conteneurs ne présente aucune taille de stockage maximale, mais doit spécifier une clé de partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-330">Unlimited containers do not have a maximum storage size, but must specify a partition key.</span></span> <span data-ttu-id="4b239-331">Il incombe à l’application cliente d’envoyer les requêtes vers la partition appropriée, généralement en implémentant son propre mécanisme de mappage en fonction de certains attributs des données qui définissent la clé de partitionnement.</span><span class="sxs-lookup"><span data-stu-id="4b239-331">With application sharding, the client application must direct requests to the appropriate shard, usually by implementing its own mapping mechanism based on some attributes of the data that define the shard key.</span></span>

<span data-ttu-id="4b239-332">Toutes les bases de données sont créées dans le contexte d’un compte de base de données Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4b239-332">All databases are created in the context of a Cosmos DB database account.</span></span> <span data-ttu-id="4b239-333">Un même compte peut contenir plusieurs bases de données et indique les régions dans lesquelles les bases de données sont créées.</span><span class="sxs-lookup"><span data-stu-id="4b239-333">A single account can contain several databases, and it specifies in which regions the databases are created.</span></span> <span data-ttu-id="4b239-334">Chaque compte applique également son propre contrôle d’accès.</span><span class="sxs-lookup"><span data-stu-id="4b239-334">Each account also enforces its own access control.</span></span> <span data-ttu-id="4b239-335">Vous pouvez utiliser des comptes Cosmos DB pour géolocaliser les partitions (collections au sein des bases de données) situées à proximité des utilisateurs ayant besoin d’y accéder, et appliquer des restrictions afin que seuls ces utilisateurs puissent s’y connecter.</span><span class="sxs-lookup"><span data-stu-id="4b239-335">You can use Cosmos DB accounts to geo-locate shards (collections within databases) close to the users who need to access them, and enforce restrictions so that only those users can connect to them.</span></span>

<span data-ttu-id="4b239-336">Lorsque vous décidez de la procédure à suivre pour partitionner des données à l’aide de l’API SQL Cosmos DB, tenez compte des points suivants :</span><span class="sxs-lookup"><span data-stu-id="4b239-336">Consider the following points when deciding how to partition data with the Cosmos DB SQL API:</span></span>

- <span data-ttu-id="4b239-337">**Les ressources disponibles pour une base de données Cosmos DB sont soumises aux limites de quota du compte**.</span><span class="sxs-lookup"><span data-stu-id="4b239-337">**The resources available to a Cosmos DB database are subject to the quota limitations of the account**.</span></span> <span data-ttu-id="4b239-338">Chaque base de données peut contenir un certain nombre de collections, et chaque collection est associée à un niveau de performances qui régit le taux limite d’unités de demande (débit réservé) pour cette collection.</span><span class="sxs-lookup"><span data-stu-id="4b239-338">Each database can hold a number of collections, and each collection is associated with a performance level that governs the RU rate limit (reserved throughput) for that collection.</span></span> <span data-ttu-id="4b239-339">Pour plus d’informations, consultez [Abonnement Azure et limites, quotas et contraintes de service][azure-limits].</span><span class="sxs-lookup"><span data-stu-id="4b239-339">For more information, see [Azure subscription and service limits, quotas, and constraints][azure-limits].</span></span>

- <span data-ttu-id="4b239-340">**Chaque document doit avoir un attribut pouvant être utilisé pour identifier de manière unique ce document dans la collection dans laquelle il est stocké**.</span><span class="sxs-lookup"><span data-stu-id="4b239-340">**Each document must have an attribute that can be used to uniquely identify that document within the collection in which it is held**.</span></span> <span data-ttu-id="4b239-341">Cet attribut est différent de la clé de partition, qui définit la collection dans laquelle le document est stocké.</span><span class="sxs-lookup"><span data-stu-id="4b239-341">This attribute is different from the shard key, which defines which collection holds the document.</span></span> <span data-ttu-id="4b239-342">Une collection peut contenir un grand nombre de documents.</span><span class="sxs-lookup"><span data-stu-id="4b239-342">A collection can contain a large number of documents.</span></span> <span data-ttu-id="4b239-343">En théorie, ce nombre est limité uniquement par la longueur maximale de l’ID de document.</span><span class="sxs-lookup"><span data-stu-id="4b239-343">In theory, it's limited only by the maximum length of the document ID.</span></span> <span data-ttu-id="4b239-344">L’ID du document peut comprendre jusqu’à 255 caractères.</span><span class="sxs-lookup"><span data-stu-id="4b239-344">The document ID can be up to 255 characters.</span></span>

- <span data-ttu-id="4b239-345">**Toutes les opérations sur un document sont exécutées dans le contexte d’une transaction. Les transactions se limitent à la collection dans laquelle se trouve le document.**</span><span class="sxs-lookup"><span data-stu-id="4b239-345">**All operations against a document are performed within the context of a transaction. Transactions are scoped to the collection in which the document is contained.**</span></span> <span data-ttu-id="4b239-346">Si une opération échoue, la tâche réalisée est annulée.</span><span class="sxs-lookup"><span data-stu-id="4b239-346">If an operation fails, the work that it has performed is rolled back.</span></span> <span data-ttu-id="4b239-347">Quand un document est sujet à une opération, toutes les modifications apportées sont soumises à un isolement de niveau capture instantanée.</span><span class="sxs-lookup"><span data-stu-id="4b239-347">While a document is subject to an operation, any changes that are made are subject to snapshot-level isolation.</span></span> <span data-ttu-id="4b239-348">Ce mécanisme garantit que si, par exemple, une requête visant à créer un document échoue, un autre utilisateur qui interroge la base de données simultanément ne verra pas un document partiel supprimé par la suite.</span><span class="sxs-lookup"><span data-stu-id="4b239-348">This mechanism guarantees that if, for example, a request to create a new document fails, another user who's querying the database simultaneously will not see a partial document that is then removed.</span></span>

- <span data-ttu-id="4b239-349">**Les requêtes de base de données se limitent également au niveau de la collection**.</span><span class="sxs-lookup"><span data-stu-id="4b239-349">**Database queries are also scoped to the collection level**.</span></span> <span data-ttu-id="4b239-350">Une seule requête peut récupérer les données issues d’une seule collection.</span><span class="sxs-lookup"><span data-stu-id="4b239-350">A single query can retrieve data from only one collection.</span></span> <span data-ttu-id="4b239-351">Si vous devez récupérer des données issues de plusieurs collections, vous devez interroger chaque collection individuellement et fusionner les résultats dans votre code d’application.</span><span class="sxs-lookup"><span data-stu-id="4b239-351">If you need to retrieve data from multiple collections, you must query each collection individually and merge the results in your application code.</span></span>

- <span data-ttu-id="4b239-352">**Cosmos DB prend en charge les éléments programmables qui peuvent tous être stockés dans une collection avec des documents**.</span><span class="sxs-lookup"><span data-stu-id="4b239-352">**Cosmos DB supports programmable items that can all be stored in a collection alongside documents**.</span></span> <span data-ttu-id="4b239-353">Il s’agit notamment des procédures stockées, des fonctions définies par l’utilisateur et des déclencheurs (écrits en JavaScript).</span><span class="sxs-lookup"><span data-stu-id="4b239-353">These include stored procedures, user-defined functions, and triggers (written in JavaScript).</span></span> <span data-ttu-id="4b239-354">Ces éléments peuvent accéder à n’importe quel document au sein de la même collection.</span><span class="sxs-lookup"><span data-stu-id="4b239-354">These items can access any document within the same collection.</span></span> <span data-ttu-id="4b239-355">En outre, ces éléments s’exécutent soit dans le cadre de la portée de la transaction actuelle (dans le cas d’un déclencheur intervenant suite à une opération de création, de suppression ou de remplacement effectuée sur un document), soit en démarrant une nouvelle transaction (dans le cas d’une procédure stockée exécutée suite à une demande client explicite).</span><span class="sxs-lookup"><span data-stu-id="4b239-355">Furthermore, these items run either inside the scope of the ambient transaction (in the case of a trigger that fires as the result of a create, delete, or replace operation performed against a document), or by starting a new transaction (in the case of a stored procedure that is run as the result of an explicit client request).</span></span> <span data-ttu-id="4b239-356">Si le code d’un élément programmable lève une exception, la transaction est annulée.</span><span class="sxs-lookup"><span data-stu-id="4b239-356">If the code in a programmable item throws an exception, the transaction is rolled back.</span></span> <span data-ttu-id="4b239-357">Vous pouvez utiliser des procédures stockées et des déclencheurs pour maintenir l’intégrité et la cohérence entre des documents, mais ces documents doivent tous faire partie de la même collection.</span><span class="sxs-lookup"><span data-stu-id="4b239-357">You can use stored procedures and triggers to maintain integrity and consistency between documents, but these documents must all be part of the same collection.</span></span>

- <span data-ttu-id="4b239-358">**Les collections que vous souhaitez conserver dans les bases de données doivent être peu susceptibles de dépasser les limites de débit définies par les niveaux de performances des collections**.</span><span class="sxs-lookup"><span data-stu-id="4b239-358">**The collections that you intend to hold in the databases should be unlikely to exceed the throughput limits defined by the performance levels of the collections**.</span></span> <span data-ttu-id="4b239-359">Pour en savoir plus, voir [Unités de requête dans Azure Cosmos DB][cosmos-db-ru].</span><span class="sxs-lookup"><span data-stu-id="4b239-359">For more information, see [Request Units in Azure Cosmos DB][cosmos-db-ru].</span></span> <span data-ttu-id="4b239-360">Si vous prévoyez d’atteindre ces limites, envisagez de fractionner les collections des bases de données entre différents comptes afin de réduire la charge par collection.</span><span class="sxs-lookup"><span data-stu-id="4b239-360">If you anticipate reaching these limits, consider splitting collections across databases in different accounts to reduce the load per collection.</span></span>

## <a name="partitioning-azure-search"></a><span data-ttu-id="4b239-361">Partitionnement Recherche Azure</span><span class="sxs-lookup"><span data-stu-id="4b239-361">Partitioning Azure Search</span></span>

<span data-ttu-id="4b239-362">La capacité à rechercher des données est souvent la méthode principale de navigation et d’exploration fournie par de nombreuses applications web.</span><span class="sxs-lookup"><span data-stu-id="4b239-362">The ability to search for data is often the primary method of navigation and exploration that's provided by many web applications.</span></span> <span data-ttu-id="4b239-363">Elle permet aux utilisateurs de trouver des ressources rapidement (par exemple, des produits dans une application de commerce électronique) en fonction de combinaisons de critères de recherche.</span><span class="sxs-lookup"><span data-stu-id="4b239-363">It helps users find resources quickly (for example, products in an e-commerce application) based on combinations of search criteria.</span></span> <span data-ttu-id="4b239-364">Le service de recherche Azure Search propose des fonctionnalités de recherche en texte intégral dans le contenu Web, ainsi que des fonctionnalités telles que les requêtes prédictives, les requêtes suggérées en fonction des correspondances suivantes et la navigation à facettes.</span><span class="sxs-lookup"><span data-stu-id="4b239-364">The Azure Search service provides full-text search capabilities over web content, and includes features such as type-ahead, suggested queries based on near matches, and faceted navigation.</span></span> <span data-ttu-id="4b239-365">Pour plus d’informations, consultez [Qu’est-ce que Recherche Azure ?].</span><span class="sxs-lookup"><span data-stu-id="4b239-365">For more information, see [What is Azure Search?].</span></span>

<span data-ttu-id="4b239-366">Azure Search stocke le contenu pouvant faire l’objet d’une recherche sous forme de documents JSON dans une base de données.</span><span class="sxs-lookup"><span data-stu-id="4b239-366">Azure Search stores searchable content as JSON documents in a database.</span></span> <span data-ttu-id="4b239-367">Vous définissez des index qui spécifient les champs de recherche dans ces documents et fournissez ces définitions à Azure Search.</span><span class="sxs-lookup"><span data-stu-id="4b239-367">You define indexes that specify the searchable fields in these documents and provide these definitions to Azure Search.</span></span> <span data-ttu-id="4b239-368">Quand un utilisateur soumet une demande de recherche, Azure Search utilise les index appropriés pour trouver les éléments correspondants.</span><span class="sxs-lookup"><span data-stu-id="4b239-368">When a user submits a search request, Azure Search uses the appropriate indexes to find matching items.</span></span>

<span data-ttu-id="4b239-369">Pour réduire la contention, le stockage utilisé par Azure Search peut être divisé en 1, 2, 3, 4, 6, ou 12 partitions, et chaque partition peut être répliquée jusqu’à 6 fois.</span><span class="sxs-lookup"><span data-stu-id="4b239-369">To reduce contention, the storage that's used by Azure Search can be divided into 1, 2, 3, 4, 6, or 12 partitions, and each partition can be replicated up to 6 times.</span></span> <span data-ttu-id="4b239-370">Le produit du nombre de partitions multiplié par le nombre de réplicas est appelé *unité de recherche*.</span><span class="sxs-lookup"><span data-stu-id="4b239-370">The product of the number of partitions multiplied by the number of replicas is called the *search unit* (SU).</span></span> <span data-ttu-id="4b239-371">Une même instance d’Azure Search peut contenir au maximum 36 unités de recherche (une base de données avec 12 partitions prend en charge 3 réplicas au maximum).</span><span class="sxs-lookup"><span data-stu-id="4b239-371">A single instance of Azure Search can contain a maximum of 36 SUs (a database with 12 partitions only supports a maximum of 3 replicas).</span></span>

<span data-ttu-id="4b239-372">La facturation se fait en fonction de chaque unité de recherche allouée à votre service.</span><span class="sxs-lookup"><span data-stu-id="4b239-372">You are billed for each SU that is allocated to your service.</span></span> <span data-ttu-id="4b239-373">À mesure que le volume de contenu pouvant faire l’objet d’une recherche ou que le taux des demandes de recherche augmente, vous pouvez ajouter des unités de recherche à une instance existante d’Azure Search pour gérer la charge supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="4b239-373">As the volume of searchable content increases or the rate of search requests grows, you can add SUs to an existing instance of Azure Search to handle the extra load.</span></span> <span data-ttu-id="4b239-374">Azure Search distribue uniformément les documents parmi les partitions.</span><span class="sxs-lookup"><span data-stu-id="4b239-374">Azure Search itself distributes the documents evenly across the partitions.</span></span> <span data-ttu-id="4b239-375">Aucune stratégie de partitionnement manuel n’est actuellement prise en charge.</span><span class="sxs-lookup"><span data-stu-id="4b239-375">No manual partitioning strategies are currently supported.</span></span>

<span data-ttu-id="4b239-376">Chaque partition peut contenir un maximum de 15 millions de documents ou occuper 300 Go d’espace de stockage (la valeur la plus petite étant retenue).</span><span class="sxs-lookup"><span data-stu-id="4b239-376">Each partition can contain a maximum of 15 million documents or occupy 300 GB of storage space (whichever is smaller).</span></span> <span data-ttu-id="4b239-377">Vous pouvez créer jusqu’à 50 index.</span><span class="sxs-lookup"><span data-stu-id="4b239-377">You can create up to 50 indexes.</span></span> <span data-ttu-id="4b239-378">Les performances du service varient et dépendent de la complexité des documents, des index disponibles et de la latence du réseau.</span><span class="sxs-lookup"><span data-stu-id="4b239-378">The performance of the service varies and depends on the complexity of the documents, the available indexes, and the effects of network latency.</span></span> <span data-ttu-id="4b239-379">En moyenne, un réplica (1 unité de recherche) doit pouvoir gérer 15 requêtes par seconde, même s’il convient de réaliser une mesure à l’aide de vos propres données pour obtenir un résultat plus précis du débit.</span><span class="sxs-lookup"><span data-stu-id="4b239-379">On average, a single replica (1 SU) should be able to handle 15 queries per second (QPS), although we recommend performing benchmarking with your own data to obtain a more precise measure of throughput.</span></span> <span data-ttu-id="4b239-380">Pour plus d’informations, consultez [Limites de service d’Azure Search].</span><span class="sxs-lookup"><span data-stu-id="4b239-380">For more information, see [Service limits in Azure Search].</span></span>

> [!NOTE]
> <span data-ttu-id="4b239-381">Vous pouvez stocker un jeu de types de données limité dans les documents pouvant faire l’objet d’une recherche, notamment des chaînes, des valeurs booléennes, des données numériques, des données d’horodatage et certaines données géographiques.</span><span class="sxs-lookup"><span data-stu-id="4b239-381">You can store a limited set of data types in searchable documents, including strings, Booleans, numeric data, datetime data, and some geographical data.</span></span> <span data-ttu-id="4b239-382">Pour plus d’informations, consultez la page [Types de données pris en charge (Azure Search)] sur le site web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="4b239-382">For more details, see the page [Supported data types (Azure Search)] on the Microsoft website.</span></span>

<span data-ttu-id="4b239-383">Vous disposez d’un contrôle limité sur la manière dont Azure Search partitionne les données pour chaque instance du service.</span><span class="sxs-lookup"><span data-stu-id="4b239-383">You have limited control over how Azure Search partitions data for each instance of the service.</span></span> <span data-ttu-id="4b239-384">Cependant, dans un environnement global, vous pouvez améliorer les performances et réduire la latence et la contention en partitionnant le service proprement dit en appliquant l’une des stratégies suivantes :</span><span class="sxs-lookup"><span data-stu-id="4b239-384">However, in a global environment you might be able to improve performance and reduce latency and contention further by partitioning the service itself using either of the following strategies:</span></span>

- <span data-ttu-id="4b239-385">Créez une instance d’Azure Search dans chaque région géographique et vérifiez que les applications clientes sont dirigées vers l’instance disponible la plus proche.</span><span class="sxs-lookup"><span data-stu-id="4b239-385">Create an instance of Azure Search in each geographic region, and ensure that client applications are directed towards the nearest available instance.</span></span> <span data-ttu-id="4b239-386">Cette stratégie exige la réplication de chaque mise à jour du contenu pouvant faire l’objet d’une recherche en temps voulu au sein de toutes les instances du service.</span><span class="sxs-lookup"><span data-stu-id="4b239-386">This strategy requires that any updates to searchable content are replicated in a timely manner across all instances of the service.</span></span>

- <span data-ttu-id="4b239-387">Créez deux niveaux d’Azure Search :</span><span class="sxs-lookup"><span data-stu-id="4b239-387">Create two tiers of Azure Search:</span></span>

  - <span data-ttu-id="4b239-388">Un service local dans chaque région qui contient les données les plus fréquemment sollicitées par les utilisateurs dans cette région.</span><span class="sxs-lookup"><span data-stu-id="4b239-388">A local service in each region that contains the data that's most frequently accessed by users in that region.</span></span> <span data-ttu-id="4b239-389">Les utilisateurs peuvent diriger les demandes ici pour obtenir des résultats rapides, mais limités.</span><span class="sxs-lookup"><span data-stu-id="4b239-389">Users can direct requests here for fast but limited results.</span></span>
  - <span data-ttu-id="4b239-390">Un service global qui englobe toutes les données.</span><span class="sxs-lookup"><span data-stu-id="4b239-390">A global service that encompasses all the data.</span></span> <span data-ttu-id="4b239-391">Les utilisateurs peuvent diriger les demandes ici pour obtenir des résultats plus lents, mais plus complets.</span><span class="sxs-lookup"><span data-stu-id="4b239-391">Users can direct requests here for slower but more complete results.</span></span>

<span data-ttu-id="4b239-392">Cette approche est plus appropriée quand les données faisant l’objet d’une recherche présentent des variations régionales significatives.</span><span class="sxs-lookup"><span data-stu-id="4b239-392">This approach is most suitable when there is a significant regional variation in the data that's being searched.</span></span>

## <a name="partitioning-azure-redis-cache"></a><span data-ttu-id="4b239-393">Partitionnement Cache Redis Azure</span><span class="sxs-lookup"><span data-stu-id="4b239-393">Partitioning Azure Redis Cache</span></span>

<span data-ttu-id="4b239-394">Le cache Redis Azure propose un service de mise en cache partagé dans le cloud basé sur le magasin de données de clés et de valeurs Redis.</span><span class="sxs-lookup"><span data-stu-id="4b239-394">Azure Redis Cache provides a shared caching service in the cloud that's based on the Redis key-value data store.</span></span> <span data-ttu-id="4b239-395">Comme son nom l’indique, le cache Redis Azure est conçu comme une solution de mise en cache.</span><span class="sxs-lookup"><span data-stu-id="4b239-395">As its name implies, Azure Redis Cache is intended as a caching solution.</span></span> <span data-ttu-id="4b239-396">Utilisez-le uniquement pour contenir des données temporaires, et non comme un magasin de données permanent.</span><span class="sxs-lookup"><span data-stu-id="4b239-396">Use it only for holding transient data and not as a permanent data store.</span></span> <span data-ttu-id="4b239-397">Les applications qui utilisent le cache Redis Azure doivent pouvoir continuer à fonctionner si le cache n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="4b239-397">Applications that use Azure Redis Cache should be able to continue functioning if the cache is unavailable.</span></span> <span data-ttu-id="4b239-398">Le cache Redis Azure prend en charge la réplication principale/secondaire pour fournir une haute disponibilité, mais le service limite actuellement la taille maximale du cache à 53 Go.</span><span class="sxs-lookup"><span data-stu-id="4b239-398">Azure Redis Cache supports primary/secondary replication to provide high availability, but currently limits the maximum cache size to 53 GB.</span></span> <span data-ttu-id="4b239-399">Si vous devez disposer de davantage d’espace, vous devez créer des caches supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="4b239-399">If you need more space than this, you must create additional caches.</span></span> <span data-ttu-id="4b239-400">Pour plus d’informations, consultez [Cache Redis Azure].</span><span class="sxs-lookup"><span data-stu-id="4b239-400">For more information, see [Azure Redis Cache].</span></span>

<span data-ttu-id="4b239-401">Le partitionnement d’un magasin de données Redis implique la répartition des données entre des instances du service Redis.</span><span class="sxs-lookup"><span data-stu-id="4b239-401">Partitioning a Redis data store involves splitting the data across instances of the Redis service.</span></span> <span data-ttu-id="4b239-402">Chaque instance constitue une partition unique.</span><span class="sxs-lookup"><span data-stu-id="4b239-402">Each instance constitutes a single partition.</span></span> <span data-ttu-id="4b239-403">Le cache Redis Azure fait abstraction des services Redis derrière une façade et ne les expose pas directement.</span><span class="sxs-lookup"><span data-stu-id="4b239-403">Azure Redis Cache abstracts the Redis services behind a façade and does not expose them directly.</span></span> <span data-ttu-id="4b239-404">La méthode la plus simple pour implémenter le partitionnement consiste à créer plusieurs instances de cache Redis Azure et à répartir les données entre elles.</span><span class="sxs-lookup"><span data-stu-id="4b239-404">The simplest way to implement partitioning is to create multiple Azure Redis Cache instances and spread the data across them.</span></span>

<span data-ttu-id="4b239-405">Vous pouvez associer chaque élément de données à un identificateur (une clé de partition) qui indique dans quel cache l’élément est stocké.</span><span class="sxs-lookup"><span data-stu-id="4b239-405">You can associate each data item with an identifier (a partition key) that specifies which cache stores the data item.</span></span> <span data-ttu-id="4b239-406">La logique de l’application cliente peut ensuite utiliser cet identificateur pour acheminer les demandes vers la partition appropriée.</span><span class="sxs-lookup"><span data-stu-id="4b239-406">The client application logic can then use this identifier to route requests to the appropriate partition.</span></span> <span data-ttu-id="4b239-407">Ce schéma est très simple mais, si le schéma de partitionnement change (par exemple si d’autres instances de cache Redis Azure sont créées), vous devrez peut-être reconfigurer les applications clientes.</span><span class="sxs-lookup"><span data-stu-id="4b239-407">This scheme is very simple, but if the partitioning scheme changes (for example, if additional Azure Redis Cache instances are created), client applications might need to be reconfigured.</span></span>

<span data-ttu-id="4b239-408">Le cache Redis natif (pas le cache Redis Azure) prend en charge le partitionnement côté serveur basé sur le clustering Redis.</span><span class="sxs-lookup"><span data-stu-id="4b239-408">Native Redis (not Azure Redis Cache) supports server-side partitioning based on Redis clustering.</span></span> <span data-ttu-id="4b239-409">Avec cette approche, vous pouvez répartir les données de manière égale parmi les serveurs à l’aide d’un mécanisme de hachage.</span><span class="sxs-lookup"><span data-stu-id="4b239-409">In this approach, you can divide the data evenly across servers by using a hashing mechanism.</span></span> <span data-ttu-id="4b239-410">Chaque serveur Redis stocke les métadonnées décrivant la plage de clés de hachage stockées dans la partition et contient également les informations relatives aux clés de hachage présentes au sein de partitions présentes sur d’autres serveurs.</span><span class="sxs-lookup"><span data-stu-id="4b239-410">Each Redis server stores metadata that describes the range of hash keys that the partition holds, and also contains information about which hash keys are located in the partitions on other servers.</span></span>

<span data-ttu-id="4b239-411">Les applications clientes envoient simplement les demandes à l’un des serveurs Redis participants (probablement le plus proche).</span><span class="sxs-lookup"><span data-stu-id="4b239-411">Client applications simply send requests to any of the participating Redis servers (probably the closest one).</span></span> <span data-ttu-id="4b239-412">Le serveur Redis examine la demande du client.</span><span class="sxs-lookup"><span data-stu-id="4b239-412">The Redis server examines the client request.</span></span> <span data-ttu-id="4b239-413">Si elle peut être résolue localement, il effectue l’opération demandée.</span><span class="sxs-lookup"><span data-stu-id="4b239-413">If it can be resolved locally, it performs the requested operation.</span></span> <span data-ttu-id="4b239-414">Dans le cas contraire, il transfère la demande au serveur approprié.</span><span class="sxs-lookup"><span data-stu-id="4b239-414">Otherwise it forwards the request on to the appropriate server.</span></span>

<span data-ttu-id="4b239-415">Ce modèle est mis en œuvre à l’aide du clustering Redis et est décrit plus en détail sur la page [Redis cluster tutorial] sur le site web de Redis.</span><span class="sxs-lookup"><span data-stu-id="4b239-415">This model is implemented by using Redis clustering, and is described in more detail on the [Redis cluster tutorial] page on the Redis website.</span></span> <span data-ttu-id="4b239-416">Le clustering Redis est transparent pour les applications clientes.</span><span class="sxs-lookup"><span data-stu-id="4b239-416">Redis clustering is transparent to client applications.</span></span> <span data-ttu-id="4b239-417">Vous pouvez ajouter des serveurs Redis supplémentaires au cluster (et repartitionner les données) sans avoir à reconfigurer les clients.</span><span class="sxs-lookup"><span data-stu-id="4b239-417">Additional Redis servers can be added to the cluster (and the data can be re-partitioned) without requiring that you reconfigure the clients.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="4b239-418">Le Cache Redis Azure prend actuellement en charge le clustering Redis seulement dans le niveau [Premium](/azure/azure-cache-for-redis/cache-how-to-premium-clustering).</span><span class="sxs-lookup"><span data-stu-id="4b239-418">Azure Redis Cache currently supports Redis clustering in [premium](/azure/azure-cache-for-redis/cache-how-to-premium-clustering) tier only.</span></span>

<span data-ttu-id="4b239-419">La page [Partitioning: how to split data among multiple Redis instances] sur le site web de Redis fournit des informations supplémentaires sur l’implémentation du partitionnement avec Redis.</span><span class="sxs-lookup"><span data-stu-id="4b239-419">The page [Partitioning: how to split data among multiple Redis instances] on the Redis website provides more information about implementing partitioning with Redis.</span></span> <span data-ttu-id="4b239-420">Le reste de cette section part du principe que vous mettez en œuvre le partitionnement côté client ou assisté par proxy.</span><span class="sxs-lookup"><span data-stu-id="4b239-420">The remainder of this section assumes that you are implementing client-side or proxy-assisted partitioning.</span></span>

<span data-ttu-id="4b239-421">Considérez les points suivants quand vous décidez de partitionner des données avec le cache Redis Azure :</span><span class="sxs-lookup"><span data-stu-id="4b239-421">Consider the following points when deciding how to partition data with Azure Redis Cache:</span></span>

- <span data-ttu-id="4b239-422">Le cache Redis Azure n’est pas destiné à fonctionner en tant que magasin de données permanent. Ainsi, quel que soit le schéma de partitionnement que vous implémentez, votre code d’application doit pouvoir récupérer les données à partir d’un emplacement autre que le cache.</span><span class="sxs-lookup"><span data-stu-id="4b239-422">Azure Redis Cache is not intended to act as a permanent data store, so whatever partitioning scheme you implement, your application code must be able to retrieve data from a location that's not the cache.</span></span>

- <span data-ttu-id="4b239-423">Les données fréquemment sollicitées doivent être conservées dans la même partition.</span><span class="sxs-lookup"><span data-stu-id="4b239-423">Data that is frequently accessed together should be kept in the same partition.</span></span> <span data-ttu-id="4b239-424">Redis est un magasin de clés/valeurs puissant qui offre plusieurs mécanismes hautement optimisés pour structurer les données.</span><span class="sxs-lookup"><span data-stu-id="4b239-424">Redis is a powerful key-value store that provides several highly optimized mechanisms for structuring data.</span></span> <span data-ttu-id="4b239-425">Il peut s’agir des mécanismes suivants :</span><span class="sxs-lookup"><span data-stu-id="4b239-425">These mechanisms can be one of the following:</span></span>
  - <span data-ttu-id="4b239-426">Chaînes simples (données binaires d’une longueur allant jusqu’à 512 Mo)</span><span class="sxs-lookup"><span data-stu-id="4b239-426">Simple strings (binary data up to 512 MB in length)</span></span>
  - <span data-ttu-id="4b239-427">Types d’agrégation comme des listes (qui peuvent servir de files d’attente et de piles)</span><span class="sxs-lookup"><span data-stu-id="4b239-427">Aggregate types such as lists (which can act as queues and stacks)</span></span>
  - <span data-ttu-id="4b239-428">Ensembles (triés et non triés)</span><span class="sxs-lookup"><span data-stu-id="4b239-428">Sets (ordered and unordered)</span></span>
  - <span data-ttu-id="4b239-429">Hachages (qui peuvent regrouper des champs associés, tels que des éléments qui représentent les champs d’un objet)</span><span class="sxs-lookup"><span data-stu-id="4b239-429">Hashes (which can group related fields together, such as the items that represent the fields in an object)</span></span>

- <span data-ttu-id="4b239-430">Les types d’agrégation permettent d’associer de nombreuses valeurs connexes avec la même clé.</span><span class="sxs-lookup"><span data-stu-id="4b239-430">The aggregate types enable you to associate many related values with the same key.</span></span> <span data-ttu-id="4b239-431">Une clé Redis identifie une liste, un ensemble ou un hachage plutôt que les éléments de données qu’elle contient.</span><span class="sxs-lookup"><span data-stu-id="4b239-431">A Redis key identifies a list, set, or hash rather than the data items that it contains.</span></span> <span data-ttu-id="4b239-432">Ces types sont tous disponibles avec le cache Redis Azure et sont décrits dans la page [Data types] sur le site web de Redis.</span><span class="sxs-lookup"><span data-stu-id="4b239-432">These types are all available with Azure Redis Cache and are described by the [Data types] page on the Redis website.</span></span> <span data-ttu-id="4b239-433">Par exemple, dans le cadre d’un système de commerce électronique qui assure le suivi des commandes passées par les clients, les détails de chaque client peuvent être stockés dans un hachage Redis indexé à l’aide de l’ID du client.</span><span class="sxs-lookup"><span data-stu-id="4b239-433">For example, in part of an e-commerce system that tracks the orders that are placed by customers, the details of each customer can be stored in a Redis hash that is keyed by using the customer ID.</span></span> <span data-ttu-id="4b239-434">Chaque hachage peut contenir une collection d’ID de commande relatifs au client.</span><span class="sxs-lookup"><span data-stu-id="4b239-434">Each hash can hold a collection of order IDs for the customer.</span></span> <span data-ttu-id="4b239-435">Un jeu Redis distinct peut contenir les commandes, à nouveau structurées sous forme de hachages, indexées à l’aide de l’ID de la commande.</span><span class="sxs-lookup"><span data-stu-id="4b239-435">A separate Redis set can hold the orders, again structured as hashes, and keyed by using the order ID.</span></span> <span data-ttu-id="4b239-436">La figure 8 illustre cette structure.</span><span class="sxs-lookup"><span data-stu-id="4b239-436">Figure 8 shows this structure.</span></span> <span data-ttu-id="4b239-437">Remarquez que Redis ne met pas en œuvre toutes les formes d’intégrité référentielle ; il incombe au développeur de maintenir les relations entre les clients et commandes.</span><span class="sxs-lookup"><span data-stu-id="4b239-437">Note that Redis does not implement any form of referential integrity, so it is the developer's responsibility to maintain the relationships between customers and orders.</span></span>

![Structure suggérée au sein du stockage Redis pour enregistrer les commandes des clients et les détails associés](./images/data-partitioning/RedisCustomersandOrders.png)

<span data-ttu-id="4b239-439">*Figure 8 : Structure suggérée au sein du stockage Redis pour enregistrer les commandes des clients et les détails associés.*</span><span class="sxs-lookup"><span data-stu-id="4b239-439">*Figure 8. Suggested structure in Redis storage for recording customer orders and their details.*</span></span>

> [!NOTE]
> <span data-ttu-id="4b239-440">Dans Redis, toutes les clés sont des valeurs de données binaires (telles que des chaînes Redis) pouvant contenir jusqu’à 512 Mo de données.</span><span class="sxs-lookup"><span data-stu-id="4b239-440">In Redis, all keys are binary data values (like Redis strings) and can contain up to 512 MB of data.</span></span> <span data-ttu-id="4b239-441">En théorie, une clé peut contenir pratiquement n’importe quelle information.</span><span class="sxs-lookup"><span data-stu-id="4b239-441">In theory, a key can contain almost any information.</span></span> <span data-ttu-id="4b239-442">Cependant, nous vous recommandons d’adopter une convention d’affectation de noms cohérente concernant les clés et permettant de décrire le type de données et d’identifier l’entité, sans pour autant que le nom soit trop long.</span><span class="sxs-lookup"><span data-stu-id="4b239-442">However, we recommend adopting a consistent naming convention for keys that is descriptive of the type of data and that identifies the entity, but is not excessively long.</span></span> <span data-ttu-id="4b239-443">Une approche courante consiste à utiliser des clés au format « type_entité:ID ».</span><span class="sxs-lookup"><span data-stu-id="4b239-443">A common approach is to use keys of the form "entity_type:ID".</span></span> <span data-ttu-id="4b239-444">Par exemple, vous pouvez utiliser « client:99 » pour indiquer la clé pour un client avec l’ID 99.</span><span class="sxs-lookup"><span data-stu-id="4b239-444">For example, you can use "customer:99" to indicate the key for a customer with the ID 99.</span></span>

- <span data-ttu-id="4b239-445">Vous pouvez mettre en œuvre le partitionnement vertical en stockant les informations connexes dans des agrégations différentes au sein de la même base de données.</span><span class="sxs-lookup"><span data-stu-id="4b239-445">You can implement vertical partitioning by storing related information in different aggregations in the same database.</span></span> <span data-ttu-id="4b239-446">Par exemple, dans une application de commerce électronique, vous pouvez stocker les informations relatives aux produits fréquemment sollicitées dans une table de hachage Redis et les informations les moins fréquemment sollicitées dans une autre.</span><span class="sxs-lookup"><span data-stu-id="4b239-446">For example, in an e-commerce application, you can store commonly accessed information about products in one Redis hash and less frequently used detailed information in another.</span></span> <span data-ttu-id="4b239-447">Les deux hachages peuvent utiliser le même ID de produit dans le cadre de la clé.</span><span class="sxs-lookup"><span data-stu-id="4b239-447">Both hashes can use the same product ID as part of the key.</span></span> <span data-ttu-id="4b239-448">Par exemple, vous pouvez utiliser « product: *nn* » (où *nn* correspond à l’ID du produit) pour les informations sur le produit et « product_details:*nn* » pour les informations détaillées.</span><span class="sxs-lookup"><span data-stu-id="4b239-448">For example, you can use "product: *nn*" (where *nn* is the product ID) for the product information and "product_details: *nn*" for the detailed data.</span></span> <span data-ttu-id="4b239-449">Cette stratégie favorise la réduction du volume de données que la plupart des requêtes sont susceptibles de récupérer.</span><span class="sxs-lookup"><span data-stu-id="4b239-449">This strategy can help reduce the volume of data that most queries are likely to retrieve.</span></span>

- <span data-ttu-id="4b239-450">Vous pouvez repartitionner un magasin de données Redis, mais sachez qu’il s’agit d’une tâche longue et complexe.</span><span class="sxs-lookup"><span data-stu-id="4b239-450">You can repartition a Redis data store, but keep in mind that it's a complex and time-consuming task.</span></span> <span data-ttu-id="4b239-451">Le clustering Redis peut repartitionner automatiquement les données, mais cette capacité n’est pas disponible avec le cache Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="4b239-451">Redis clustering can repartition data automatically, but this capability is not available with Azure Redis Cache.</span></span> <span data-ttu-id="4b239-452">Ainsi, quand vous concevez votre schéma de partitionnement, essayez de laisser suffisamment d’espace libre dans chaque partition pour permettre l’augmentation attendue du volume de données au fil du temps.</span><span class="sxs-lookup"><span data-stu-id="4b239-452">Therefore, when you design your partitioning scheme, try to leave sufficient free space in each partition to allow for expected data growth over time.</span></span> <span data-ttu-id="4b239-453">Cependant, n’oubliez pas que le cache Redis Azure est conçu pour mettre temporairement des données en cache et que les données stockées dans le cache peuvent présenter une durée de vie limitée, spécifiée en tant que valeur de durée de vie.</span><span class="sxs-lookup"><span data-stu-id="4b239-453">However, remember that Azure Redis Cache is intended to cache data temporarily, and that data held in the cache can have a limited lifetime specified as a time-to-live (TTL) value.</span></span> <span data-ttu-id="4b239-454">Concernant les données relativement volatiles, la durée de vie peut être courte. En revanche, concernant les données statiques, la durée de vie peut être beaucoup plus longue.</span><span class="sxs-lookup"><span data-stu-id="4b239-454">For relatively volatile data, the TTL can be short, but for static data the TTL can be a lot longer.</span></span> <span data-ttu-id="4b239-455">Évitez de stocker de grandes quantités de données durables dans le cache si le volume de ces données est susceptible de remplir le cache.</span><span class="sxs-lookup"><span data-stu-id="4b239-455">Avoid storing large amounts of long-lived data in the cache if the volume of this data is likely to fill the cache.</span></span> <span data-ttu-id="4b239-456">Vous pouvez spécifier une stratégie d’éviction permettant au cache Redis Azure de supprimer les données si l’espace est limité.</span><span class="sxs-lookup"><span data-stu-id="4b239-456">You can specify an eviction policy that causes Azure Redis Cache to remove data if space is at a premium.</span></span>

  > [!NOTE]
  > <span data-ttu-id="4b239-457">Le cache Redis Azure vous permet de spécifier la taille maximale du cache (de 250 Mo à 53 Go) en sélectionnant le niveau tarifaire approprié.</span><span class="sxs-lookup"><span data-stu-id="4b239-457">When you use Azure Redis cache, you specify the maximum size of the cache (from 250 MB to 53 GB) by selecting the appropriate pricing tier.</span></span> <span data-ttu-id="4b239-458">Cependant, après avoir créé un cache Redis Azure, vous ne pouvez plus en augmenter ni en réduire la taille.</span><span class="sxs-lookup"><span data-stu-id="4b239-458">However, after an Azure Redis Cache has been created, you cannot increase (or decrease) its size.</span></span>

- <span data-ttu-id="4b239-459">Les lots et transactions Redis ne peuvent pas couvrir plusieurs connexions. Ainsi, toutes les données affectées par un lot ou une transaction doivent être stockées dans la même base de données (partition).</span><span class="sxs-lookup"><span data-stu-id="4b239-459">Redis batches and transactions cannot span multiple connections, so all data that is affected by a batch or transaction should be held in the same database (shard).</span></span>

  > [!NOTE]
  > <span data-ttu-id="4b239-460">Une séquence d’opérations relative à une transaction Redis n’est pas nécessairement atomique.</span><span class="sxs-lookup"><span data-stu-id="4b239-460">A sequence of operations in a Redis transaction is not necessarily atomic.</span></span> <span data-ttu-id="4b239-461">Les commandes qui composent une transaction sont vérifiées et mises en file d’attente avant d’être exécutées.</span><span class="sxs-lookup"><span data-stu-id="4b239-461">The commands that compose a transaction are verified and queued before they run.</span></span> <span data-ttu-id="4b239-462">Si une erreur se produit pendant cette phase, la file d’attente entière est ignorée.</span><span class="sxs-lookup"><span data-stu-id="4b239-462">If an error occurs during this phase, the entire queue is discarded.</span></span> <span data-ttu-id="4b239-463">Cependant, une fois la transaction envoyée avec succès, les commandes placées en file d’attente sont exécutées en séquence.</span><span class="sxs-lookup"><span data-stu-id="4b239-463">However, after the transaction has been successfully submitted, the queued commands run in sequence.</span></span> <span data-ttu-id="4b239-464">Si une commande échoue, seule cette commande cesse de s’exécuter.</span><span class="sxs-lookup"><span data-stu-id="4b239-464">If any command fails, only that command stops running.</span></span> <span data-ttu-id="4b239-465">Toutes les commandes précédentes et suivantes dans la file d’attente sont exécutées.</span><span class="sxs-lookup"><span data-stu-id="4b239-465">All previous and subsequent commands in the queue are performed.</span></span> <span data-ttu-id="4b239-466">Pour plus d’informations, consultez la page [Transactions] sur le site web de Redis.</span><span class="sxs-lookup"><span data-stu-id="4b239-466">For more information, go to the [Transactions] page on the Redis website.</span></span>

- <span data-ttu-id="4b239-467">Redis prend en charge un nombre limité d’opérations atomiques.</span><span class="sxs-lookup"><span data-stu-id="4b239-467">Redis supports a limited number of atomic operations.</span></span> <span data-ttu-id="4b239-468">Les seules opérations de ce type qui prennent en charge plusieurs clés et valeurs sont les opérations MGET et MSET.</span><span class="sxs-lookup"><span data-stu-id="4b239-468">The only operations of this type that support multiple keys and values are MGET and MSET operations.</span></span> <span data-ttu-id="4b239-469">Les opérations MGET retournent une collection de valeurs pour une liste de clés spécifiée, et les opérations MSET stockent une collection de valeurs pour une liste de clés spécifiée.</span><span class="sxs-lookup"><span data-stu-id="4b239-469">MGET operations return a collection of values for a specified list of keys, and MSET operations store a collection of values for a specified list of keys.</span></span> <span data-ttu-id="4b239-470">Si vous devez utiliser ces opérations, les paires clés/valeurs référencées par les commandes MSET et MGET doivent être stockées dans la même base de données.</span><span class="sxs-lookup"><span data-stu-id="4b239-470">If you need to use these operations, the key-value pairs that are referenced by the MSET and MGET commands must be stored within the same database.</span></span>

## <a name="partitioning-azure-service-fabric"></a><span data-ttu-id="4b239-471">Partitionnement Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="4b239-471">Partitioning Azure Service Fabric</span></span>

<span data-ttu-id="4b239-472">Azure Service Fabric est une plateforme de microservices qui fournit un runtime pour les applications distribuées dans le cloud.</span><span class="sxs-lookup"><span data-stu-id="4b239-472">Azure Service Fabric is a microservices platform that provides a runtime for distributed applications in the cloud.</span></span> <span data-ttu-id="4b239-473">Service Fabric prend en charge les exécutables invités .Net, les services avec état et sans état, ainsi que les conteneurs.</span><span class="sxs-lookup"><span data-stu-id="4b239-473">Service Fabric supports .Net guest executables, stateful and stateless services, and containers.</span></span> <span data-ttu-id="4b239-474">Les services avec état fournissent une [collection fiable][service-fabric-reliable-collections] pour stocker les données de manière permanente dans une collection clé-valeur au sein du cluster Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="4b239-474">Stateful services provide a [reliable collection][service-fabric-reliable-collections] to persistently store data in a key-value collection within the Service Fabric cluster.</span></span> <span data-ttu-id="4b239-475">Pour plus d’informations sur les stratégies relatives aux clés de partitionnement dans une collection fiable, consultez l’article [Instructions et recommandations pour les collections fiables dans Azure Service Fabric].</span><span class="sxs-lookup"><span data-stu-id="4b239-475">For more information about strategies for partitioning keys in a reliable collection, see [guidelines and recommendations for reliable collections in Azure Service Fabric].</span></span>

### <a name="more-information"></a><span data-ttu-id="4b239-476">Plus d’informations</span><span class="sxs-lookup"><span data-stu-id="4b239-476">More information</span></span>

- <span data-ttu-id="4b239-477">L’article [Vue d’ensemble d’Azure Service Fabric] constitue une présentation d’Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="4b239-477">[Overview of Azure Service Fabric] is an introduction to Azure Service Fabric.</span></span>

- <span data-ttu-id="4b239-478">L’article [Partitionnement des services fiables Service Fabric] fournit des informations supplémentaires sur les services fiables dans Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="4b239-478">[Partition Service Fabric reliable services] provides more information about reliable services in Azure Service Fabric.</span></span>

## <a name="partitioning-azure-event-hubs"></a><span data-ttu-id="4b239-479">Partitionnement Azure Event Hubs</span><span class="sxs-lookup"><span data-stu-id="4b239-479">Partitioning Azure Event Hubs</span></span>

<span data-ttu-id="4b239-480">[Azure Event Hubs][event-hubs] est conçu pour la diffusion de données en continu à grande échelle, et le partitionnement est intégré au service pour permettre une mise à l’échelle horizontale.</span><span class="sxs-lookup"><span data-stu-id="4b239-480">[Azure Event Hubs][event-hubs] is designed for data streaming at massive scale, and partitioning is built into the service to enable horizontal scaling.</span></span> <span data-ttu-id="4b239-481">Chaque consommateur lit uniquement une partition spécifique du flux de messages.</span><span class="sxs-lookup"><span data-stu-id="4b239-481">Each consumer only reads a specific partition of the message stream.</span></span>

<span data-ttu-id="4b239-482">L’éditeur d’événements est uniquement informé de sa clé de partition, et non de la partition sur laquelle les événements sont publiés.</span><span class="sxs-lookup"><span data-stu-id="4b239-482">The event publisher is only aware of its partition key, not the partition to which the events are published.</span></span> <span data-ttu-id="4b239-483">Grâce à cette dissociation de la clé et de la partition, l’expéditeur n’a pas besoin de connaître trop d’informations sur le traitement en aval.</span><span class="sxs-lookup"><span data-stu-id="4b239-483">This decoupling of key and partition insulates the sender from needing to know too much about the downstream processing.</span></span> <span data-ttu-id="4b239-484">(Il est également possible d’envoyer des événements directement à une partition spécifique, mais cette opération est généralement déconseillée.)</span><span class="sxs-lookup"><span data-stu-id="4b239-484">(It's also possible send events directly to a given partition, but generally that's not recommended.)</span></span>  

<span data-ttu-id="4b239-485">Lorsque vous sélectionnez le nombre de partitions, tenez compte de la mise à l’échelle sur le long terme.</span><span class="sxs-lookup"><span data-stu-id="4b239-485">Consider long-term scale when you select the partition count.</span></span> <span data-ttu-id="4b239-486">Après la création d’un Event Hub, vous ne pourrez plus modifier le nombre de partitions.</span><span class="sxs-lookup"><span data-stu-id="4b239-486">After an event hub is created, you can't change the number of partitions.</span></span>

<span data-ttu-id="4b239-487">Pour plus d’informations sur l’utilisation de partitions dans Event Hubs, consultez l’article [Qu’est-ce qu’Event Hubs ?].</span><span class="sxs-lookup"><span data-stu-id="4b239-487">For more information about using partitions in Event Hubs, see [What is Event Hubs?].</span></span>

<span data-ttu-id="4b239-488">Pour découvrir des considérations relatives aux compromis entre la disponibilité et la cohérence, consultez l’article [Disponibilité et cohérence dans Event Hubs].</span><span class="sxs-lookup"><span data-stu-id="4b239-488">For considerations about trade-offs between availability and consistency, see [Availability and consistency in Event Hubs].</span></span>

[Disponibilité et cohérence dans Event Hubs]: /azure/event-hubs/event-hubs-availability-and-consistency
[Availability and consistency in Event Hubs]: /azure/event-hubs/event-hubs-availability-and-consistency
[azure-limits]: /azure/azure-subscription-service-limits
[Azure Content Delivery Network]: /azure/cdn/cdn-overview
[Cache Redis Azure]: https://azure.microsoft.com/services/cache/
[Azure Redis Cache]: https://azure.microsoft.com/services/cache/
[Azure Storage Scalability and Performance Targets]: /azure/storage/storage-scalability-targets
[Guide de conception de table de stockage Azure]: /azure/storage/storage-table-design-guide
[Azure Storage Table Design Guide]: /azure/storage/storage-table-design-guide
[Building a Polyglot Solution]: https://msdn.microsoft.com/library/dn313279.aspx
[cosmos-db-ru]: /azure/cosmos-db/request-units
[Data Access for Highly-Scalable Solutions: Using SQL, NoSQL, and Polyglot Persistence]: https://msdn.microsoft.com/library/dn271399.aspx
[Data consistency primer]: https://aka.ms/Data-Consistency-Primer
[Data Partitioning Guidance]: https://msdn.microsoft.com/library/dn589795.aspx
[Data types]: https://redis.io/topics/data-types
[Data Types]: https://redis.io/topics/data-types
[cosmosdb-sql-api]: /azure/cosmos-db/sql-api-introduction
[Elastic Database features overview]: /azure/sql-database/sql-database-elastic-scale-introduction
[event-hubs]: /azure/event-hubs
[Federations Migration Utility]: https://code.msdn.microsoft.com/vstudio/Federations-Migration-ce61e9c1
[Instructions et recommandations pour les collections fiables dans Azure Service Fabric]: /azure/service-fabric/service-fabric-reliable-services-reliable-collections-guidelines
[guidelines and recommendations for reliable collections in Azure Service Fabric]: /azure/service-fabric/service-fabric-reliable-services-reliable-collections-guidelines
[Multi-shard querying]: /azure/sql-database/sql-database-elastic-scale-multishard-querying
[Vue d’ensemble d’Azure Service Fabric]: /azure/service-fabric/service-fabric-overview
[Overview of Azure Service Fabric]: /azure/service-fabric/service-fabric-overview
[Partitionnement des services fiables Service Fabric]: /azure/service-fabric/service-fabric-concepts-partitioning
[Partition Service Fabric reliable services]: /azure/service-fabric/service-fabric-concepts-partitioning
[Partitioning: how to split data among multiple Redis instances]: https://redis.io/topics/partitioning
[Exécution de transactions de groupe d’entités]: /rest/api/storageservices/Performing-Entity-Group-Transactions
[Performing Entity Group Transactions]: /rest/api/storageservices/Performing-Entity-Group-Transactions
[Redis cluster tutorial]: https://redis.io/topics/cluster-tutorial
[Running Redis on a CentOS Linux VM in Azure]: https://blogs.msdn.microsoft.com/tconte/2012/06/08/running-redis-on-a-centos-linux-vm-in-windows-azure/
[Scaling using the Elastic Database split-merge tool]: /azure/sql-database/sql-database-elastic-scale-overview-split-and-merge
[Using Azure Content Delivery Network]: /azure/cdn/cdn-create-new-endpoint
[Quotas Service Bus]: /azure/service-bus-messaging/service-bus-quotas
[Service Bus quotas]: /azure/service-bus-messaging/service-bus-quotas
[service-fabric-reliable-collections]: /azure/service-fabric/service-fabric-reliable-services-reliable-collections
[Limites de service d’Azure Search]:  /azure/search/search-limits-quotas-capacity
[Service limits in Azure Search]:  /azure/search/search-limits-quotas-capacity
[Sharding pattern]: ../patterns/sharding.md
[Types de données pris en charge (Azure Search)]:  https://msdn.microsoft.com/library/azure/dn798938.aspx
[Supported Data Types (Azure Search)]:  https://msdn.microsoft.com/library/azure/dn798938.aspx
[Transactions]: https://redis.io/topics/transactions
[Qu’est-ce qu’Event Hubs ?]: /azure/event-hubs/event-hubs-what-is-event-hubs
[What is Event Hubs?]: /azure/event-hubs/event-hubs-what-is-event-hubs
[Qu’est-ce que Recherche Azure ?]: /azure/search/search-what-is-azure-search
[What is Azure Search?]: /azure/search/search-what-is-azure-search
[What is Azure SQL Database?]: /azure/sql-database/sql-database-technical-overview
[objectifs d’extensibilité]: /azure/storage/common/storage-scalability-targets
[scalability targets]: /azure/storage/common/storage-scalability-targets
