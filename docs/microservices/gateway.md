---
title: "Passerelles d’API"
description: "Passerelles d’API dans les microservices"
author: MikeWasson
ms.date: 12/08/2017
ms.openlocfilehash: 6483d416363e24f4084d6b856847a740bf4054d9
ms.sourcegitcommit: a8453c4bc7c870fa1a12bb3c02e3b310db87530c
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/29/2017
---
# <a name="designing-microservices-api-gateways"></a><span data-ttu-id="a4995-103">Conception de microservices : passerelles d’API</span><span class="sxs-lookup"><span data-stu-id="a4995-103">Designing microservices: API gateways</span></span>

<span data-ttu-id="a4995-104">Dans une architecture microservices, un client peut interagir avec plusieurs services frontaux.</span><span class="sxs-lookup"><span data-stu-id="a4995-104">In a microservices architecture, a client might interact with more than one front-end service.</span></span> <span data-ttu-id="a4995-105">Dans ce cas, comment un client sait-il quels points de terminaison appeler ?</span><span class="sxs-lookup"><span data-stu-id="a4995-105">Given this fact, how does a client know what endpoints to call?</span></span> <span data-ttu-id="a4995-106">Que se passe-t-il lors de l’introduction de nouveaux services ou lorsque des services existants sont refactorisés ?</span><span class="sxs-lookup"><span data-stu-id="a4995-106">What happens when new services are introduced, or existing services are refactored?</span></span> <span data-ttu-id="a4995-107">Comment les services gèrent-ils l’arrêt SSL, l’authentification et les autres problèmes ?</span><span class="sxs-lookup"><span data-stu-id="a4995-107">How do services handle SSL termination, authentication, and other concerns?</span></span> <span data-ttu-id="a4995-108">Une *passerelle d’API* permet de relever ces défis.</span><span class="sxs-lookup"><span data-stu-id="a4995-108">An *API gateway* can help to address these challenges.</span></span> 

![](./images/gateway.png)

## <a name="what-is-an-api-gateway"></a><span data-ttu-id="a4995-109">Qu'est-ce qu'une passerelle d'API ?</span><span class="sxs-lookup"><span data-stu-id="a4995-109">What is an API gateway?</span></span>

<span data-ttu-id="a4995-110">Une passerelle d’API se situe entre les clients et les services.</span><span class="sxs-lookup"><span data-stu-id="a4995-110">An API gateway sits between clients and services.</span></span> <span data-ttu-id="a4995-111">Elle agit comme un proxy inverse, en acheminant les requêtes des clients vers les services.</span><span class="sxs-lookup"><span data-stu-id="a4995-111">It acts as a reverse proxy, routing requests from clients to services.</span></span> <span data-ttu-id="a4995-112">Elle peut également effectuer diverses tâches transversales telles que l’authentification, l’arrêt SSL et la limitation du débit.</span><span class="sxs-lookup"><span data-stu-id="a4995-112">It may also perform various cross-cutting tasks such as authentication, SSL termination, and rate limiting.</span></span> <span data-ttu-id="a4995-113">Si vous ne pouvez pas déployer de passerelle, les clients doivent envoyer des requêtes directement aux services frontaux.</span><span class="sxs-lookup"><span data-stu-id="a4995-113">If you don't deploy a gateway, clients must send requests directly to front-end services.</span></span> <span data-ttu-id="a4995-114">Toutefois, il existe certains problèmes potentiels relatifs à l’exposition directe des services aux clients :</span><span class="sxs-lookup"><span data-stu-id="a4995-114">However, there are some potential problems with exposing services directly to clients:</span></span>

- <span data-ttu-id="a4995-115">Elle peut entraîner un code client complexe.</span><span class="sxs-lookup"><span data-stu-id="a4995-115">It can result in complex client code.</span></span> <span data-ttu-id="a4995-116">Le client doit effectuer le suivi de plusieurs points de terminaison et gérer les échecs de façon résiliente.</span><span class="sxs-lookup"><span data-stu-id="a4995-116">The client must keep track of multiple endpoints, and handle failures in a resilient way.</span></span> 
- <span data-ttu-id="a4995-117">Elle crée un couplage entre le client et le serveur principal.</span><span class="sxs-lookup"><span data-stu-id="a4995-117">It creates coupling between the client and the backend.</span></span> <span data-ttu-id="a4995-118">Le client doit connaître la façon dont les services individuels sont décomposés.</span><span class="sxs-lookup"><span data-stu-id="a4995-118">The client needs to know how the individual services are decomposed.</span></span> <span data-ttu-id="a4995-119">Cela rend plus difficiles la maintenance du client et la refactorisation des services.</span><span class="sxs-lookup"><span data-stu-id="a4995-119">That makes it harder to maintain the client and also harder to refactor services.</span></span>
- <span data-ttu-id="a4995-120">Une seule opération peut nécessiter des appels à plusieurs services.</span><span class="sxs-lookup"><span data-stu-id="a4995-120">A single operation might require calls to multiple services.</span></span> <span data-ttu-id="a4995-121">Cela peut entraîner plusieurs allers-retours réseau entre le client et le serveur, ajoutant ainsi une latence importante.</span><span class="sxs-lookup"><span data-stu-id="a4995-121">That can result in multiple network round trips between the client and the server, adding significant latency.</span></span> 
- <span data-ttu-id="a4995-122">Chaque service public doit gérer des problèmes tels que l’authentification, le SSL et la limitation du débit client.</span><span class="sxs-lookup"><span data-stu-id="a4995-122">Each public-facing service must handle concerns such as authentication, SSL, and client rate limiting.</span></span> 
- <span data-ttu-id="a4995-123">Les services doivent exposer un protocole pratique pour le client, comme HTTP ou WebSocket.</span><span class="sxs-lookup"><span data-stu-id="a4995-123">Services must expose a client-friendly protocol such as HTTP or WebSocket.</span></span> <span data-ttu-id="a4995-124">Cela limite le choix des [protocoles de communication](./interservice-communication.md).</span><span class="sxs-lookup"><span data-stu-id="a4995-124">This limits the choice of [communication protocols](./interservice-communication.md).</span></span> 
- <span data-ttu-id="a4995-125">Les services avec des points de terminaison publics représentent une surface d’attaque potentielle et doivent être renforcés.</span><span class="sxs-lookup"><span data-stu-id="a4995-125">Services with public endpoints are a potential attack surface, and must be hardened.</span></span>

<span data-ttu-id="a4995-126">Une passerelle permet de résoudre ces problèmes en dissociant les clients des services.</span><span class="sxs-lookup"><span data-stu-id="a4995-126">A gateway helps to address these issues by decoupling clients from services.</span></span> <span data-ttu-id="a4995-127">Les passerelles peuvent exécuter un certain nombre de fonctions différentes, et vous n’aurez peut-être pas besoin de toutes.</span><span class="sxs-lookup"><span data-stu-id="a4995-127">Gateways can perform a number of different functions, and you may not need all of them.</span></span> <span data-ttu-id="a4995-128">Les fonctions peuvent être regroupées dans les modèles de conception suivants :</span><span class="sxs-lookup"><span data-stu-id="a4995-128">The functions can be grouped into the following design patterns:</span></span>

<span data-ttu-id="a4995-129">[Routage de passerelle](../patterns/gateway-routing.md) :</span><span class="sxs-lookup"><span data-stu-id="a4995-129">[Gateway Routing](../patterns/gateway-routing.md).</span></span> <span data-ttu-id="a4995-130">utilisez la passerelle comme un proxy inverse pour acheminer les requêtes vers un ou plusieurs services principaux, à l’aide du routage de couche 7.</span><span class="sxs-lookup"><span data-stu-id="a4995-130">Use the gateway as a reverse proxy to route requests to one or more backend services, using layer 7 routing.</span></span> <span data-ttu-id="a4995-131">La passerelle fournit un point de terminaison unique pour les clients et permet de découpler les clients des services.</span><span class="sxs-lookup"><span data-stu-id="a4995-131">The gateway provides a single endpoint for clients, and helps to decouple clients from services.</span></span> 

<span data-ttu-id="a4995-132">[Agrégation de passerelle](../patterns/gateway-aggregation.md) :</span><span class="sxs-lookup"><span data-stu-id="a4995-132">[Gateway Aggregation](../patterns/gateway-aggregation.md).</span></span> <span data-ttu-id="a4995-133">utilisez la passerelle pour agréger plusieurs requêtes individuelles dans une requête unique.</span><span class="sxs-lookup"><span data-stu-id="a4995-133">Use the gateway to aggregate multiple individual requests into a single request.</span></span> <span data-ttu-id="a4995-134">Ce modèle s’applique lorsqu’une opération requiert des appels à plusieurs services principaux.</span><span class="sxs-lookup"><span data-stu-id="a4995-134">This pattern applies when a single operation requires calls to multiple backend services.</span></span> <span data-ttu-id="a4995-135">Le client envoie une seule requête à la passerelle.</span><span class="sxs-lookup"><span data-stu-id="a4995-135">The client sends one request to the gateway.</span></span> <span data-ttu-id="a4995-136">La passerelle répartit les requêtes entre les différents services principaux, puis agrège les résultats et les renvoie au client.</span><span class="sxs-lookup"><span data-stu-id="a4995-136">The gateway dispatches requests to the various backend services, and then aggregates the results and sends them back to the client.</span></span> <span data-ttu-id="a4995-137">Cela permet de réduire les échanges excessifs entre le client et les services principaux.</span><span class="sxs-lookup"><span data-stu-id="a4995-137">This helps to reduce chattiness between the client and the backend.</span></span> 

<span data-ttu-id="a4995-138">[Déchargement de passerelle](../patterns/gateway-offloading.md) :</span><span class="sxs-lookup"><span data-stu-id="a4995-138">[Gateway Offloading](../patterns/gateway-offloading.md).</span></span> <span data-ttu-id="a4995-139">utilisez la passerelle pour décharger des fonctionnalités à partir des services individuels vers la passerelle, en particulier les problèmes transversaux.</span><span class="sxs-lookup"><span data-stu-id="a4995-139">Use the gateway to offload functionality from individual services to the gateway, particularly cross-cutting concerns.</span></span> <span data-ttu-id="a4995-140">Il peut être utile de regrouper ces fonctions à un seul endroit, plutôt que de confier leur mise en œuvre à chaque service.</span><span class="sxs-lookup"><span data-stu-id="a4995-140">It can be useful to consolidate these functions into one place, rather than making every service responsible for implementing them.</span></span> <span data-ttu-id="a4995-141">Cela est particulièrement vrai pour les fonctionnalités dont l’implémentation correcte nécessite des compétences particulières, telles que l’authentification et l’autorisation.</span><span class="sxs-lookup"><span data-stu-id="a4995-141">This is particularly true for features that requires specialized skills to implement correctly, such as authentication and authorization.</span></span> 

<span data-ttu-id="a4995-142">Voici quelques exemples de fonctionnalités qui peuvent être déchargées sur une passerelle :</span><span class="sxs-lookup"><span data-stu-id="a4995-142">Here are some examples of functionality that could be offloaded to a gateway:</span></span>

- <span data-ttu-id="a4995-143">Arrêt SSL</span><span class="sxs-lookup"><span data-stu-id="a4995-143">SSL termination</span></span>
- <span data-ttu-id="a4995-144">Authentification</span><span class="sxs-lookup"><span data-stu-id="a4995-144">Authentication</span></span>
- <span data-ttu-id="a4995-145">Liste verte d’adresses IP</span><span class="sxs-lookup"><span data-stu-id="a4995-145">IP whitelisting</span></span>
- <span data-ttu-id="a4995-146">Limitation du débit client</span><span class="sxs-lookup"><span data-stu-id="a4995-146">Client rate limiting (throttling)</span></span>
- <span data-ttu-id="a4995-147">Enregistrement et surveillance</span><span class="sxs-lookup"><span data-stu-id="a4995-147">Logging and monitoring</span></span>
- <span data-ttu-id="a4995-148">Mise en cache des réponses</span><span class="sxs-lookup"><span data-stu-id="a4995-148">Response caching</span></span>
- <span data-ttu-id="a4995-149">Pare-feu d’application web</span><span class="sxs-lookup"><span data-stu-id="a4995-149">Web application firewall</span></span>
- <span data-ttu-id="a4995-150">Compression GZIP</span><span class="sxs-lookup"><span data-stu-id="a4995-150">GZIP compression</span></span>
- <span data-ttu-id="a4995-151">Maintenance du contenu statique</span><span class="sxs-lookup"><span data-stu-id="a4995-151">Servicing static content</span></span>

## <a name="choosing-a-gateway-technology"></a><span data-ttu-id="a4995-152">Choix d’une technologie de passerelle</span><span class="sxs-lookup"><span data-stu-id="a4995-152">Choosing a gateway technology</span></span>

<span data-ttu-id="a4995-153">Voici quelques options justifiant l’implémentation d’une passerelle d’API dans votre application.</span><span class="sxs-lookup"><span data-stu-id="a4995-153">Here are some options for implementing an API gateway in your application.</span></span>

- <span data-ttu-id="a4995-154">**Serveur proxy inverse** :</span><span class="sxs-lookup"><span data-stu-id="a4995-154">**Reverse proxy server**.</span></span> <span data-ttu-id="a4995-155">Nginx et HAProxy sont des serveurs proxy inverse courants qui prennent en charge des fonctionnalités telles que l’équilibrage de charge, le SSL et le routage de couche 7.</span><span class="sxs-lookup"><span data-stu-id="a4995-155">Nginx and HAProxy are popular reverse proxy servers that support features such as load balancing, SSL, and layer 7 routing.</span></span> <span data-ttu-id="a4995-156">Tous deux sont des produits libres et open source, avec des éditions payantes qui fournissent des fonctionnalités supplémentaires et des options de support.</span><span class="sxs-lookup"><span data-stu-id="a4995-156">They are both free, open-source products, with paid editions that provide additional features and support options.</span></span> <span data-ttu-id="a4995-157">Nginx et HAProxy sont des produits matures, dotés de riches ensembles de fonctionnalités et aux hautes performances.</span><span class="sxs-lookup"><span data-stu-id="a4995-157">Nginx and HAProxy are both mature products with rich feature sets and high performance.</span></span> <span data-ttu-id="a4995-158">Vous pouvez les étendre avec des modules tiers ou en écrivant des scripts personnalisés dans Lua.</span><span class="sxs-lookup"><span data-stu-id="a4995-158">You can extend them with third-party modules or by writing custom scripts in Lua.</span></span> <span data-ttu-id="a4995-159">Nginx prend également en charge un module de création de script basé sur JavaScript, appelé NginScript.</span><span class="sxs-lookup"><span data-stu-id="a4995-159">Nginx also supports a JavaScript-based scripting module called NginScript.</span></span>

- <span data-ttu-id="a4995-160">**Contrôleur d’entrée de maillage de service** :</span><span class="sxs-lookup"><span data-stu-id="a4995-160">**Service mesh ingress controller**.</span></span> <span data-ttu-id="a4995-161">si vous utilisez un maillage de service tel que linkerd ou Istio, considérez les fonctionnalités fournies par le contrôleur d’entrée de ce service de maillage.</span><span class="sxs-lookup"><span data-stu-id="a4995-161">If you are using a service mesh such as linkerd or Istio, consider the features that are provided by the ingress controller for that service mesh.</span></span> <span data-ttu-id="a4995-162">Par exemple, le contrôleur d’entrée Istio prend en charge le routage de couche 7, les redirections HTTP, les nouvelles tentatives et d’autres fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="a4995-162">For example, the Istio ingress controller supports layer 7 routing, HTTP redirects, retries, and other features.</span></span> 

- <span data-ttu-id="a4995-163">[Azure Application Gateway](/azure/application-gateway/) :</span><span class="sxs-lookup"><span data-stu-id="a4995-163">[Azure Application Gateway](/azure/application-gateway/).</span></span> <span data-ttu-id="a4995-164">Application Gateway est un service managé d’équilibrage de charge qui peut exécuter un routage de couche 7et un arrêt SSL.</span><span class="sxs-lookup"><span data-stu-id="a4995-164">Application Gateway is a managed load balancing service that can perform layer-7 routing and SSL termination.</span></span> <span data-ttu-id="a4995-165">Il fournit également un pare-feu d’application web (WAF).</span><span class="sxs-lookup"><span data-stu-id="a4995-165">It also provides a web application firewall (WAF).</span></span>

- <span data-ttu-id="a4995-166">[Azure API Management](/azure/api-management/) :</span><span class="sxs-lookup"><span data-stu-id="a4995-166">[Azure API Management](/azure/api-management/).</span></span> <span data-ttu-id="a4995-167">API Management est une solution clé en main pour la publication d’API à destination des clients internes et externes.</span><span class="sxs-lookup"><span data-stu-id="a4995-167">API Management is a turnkey solution for publishing APIs to external and internal customers.</span></span> <span data-ttu-id="a4995-168">Elle fournit des fonctionnalités utiles pour gérer une API publique, y compris la limitation du débit, la liste verte d’adresses IP et l’authentification à l’aide d’Azure Active Directory ou d’autres fournisseurs d’identité.</span><span class="sxs-lookup"><span data-stu-id="a4995-168">It provides features that are useful for managing a public-facing API, including rate limiting, IP white listing, and authentication using Azure Active Directory or other identity providers.</span></span> <span data-ttu-id="a4995-169">API Management n’effectue aucun équilibrage de charge. Par conséquent, elle doit être utilisée conjointement à un équilibreur de charge, tel qu’Application Gateway ou un proxy inverse.</span><span class="sxs-lookup"><span data-stu-id="a4995-169">API Management doesn't perform any load balancing, so it should be used in conjunction with a load balancer such as Application Gateway or a reverse proxy.</span></span>

<span data-ttu-id="a4995-170">Lors du choix d’une technologie de passerelle, considérez les points suivants :</span><span class="sxs-lookup"><span data-stu-id="a4995-170">When choosing a gateway technology, consider the following:</span></span>

<span data-ttu-id="a4995-171">**Fonctionnalités** :</span><span class="sxs-lookup"><span data-stu-id="a4995-171">**Features**.</span></span> <span data-ttu-id="a4995-172">les options répertoriées ci-dessus prennent en charge le routage de couche 7, mais la prise en charge des autres fonctionnalités varie.</span><span class="sxs-lookup"><span data-stu-id="a4995-172">The options listed above all support layer 7 routing, but support for other features will vary.</span></span> <span data-ttu-id="a4995-173">Selon les fonctionnalités dont vous avez besoin, vous pouvez déployer plusieurs passerelles.</span><span class="sxs-lookup"><span data-stu-id="a4995-173">Depending on the features that you need, you might deploy more than one gateway.</span></span> 

<span data-ttu-id="a4995-174">**Déploiement**.</span><span class="sxs-lookup"><span data-stu-id="a4995-174">**Deployment**.</span></span> <span data-ttu-id="a4995-175">Azure Application Gateway et API Management sont des services managés.</span><span class="sxs-lookup"><span data-stu-id="a4995-175">Azure Application Gateway and API Management are managed services.</span></span> <span data-ttu-id="a4995-176">Nginx et HAProxy s’exécutent généralement dans des conteneurs situés à l’intérieur du cluster, mais ils peuvent également être déployés vers des machines virtuelles dédiées en dehors du cluster.</span><span class="sxs-lookup"><span data-stu-id="a4995-176">Nginx and HAProxy will typically run in containers inside the cluster, but can also be deployed to dedicated VMs outside of the cluster.</span></span> <span data-ttu-id="a4995-177">Cela isole la passerelle du reste de la charge de travail, mais entraîne une surcharge de gestion plus élevée.</span><span class="sxs-lookup"><span data-stu-id="a4995-177">This isolates the gateway from the rest of the workload, but incurs higher management overhead.</span></span>

<span data-ttu-id="a4995-178">**Gestion** :</span><span class="sxs-lookup"><span data-stu-id="a4995-178">**Management**.</span></span> <span data-ttu-id="a4995-179">lors de l’ajout ou de la mise à jour de services, les règles de routage de passerelle peuvent nécessiter une mise à jour.</span><span class="sxs-lookup"><span data-stu-id="a4995-179">When services are updated or new services are added, the gateway routing rules may need to be updated.</span></span> <span data-ttu-id="a4995-180">Envisagez le mode de gestion de ce processus.</span><span class="sxs-lookup"><span data-stu-id="a4995-180">Consider how this process will be managed.</span></span> <span data-ttu-id="a4995-181">Des considérations similaires s’appliquent à la gestion des certificats SSL, des listes vertes d’adresses IP et d’autres aspects de la configuration.</span><span class="sxs-lookup"><span data-stu-id="a4995-181">Similar considerations apply to managing SSL certificates, IP whitelists, and other aspects of configuration.</span></span>

## <a name="deployment-considerations"></a><span data-ttu-id="a4995-182">Points à prendre en considération pour le déploiement</span><span class="sxs-lookup"><span data-stu-id="a4995-182">Deployment considerations</span></span>

### <a name="deploying-nginx-or-haproxy-to-kubernetes"></a><span data-ttu-id="a4995-183">Déploiement Nginx ou HAProxy vers Kubernetes</span><span class="sxs-lookup"><span data-stu-id="a4995-183">Deploying Nginx or HAProxy to Kubernetes</span></span>

<span data-ttu-id="a4995-184">Vous pouvez déployer Nginx ou HAProxy sur Kubernetes en tant que [ReplicaSet](https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/) ou [DaemonSet](https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/) qui spécifie l’image de conteneur Nginx ou HAProxy.</span><span class="sxs-lookup"><span data-stu-id="a4995-184">You can deploy Nginx or HAProxy to Kubernetes as a [ReplicaSet](https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/) or [DaemonSet](https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/) that specifies the Nginx or HAProxy container image.</span></span> <span data-ttu-id="a4995-185">Utilisez un élément ConfigMap pour stocker le fichier de configuration du proxy et montez l’élément ConfigMap en tant que volume.</span><span class="sxs-lookup"><span data-stu-id="a4995-185">Use a ConfigMap to store the configuration file for the proxy, and mount the ConfigMap as a volume.</span></span> <span data-ttu-id="a4995-186">Créez un service de type LoadBalancer pour exposer la passerelle via un équilibreur de charge Azure.</span><span class="sxs-lookup"><span data-stu-id="a4995-186">Create a service of type LoadBalancer to expose the gateway through an Azure Load Balancer.</span></span> 

<!-- - Configure a readiness probe that serves a static file from the gateway (rather than routing to another service). -->

<span data-ttu-id="a4995-187">Une alternative consiste à créer un contrôleur d’entrée.</span><span class="sxs-lookup"><span data-stu-id="a4995-187">An alternative is to create an Ingress Controller.</span></span> <span data-ttu-id="a4995-188">Un contrôleur d’entrée est une ressource Kubernetes qui déploie un équilibreur de charge ou un serveur proxy inverse.</span><span class="sxs-lookup"><span data-stu-id="a4995-188">An Ingress Controller is a Kubernetes resource that deploys a load balancer or reverse proxy server.</span></span> <span data-ttu-id="a4995-189">Plusieurs implémentations existent, y compris Nginx et HAProxy.</span><span class="sxs-lookup"><span data-stu-id="a4995-189">Several implementations exist, including Nginx and HAProxy.</span></span> <span data-ttu-id="a4995-190">Une ressource séparée appelée « entrée » définit des paramètres pour le contrôleur d’entrée, tels que des règles de routage et des certificats TLS.</span><span class="sxs-lookup"><span data-stu-id="a4995-190">A separate resource called an Ingress defines settings for the Ingress Controller, such as routing rules and TLS certificates.</span></span> <span data-ttu-id="a4995-191">De cette façon, vous n’avez pas besoin de gérer des fichiers de configuration complexes propres à une technologie de serveur proxy spécifique.</span><span class="sxs-lookup"><span data-stu-id="a4995-191">That way, you don't need to manage complex configuration files that are specific to a particular proxy server technology.</span></span> <span data-ttu-id="a4995-192">Les contrôleurs d’entrée sont encore une fonctionnalité bêta de Kubernetes au moment de la rédaction de cet article et continueront d’évoluer.</span><span class="sxs-lookup"><span data-stu-id="a4995-192">Ingress Controllers are still a beta feature of Kubernetes at the time of this writing, and the feature will continue to evolve.</span></span>

<span data-ttu-id="a4995-193">La passerelle est un point de défaillance unique ou un goulot d’étranglement potentiel dans le système. Déployez donc toujours au moins deux réplicas pour une haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="a4995-193">The gateway is a potential bottleneck or single point of failure in the system, so always deploy at least two replicas for high availability.</span></span> <span data-ttu-id="a4995-194">Vous devrez peut-être mettre à l’échelle les réplicas, en fonction de la charge.</span><span class="sxs-lookup"><span data-stu-id="a4995-194">You may need to scale out the replicas further, depending on the load.</span></span> 

<span data-ttu-id="a4995-195">Envisagez également d’exécuter la passerelle sur un ensemble dédié de nœuds dans le cluster.</span><span class="sxs-lookup"><span data-stu-id="a4995-195">Also consider running the gateway on a dedicated set of nodes in the cluster.</span></span> <span data-ttu-id="a4995-196">Cette approche présente les avantages suivants :</span><span class="sxs-lookup"><span data-stu-id="a4995-196">Benefits to this approach include:</span></span>

- <span data-ttu-id="a4995-197">Isolement :</span><span class="sxs-lookup"><span data-stu-id="a4995-197">Isolation.</span></span> <span data-ttu-id="a4995-198">tout le trafic entrant est envoyé vers un ensemble fixe de nœuds, qui peut être isolé des services principaux.</span><span class="sxs-lookup"><span data-stu-id="a4995-198">All inbound traffic goes to a fixed set of nodes, which can be isolated from backend services.</span></span>

- <span data-ttu-id="a4995-199">Configuration stable :</span><span class="sxs-lookup"><span data-stu-id="a4995-199">Stable configuration.</span></span> <span data-ttu-id="a4995-200">si la passerelle est mal configurée, l’application entière peut devenir indisponible.</span><span class="sxs-lookup"><span data-stu-id="a4995-200">If the gateway is misconfigured, the entire application may become unavailable.</span></span> 

- <span data-ttu-id="a4995-201">Les performances.</span><span class="sxs-lookup"><span data-stu-id="a4995-201">Performance.</span></span> <span data-ttu-id="a4995-202">vous pouvez utiliser une configuration de machine virtuelle spécifique pour la passerelle pour des raisons de performances.</span><span class="sxs-lookup"><span data-stu-id="a4995-202">You may want to use a specific VM configuration for the gateway for performance reasons.</span></span>

<!-- - Load balancing. You can configure the external load balancer so that requests always go to a gateway node. That can save a network hop, which would otherwise happen whenever a request lands on a node that isn't running a gateway pod. This consideration applies mainly to large clusters, where the gateway runs on a relatively small fraction of the total nodes. In Azure Container Service (ACS), this approach currently requires [ACS Engine](https://github.com/Azure/acs-engine)) which allows you to create multiple agent pools. Then you can deploy the gateway as a DaemonSet to the front-end pool. -->

### <a name="azure-application-gateway"></a><span data-ttu-id="a4995-203">Azure Application Gateway</span><span class="sxs-lookup"><span data-stu-id="a4995-203">Azure Application Gateway</span></span>

<span data-ttu-id="a4995-204">Pour connecter Application Gateway à un cluster Kubernetes dans Azure :</span><span class="sxs-lookup"><span data-stu-id="a4995-204">To connect Application Gateway to a Kubernetes cluster in Azure:</span></span>

1. <span data-ttu-id="a4995-205">Créez un sous-réseau vide dans le réseau virtuel du cluster.</span><span class="sxs-lookup"><span data-stu-id="a4995-205">Create an empty subnet in the cluster VNet.</span></span>
2. <span data-ttu-id="a4995-206">Déployez Application Gateway.</span><span class="sxs-lookup"><span data-stu-id="a4995-206">Deploy Application Gateway.</span></span>
3. <span data-ttu-id="a4995-207">Créez un service Kubernetes avec type=[NodePort](https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport).</span><span class="sxs-lookup"><span data-stu-id="a4995-207">Create a Kubernetes service with type=[NodePort](https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport).</span></span> <span data-ttu-id="a4995-208">Cela expose le service sur chaque nœud afin qu’il soit accessible depuis l’extérieur du cluster.</span><span class="sxs-lookup"><span data-stu-id="a4995-208">This exposes the service on each node so that it can be reached from outside the cluster.</span></span> <span data-ttu-id="a4995-209">Cela ne crée pas d’équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="a4995-209">It does not create a load balancer.</span></span>
5. <span data-ttu-id="a4995-210">Obtenez le numéro de port attribué au service.</span><span class="sxs-lookup"><span data-stu-id="a4995-210">Get the assigned port number for the service.</span></span>
6. <span data-ttu-id="a4995-211">Ajoutez une règle Application Gateway où :</span><span class="sxs-lookup"><span data-stu-id="a4995-211">Add an Application Gateway rule where:</span></span>
    - <span data-ttu-id="a4995-212">Le pool principal contient les machines virtuelles d’agent.</span><span class="sxs-lookup"><span data-stu-id="a4995-212">The backend pool contains the agent VMs.</span></span>
    - <span data-ttu-id="a4995-213">Le paramètre HTTP spécifie le numéro de port de service.</span><span class="sxs-lookup"><span data-stu-id="a4995-213">The HTTP setting specifies the service port number.</span></span>
    - <span data-ttu-id="a4995-214">Le processus d’écoute de la passerelle écoute sur les ports 80/443.</span><span class="sxs-lookup"><span data-stu-id="a4995-214">The gateway listener listens on ports 80/443</span></span>
    
<span data-ttu-id="a4995-215">Définissez le nombre d’instances sur 2 ou plus pour la haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="a4995-215">Set the instance count to 2 or more for high availability.</span></span>

### <a name="azure-api-management"></a><span data-ttu-id="a4995-216">Gestion des API Azure</span><span class="sxs-lookup"><span data-stu-id="a4995-216">Azure API Management</span></span> 

<span data-ttu-id="a4995-217">Pour connecter API Management à un cluster Kubernetes dans Azure :</span><span class="sxs-lookup"><span data-stu-id="a4995-217">To connect API Management to a Kubernetes cluster in Azure:</span></span>

1. <span data-ttu-id="a4995-218">Créez un sous-réseau vide dans le réseau virtuel du cluster.</span><span class="sxs-lookup"><span data-stu-id="a4995-218">Create an empty subnet in the cluster VNet.</span></span>
2. <span data-ttu-id="a4995-219">Déployez API Management vers ce sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="a4995-219">Deploy API Management to that subnet.</span></span>
3. <span data-ttu-id="a4995-220">Créez un service Kubernetes de type LoadBalancer.</span><span class="sxs-lookup"><span data-stu-id="a4995-220">Create a Kubernetes service of type LoadBalancer.</span></span> <span data-ttu-id="a4995-221">Utilisez l’annotation d’[équilibreur de charge interne](https://kubernetes.io/docs/concepts/services-networking/service/#internal-load-balancer) pour créer un équilibreur de charge interne, au lieu d’un équilibreur de charge connecté à Internet, qui est l’option par défaut.</span><span class="sxs-lookup"><span data-stu-id="a4995-221">Use the [internal load balancer](https://kubernetes.io/docs/concepts/services-networking/service/#internal-load-balancer) annotation to create an internal load balancer, instead of an Internet-facing load balancer, which is the default.</span></span>
4. <span data-ttu-id="a4995-222">Recherchez l’adresse IP privée de l’équilibreur de charge interne, à l’aide de kubectl ou de l’interface de ligne de commande Azure.</span><span class="sxs-lookup"><span data-stu-id="a4995-222">Find the private IP of the internal load balancer, using kubectl or the Azure CLI.</span></span>
5. <span data-ttu-id="a4995-223">Utilisez API Management pour créer une API qui mène à l’adresse IP privée de l’équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="a4995-223">Use API Management to create an API that directs to the private IP address of the load balancer.</span></span>

<span data-ttu-id="a4995-224">Vous pouvez combiner API Management avec un proxy inverse : Nginx, HAProxy ou Azure Application Gateway.</span><span class="sxs-lookup"><span data-stu-id="a4995-224">Consider combining API Management with a reverse proxy, whether Nginx, HAProxy, or Azure Application Gateway.</span></span> <span data-ttu-id="a4995-225">Pour plus d’informations sur l’utilisation d’API Management avec Application Gateway, voir [Intégration de la gestion des API dans un réseau virtuel interne avec Application Gateway](/azure/api-management/api-management-howto-integrate-internal-vnet-appgateway).</span><span class="sxs-lookup"><span data-stu-id="a4995-225">For information about using API Management with Application Gateway, see [Integrate API Management in an internal VNET with Application Gateway](/azure/api-management/api-management-howto-integrate-internal-vnet-appgateway).</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="a4995-226">Enregistrement et surveillance</span><span class="sxs-lookup"><span data-stu-id="a4995-226">Logging and monitoring</span></span>](./logging-monitoring.md)
