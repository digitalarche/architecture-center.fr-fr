---
title: Guide technique - Récupération suite à des défaillances locales dans Azure
description: Article dédié à la compréhension et à la conception d’applications robustes, hautement disponibles et tolérantes aux pannes, ainsi qu’à la planification de la récupération d’urgence axée sur les défaillances locales dans Azure.
author: adamglick
ms.date: 08/18/2016
ms.openlocfilehash: 5fc929bd1affe3dd6616f908bae0e7d2fefb89d5
ms.sourcegitcommit: e67b751f230792bba917754d67789a20810dc76b
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/06/2018
ms.locfileid: "30846832"
---
[!INCLUDE [header](../_includes/header.md)]

# <a name="azure-resiliency-technical-guidance-recovery-from-local-failures-in-azure"></a><span data-ttu-id="ad409-103">Guide technique de la résilience Azure - Récupération suite à des défaillances locales dans Azure</span><span class="sxs-lookup"><span data-stu-id="ad409-103">Azure resiliency technical guidance: Recovery from local failures in Azure</span></span>

<span data-ttu-id="ad409-104">Il existe deux menaces principales à la disponibilité des applications :</span><span class="sxs-lookup"><span data-stu-id="ad409-104">There are two primary threats to application availability:</span></span>

* <span data-ttu-id="ad409-105">La défaillance des appareils, tels que les lecteurs et les serveurs.</span><span class="sxs-lookup"><span data-stu-id="ad409-105">The failure of devices, such as drives and servers</span></span>
* <span data-ttu-id="ad409-106">L’épuisement des ressources critiques, telles que le calcul dans des conditions de charge maximale.</span><span class="sxs-lookup"><span data-stu-id="ad409-106">The exhaustion of critical resources, such as compute under peak load conditions</span></span>

<span data-ttu-id="ad409-107">Azure offre une combinaison de gestion des ressources, d’élasticité, d’équilibrage de charge et de partitionnement pour permettre d’obtenir une haute disponibilité dans ces circonstances.</span><span class="sxs-lookup"><span data-stu-id="ad409-107">Azure provides a combination of resource management, elasticity, load balancing, and partitioning to enable high availability under these circumstances.</span></span> <span data-ttu-id="ad409-108">Certaines de ces fonctionnalités sont exécutées automatiquement pour tous les services Azure.</span><span class="sxs-lookup"><span data-stu-id="ad409-108">Some of these features are performed automatically for all Azure services.</span></span> <span data-ttu-id="ad409-109">Cependant, dans certains cas, le développeur d’application doit effectuer un travail supplémentaire pour tirer parti de ces fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="ad409-109">However, in some cases, the application developer must do some additional work to benefit from them.</span></span>

## <a name="cloud-services"></a><span data-ttu-id="ad409-110">Cloud Services</span><span class="sxs-lookup"><span data-stu-id="ad409-110">Cloud Services</span></span>
<span data-ttu-id="ad409-111">Azure Cloud Services se compose de collections d’un ou de plusieurs rôles Web ou de travail.</span><span class="sxs-lookup"><span data-stu-id="ad409-111">Azure Cloud Services consists of collections of one or more web or worker roles.</span></span> <span data-ttu-id="ad409-112">Une ou plusieurs instances d’un rôle peuvent s’exécuter simultanément.</span><span class="sxs-lookup"><span data-stu-id="ad409-112">One or more instances of a role can run concurrently.</span></span> <span data-ttu-id="ad409-113">Le nombre d’instances est déterminé par la configuration.</span><span class="sxs-lookup"><span data-stu-id="ad409-113">The configuration determines the number of instances.</span></span> <span data-ttu-id="ad409-114">Les instances de rôle sont surveillées et gérées à l’aide d’un composant appelé le contrôleur de structure.</span><span class="sxs-lookup"><span data-stu-id="ad409-114">Role instances are monitored and managed through a component called the fabric controller.</span></span> <span data-ttu-id="ad409-115">Le contrôleur de structure détecte automatiquement les défaillances logicielles et matérielles, et y répond.</span><span class="sxs-lookup"><span data-stu-id="ad409-115">The fabric controller detects and responds to both software and hardware failures automatically.</span></span>

<span data-ttu-id="ad409-116">Chaque instance de rôle s’exécute dans sa propre machine virtuelle et communique avec son contrôleur de structure par le biais d’un agent invité.</span><span class="sxs-lookup"><span data-stu-id="ad409-116">Every role instance runs in its own virtual machine (VM) and communicates with its fabric controller through a guest agent.</span></span> <span data-ttu-id="ad409-117">L’agent invité collecte les métriques de ressource et de nœud, y compris l’utilisation des machines virtuelles, les états, les journaux, l’utilisation des ressources, les exceptions et les conditions de défaillance.</span><span class="sxs-lookup"><span data-stu-id="ad409-117">The guest agent collects resource and node metrics, including VM usage, status, logs, resource usage, exceptions, and failure conditions.</span></span> <span data-ttu-id="ad409-118">Le contrôleur de structure interroge l’agent invité à des intervalles configurables, et redémarre la machine virtuelle si l’agent invité ne répond pas.</span><span class="sxs-lookup"><span data-stu-id="ad409-118">The fabric controller queries the guest agent at configurable intervals, and it restarts the VM if the guest agent fails to respond.</span></span> <span data-ttu-id="ad409-119">En cas de défaillance matérielle, le contrôleur de structure associé déplace toutes les instances de rôle affectées vers un nouveau nœud de matériel et reconfigure le réseau pour y acheminer le trafic.</span><span class="sxs-lookup"><span data-stu-id="ad409-119">In the event of hardware failure, the associated fabric controller moves all affected role instances to a new hardware node and reconfigures the network to route traffic there.</span></span>

<span data-ttu-id="ad409-120">Pour tirer parti de ces fonctionnalités, les développeurs doivent s’assurer que tous les rôles de service évitent de stocker l’état sur les instances de rôle.</span><span class="sxs-lookup"><span data-stu-id="ad409-120">To benefit from these features, developers should ensure that all service roles avoid storing state on the role instances.</span></span> <span data-ttu-id="ad409-121">Au lieu de cela, toutes les données persistantes doivent être accessibles à partir d’un stockage durable, tels que Stockage Azure ou Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="ad409-121">Instead, all persistent data should be accessed from durable storage, such as Azure Storage or Azure SQL Database.</span></span> <span data-ttu-id="ad409-122">Ainsi, tous les rôles sont en mesure de gérer les demandes.</span><span class="sxs-lookup"><span data-stu-id="ad409-122">This allows any roles to handle requests.</span></span> <span data-ttu-id="ad409-123">Cela signifie également que les instances de rôle peuvent tomber en panne à tout moment sans créer d’incohérences dans l’état temporaire ou permanent du service.</span><span class="sxs-lookup"><span data-stu-id="ad409-123">It also means that role instances can go down at any time without creating inconsistencies in the transient or persistent state of the service.</span></span>

<span data-ttu-id="ad409-124">La nécessité de stocker l’état en dehors des rôles présente plusieurs implications.</span><span class="sxs-lookup"><span data-stu-id="ad409-124">The requirement to store state externally to the roles has several implications.</span></span> <span data-ttu-id="ad409-125">Par exemple, cela implique que toutes les modifications associées à une table Azure Storage doivent être effectuées dans une seule transaction de groupe d’entités, si possible.</span><span class="sxs-lookup"><span data-stu-id="ad409-125">It implies, for example, that all related changes to an Azure Storage table should be changed in a single entity-group transaction, if possible.</span></span> <span data-ttu-id="ad409-126">Bien entendu, il n’est pas toujours possible d’apporter toutes les modifications dans une transaction unique.</span><span class="sxs-lookup"><span data-stu-id="ad409-126">Of course, it isn't always possible to make all changes in a single transaction.</span></span> <span data-ttu-id="ad409-127">Vous devez tout particulièrement veiller à garantir que les défaillances d’instances de rôle ne provoquent aucun problème lorsqu’elles interrompent des opérations de longue durée qui englobent un minimum de deux mises à jour de l’état permanent du service.</span><span class="sxs-lookup"><span data-stu-id="ad409-127">You must take special care to ensure that role instance failures do not cause problems when they interrupt long-running operations that span two or more updates to the persistent state of the service.</span></span> <span data-ttu-id="ad409-128">Si un autre rôle tente à nouveau une telle opération, il doit anticiper les situations pour lesquelles le travail a été partiellement effectué, et les gérer efficacement.</span><span class="sxs-lookup"><span data-stu-id="ad409-128">If another role attempts to retry such an operation, it should anticipate and handle the case where the work was partially completed.</span></span>

<span data-ttu-id="ad409-129">Par exemple, imaginons un service qui partitionne les données dans plusieurs magasins.</span><span class="sxs-lookup"><span data-stu-id="ad409-129">For example, consider a service that partitions data across multiple stores.</span></span> <span data-ttu-id="ad409-130">Si un rôle de travail tombe en panne pendant le déplacement d’une partition, le déplacement de la partition peut ne pas aboutir.</span><span class="sxs-lookup"><span data-stu-id="ad409-130">If a worker role goes down while it's relocating a shard, the relocation of the shard might not finish.</span></span> <span data-ttu-id="ad409-131">Ou bien, le déplacement peut être répété depuis le début par un autre rôle de travail, ce qui peut éventuellement générer des données orphelines ou corrompre des données.</span><span class="sxs-lookup"><span data-stu-id="ad409-131">Or the relocation might be repeated from its inception by a different worker role, potentially causing orphaned data or data corruption.</span></span> <span data-ttu-id="ad409-132">Pour éviter ces problèmes, les opérations de longue durée doivent être du même type que l’une ou l’ensemble des opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="ad409-132">To prevent problems, long-running operations must be one or both of the following:</span></span>

* <span data-ttu-id="ad409-133">*Idempotente*: répétable sans effet secondaire.</span><span class="sxs-lookup"><span data-stu-id="ad409-133">*Idempotent*: Repeatable without side effects.</span></span> <span data-ttu-id="ad409-134">Pour être idempotente, une opération de longue durée doit présenter un effet identique dans toutes ses itérations, même lorsqu’elle est interrompue pendant l’exécution.</span><span class="sxs-lookup"><span data-stu-id="ad409-134">To be idempotent, a long-running operation should have the same effect no matter how many times it's executed, even when it's interrupted during execution.</span></span>
* <span data-ttu-id="ad409-135">*Redémarrable de façon incrémentielle*: en mesure de continuer à partir du point de défaillance le plus récent.</span><span class="sxs-lookup"><span data-stu-id="ad409-135">*Incrementally restartable*: Able to continue from the most recent point of failure.</span></span> <span data-ttu-id="ad409-136">Pour être redémarrable de façon incrémentielle, une opération de longue durée doit se composer d’une séquence d’opérations atomiques plus petites.</span><span class="sxs-lookup"><span data-stu-id="ad409-136">To be incrementally restartable, a long-running operation should consist of a sequence of smaller atomic operations.</span></span> <span data-ttu-id="ad409-137">Elle doit également enregistrer sa progression dans le stockage durable, de façon à ce que chacun des appels ultérieurs reprenne là où son prédécesseur s’est arrêté.</span><span class="sxs-lookup"><span data-stu-id="ad409-137">It should also record its progress in durable storage, so that each subsequent invocation picks up where its predecessor stopped.</span></span>

<span data-ttu-id="ad409-138">Enfin, toutes les opérations de longue durée doivent être appelées à plusieurs reprises jusqu’à leur réussite.</span><span class="sxs-lookup"><span data-stu-id="ad409-138">Finally, all long-running operations should be invoked repeatedly until they succeed.</span></span> <span data-ttu-id="ad409-139">Par exemple, une opération d’approvisionnement peut être placée dans une file d’attente Azure, puis supprimée de la file d’attente par un rôle de travail uniquement lorsqu’elle réussit.</span><span class="sxs-lookup"><span data-stu-id="ad409-139">For example, a provisioning operation might be placed in an Azure queue, and then removed from the queue by a worker role only when it succeeds.</span></span> <span data-ttu-id="ad409-140">Un nettoyage de la mémoire peut être nécessaire afin de nettoyer les données créées par des opérations interrompues.</span><span class="sxs-lookup"><span data-stu-id="ad409-140">Garbage collection might be necessary to clean up data that interrupted operations create.</span></span>

### <a name="elasticity"></a><span data-ttu-id="ad409-141">Élasticité</span><span class="sxs-lookup"><span data-stu-id="ad409-141">Elasticity</span></span>
<span data-ttu-id="ad409-142">Le nombre initial d’instances en cours d’exécution pour chaque rôle est déterminé dans la configuration de chaque rôle.</span><span class="sxs-lookup"><span data-stu-id="ad409-142">The initial number of instances running for each role is determined in each role’s configuration.</span></span> <span data-ttu-id="ad409-143">Les administrateurs doivent initialement configurer chaque rôle pour l’exécution avec deux ou plusieurs instances, en fonction de la charge attendue.</span><span class="sxs-lookup"><span data-stu-id="ad409-143">Administrators should initially configure each role to run with two or more instances based on expected load.</span></span> <span data-ttu-id="ad409-144">Cependant, vous pouvez facilement monter en puissance ou descendre en puissance les instances de rôle en fonction des variations des modèles d’utilisation.</span><span class="sxs-lookup"><span data-stu-id="ad409-144">But you can easily scale role instances up or down as usage patterns change.</span></span> <span data-ttu-id="ad409-145">Vous pouvez effectuer cette opération manuellement dans le portail Azure ou automatiser le processus à l’aide de Windows PowerShell, de l’API Gestion des services ou d’outils tiers.</span><span class="sxs-lookup"><span data-stu-id="ad409-145">You can do this manually in the Azure portal, or you can automate the process by using Windows PowerShell, the Service Management API, or third-party tools.</span></span> <span data-ttu-id="ad409-146">Pour plus d’informations, consultez [Mise à l’échelle automatique d’un service cloud](/azure/cloud-services/cloud-services-how-to-scale/).</span><span class="sxs-lookup"><span data-stu-id="ad409-146">For more information, see [How to autoscale an application](/azure/cloud-services/cloud-services-how-to-scale/).</span></span>

### <a name="partitioning"></a><span data-ttu-id="ad409-147">Partitionnement</span><span class="sxs-lookup"><span data-stu-id="ad409-147">Partitioning</span></span>
<span data-ttu-id="ad409-148">Le contrôleur de structure Azure utilise deux types de partitions :</span><span class="sxs-lookup"><span data-stu-id="ad409-148">The Azure fabric controller uses two types of partitions:</span></span>

* <span data-ttu-id="ad409-149">Un *domaine de mise à jour* est utilisé pour mettre à niveau les instances d’un rôle de service dans les groupes.</span><span class="sxs-lookup"><span data-stu-id="ad409-149">An *update domain* is used to upgrade a service’s role instances in groups.</span></span> <span data-ttu-id="ad409-150">Azure déploie les instances de service dans plusieurs domaines de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="ad409-150">Azure deploys service instances into multiple update domains.</span></span> <span data-ttu-id="ad409-151">Dans le cadre d’une mise à jour sur place, le contrôleur de structure interrompt toutes les instances d’un domaine de mise à jour, les met à jour et les redémarre avant de passer au domaine de mise à jour suivant.</span><span class="sxs-lookup"><span data-stu-id="ad409-151">For an in-place update, the fabric controller brings down all the instances in one update domain, updates them, and then restarts them before moving to the next update domain.</span></span> <span data-ttu-id="ad409-152">Cette approche prévient toute indisponibilité de l’intégralité du service durant le processus de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="ad409-152">This approach prevents the entire service from being unavailable during the update process.</span></span>
* <span data-ttu-id="ad409-153">Un *domaine d’erreur* définit les points potentiels de défaillance matérielle ou de réseau.</span><span class="sxs-lookup"><span data-stu-id="ad409-153">A *fault domain* defines potential points of hardware or network failure.</span></span> <span data-ttu-id="ad409-154">Le contrôleur de structure garantit que les instances d’un rôle en présentant plusieurs sont distribuées entre plusieurs domaines d’erreur pour éviter toute interruption du service par des défaillances matérielles isolées.</span><span class="sxs-lookup"><span data-stu-id="ad409-154">For any role that has more than one instance, the fabric controller ensures that the instances are distributed across multiple fault domains, to prevent isolated hardware failures from disrupting service.</span></span> <span data-ttu-id="ad409-155">L’exposition aux défaillances de serveur et de cluster est régie par les domaines d’erreur.</span><span class="sxs-lookup"><span data-stu-id="ad409-155">Fault domains govern all exposure to server and cluster failures.</span></span>

<span data-ttu-id="ad409-156">Le [contrat de niveau de service Azure](https://azure.microsoft.com/support/legal/sla/) garantit que lorsqu’au minimum deux instances de rôles Web sont déployées sur des domaines d’erreur et de mise à niveau différents, elles présentent une connectivité externe au moins 99,95 % du temps.</span><span class="sxs-lookup"><span data-stu-id="ad409-156">The [Azure service-level agreement (SLA)](https://azure.microsoft.com/support/legal/sla/) guarantees that when two or more web role instances are deployed to different fault and upgrade domains, they'll have external connectivity at least 99.95 percent of the time.</span></span> <span data-ttu-id="ad409-157">Contrairement aux domaines de mise à jour, il n’existe aucun moyen de contrôler le nombre de domaines d’erreur.</span><span class="sxs-lookup"><span data-stu-id="ad409-157">Unlike update domains, there's no way to control the number of fault domains.</span></span> <span data-ttu-id="ad409-158">Azure alloue automatiquement les domaines d’erreur et distribue les instances de rôle entre elles.</span><span class="sxs-lookup"><span data-stu-id="ad409-158">Azure automatically allocates fault domains and distributes role instances across them.</span></span> <span data-ttu-id="ad409-159">Les deux premières instances au minimum de chaque rôle sont placées dans des domaines d’erreur et de mise à niveau différents pour garantir que les rôles présentant au moins deux instances satisferont les contrats de niveau de service.</span><span class="sxs-lookup"><span data-stu-id="ad409-159">At least the first two instances of every role are placed in different fault and upgrade domains to ensure that any role with at least two instances will satisfy the SLA.</span></span> <span data-ttu-id="ad409-160">Cela est représenté dans le diagramme suivant.</span><span class="sxs-lookup"><span data-stu-id="ad409-160">This is represented in the following diagram.</span></span>

![Vue simplifiée de l’isolement de domaines d’erreur](./images/technical-guidance-recovery-local-failures/partitioning-1.png)

### <a name="load-balancing"></a><span data-ttu-id="ad409-162">Équilibrage de la charge</span><span class="sxs-lookup"><span data-stu-id="ad409-162">Load balancing</span></span>
<span data-ttu-id="ad409-163">Tout le trafic entrant d’un rôle web passe par un équilibreur de charge sans état, qui distribue les demandes des clients entre les instances de rôle.</span><span class="sxs-lookup"><span data-stu-id="ad409-163">All inbound traffic to a web role passes through a stateless load balancer, which distributes client requests among the role instances.</span></span> <span data-ttu-id="ad409-164">Des instances de rôle isolées n’ont pas d’adresses IP publiques et ne sont pas directement adressables à partir d’Internet.</span><span class="sxs-lookup"><span data-stu-id="ad409-164">Individual role instances do not have public IP addresses, and they are not directly addressable from the Internet.</span></span> <span data-ttu-id="ad409-165">Les rôles Web sont sans état, ce qui permet de diriger les requêtes des clients vers toute instance de rôle.</span><span class="sxs-lookup"><span data-stu-id="ad409-165">Web roles are stateless so that any client request can be routed to any role instance.</span></span> <span data-ttu-id="ad409-166">Un événement [StatusCheck](https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleenvironment.statuscheck.aspx) est déclenché toutes les 15 secondes.</span><span class="sxs-lookup"><span data-stu-id="ad409-166">A [StatusCheck](https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleenvironment.statuscheck.aspx) event is raised every 15 seconds.</span></span> <span data-ttu-id="ad409-167">Vous pouvez utiliser cet événement pour indiquer si le rôle est prêt à recevoir le trafic, ou s’il est occupé et doit être retiré de la rotation d’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="ad409-167">You can use this to indicate whether the role is ready to receive traffic, or whether it's busy and should be taken out of the load-balancer rotation.</span></span>

## <a name="virtual-machines"></a><span data-ttu-id="ad409-168">Virtual Machines</span><span class="sxs-lookup"><span data-stu-id="ad409-168">Virtual Machines</span></span>
<span data-ttu-id="ad409-169">Azure Virtual Machines diffère des rôles de calcul Platform as a Service (PaaS) par plusieurs aspects relatifs à la haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="ad409-169">Azure Virtual Machines differs from platform as a service (PaaS) compute roles in several respects in relation to high availability.</span></span> <span data-ttu-id="ad409-170">Dans certains cas, vous devez effectuer des opérations supplémentaires pour garantir une haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="ad409-170">In some instances, you must do additional work to ensure high availability.</span></span>

### <a name="disk-durability"></a><span data-ttu-id="ad409-171">Durabilité des disques</span><span class="sxs-lookup"><span data-stu-id="ad409-171">Disk durability</span></span>
<span data-ttu-id="ad409-172">Contrairement aux instances de rôle PaaS, les données stockées sur les disques de machines virtuelles demeurent persistantes, même en cas de déplacement des machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="ad409-172">Unlike PaaS role instances, data stored on virtual machine drives is persistent even when the virtual machine is relocated.</span></span> <span data-ttu-id="ad409-173">Les machines virtuelles Azure utilisent les disques de machines virtuelles existant en tant qu’objets blob dans Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ad409-173">Azure virtual machines use VM disks that exist as blobs in Azure Storage.</span></span> <span data-ttu-id="ad409-174">En raison des caractéristiques de disponibilité d’Azure Storage, les données stockées sur des lecteurs d’une machine virtuelle sont également hautement disponibles.</span><span class="sxs-lookup"><span data-stu-id="ad409-174">Because of the availability characteristics of Azure Storage, the data stored on a virtual machine’s drives is also highly available.</span></span>

<span data-ttu-id="ad409-175">Notez que le lecteur D (sur les machines virtuelles Windows) fait exception à cette règle.</span><span class="sxs-lookup"><span data-stu-id="ad409-175">Note that drive D (in Windows VMs) is the exception to this rule.</span></span> <span data-ttu-id="ad409-176">Le lecteur D correspond au stockage physique sur le serveur monté en rack qui héberge la machine virtuelle ; ses données seront perdues en cas de recyclage de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="ad409-176">Drive D is actually physical storage on the rack server that hosts the VM, and its data will be lost if the VM is recycled.</span></span> <span data-ttu-id="ad409-177">Le lecteur D est dédié au stockage temporaire uniquement.</span><span class="sxs-lookup"><span data-stu-id="ad409-177">Drive D is intended for temporary storage only.</span></span> <span data-ttu-id="ad409-178">Sous Linux, Azure expose « généralement » (mais pas systématiquement) le disque temporaire local en tant qu’appareil en mode bloc /dev/sdb.</span><span class="sxs-lookup"><span data-stu-id="ad409-178">In Linux, Azure “usually” (but not always) exposes the local temporary disk as /dev/sdb block device.</span></span> <span data-ttu-id="ad409-179">Il est souvent monté par l’Agent Linux Azure sous forme de point de montage /mnt/resource ou /mnt (configurable via/etc/waagent.conf).</span><span class="sxs-lookup"><span data-stu-id="ad409-179">It is often mounted by the Azure Linux Agent as /mnt/resource or /mnt mount points (configurable via /etc/waagent.conf).</span></span>

### <a name="partitioning"></a><span data-ttu-id="ad409-180">Partitionnement</span><span class="sxs-lookup"><span data-stu-id="ad409-180">Partitioning</span></span>
<span data-ttu-id="ad409-181">Azure comprend de manière native les niveaux d’une application PaaS (rôle Web et rôle de travail), et peut par conséquent les distribuer efficacement entre les domaines d’erreur et de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="ad409-181">Azure natively understands the tiers in a PaaS application (web role and worker role) and thus can properly distribute them across fault and update domains.</span></span> <span data-ttu-id="ad409-182">En revanche, les niveaux dans une application Infrastructure as a Service (IaaS) doivent être définis manuellement via les groupes à haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="ad409-182">In contrast, the tiers in an infrastructure as a service (IaaS) application must be manually defined through availability sets.</span></span> <span data-ttu-id="ad409-183">Des groupes à haute disponibilité sont requis pour les contrats de niveau de service établis sous IaaS.</span><span class="sxs-lookup"><span data-stu-id="ad409-183">Availability sets are required for an SLA under IaaS.</span></span>

![Groupes à haute disponibilité pour les machines virtuelles Azure](./images/technical-guidance-recovery-local-failures/partitioning-2.png)

<span data-ttu-id="ad409-185">Dans le diagramme précédent, le niveau Internet Information Services (IIS, qui fonctionne comme un niveau d’application Web) et le niveau SQL (qui fonctionne comme un niveau de données) sont affectés à différents groupes à haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="ad409-185">In the preceding diagram, the Internet Information Services (IIS) tier (which works as a web app tier) and the SQL tier (which works as a data tier) are assigned to different availability sets.</span></span> <span data-ttu-id="ad409-186">Cela garantit que toutes les instances de chaque niveau disposent d’une redondance matérielle, en distribuant les machines virtuelles dans les domaines d’erreur, et que les niveaux dans leur intégralité ne sont pas arrêtés pendant une mise à jour.</span><span class="sxs-lookup"><span data-stu-id="ad409-186">This ensures that all instances of each tier have hardware redundancy by distributing virtual machines across fault domains, and that entire tiers are not taken down during an update.</span></span>

### <a name="load-balancing"></a><span data-ttu-id="ad409-187">Équilibrage de la charge</span><span class="sxs-lookup"><span data-stu-id="ad409-187">Load balancing</span></span>
<span data-ttu-id="ad409-188">Si le trafic est distribué entre les machines virtuelles, vous devez les regrouper dans une application et équilibrer la charge sur un point de terminaison TCP ou UDP spécifique.</span><span class="sxs-lookup"><span data-stu-id="ad409-188">If the VMs should have traffic distributed across them, you must group the VMs in an application and load balance across a specific TCP or UDP endpoint.</span></span> <span data-ttu-id="ad409-189">Pour plus d’informations, consultez [Équilibrage de charge des machines virtuelles](/azure/virtual-machines/virtual-machines-linux-load-balance/?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="ad409-189">For more information, see [Load balancing virtual machines](/azure/virtual-machines/virtual-machines-linux-load-balance/?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span> <span data-ttu-id="ad409-190">Si les machines virtuelles sont approvisionnées par une autre source (par exemple, un mécanisme de file d’attente), aucun équilibreur de charge n’est requis.</span><span class="sxs-lookup"><span data-stu-id="ad409-190">If the VMs receive input from another source (for example, a queuing mechanism), a load balancer is not required.</span></span> <span data-ttu-id="ad409-191">L’équilibreur de charge utilise un contrôle d’intégrité de base pour déterminer si le trafic doit être envoyé au nœud.</span><span class="sxs-lookup"><span data-stu-id="ad409-191">The load balancer uses a basic health check to determine whether traffic should be sent to the node.</span></span> <span data-ttu-id="ad409-192">Il est également possible de créer vos propres sondes pour implémenter des mesures spécifiques de contrôle d’intégrité de l’application. Le cas échéant, elles déterminent si la machine virtuelle doit recevoir le trafic.</span><span class="sxs-lookup"><span data-stu-id="ad409-192">It's also possible to create your own probes to implement application-specific health metrics that determine whether the VM should receive traffic.</span></span>

## <a name="storage"></a><span data-ttu-id="ad409-193">Stockage</span><span class="sxs-lookup"><span data-stu-id="ad409-193">Storage</span></span>
<span data-ttu-id="ad409-194">Azure Storage est le service de données durables de ligne de base pour Azure.</span><span class="sxs-lookup"><span data-stu-id="ad409-194">Azure Storage is the baseline durable data service for Azure.</span></span> <span data-ttu-id="ad409-195">Il fournit des objets blob, des tables, des files d’attente et du stockage sur disque de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="ad409-195">It provides blob, table, queue, and VM disk storage.</span></span> <span data-ttu-id="ad409-196">Il utilise une combinaison de réplication et de gestion des ressources pour assurer la haute disponibilité dans un centre de données unique.</span><span class="sxs-lookup"><span data-stu-id="ad409-196">It uses a combination of replication and resource management to provide high availability within a single datacenter.</span></span> <span data-ttu-id="ad409-197">Le contrat de niveau de service relatif à la disponibilité d’Azure Storage garantit qu’au moins 99,9 % du temps :</span><span class="sxs-lookup"><span data-stu-id="ad409-197">The Azure Storage availability SLA guarantees that at least 99.9 percent of the time:</span></span>

* <span data-ttu-id="ad409-198">Des demandes correctement mises en forme pour ajouter, mettre à jour, lire et supprimer des données, sont traitées comme nécessaire.</span><span class="sxs-lookup"><span data-stu-id="ad409-198">Correctly formatted requests to add, update, read, and delete data will be successfully and correctly processed.</span></span>
* <span data-ttu-id="ad409-199">Les comptes de stockage pourront se connecter à la passerelle Internet.</span><span class="sxs-lookup"><span data-stu-id="ad409-199">Storage accounts will have connectivity to the Internet gateway.</span></span>

### <a name="replication"></a><span data-ttu-id="ad409-200">Réplication</span><span class="sxs-lookup"><span data-stu-id="ad409-200">Replication</span></span>
<span data-ttu-id="ad409-201">Azure Storage simplifie la durabilité des données en conservant plusieurs copies de toutes les données sur des lecteurs différents situés dans des sous-systèmes de stockage physique entièrement indépendants au sein de la région.</span><span class="sxs-lookup"><span data-stu-id="ad409-201">Azure Storage facilitates data durability by maintaining multiple copies of all data on different drives across fully independent physical storage subsystems within the region.</span></span> <span data-ttu-id="ad409-202">Les données sont répliquées de façon synchrone et toutes les copies sont validées avant la reconnaissance de l’écriture.</span><span class="sxs-lookup"><span data-stu-id="ad409-202">Data is replicated synchronously, and all copies are committed before the write is acknowledged.</span></span> <span data-ttu-id="ad409-203">Azure Storage est fortement cohérent, ce qui signifie que les lectures correspondent forcément aux écritures les plus récentes.</span><span class="sxs-lookup"><span data-stu-id="ad409-203">Azure Storage is strongly consistent, meaning that reads are guaranteed to reflect the most recent writes.</span></span> <span data-ttu-id="ad409-204">En outre, les copies de données sont analysées en continu pour détecter et corriger une altération binaire, une menace souvent négligée en matière d’intégrité des données stockées.</span><span class="sxs-lookup"><span data-stu-id="ad409-204">In addition, copies of data are continually scanned to detect and repair bit rot, an often overlooked threat to the integrity of stored data.</span></span>

<span data-ttu-id="ad409-205">Les services bénéficient de la réplication, simplement par l’utilisation d’Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ad409-205">Services benefit from replication just by using Azure Storage.</span></span> <span data-ttu-id="ad409-206">Aucune tâche supplémentaire n’est requise par le développeur de service pour la récupération suite à une défaillance locale.</span><span class="sxs-lookup"><span data-stu-id="ad409-206">The service developer doesn't need to do additional work to recover from a local failure.</span></span>

### <a name="resource-management"></a><span data-ttu-id="ad409-207">Gestion des ressources</span><span class="sxs-lookup"><span data-stu-id="ad409-207">Resource management</span></span>
<span data-ttu-id="ad409-208">La taille des comptes de stockage créés après le mai 2014 peut être augmentée jusqu’à 500 To (contre 200 To auparavant).</span><span class="sxs-lookup"><span data-stu-id="ad409-208">Storage accounts created after May 2014, can grow to up to 500 TB (the previous maximum was 200 TB).</span></span> <span data-ttu-id="ad409-209">Si de l’espace supplémentaire est nécessaire, les applications doivent être conçues pour utiliser plusieurs comptes de stockage.</span><span class="sxs-lookup"><span data-stu-id="ad409-209">If additional space is required, applications must be designed to use multiple storage accounts.</span></span>

### <a name="virtual-machine-disks"></a><span data-ttu-id="ad409-210">Disques de machines virtuelles</span><span class="sxs-lookup"><span data-stu-id="ad409-210">Virtual machine disks</span></span>
<span data-ttu-id="ad409-211">Un disque de machine virtuelle est stocké comme un objet blob de pages dans Azure Storage. Par conséquent, il présente les mêmes propriétés de durabilité et d’extensibilité que le stockage d’objets blob.</span><span class="sxs-lookup"><span data-stu-id="ad409-211">A virtual machine’s disk is stored as a page blob in Azure Storage, giving it all the same durability and scalability properties as Blob storage.</span></span> <span data-ttu-id="ad409-212">Cette conception rend les données d’un disque de machine virtuelle persistantes, même si le serveur exécutant la machine virtuelle tombe en panne et que la machine virtuelle doit être redémarrée sur un autre serveur.</span><span class="sxs-lookup"><span data-stu-id="ad409-212">This design makes the data on a virtual machine’s disk persistent, even if the server running the VM fails and the VM must be restarted on another server.</span></span>

## <a name="database"></a><span data-ttu-id="ad409-213">Base de données</span><span class="sxs-lookup"><span data-stu-id="ad409-213">Database</span></span>
### <a name="sql-database"></a><span data-ttu-id="ad409-214">Base de données SQL</span><span class="sxs-lookup"><span data-stu-id="ad409-214">SQL Database</span></span>
<span data-ttu-id="ad409-215">La Base de données SQL Azure fournit une base de données en tant que service.</span><span class="sxs-lookup"><span data-stu-id="ad409-215">Azure SQL Database provides database as a service.</span></span> <span data-ttu-id="ad409-216">Elle permet aux applications d’effectuer rapidement des opérations d’approvisionnement, d’insérer des données et d’interroger des bases de données relationnelles.</span><span class="sxs-lookup"><span data-stu-id="ad409-216">It allows applications to quickly provision, insert data into, and query relational databases.</span></span> <span data-ttu-id="ad409-217">Elle offre de nombreuses fonctionnalités communes de SQL Server, tout en vous épargnant la complexité associée au matériel, à la configuration, à la mise à jour corrective et à la résilience.</span><span class="sxs-lookup"><span data-stu-id="ad409-217">It provides many of the familiar SQL Server features and functionality, while abstracting the burden of hardware, configuration, patching, and resiliency.</span></span>

> [!NOTE]
> <span data-ttu-id="ad409-218">Azure SQL Database ne fournit pas un ensemble de fonctionnalités identique à celui de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ad409-218">Azure SQL Database does not provide one-to-one feature parity with SQL Server.</span></span> <span data-ttu-id="ad409-219">Il est conçu pour répondre à une série d’exigences spécifiques aux applications cloud (mise à l’échelle élastique, base de données en tant que service pour réduire les coûts de maintenance et ainsi de suite).</span><span class="sxs-lookup"><span data-stu-id="ad409-219">It's intended to fulfill a different set of requirements--one that's uniquely suited to cloud applications (elastic scale, database as a service to reduce maintenance costs, and so on).</span></span> <span data-ttu-id="ad409-220">Pour plus d’informations, consultez [Choisir une option SQL Server cloud : Base de données SQL Azure (PaaS) ou SQL Server sur des machines virtuelles Azure (IaaS)](/azure/sql-database/sql-database-paas-vs-sql-server-iaas/).</span><span class="sxs-lookup"><span data-stu-id="ad409-220">For more information, see [Choose a cloud SQL Server option: Azure SQL (PaaS) Database or SQL Server on Azure VMs (IaaS)](/azure/sql-database/sql-database-paas-vs-sql-server-iaas/).</span></span>
> 
> 

#### <a name="replication"></a><span data-ttu-id="ad409-221">Réplication</span><span class="sxs-lookup"><span data-stu-id="ad409-221">Replication</span></span>
<span data-ttu-id="ad409-222">Azure SQL Database fournit la résilience intégrée dédiée aux défaillances au niveau du nœud.</span><span class="sxs-lookup"><span data-stu-id="ad409-222">Azure SQL Database provides built-in resiliency to node-level failure.</span></span> <span data-ttu-id="ad409-223">Toutes les écritures dans une base de données sont automatiquement répliquées sur au minimum deux nœuds d’arrière-plan via une technique de validation de quorum.</span><span class="sxs-lookup"><span data-stu-id="ad409-223">All writes into a database are automatically replicated to two or more background nodes through a quorum commit technique.</span></span> <span data-ttu-id="ad409-224">(Le nœud principal et au moins un des nœuds secondaires doivent confirmer que l’activité est écrite dans le journal des transactions avant que la transaction soit considérée comme réussie et qu’elle soit renvoyée.) En cas de défaillance du nœud, la base de données bascule automatiquement vers l’un des réplicas secondaires.</span><span class="sxs-lookup"><span data-stu-id="ad409-224">(The primary and at least one secondary must confirm that the activity is written to the transaction log before the transaction is deemed successful and returns.) In the case of node failure, the database automatically fails over to one of the secondary replicas.</span></span> <span data-ttu-id="ad409-225">Cela entraîne une interruption de connexion temporaire pour les applications clientes.</span><span class="sxs-lookup"><span data-stu-id="ad409-225">This causes a transient connection interruption for client applications.</span></span> <span data-ttu-id="ad409-226">Pour cette raison, tous les clients Azure SQL Database doivent implémenter une certaine forme de gestion des connexions temporaires.</span><span class="sxs-lookup"><span data-stu-id="ad409-226">For this reason, all Azure SQL Database clients must implement some form of transient connection handling.</span></span> <span data-ttu-id="ad409-227">Pour plus d’informations, consultez [Guide spécifique relatif au service de nouvelle tentative](/azure/best-practices-retry-service-specific/).</span><span class="sxs-lookup"><span data-stu-id="ad409-227">For more information, see [Retry service specific guidance](/azure/best-practices-retry-service-specific/).</span></span>

#### <a name="resource-management"></a><span data-ttu-id="ad409-228">Gestion des ressources</span><span class="sxs-lookup"><span data-stu-id="ad409-228">Resource management</span></span>
<span data-ttu-id="ad409-229">Lors de la création, chaque base de données est configurée avec une limite de taille supérieure.</span><span class="sxs-lookup"><span data-stu-id="ad409-229">Each database, when created, is configured with an upper size limit.</span></span> <span data-ttu-id="ad409-230">La taille maximale actuellement disponible est de 1 To (les limites de taille varient en fonction de votre niveau de service, consultez la section relative aux [niveaux de service et de performances des bases de données Azure SQL](/azure/sql-database/sql-database-resource-limits/#service-tiers-and-performance-levels).</span><span class="sxs-lookup"><span data-stu-id="ad409-230">The currently available maximum size is 1 TB (size limits vary based on your service tier, see [service tiers and performance levels of Azure SQL Databases](/azure/sql-database/sql-database-resource-limits/#service-tiers-and-performance-levels).</span></span> <span data-ttu-id="ad409-231">Lorsqu’une base de données atteint sa limite de taille maximale, elle refuse les commandes INSERT ou UPDATE supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="ad409-231">When a database hits its upper size limit, it rejects additional INSERT or UPDATE commands.</span></span> <span data-ttu-id="ad409-232">(L’interrogation et la suppression des données sont toujours possibles.)</span><span class="sxs-lookup"><span data-stu-id="ad409-232">(Querying and deleting data is still possible.)</span></span>

<span data-ttu-id="ad409-233">Dans une base de données, Azure SQL Database utilise une structure pour gérer les ressources.</span><span class="sxs-lookup"><span data-stu-id="ad409-233">Within a database, Azure SQL Database uses a fabric to manage resources.</span></span> <span data-ttu-id="ad409-234">Toutefois, au lieu d’un contrôleur de structure, elle utilise une topologie en anneau pour détecter les erreurs.</span><span class="sxs-lookup"><span data-stu-id="ad409-234">However, instead of a fabric controller, it uses a ring topology to detect failures.</span></span> <span data-ttu-id="ad409-235">Dans un cluster, chaque réplica a deux voisins et il est chargé de détecter leur mise hors service.</span><span class="sxs-lookup"><span data-stu-id="ad409-235">Every replica in a cluster has two neighbors and is responsible for detecting when they go down.</span></span> <span data-ttu-id="ad409-236">Lorsqu’un réplica est mis hors service, ses voisins déclenchent un Reconfiguration Agent pour le recréer sur une autre machine.</span><span class="sxs-lookup"><span data-stu-id="ad409-236">When a replica goes down, its neighbors trigger a reconfiguration agent to re-create it on another machine.</span></span> <span data-ttu-id="ad409-237">La limitation du moteur fournie vous assure qu’un serveur logique n’utilise pas trop de ressources sur une machine ou ne dépasse les limites physiques de la machine.</span><span class="sxs-lookup"><span data-stu-id="ad409-237">Engine throttling is provided to ensure that a logical server doesn't use too many resources on a machine or exceed the machine’s physical limits.</span></span>

### <a name="elasticity"></a><span data-ttu-id="ad409-238">Élasticité</span><span class="sxs-lookup"><span data-stu-id="ad409-238">Elasticity</span></span>
<span data-ttu-id="ad409-239">Si l’application nécessite davantage que la limite de base de données de 1 To, elle doit implémenter une approche d’augmentation de la taille des instances.</span><span class="sxs-lookup"><span data-stu-id="ad409-239">If the application requires more than the 1 TB database limit, it must implement a scale-out approach.</span></span> <span data-ttu-id="ad409-240">Vous augmentez la taille des instances avec Azure SQL Database via un partitionnement manuel des données entre plusieurs bases de données SQL.</span><span class="sxs-lookup"><span data-stu-id="ad409-240">You scale out with Azure SQL Database by manually partitioning, also known as sharding, data across multiple SQL databases.</span></span> <span data-ttu-id="ad409-241">Cette approche d’augmentation de la taille des instances permet d’obtenir une augmentation quasi linéaire du prix par rapport à la mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="ad409-241">This scale-out approach provides the opportunity to achieve nearly linear cost growth with scale.</span></span> <span data-ttu-id="ad409-242">La croissance élastique ou la capacité à la demande peuvent augmenter avec une tarification incrémentielle en fonction des besoins, car les bases de données sont facturées en fonction de la taille moyenne réelle utilisée chaque jour, pas en fonction de la taille maximale possible.</span><span class="sxs-lookup"><span data-stu-id="ad409-242">Elastic growth or capacity on demand can grow with incremental costs as needed because databases are billed based on the average actual size used per day, not based on maximum possible size.</span></span>

## <a name="sql-server-on-virtual-machines"></a><span data-ttu-id="ad409-243">SQL Server sur Virtual Machines</span><span class="sxs-lookup"><span data-stu-id="ad409-243">SQL Server on Virtual Machines</span></span>
<span data-ttu-id="ad409-244">En installant SQL Server (version 2014 ou ultérieure) sur Azure Virtual Machines, vous pouvez tirer profit des fonctionnalités traditionnelles de disponibilité de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ad409-244">By installing SQL Server (version 2014 or later) on Azure Virtual Machines, you can take advantage of the traditional availability features of SQL Server.</span></span> <span data-ttu-id="ad409-245">Ces fonctionnalités incluent les groupes de disponibilité AlwaysOn et la mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="ad409-245">These features include AlwaysOn Availability Groups and database mirroring.</span></span> <span data-ttu-id="ad409-246">Veuillez noter que les machines virtuelles Azure, le stockage et le réseau ont des caractéristiques opérationnelles différentes de celles d’une infrastructure informatique non virtualisée locale.</span><span class="sxs-lookup"><span data-stu-id="ad409-246">Note that Azure VMs, storage, and networking have different operational characteristics than an on-premises, non-virtualized IT infrastructure.</span></span> <span data-ttu-id="ad409-247">Pour une implémentation réussie d’une solution de haute disponibilité/de récupération d’urgence SQL Server dans Azure, vous devez comprendre ces différences et concevoir votre solution de façon à les gérer.</span><span class="sxs-lookup"><span data-stu-id="ad409-247">A successful implementation of a high availability/disaster recovery (HA/DR) SQL Server solution in Azure requires that you understand these differences and design your solution to accommodate them.</span></span>

### <a name="high-availability-nodes-in-an-availability-set"></a><span data-ttu-id="ad409-248">Nœuds haute disponibilité d’un groupe à haute disponibilité</span><span class="sxs-lookup"><span data-stu-id="ad409-248">High-availability nodes in an availability set</span></span>
<span data-ttu-id="ad409-249">Lorsque vous implémentez une solution de haute disponibilité dans Azure, vous pouvez utiliser le groupe à haute disponibilité dans Azure pour placer les nœuds haute disponibilité dans des domaines d’erreur et des domaines de mise à niveau distincts.</span><span class="sxs-lookup"><span data-stu-id="ad409-249">When you implement a high-availability solution in Azure, you can use the availability set in Azure to place the high-availability nodes into separate fault domains and upgrade domains.</span></span> <span data-ttu-id="ad409-250">Pour être clair, le groupe à haute disponibilité est un concept Azure.</span><span class="sxs-lookup"><span data-stu-id="ad409-250">To be clear, the availability set is an Azure concept.</span></span> <span data-ttu-id="ad409-251">Nous vous recommandons de suivre cette meilleure pratique pour vous assurer de la haute disponibilité de vos bases de données, que vous utilisiez des groupes de disponibilité AlwaysOn, la mise en miroir de bases de données ou une autre solution.</span><span class="sxs-lookup"><span data-stu-id="ad409-251">It's a best practice that you should follow to make sure that your databases are indeed highly available, whether you're using AlwaysOn Availability Groups, database mirroring, or something else.</span></span> <span data-ttu-id="ad409-252">Si vous ne suivez pas cette meilleure pratique, vous pourriez croire, à tort, que votre système est hautement disponible.</span><span class="sxs-lookup"><span data-stu-id="ad409-252">If you don't follow this best practice, you might be under the false assumption that your system is highly available.</span></span> <span data-ttu-id="ad409-253">Mais en réalité, vos nœuds peuvent tous tomber en panne simultanément, car ils se trouvent dans le même domaine d’erreur de la région Azure.</span><span class="sxs-lookup"><span data-stu-id="ad409-253">But in reality, your nodes can all fail simultaneously because they happen to be placed in the same fault domain in the Azure region.</span></span>

<span data-ttu-id="ad409-254">Cette recommandation n’est pas applicable avec la copie des journaux de transaction.</span><span class="sxs-lookup"><span data-stu-id="ad409-254">This recommendation is not as applicable with log shipping.</span></span> <span data-ttu-id="ad409-255">Puisque la copie des journaux de transaction est une fonctionnalité de récupération d’urgence, vous devez vous assurer que les serveurs s’exécutent dans des régions Azure distinctes.</span><span class="sxs-lookup"><span data-stu-id="ad409-255">As a disaster recovery feature, you should ensure that the servers are running in separate Azure regions.</span></span> <span data-ttu-id="ad409-256">Par définition, ces régions sont des domaines d’erreur distincts.</span><span class="sxs-lookup"><span data-stu-id="ad409-256">By definition, these regions are separate fault domains.</span></span>

<span data-ttu-id="ad409-257">Pour que les machines virtuelles Azure Cloud Services déployées via le portail classique se trouvent dans le même groupe à haute disponibilité, vous devez les déployer dans le même service cloud.</span><span class="sxs-lookup"><span data-stu-id="ad409-257">For Azure Cloud Services VMs deployed through the classic portal to be in the same availability set, you must deploy them in the same Cloud Service.</span></span> <span data-ttu-id="ad409-258">Les machines virtuelles déployées via Azure Resource Manager (portail actuel) ne présentent pas cette limite.</span><span class="sxs-lookup"><span data-stu-id="ad409-258">VMs deployed through Azure Resource Manager (the current portal) do not have this limitation.</span></span> <span data-ttu-id="ad409-259">Pour les machines virtuelles déployées sur le portail classique dans Azure Cloud Service, seuls les nœuds du même service cloud peuvent participer au même groupe à haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="ad409-259">For classic portal deployed VMs in Azure Cloud Service, only nodes in the same Cloud Service can participate in the same availability set.</span></span> <span data-ttu-id="ad409-260">En outre, les machines virtuelles Cloud Services doivent se trouver dans le même réseau virtuel pour s’assurer qu’elles conservent leur adresse IP même après la réparation du service.</span><span class="sxs-lookup"><span data-stu-id="ad409-260">In addition, the Cloud Services VMs should be in the same virtual network to ensure that they maintain their IPs even after service healing.</span></span> <span data-ttu-id="ad409-261">Cela vous permet d’éviter les temps d’interruption de mise à jour DNS.</span><span class="sxs-lookup"><span data-stu-id="ad409-261">This avoids DNS update disruptions.</span></span>

### <a name="azure-only-high-availability-solutions"></a><span data-ttu-id="ad409-262">Azure uniquement : solutions de haute disponibilité</span><span class="sxs-lookup"><span data-stu-id="ad409-262">Azure-only: High-availability solutions</span></span>
<span data-ttu-id="ad409-263">Vous pouvez disposer d’une solution de haute disponibilité pour vos bases de données SQL Server dans Azure à l’aide des groupes de disponibilité AlwaysOn ou de la mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="ad409-263">You can have a high-availability solution for your SQL Server databases in Azure by using AlwaysOn Availability Groups or database mirroring.</span></span>

<span data-ttu-id="ad409-264">Le diagramme suivant illustre l’architecture des groupes de disponibilité AlwaysOn exécutés dans Azure Virtual Machines.</span><span class="sxs-lookup"><span data-stu-id="ad409-264">The following diagram demonstrates the architecture of AlwaysOn Availability Groups running on Azure Virtual Machines.</span></span> <span data-ttu-id="ad409-265">Ce diagramme a été extrait de l’article détaillé sur ce sujet, [Haute disponibilité et récupération d’urgence pour SQL Server dans Azure Virtual Machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span><span class="sxs-lookup"><span data-stu-id="ad409-265">This diagram was taken from the in-depth article on this subject, [High availability and disaster recovery for SQL Server on Azure Virtual Machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span></span>

![Groupes de disponibilité AlwaysOn dans Microsoft Azure](./images/technical-guidance-recovery-local-failures/high_availability_solutions-1.png)

<span data-ttu-id="ad409-267">Vous pouvez également approvisionner automatiquement un déploiement de groupe de disponibilité AlwaysOn de bout en bout sur les machines virtuelles Azure, en utilisant le modèle AlwaysOn dans le portail Azure.</span><span class="sxs-lookup"><span data-stu-id="ad409-267">You can also automatically provision an AlwaysOn Availability Groups deployment end-to-end on Azure VMs by using the AlwaysOn template in the Azure portal.</span></span> <span data-ttu-id="ad409-268">Pour plus d’informations, consultez [Offre AlwaysOn SQL Server dans la galerie du portail Microsoft Azure](https://blogs.technet.microsoft.com/dataplatforminsider/2014/08/25/sql-server-alwayson-offering-in-microsoft-azure-portal-gallery/).</span><span class="sxs-lookup"><span data-stu-id="ad409-268">For more information, see [SQL Server AlwaysOn Offering in Microsoft Azure Portal Gallery](https://blogs.technet.microsoft.com/dataplatforminsider/2014/08/25/sql-server-alwayson-offering-in-microsoft-azure-portal-gallery/).</span></span>

<span data-ttu-id="ad409-269">Le diagramme suivant illustre l’utilisation de la mise en miroir de bases de données sur Azure Virtual Machines.</span><span class="sxs-lookup"><span data-stu-id="ad409-269">The following diagram demonstrates the use of database mirroring on Azure Virtual Machines.</span></span> <span data-ttu-id="ad409-270">Il a également été extrait de la rubrique détaillée [Haute disponibilité et récupération d’urgence pour SQL Server sur des machines virtuelles Azure](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span><span class="sxs-lookup"><span data-stu-id="ad409-270">It was also taken from the in-depth topic [High availability and disaster recovery for SQL Server on Azure Virtual Machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span></span>

![Mise en miroir de bases de données dans Microsoft Azure](./images/technical-guidance-recovery-local-failures/high_availability_solutions-2.png)

> [!NOTE]
> <span data-ttu-id="ad409-272">Dans les deux architectures, un contrôleur de domaine est requis.</span><span class="sxs-lookup"><span data-stu-id="ad409-272">Both architectures require a domain controller.</span></span> <span data-ttu-id="ad409-273">Toutefois, avec la mise en miroir de bases de données, il est possible d’utiliser des certificats de serveur pour éliminer le recours à un contrôleur de domaine.</span><span class="sxs-lookup"><span data-stu-id="ad409-273">However, with database mirroring, it's possible to use server certificates to eliminate the need for a domain controller.</span></span>
> 
> 

## <a name="other-azure-platform-services"></a><span data-ttu-id="ad409-274">Autres services de plateforme Azure</span><span class="sxs-lookup"><span data-stu-id="ad409-274">Other Azure platform services</span></span>
<span data-ttu-id="ad409-275">Les applications qui reposent sur Azure bénéficient des fonctionnalités de plateforme pour la récupération suite à des défaillances locales.</span><span class="sxs-lookup"><span data-stu-id="ad409-275">Applications that are built on Azure benefit from platform capabilities to recover from local failures.</span></span> <span data-ttu-id="ad409-276">Dans certains cas, vous pouvez entreprendre des actions spécifiques pour augmenter la disponibilité de votre scénario particulier.</span><span class="sxs-lookup"><span data-stu-id="ad409-276">In some cases, you can take specific actions to increase availability for your specific scenario.</span></span>

### <a name="service-bus"></a><span data-ttu-id="ad409-277">Service Bus</span><span class="sxs-lookup"><span data-stu-id="ad409-277">Service Bus</span></span>
<span data-ttu-id="ad409-278">Pour éviter une panne temporaire d’Azure Service Bus, envisagez de créer une file d’attente durable côté client.</span><span class="sxs-lookup"><span data-stu-id="ad409-278">To mitigate against a temporary outage of Azure Service Bus, consider creating a durable client-side queue.</span></span> <span data-ttu-id="ad409-279">Cette fonctionnalité utilise temporairement un autre mécanisme stockage local pour stocker les messages qui ne peuvent pas être ajoutés à la file d’attente Service Bus.</span><span class="sxs-lookup"><span data-stu-id="ad409-279">This temporarily uses an alternate, local storage mechanism to store messages that cannot be added to the Service Bus queue.</span></span> <span data-ttu-id="ad409-280">L’application peut décider comment traiter les messages temporairement stockés après la restauration du service.</span><span class="sxs-lookup"><span data-stu-id="ad409-280">The application can decide how to handle the temporarily stored messages after the service is restored.</span></span> <span data-ttu-id="ad409-281">Pour plus d’informations, consultez [Bonnes pratiques relatives aux améliorations des performances dans l’utilisation de la messagerie répartie Service Bus](/azure/service-bus-messaging/service-bus-performance-improvements/) et [Service Bus (récupération d’urgence)](recovery-loss-azure-region.md#other-azure-platform-services).</span><span class="sxs-lookup"><span data-stu-id="ad409-281">For more information, see [Best practices for performance improvements using Service Bus brokered messaging](/azure/service-bus-messaging/service-bus-performance-improvements/) and [Service Bus (disaster recovery)](recovery-loss-azure-region.md#other-azure-platform-services).</span></span>

### <a name="hdinsight"></a><span data-ttu-id="ad409-282">HDInsight</span><span class="sxs-lookup"><span data-stu-id="ad409-282">HDInsight</span></span>
<span data-ttu-id="ad409-283">Par défaut, les données associées à Azure HDInsight sont stockées dans Stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="ad409-283">The data that's associated with Azure HDInsight is stored by default in Azure Blob storage.</span></span> <span data-ttu-id="ad409-284">Azure Storage spécifie les propriétés de haute disponibilité et de durabilité pour le stockage d’objets blob.</span><span class="sxs-lookup"><span data-stu-id="ad409-284">Azure Storage specifies high-availability and durability properties for Blob storage.</span></span> <span data-ttu-id="ad409-285">Le traitement à plusieurs nœuds associé à des travaux Hadoop MapReduce est effectué sur un système de fichiers HDFS (Hadoop Distributed File System) temporaire, qui est approvisionné quand HDInsight le requiert.</span><span class="sxs-lookup"><span data-stu-id="ad409-285">The multiple-node processing that's associated with Hadoop MapReduce jobs occurs on a transient Hadoop Distributed File System (HDFS) that is provisioned when HDInsight needs it.</span></span> <span data-ttu-id="ad409-286">Les résultats d’un travail MapReduce sont également stockés par défaut dans le stockage d’objets blob Azure, afin que les données traitées soient durables et demeurent hautement disponibles une fois le cluster Hadoop déprovisionné.</span><span class="sxs-lookup"><span data-stu-id="ad409-286">Results from a MapReduce job are also stored by default in Azure Blob storage, so that the processed data is durable and remains highly available after the Hadoop cluster is deprovisioned.</span></span> <span data-ttu-id="ad409-287">Pour plus d’informations, consultez la section [HDInsight (récupération d’urgence)](recovery-loss-azure-region.md#other-azure-platform-services).</span><span class="sxs-lookup"><span data-stu-id="ad409-287">For more information, see [HDInsight (disaster recovery)](recovery-loss-azure-region.md#other-azure-platform-services).</span></span>

## <a name="checklists-for-local-failures"></a><span data-ttu-id="ad409-288">Listes de contrôle pour les défaillances locales</span><span class="sxs-lookup"><span data-stu-id="ad409-288">Checklists for local failures</span></span>
### <a name="cloud-services"></a><span data-ttu-id="ad409-289">Cloud Services</span><span class="sxs-lookup"><span data-stu-id="ad409-289">Cloud Services</span></span>
1. <span data-ttu-id="ad409-290">Consultez la section Services cloud de ce document.</span><span class="sxs-lookup"><span data-stu-id="ad409-290">Review the Cloud Services section of this document.</span></span>
2. <span data-ttu-id="ad409-291">Configurez au moins deux instances pour chaque rôle.</span><span class="sxs-lookup"><span data-stu-id="ad409-291">Configure at least two instances for each role.</span></span>
3. <span data-ttu-id="ad409-292">Rendez l’état persistant dans le stockage durable, mais pas sur les instances de rôle.</span><span class="sxs-lookup"><span data-stu-id="ad409-292">Persist state in durable storage, not on role instances.</span></span>
4. <span data-ttu-id="ad409-293">Gérez correctement l’événement StatusCheck.</span><span class="sxs-lookup"><span data-stu-id="ad409-293">Correctly handle the StatusCheck event.</span></span>
5. <span data-ttu-id="ad409-294">Encapsulez les modifications associées dans les transactions lorsque cela est possible.</span><span class="sxs-lookup"><span data-stu-id="ad409-294">Wrap related changes in transactions when possible.</span></span>
6. <span data-ttu-id="ad409-295">Vérifiez que les tâches du rôle de travail sont idempotentes et redémarrables.</span><span class="sxs-lookup"><span data-stu-id="ad409-295">Verify that worker role tasks are idempotent and restartable.</span></span>
7. <span data-ttu-id="ad409-296">Continuez à appeler les opérations jusqu’à leur réussite.</span><span class="sxs-lookup"><span data-stu-id="ad409-296">Continue to invoke operations until they succeed.</span></span>
8. <span data-ttu-id="ad409-297">Envisagez de mettre en place des stratégies de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="ad409-297">Consider autoscaling strategies.</span></span>

### <a name="virtual-machines"></a><span data-ttu-id="ad409-298">Virtual Machines</span><span class="sxs-lookup"><span data-stu-id="ad409-298">Virtual Machines</span></span>
1. <span data-ttu-id="ad409-299">Consulter la section Machines virtuelles de ce document.</span><span class="sxs-lookup"><span data-stu-id="ad409-299">Review the Virtual Machines section of this document.</span></span>
2. <span data-ttu-id="ad409-300">N’utilisez pas le lecteur D pour le stockage persistant.</span><span class="sxs-lookup"><span data-stu-id="ad409-300">Do not use drive D for persistent storage.</span></span>
3. <span data-ttu-id="ad409-301">Groupez les machines dans un niveau de service d’un groupe à haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="ad409-301">Group machines in a service tier into an availability set.</span></span>
4. <span data-ttu-id="ad409-302">Configurez l’équilibrage de charge et les sondes facultatives.</span><span class="sxs-lookup"><span data-stu-id="ad409-302">Configure load balancing and optional probes.</span></span>

### <a name="storage"></a><span data-ttu-id="ad409-303">Stockage</span><span class="sxs-lookup"><span data-stu-id="ad409-303">Storage</span></span>
1. <span data-ttu-id="ad409-304">Consultez la section Stockage de ce document.</span><span class="sxs-lookup"><span data-stu-id="ad409-304">Review the Storage section of this document.</span></span>
2. <span data-ttu-id="ad409-305">Utilisez plusieurs comptes de stockage lorsque les données ou la bande passante dépassent les quotas.</span><span class="sxs-lookup"><span data-stu-id="ad409-305">Use multiple storage accounts when data or bandwidth exceeds quotas.</span></span>

### <a name="sql-database"></a><span data-ttu-id="ad409-306">Base de données SQL</span><span class="sxs-lookup"><span data-stu-id="ad409-306">SQL Database</span></span>
1. <span data-ttu-id="ad409-307">Consultez la section Base de données SQL de ce document.</span><span class="sxs-lookup"><span data-stu-id="ad409-307">Review the SQL Database section of this document.</span></span>
2. <span data-ttu-id="ad409-308">Implémentez une stratégie de nouvelle tentative pour gérer les erreurs temporaires.</span><span class="sxs-lookup"><span data-stu-id="ad409-308">Implement a retry policy to handle transient errors.</span></span>
3. <span data-ttu-id="ad409-309">Utilisez le partitionnement en tant que stratégie d’augmentation de la taille des instances.</span><span class="sxs-lookup"><span data-stu-id="ad409-309">Use partitioning/sharding as a scale-out strategy.</span></span>

### <a name="sql-server-on-virtual-machines"></a><span data-ttu-id="ad409-310">SQL Server sur Virtual Machines</span><span class="sxs-lookup"><span data-stu-id="ad409-310">SQL Server on Virtual Machines</span></span>
1. <span data-ttu-id="ad409-311">Consultez la section SQL Server sur Virtual Machines de ce document.</span><span class="sxs-lookup"><span data-stu-id="ad409-311">Review the SQL Server on Virtual Machines section of this document.</span></span>
2. <span data-ttu-id="ad409-312">Suivez les recommandations précédentes relatives à Virtual Machines.</span><span class="sxs-lookup"><span data-stu-id="ad409-312">Follow the previous recommendations for Virtual Machines.</span></span>
3. <span data-ttu-id="ad409-313">Utilisez les fonctionnalités de haute disponibilité de SQL Server, telles que AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="ad409-313">Use SQL Server high availability features, such as AlwaysOn.</span></span>

### <a name="service-bus"></a><span data-ttu-id="ad409-314">Service Bus</span><span class="sxs-lookup"><span data-stu-id="ad409-314">Service Bus</span></span>
1. <span data-ttu-id="ad409-315">Consultez la section Service Bus de ce document.</span><span class="sxs-lookup"><span data-stu-id="ad409-315">Review the Service Bus section of this document.</span></span>
2. <span data-ttu-id="ad409-316">Envisagez de créer une file d’attente durable côté client en tant que sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="ad409-316">Consider creating a durable client-side queue as a backup.</span></span>

### <a name="hdinsight"></a><span data-ttu-id="ad409-317">HDInsight</span><span class="sxs-lookup"><span data-stu-id="ad409-317">HDInsight</span></span>
1. <span data-ttu-id="ad409-318">Consultez la section HDInsight de ce document.</span><span class="sxs-lookup"><span data-stu-id="ad409-318">Review the HDInsight section of this document.</span></span>
2. <span data-ttu-id="ad409-319">Aucune tâche supplémentaire de disponibilité requise pour les défaillances locales.</span><span class="sxs-lookup"><span data-stu-id="ad409-319">No additional availability steps are required for local failures.</span></span>

