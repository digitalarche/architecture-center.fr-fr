---
title: "Application web multirégion"
description: "Architecture recommandée pour une application web à haute disponibilité s’exécutant dans Microsoft Azure."
author: MikeWasson
ms.date: 11/23/2016
cardTitle: Run in multiple regions
ms.openlocfilehash: 2d7d0c38bef3efc73a7ba2dd61e4190d07deb1b5
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/14/2017
---
# <a name="run-a-web-application-in-multiple-regions"></a><span data-ttu-id="064f0-103">Exécuter une application web dans plusieurs régions</span><span class="sxs-lookup"><span data-stu-id="064f0-103">Run a web application in multiple regions</span></span>
[!INCLUDE [header](../../_includes/header.md)]

<span data-ttu-id="064f0-104">Cette architecture de référence indique comment exécuter une application Azure App Service dans plusieurs régions afin de bénéficier d’une haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="064f0-104">This reference architecture shows how to run an Azure App Service application in multiple regions to achieve high availability.</span></span> 

![Architecture de référence : application web à haute disponibilité](./images/multi-region-web-app-diagram.png) 

<span data-ttu-id="064f0-106">*Téléchargez un [fichier Visio][visio-download] de cette architecture.*</span><span class="sxs-lookup"><span data-stu-id="064f0-106">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="064f0-107">Architecture</span><span class="sxs-lookup"><span data-stu-id="064f0-107">Architecture</span></span> 

<span data-ttu-id="064f0-108">Cette architecture repose sur celle illustrée dans l’article [Améliorer l’évolutivité dans une application web][guidance-web-apps-scalability].</span><span class="sxs-lookup"><span data-stu-id="064f0-108">This architecture builds on the one shown in [Improve scalability in a web application][guidance-web-apps-scalability].</span></span> <span data-ttu-id="064f0-109">Les principales différences entre ces deux architectures sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="064f0-109">The main differences are:</span></span>

* <span data-ttu-id="064f0-110">**Régions primaires et secondaires**.</span><span class="sxs-lookup"><span data-stu-id="064f0-110">**Primary and secondary regions**.</span></span> <span data-ttu-id="064f0-111">Cette architecture utilise deux régions pour garantir une meilleure disponibilité.</span><span class="sxs-lookup"><span data-stu-id="064f0-111">This architecture uses two regions to achieve higher availability.</span></span> <span data-ttu-id="064f0-112">L’application est déployée dans chaque région.</span><span class="sxs-lookup"><span data-stu-id="064f0-112">The application is deployed to each region.</span></span> <span data-ttu-id="064f0-113">Pendant les opérations normales, le trafic réseau est routé vers la région primaire.</span><span class="sxs-lookup"><span data-stu-id="064f0-113">During normal operations, network traffic is routed to the primary region.</span></span> <span data-ttu-id="064f0-114">Si la région primaire n’est plus disponible, le trafic est routé vers la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="064f0-114">If the primary region becomes unavailable, traffic is routed to the secondary region.</span></span> 
* <span data-ttu-id="064f0-115">**Azure Traffic Manager**.</span><span class="sxs-lookup"><span data-stu-id="064f0-115">**Azure Traffic Manager**.</span></span> <span data-ttu-id="064f0-116">[Traffic Manager][traffic-manager] route les demandes entrantes vers la région primaire.</span><span class="sxs-lookup"><span data-stu-id="064f0-116">[Traffic Manager][traffic-manager] routes incoming requests to the primary region.</span></span> <span data-ttu-id="064f0-117">Si l’application qui s’exécute dans cette région n’est plus disponible, Traffic Manager bascule vers la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="064f0-117">If the application running that region becomes unavailable, Traffic Manager fails over to the secondary region.</span></span>
* <span data-ttu-id="064f0-118">**Géoréplication** de SQL Database et de Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="064f0-118">**Geo-replication** of SQL Database and Cosmos DB.</span></span> 

<span data-ttu-id="064f0-119">Une architecture multirégion peut offrir une meilleure disponibilité qu’un déploiement dans une seule région.</span><span class="sxs-lookup"><span data-stu-id="064f0-119">A multi-region architecture can provide higher availability than deploying to a single region.</span></span> <span data-ttu-id="064f0-120">Si une interruption de service régionale affecte la région primaire, vous pouvez utiliser [Traffic Manager][traffic-manager] pour basculer vers la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="064f0-120">If a regional outage affects the primary region, you can use [Traffic Manager][traffic-manager] to fail over to the secondary region.</span></span> <span data-ttu-id="064f0-121">Cette architecture peut également se révéler utile en cas de défaillance d’un sous-système spécifique de l’application.</span><span class="sxs-lookup"><span data-stu-id="064f0-121">This architecture can also help if an individual subsystem of the application fails.</span></span>

<span data-ttu-id="064f0-122">Plusieurs approches générales permettent de bénéficier d’une haute disponibilité dans l’ensemble des régions :</span><span class="sxs-lookup"><span data-stu-id="064f0-122">There are several general approaches to achieving high availability across regions:</span></span> 

* <span data-ttu-id="064f0-123">Mode actif/passif avec serveur de secours.</span><span class="sxs-lookup"><span data-stu-id="064f0-123">Active/passive with hot standby.</span></span> <span data-ttu-id="064f0-124">Le trafic est dirigé vers une région, tandis que l’autre région est en attente sur le serveur de secours.</span><span class="sxs-lookup"><span data-stu-id="064f0-124">Traffic goes to one region, while the other waits on hot standby.</span></span> <span data-ttu-id="064f0-125">Le terme « serveur de secours » signifie que les machines virtuelles de la région secondaire sont allouées et en cours d’exécution en permanence.</span><span class="sxs-lookup"><span data-stu-id="064f0-125">Hot standby means the VMs in the secondary region are allocated and running at all times.</span></span>
* <span data-ttu-id="064f0-126">Mode actif/passif avec reprise progressive.</span><span class="sxs-lookup"><span data-stu-id="064f0-126">Active/passive with cold standby.</span></span> <span data-ttu-id="064f0-127">Le trafic est dirigé vers une région, tandis que l’autre région est en attente sur le centre de données de reprise progressive.</span><span class="sxs-lookup"><span data-stu-id="064f0-127">Traffic goes to one region, while the other waits on cold standby.</span></span> <span data-ttu-id="064f0-128">Le terme « reprise progressive » signifie que les machines virtuelles de la région secondaire ne sont pas allouées tant qu’elles ne sont pas requises pour le basculement.</span><span class="sxs-lookup"><span data-stu-id="064f0-128">Cold standby means the VMs in the secondary region are not allocated until needed for failover.</span></span> <span data-ttu-id="064f0-129">La mise en œuvre de cette approche se révèle moins coûteuse, mais nécessite généralement davantage de temps en cas de défaillance.</span><span class="sxs-lookup"><span data-stu-id="064f0-129">This approach costs less to run, but will generally take longer to come online during a failure.</span></span>
* <span data-ttu-id="064f0-130">Mode actif/actif.</span><span class="sxs-lookup"><span data-stu-id="064f0-130">Active/active.</span></span> <span data-ttu-id="064f0-131">Les deux régions sont actives, et la charge de travail des requêtes est équilibrée entre les régions.</span><span class="sxs-lookup"><span data-stu-id="064f0-131">Both regions are active, and requests are load balanced between them.</span></span> <span data-ttu-id="064f0-132">Si l’une des régions n’est plus disponible, elle est mise hors service.</span><span class="sxs-lookup"><span data-stu-id="064f0-132">If one region becomes unavailable, it is taken out of rotation.</span></span> 

<span data-ttu-id="064f0-133">Cette architecture de référence est axée sur le mode actif/passif avec serveur de secours, et utilise Traffic Manager pour le basculement.</span><span class="sxs-lookup"><span data-stu-id="064f0-133">This reference architecture focuses on active/passive with hot standby, using Traffic Manager for failover.</span></span> 


## <a name="recommendations"></a><span data-ttu-id="064f0-134">Recommandations</span><span class="sxs-lookup"><span data-stu-id="064f0-134">Recommendations</span></span>

<span data-ttu-id="064f0-135">Vos exigences peuvent différer de celles de l’architecture décrite ici.</span><span class="sxs-lookup"><span data-stu-id="064f0-135">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="064f0-136">Utilisez les recommandations de cette section comme point de départ.</span><span class="sxs-lookup"><span data-stu-id="064f0-136">Use the recommendations in this section as a starting point.</span></span>

### <a name="regional-pairing"></a><span data-ttu-id="064f0-137">Association régionale</span><span class="sxs-lookup"><span data-stu-id="064f0-137">Regional pairing</span></span>
<span data-ttu-id="064f0-138">Chaque région Azure est associée à une autre région de la même zone géographique.</span><span class="sxs-lookup"><span data-stu-id="064f0-138">Each Azure region is paired with another region within the same geography.</span></span> <span data-ttu-id="064f0-139">En général, choisissez des régions de la même paire régionale (par exemple, Est des États-Unis 2 et Centre des États-Unis).</span><span class="sxs-lookup"><span data-stu-id="064f0-139">In general, choose regions from the same regional pair (for example, East US 2 and Central US).</span></span> <span data-ttu-id="064f0-140">Cette approche offre les avantages suivants :</span><span class="sxs-lookup"><span data-stu-id="064f0-140">Benefits of doing so include:</span></span>

* <span data-ttu-id="064f0-141">Dans l’éventualité d’une interruption de service générale, la récupération d’au moins une région de chaque paire est prioritaire.</span><span class="sxs-lookup"><span data-stu-id="064f0-141">If there is a broad outage, recovery of at least one region out of every pair is prioritized.</span></span>
* <span data-ttu-id="064f0-142">Les mises à jour planifiées du système Azure sont déployées dans les régions associées de manière séquentielle afin de minimiser les temps d’arrêt possibles.</span><span class="sxs-lookup"><span data-stu-id="064f0-142">Planned Azure system updates are rolled out to paired regions sequentially to minimize possible downtime.</span></span>
* <span data-ttu-id="064f0-143">Dans la plupart des cas, les paires régionales appartiennent à la même zone géographique afin de répondre aux exigences en matière de résidence des données.</span><span class="sxs-lookup"><span data-stu-id="064f0-143">In most cases, regional pairs reside within the same geography to meet data residency requirements.</span></span>

<span data-ttu-id="064f0-144">Toutefois, assurez-vous que les deux régions prennent en charge tous les services Azure requis pour votre application.</span><span class="sxs-lookup"><span data-stu-id="064f0-144">However, make sure that both regions support all of the Azure services needed for your application.</span></span> <span data-ttu-id="064f0-145">Consultez la page répertoriant les [services par région][services-by-region].</span><span class="sxs-lookup"><span data-stu-id="064f0-145">See [Services by region][services-by-region].</span></span> <span data-ttu-id="064f0-146">Pour plus d’informations sur les paires régionales, consultez l’article [Continuité des activités et récupération d’urgence (BCDR) : régions jumelées d’Azure][regional-pairs].</span><span class="sxs-lookup"><span data-stu-id="064f0-146">For more information about regional pairs, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions][regional-pairs].</span></span>

### <a name="resource-groups"></a><span data-ttu-id="064f0-147">Groupes de ressources</span><span class="sxs-lookup"><span data-stu-id="064f0-147">Resource groups</span></span>
<span data-ttu-id="064f0-148">Envisagez de placer la région primaire, la région secondaire et Traffic Manager dans des [groupes de ressources][resource groups] distincts.</span><span class="sxs-lookup"><span data-stu-id="064f0-148">Consider placing the primary region, secondary region, and Traffic Manager into separate [resource groups][resource groups].</span></span> <span data-ttu-id="064f0-149">Cette approche vous permet de gérer les ressources déployées dans chaque région sous la forme d’une collection unique.</span><span class="sxs-lookup"><span data-stu-id="064f0-149">This lets you manage the resources deployed to each region as a single collection.</span></span>

### <a name="traffic-manager-configuration"></a><span data-ttu-id="064f0-150">Configuration de Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="064f0-150">Traffic Manager configuration</span></span> 

<span data-ttu-id="064f0-151">**Routage**.</span><span class="sxs-lookup"><span data-stu-id="064f0-151">**Routing**.</span></span> <span data-ttu-id="064f0-152">Traffic Manager prend en charge plusieurs [algorithmes de routage][tm-routing].</span><span class="sxs-lookup"><span data-stu-id="064f0-152">Traffic Manager supports several [routing algorithms][tm-routing].</span></span> <span data-ttu-id="064f0-153">Pour le scénario décrit dans cet article, utilisez le routage *par priorité* (auparavant désigné sous le terme de routage *par basculement*).</span><span class="sxs-lookup"><span data-stu-id="064f0-153">For the scenario described in this article, use *priority* routing (formerly called *failover* routing).</span></span> <span data-ttu-id="064f0-154">Lorsque cette méthode de routage est configurée, Traffic Manager envoie toutes les requêtes à la région primaire, sauf si le point de terminaison de cette région devient inaccessible.</span><span class="sxs-lookup"><span data-stu-id="064f0-154">With this setting, Traffic Manager sends all requests to the primary region unless the endpoint for that region becomes unreachable.</span></span> <span data-ttu-id="064f0-155">Dans ce dernier cas, les requêtes basculent automatiquement vers la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="064f0-155">At that point, it automatically fails over to the secondary region.</span></span> <span data-ttu-id="064f0-156">Consultez l’article [Configurer la méthode de routage par basculement][tm-configure-failover].</span><span class="sxs-lookup"><span data-stu-id="064f0-156">See [Configure Failover routing method][tm-configure-failover].</span></span>

<span data-ttu-id="064f0-157">**Sonde d’intégrité**.</span><span class="sxs-lookup"><span data-stu-id="064f0-157">**Health probe**.</span></span> <span data-ttu-id="064f0-158">Traffic Manager utilise une sonde HTTP (ou HTTPS) pour surveiller la disponibilité de chaque point de terminaison.</span><span class="sxs-lookup"><span data-stu-id="064f0-158">Traffic Manager uses an HTTP (or HTTPS) probe to monitor the availability of each endpoint.</span></span> <span data-ttu-id="064f0-159">Cette sonde offre à Traffic Manager un test de réussite/échec pour le basculement vers la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="064f0-159">The probe gives Traffic Manager a pass/fail test for failing over to the secondary region.</span></span> <span data-ttu-id="064f0-160">Elle envoie une requête à un chemin d’URL spécifié.</span><span class="sxs-lookup"><span data-stu-id="064f0-160">It works by sending a request to a specified URL path.</span></span> <span data-ttu-id="064f0-161">Si la sonde obtient une réponse autre que 200 dans le délai d’expiration imparti, elle échoue.</span><span class="sxs-lookup"><span data-stu-id="064f0-161">If it gets a non-200 response within a timeout period, the probe fails.</span></span> <span data-ttu-id="064f0-162">Après quatre échecs de requêtes, Traffic Manager marque le point de terminaison comme détérioré et bascule vers l’autre point de terminaison.</span><span class="sxs-lookup"><span data-stu-id="064f0-162">After four failed requests, Traffic Manager marks the endpoint as degraded and fails over to the other endpoint.</span></span> <span data-ttu-id="064f0-163">Pour plus d’informations, consultez l’article [Surveillance et basculement des points de terminaison Traffic Manager][tm-monitoring].</span><span class="sxs-lookup"><span data-stu-id="064f0-163">For details, see [Traffic Manager endpoint monitoring and failover][tm-monitoring].</span></span>

<span data-ttu-id="064f0-164">Une bonne pratique consiste à créer un point de terminaison de sonde d’intégrité qui signale l’intégrité globale de l’application et à utiliser ce point de terminaison pour la sonde d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="064f0-164">As a best practice, create a health probe endpoint that reports the overall health of the application and use this endpoint for the health probe.</span></span> <span data-ttu-id="064f0-165">Le point de terminaison doit vérifier les dépendances critiques telles que les applications App Service, la file d’attente de stockage et SQL Database.</span><span class="sxs-lookup"><span data-stu-id="064f0-165">The endpoint should check critical dependencies such as the App Service apps, storage queue, and SQL Database.</span></span> <span data-ttu-id="064f0-166">Dans le cas contraire, la sonde risque de signaler un point de terminaison intègre alors que des parties critiques de l’application sont défaillantes.</span><span class="sxs-lookup"><span data-stu-id="064f0-166">Otherwise, the probe might report a healthy endpoint when critical parts of the application are actually failing.</span></span>

<span data-ttu-id="064f0-167">En revanche, n’utilisez pas la sonde d’intégrité pour vérifier des services de priorité inférieure.</span><span class="sxs-lookup"><span data-stu-id="064f0-167">On the other hand, don't use the health probe to check lower priority services.</span></span> <span data-ttu-id="064f0-168">Par exemple, si un service de messagerie tombe en panne, l’application peut basculer vers un second fournisseur ou simplement différer l’envoi des e-mails.</span><span class="sxs-lookup"><span data-stu-id="064f0-168">For example, if an email service goes down the application can switch to a second provider or just send emails later.</span></span> <span data-ttu-id="064f0-169">Cette situation n’est pas suffisamment prioritaire pour entraîner le basculement de l’application.</span><span class="sxs-lookup"><span data-stu-id="064f0-169">This is not a high enough priority to cause the application to fail over.</span></span> <span data-ttu-id="064f0-170">Pour plus d’informations, consultez l’article [Modèle Surveillance de point de terminaison d’intégrité][health-endpoint-monitoring-pattern].</span><span class="sxs-lookup"><span data-stu-id="064f0-170">For more information, see [Health Endpoint Monitoring Pattern][health-endpoint-monitoring-pattern].</span></span>
 
### <a name="sql-database"></a><span data-ttu-id="064f0-171">Base de données SQL</span><span class="sxs-lookup"><span data-stu-id="064f0-171">SQL Database</span></span>
<span data-ttu-id="064f0-172">Utilisez la [géoréplication active][sql-replication] pour créer un réplica secondaire lisible dans une autre région.</span><span class="sxs-lookup"><span data-stu-id="064f0-172">Use [Active Geo-Replication][sql-replication] to create a readable secondary replica in a different region.</span></span> <span data-ttu-id="064f0-173">Vous pouvez posséder jusqu’à quatre réplicas secondaires lisibles.</span><span class="sxs-lookup"><span data-stu-id="064f0-173">You can have up to four readable secondary replicas.</span></span> <span data-ttu-id="064f0-174">Basculez vers une base de données secondaire si votre base de données primaire est défaillante ou doit être mise hors connexion.</span><span class="sxs-lookup"><span data-stu-id="064f0-174">Fail over to a secondary database if your primary database fails or needs to be taken offline.</span></span> <span data-ttu-id="064f0-175">La géoréplication active peut être configurée pour toute base de données faisant partie d’un pool de bases de données élastique.</span><span class="sxs-lookup"><span data-stu-id="064f0-175">Active Geo-Replication can be configured for any database in any elastic database pool.</span></span>

### <a name="cosmos-db"></a><span data-ttu-id="064f0-176">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="064f0-176">Cosmos DB</span></span>
<span data-ttu-id="064f0-177">Cosmos DB prend en charge la géoréplication entre régions.</span><span class="sxs-lookup"><span data-stu-id="064f0-177">Cosmos DB supports geo-replication across regions.</span></span> <span data-ttu-id="064f0-178">L’une des régions est désignée comme étant accessible en écriture, tandis que les autres régions sont des réplicas en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="064f0-178">One region is designated as writable and the others are read-only replicas.</span></span>

<span data-ttu-id="064f0-179">Dans l’éventualité d’une interruption de service régionale, vous pouvez procéder à un basculement en désignant une autre région comme étant accessible en écriture.</span><span class="sxs-lookup"><span data-stu-id="064f0-179">If there is a regional outage, you can fail over by selecting another region to be the write region.</span></span> <span data-ttu-id="064f0-180">Le Kit de développement logiciel (SDK) client envoie automatiquement des requêtes d’écriture à la région accessible en écriture ; vous n’avez donc pas besoin de mettre à jour la configuration du client après un basculement.</span><span class="sxs-lookup"><span data-stu-id="064f0-180">The client SDK automatically sends write requests to the current write region, so you don't need to update the client configuration after a failover.</span></span> <span data-ttu-id="064f0-181">Pour plus d’informations, consultez l’article [Comment distribuer des données mondialement avec Azure Cosmos DB][docdb-geo].</span><span class="sxs-lookup"><span data-stu-id="064f0-181">For more information, see [How to distribute data globally with Azure Cosmos DB?][docdb-geo]</span></span>

> [!NOTE]
> <span data-ttu-id="064f0-182">Tous les réplicas appartiennent au même groupe de ressources.</span><span class="sxs-lookup"><span data-stu-id="064f0-182">All of the replicas belong to the same resource group.</span></span>
>
>

### <a name="storage"></a><span data-ttu-id="064f0-183">Storage</span><span class="sxs-lookup"><span data-stu-id="064f0-183">Storage</span></span>
<span data-ttu-id="064f0-184">Pour le service Stockage Azure, utilisez un [stockage géographiquement redondant avec accès en lecture][ra-grs] (RA-GRS).</span><span class="sxs-lookup"><span data-stu-id="064f0-184">For Azure Storage, use [read-access geo-redundant storage][ra-grs] (RA-GRS).</span></span> <span data-ttu-id="064f0-185">Dans le cadre d’un stockage RA-GRS, les données sont répliquées vers une région secondaire.</span><span class="sxs-lookup"><span data-stu-id="064f0-185">With RA-GRS storage, the data is replicated to a secondary region.</span></span> <span data-ttu-id="064f0-186">Vous disposez d’un accès en lecture seule aux données de la région secondaire par le biais d’un point de terminaison distinct.</span><span class="sxs-lookup"><span data-stu-id="064f0-186">You have read-only access to the data in the secondary region through a separate endpoint.</span></span> <span data-ttu-id="064f0-187">En cas d’interruption de service régionale ou de situation d’urgence, l’équipe Stockage Azure peut décider de procéder à un basculement géographique vers la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="064f0-187">If there is a regional outage or disaster, the Azure Storage team might decide to perform a geo-failover to the secondary region.</span></span> <span data-ttu-id="064f0-188">Ce basculement ne nécessite aucune action de la part du client.</span><span class="sxs-lookup"><span data-stu-id="064f0-188">There is no customer action required for this failover.</span></span>

<span data-ttu-id="064f0-189">Pour le service Stockage File d’attente, créez une file d’attente de sauvegarde dans la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="064f0-189">For Queue storage, create a backup queue in the secondary region.</span></span> <span data-ttu-id="064f0-190">Pendant le basculement, l’application peut utiliser la file d’attente de sauvegarde jusqu’à ce que la région primaire redevienne disponible.</span><span class="sxs-lookup"><span data-stu-id="064f0-190">During failover, the app can use the backup queue until the primary region becomes available again.</span></span> <span data-ttu-id="064f0-191">De cette façon, l’application peut continuer à traiter les nouvelles requêtes.</span><span class="sxs-lookup"><span data-stu-id="064f0-191">That way, the application can still process new requests.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="064f0-192">Considérations relatives à la disponibilité</span><span class="sxs-lookup"><span data-stu-id="064f0-192">Availability considerations</span></span>


### <a name="traffic-manager"></a><span data-ttu-id="064f0-193">Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="064f0-193">Traffic Manager</span></span>

<span data-ttu-id="064f0-194">Traffic Manager procède à un basculement automatique si la région primaire n’est plus disponible.</span><span class="sxs-lookup"><span data-stu-id="064f0-194">Traffic Manager automatically fails over if the primary region becomes unavailable.</span></span> <span data-ttu-id="064f0-195">Lors de ce basculement, l’application reste inaccessible au client pendant un certain laps de temps.</span><span class="sxs-lookup"><span data-stu-id="064f0-195">When Traffic Manager fails over, there is a period of time when clients cannot reach the application.</span></span> <span data-ttu-id="064f0-196">Cette durée dépend des facteurs suivants :</span><span class="sxs-lookup"><span data-stu-id="064f0-196">The duration is affected by the following factors:</span></span>

* <span data-ttu-id="064f0-197">La sonde d’intégrité doit détecter que le centre de données principal est devenu inaccessible.</span><span class="sxs-lookup"><span data-stu-id="064f0-197">The health probe must detect that the primary data center has become unreachable.</span></span>
* <span data-ttu-id="064f0-198">Les serveurs DNS (Domain Name Service) doivent mettre à jour les enregistrements DNS mis en cache pour l’adresse IP, qui dépend de la durée de vie (TTL) DNS.</span><span class="sxs-lookup"><span data-stu-id="064f0-198">Domain name service (DNS) servers must update the cached DNS records for the IP address, which depends on the DNS time-to-live (TTL).</span></span> <span data-ttu-id="064f0-199">La valeur TTL par défaut est de 300 secondes (5 minutes), mais vous pouvez configurer cette valeur lorsque vous créez le profil Traffic Manager.</span><span class="sxs-lookup"><span data-stu-id="064f0-199">The default TTL is 300 seconds (5 minutes), but you can configure this value when you create the Traffic Manager profile.</span></span>

<span data-ttu-id="064f0-200">Pour plus d’informations, consultez l’article [À propos de la surveillance avec Traffic Manager][tm-monitoring].</span><span class="sxs-lookup"><span data-stu-id="064f0-200">For details, see [About Traffic Manager Monitoring][tm-monitoring].</span></span>

<span data-ttu-id="064f0-201">Traffic Manager est un point de défaillance possible dans le système.</span><span class="sxs-lookup"><span data-stu-id="064f0-201">Traffic Manager is a possible failure point in the system.</span></span> <span data-ttu-id="064f0-202">Si le service échoue, les clients ne peuvent plus accéder à votre application pendant le temps d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="064f0-202">If the service fails, clients cannot access your application during the downtime.</span></span> <span data-ttu-id="064f0-203">Examinez le [Contrat de niveau de service (SLA) pour Traffic Manager][tm-sla] et déterminez si Traffic Manager peut à lui seul répondre à vos exigences métiers en matière de haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="064f0-203">Review the [Traffic Manager service level agreement (SLA)][tm-sla] and determine whether using Traffic Manager alone meets your business requirements for high availability.</span></span> <span data-ttu-id="064f0-204">Si tel n’est pas le cas, envisagez d’ajouter une autre solution de gestion du trafic en guise de restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="064f0-204">If not, consider adding another traffic management solution as a failback.</span></span> <span data-ttu-id="064f0-205">Si le service Azure Traffic Manager échoue, modifiez vos enregistrements de nom canonique (CNAME) dans DNS pour les faire pointer vers l’autre service de gestion du trafic.</span><span class="sxs-lookup"><span data-stu-id="064f0-205">If the Azure Traffic Manager service fails, change your canonical name (CNAME) records in DNS to point to the other traffic management service.</span></span> <span data-ttu-id="064f0-206">Cette opération doit être effectuée manuellement, et votre application reste inaccessible tant que ces modifications DNS n’ont pas été propagées.</span><span class="sxs-lookup"><span data-stu-id="064f0-206">This step must be performed manually, and your application will be unavailable until the DNS changes are propagated.</span></span>

### <a name="sql-database"></a><span data-ttu-id="064f0-207">Base de données SQL</span><span class="sxs-lookup"><span data-stu-id="064f0-207">SQL Database</span></span>
<span data-ttu-id="064f0-208">L’objectif de point de récupération (RPO) et le temps de récupération estimé (ERT) pour SQL Database sont décrits dans l’article [Vue d’ensemble de la continuité de l’activité avec la base de données Azure SQL][sql-rpo].</span><span class="sxs-lookup"><span data-stu-id="064f0-208">The recovery point objective (RPO) and estimated recovery time (ERT) for SQL Database are documented in [Overview of business continuity with Azure SQL Database][sql-rpo].</span></span> 

### <a name="storage"></a><span data-ttu-id="064f0-209">Storage</span><span class="sxs-lookup"><span data-stu-id="064f0-209">Storage</span></span>
<span data-ttu-id="064f0-210">Le stockage RA-GRS assure un stockage durable, mais il est important que vous compreniez ce qui peut se produire en cas d’interruption de service :</span><span class="sxs-lookup"><span data-stu-id="064f0-210">RA-GRS storage provides durable storage, but it's important to understand what can happen during an outage:</span></span>

* <span data-ttu-id="064f0-211">Si le stockage cesse d’être disponible, les données ne vous sont plus accessibles en écriture pendant un certain laps de temps.</span><span class="sxs-lookup"><span data-stu-id="064f0-211">If a storage outage occurs, there will be a period of time when you don't have write-access to the data.</span></span> <span data-ttu-id="064f0-212">Pendant l’interruption de service, vous pouvez continuer à lire les données à partir du point de terminaison secondaire.</span><span class="sxs-lookup"><span data-stu-id="064f0-212">You can still read from the secondary endpoint during the outage.</span></span>
* <span data-ttu-id="064f0-213">Si une interruption de service régionale ou une situation d’urgence affectent l’emplacement primaire et que les données ne sont pas récupérables, l’équipe Stockage Azure peut décider de procéder à un basculement géographique vers la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="064f0-213">If a regional outage or disaster affects the primary location and the data there cannot be recovered, the Azure Storage team may decide to perform a geo-failover to the secondary region.</span></span>
* <span data-ttu-id="064f0-214">La réplication des données vers la région secondaire est effectuée de manière asynchrone.</span><span class="sxs-lookup"><span data-stu-id="064f0-214">Data replication to the secondary region is performed asynchronously.</span></span> <span data-ttu-id="064f0-215">Par conséquent, un basculement géographique peut occasionner une perte de données si ces données ne sont pas récupérables à partir de la région primaire.</span><span class="sxs-lookup"><span data-stu-id="064f0-215">Therefore, if a geo-failover is performed, some data loss is possible if the data can't be recovered from the primary region.</span></span>
* <span data-ttu-id="064f0-216">Les défaillances passagères, telles qu’une indisponibilité du réseau, n’entraînent pas un basculement du stockage.</span><span class="sxs-lookup"><span data-stu-id="064f0-216">Transient failures, such as a network outage, will not trigger a storage failover.</span></span> <span data-ttu-id="064f0-217">Concevez votre application de façon à la rendre résistante aux défaillances passagères.</span><span class="sxs-lookup"><span data-stu-id="064f0-217">Design your application to be resilient to transient failures.</span></span> <span data-ttu-id="064f0-218">Les méthodes d’atténuation des risques possibles sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="064f0-218">Possible mitigations:</span></span>
  
  * <span data-ttu-id="064f0-219">lecture à partir de la région secondaire ;</span><span class="sxs-lookup"><span data-stu-id="064f0-219">Read from the secondary region.</span></span>
  * <span data-ttu-id="064f0-220">basculement temporaire vers un autre compte de stockage pour les nouvelles opérations d’écriture (par exemple, pour la mise en file d’attente des messages) ;</span><span class="sxs-lookup"><span data-stu-id="064f0-220">Temporarily switch to another storage account for new write operations (for example, to queue messages).</span></span>
  * <span data-ttu-id="064f0-221">copie des données de la région secondaire vers un autre compte de stockage ;</span><span class="sxs-lookup"><span data-stu-id="064f0-221">Copy data from the secondary region to another storage account.</span></span>
  * <span data-ttu-id="064f0-222">fourniture de fonctionnalités réduites jusqu’à la restauration automatique du système.</span><span class="sxs-lookup"><span data-stu-id="064f0-222">Provide reduced functionality until the system fails back.</span></span>

<span data-ttu-id="064f0-223">Pour plus d’informations, consultez l’article [Que faire en cas de panne du stockage Azure][storage-outage].</span><span class="sxs-lookup"><span data-stu-id="064f0-223">For more information, see [What to do if an Azure Storage outage occurs][storage-outage].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="064f0-224">Considérations relatives à la facilité de gestion</span><span class="sxs-lookup"><span data-stu-id="064f0-224">Manageability Considerations</span></span>

### <a name="traffic-manager"></a><span data-ttu-id="064f0-225">Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="064f0-225">Traffic Manager</span></span>

<span data-ttu-id="064f0-226">En cas de basculement de Traffic Manager, nous vous recommandons de procéder à une restauration automatique manuelle plutôt que d’implémenter une restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="064f0-226">If Traffic Manager fails over, we recommend performing a manual failback rather than implementing an automatic failback.</span></span> <span data-ttu-id="064f0-227">Dans le cas contraire, l’application risque d’alterner continuellement entre les régions.</span><span class="sxs-lookup"><span data-stu-id="064f0-227">Otherwise, you can create a situation where the application flips back and forth between regions.</span></span> <span data-ttu-id="064f0-228">Vérifiez que tous les sous-systèmes de l’application sont intègres avant d’effectuer la restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="064f0-228">Verify that all application subsystems are healthy before failing back.</span></span>

<span data-ttu-id="064f0-229">Notez que Traffic Manager procède à une restauration automatique par défaut.</span><span class="sxs-lookup"><span data-stu-id="064f0-229">Note that Traffic Manager automatically fails back by default.</span></span> <span data-ttu-id="064f0-230">Pour éviter cela, diminuez manuellement la priorité de la région primaire après un événement de basculement.</span><span class="sxs-lookup"><span data-stu-id="064f0-230">To prevent this, manually lower the priority of the primary region after a failover event.</span></span> <span data-ttu-id="064f0-231">Par exemple, supposons que la région primaire soit dotée de la priorité 1, et que la base de données secondaire présente la priorité 2.</span><span class="sxs-lookup"><span data-stu-id="064f0-231">For example, suppose the primary region is priority 1 and the secondary is priority 2.</span></span> <span data-ttu-id="064f0-232">Après un basculement, définissez la priorité de la région primaire sur la valeur 3 afin d’empêcher la restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="064f0-232">After a failover, set the primary region to priority 3, to prevent automatic failback.</span></span> <span data-ttu-id="064f0-233">Lorsque vous êtes prêt à rebasculer vers cette région, redéfinissez sa priorité sur la valeur 1.</span><span class="sxs-lookup"><span data-stu-id="064f0-233">When you are ready to switch back, update the priority to 1.</span></span>

<span data-ttu-id="064f0-234">Les commandes permettant de mettre à jour la priorité sont indiquées ci-après.</span><span class="sxs-lookup"><span data-stu-id="064f0-234">The following commands update the priority.</span></span>

<span data-ttu-id="064f0-235">**PowerShell**</span><span class="sxs-lookup"><span data-stu-id="064f0-235">**PowerShell**</span></span>

```bat
$endpoint = Get-AzureRmTrafficManagerEndpoint -Name <endpoint> -ProfileName <profile> -ResourceGroupName <resource-group> -Type AzureEndpoints
$endpoint.Priority = 3
Set-AzureRmTrafficManagerEndpoint -TrafficManagerEndpoint $endpoint
```

<span data-ttu-id="064f0-236">Pour plus d’informations, consultez l’article [Applets de commande Azure Traffic Manager][tm-ps].</span><span class="sxs-lookup"><span data-stu-id="064f0-236">For more information, see [Azure Traffic Manager Cmdlets][tm-ps].</span></span>

<span data-ttu-id="064f0-237">**Interface de ligne de commande Azure (CLI)**</span><span class="sxs-lookup"><span data-stu-id="064f0-237">**Azure command line interface (CLI)**</span></span>

```bat
azure network traffic-manager endpoint set --name <endpoint> --profile-name <profile> --resource-group <resource-group> --type AzureEndpoints --priority 3
```    

### <a name="sql-database"></a><span data-ttu-id="064f0-238">Base de données SQL</span><span class="sxs-lookup"><span data-stu-id="064f0-238">SQL Database</span></span>
<span data-ttu-id="064f0-239">Si la base de données primaire est défaillante, effectuez un basculement manuel vers la base de données secondaire.</span><span class="sxs-lookup"><span data-stu-id="064f0-239">If the primary database fails, perform a manual failover to the secondary database.</span></span> <span data-ttu-id="064f0-240">Consultez l’article [Restaurer une base de données SQL Azure ou basculer vers une base de données secondaire][sql-failover].</span><span class="sxs-lookup"><span data-stu-id="064f0-240">See [Restore an Azure SQL Database or failover to a secondary][sql-failover].</span></span> <span data-ttu-id="064f0-241">La base de données secondaire reste en lecture seule jusqu’à ce que vous basculiez vers cette dernière.</span><span class="sxs-lookup"><span data-stu-id="064f0-241">The secondary database remains read-only until you fail over.</span></span>


<!-- links -->

[azure-sql-db]: https://azure.microsoft.com/documentation/services/sql-database/
[docdb-geo]: /azure/documentdb/documentdb-distribute-data-globally
[guidance-web-apps-scalability]: ./scalable-web-app.md
[health-endpoint-monitoring-pattern]: https://msdn.microsoft.com/library/dn589789.aspx
[ra-grs]: /azure/storage/storage-redundancy#read-access-geo-redundant-storage
[regional-pairs]: /azure/best-practices-availability-paired-regions
[resource groups]: /azure/azure-resource-manager/resource-group-overview#resource-groups
[services-by-region]: https://azure.microsoft.com/regions/#services
[sql-failover]: /azure/sql-database/sql-database-disaster-recovery
[sql-replication]: /azure/sql-database/sql-database-geo-replication-overview
[sql-rpo]: /azure/sql-database/sql-database-business-continuity#sql-database-features-that-you-can-use-to-provide-business-continuity
[storage-outage]: /azure/storage/storage-disaster-recovery-guidance
[tm-configure-failover]: /azure/traffic-manager/traffic-manager-configure-failover-routing-method
[tm-monitoring]: /azure/traffic-manager/traffic-manager-monitoring
[tm-ps]: https://msdn.microsoft.com/library/mt125941.aspx
[tm-routing]: /azure/traffic-manager/traffic-manager-routing-methods
[tm-sla]: https://azure.microsoft.com/support/legal/sla/traffic-manager/v1_0/
[traffic-manager]: https://azure.microsoft.com/services/traffic-manager/
[visio-download]: https://archcenter.azureedge.net/cdn/app-service-reference-architectures.vsdx
