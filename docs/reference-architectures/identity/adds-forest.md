---
title: Créer une forêt de ressources AD DS dans Azure
description: >-
  Comment créer un domaine Active Directory approuvé dans Azure.

  conseils, passerelle vpn, expressroute, équilibreur de charge, réseau virtuel, active directory
author: telmosampaio
ms.date: 11/28/2016
pnp.series.title: Identity management
pnp.series.prev: adds-extend-domain
pnp.series.next: adfs
cardTitle: Create an AD DS forest in Azure
ms.openlocfilehash: e32a6420821e70c84e77d2c39614f0c45efbb7e2
ms.sourcegitcommit: e67b751f230792bba917754d67789a20810dc76b
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/06/2018
---
# <a name="create-an-active-directory-domain-services-ad-ds-resource-forest-in-azure"></a><span data-ttu-id="ab7c9-104">Créer une forêt de ressources Active Directory Domain Services (AD DS) dans Azure</span><span class="sxs-lookup"><span data-stu-id="ab7c9-104">Create an Active Directory Domain Services (AD DS) resource forest in Azure</span></span>

<span data-ttu-id="ab7c9-105">Cette architecture de référence montre comment créer, dans Azure, un domaine Active Directory distinct approuvé par les domaines de votre forêt AD locale.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-105">This reference architecture shows how to create a separate Active Directory domain in Azure that is trusted by domains in your on-premises AD forest.</span></span> [<span data-ttu-id="ab7c9-106">**Déployez cette solution**.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-106">**Deploy this solution**.</span></span>](#deploy-the-solution)

<span data-ttu-id="ab7c9-107">[![0]][0]</span><span class="sxs-lookup"><span data-stu-id="ab7c9-107">[![0]][0]</span></span> 

<span data-ttu-id="ab7c9-108">*Téléchargez un [fichier Visio][visio-download] de cette architecture.*</span><span class="sxs-lookup"><span data-stu-id="ab7c9-108">*Download a [Visio file][visio-download] of this architecture.*</span></span>

<span data-ttu-id="ab7c9-109">Active Directory Domain Services (AD DS) stocke des informations d’identité dans une structure hiérarchique.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-109">Active Directory Domain Services (AD DS) stores identity information in a hierarchical structure.</span></span> <span data-ttu-id="ab7c9-110">Le nœud supérieur de la structure hiérarchique est appelé « forêt ».</span><span class="sxs-lookup"><span data-stu-id="ab7c9-110">The top node in the hierarchical structure is known as a forest.</span></span> <span data-ttu-id="ab7c9-111">Une forêt contient des domaines, qui à leur tour contiennent d’autres types d’objets.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-111">A forest contains domains, and domains contain other types of objects.</span></span> <span data-ttu-id="ab7c9-112">Cette architecture de référence crée une forêt AD DS dans Azure avec une relation d’approbation à sens unique sortante avec un domaine local.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-112">This reference architecture creates an AD DS forest in Azure with a one-way outgoing trust relationship with an on-premises domain.</span></span> <span data-ttu-id="ab7c9-113">La forêt dans Azure contient un domaine qui n’existe pas localement.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-113">The forest in Azure contains a domain that does not exist on-premises.</span></span> <span data-ttu-id="ab7c9-114">En raison de la relation d’approbation, les ouvertures de session effectuées dans les domaines locaux peuvent être approuvées pour l’accès aux ressources dans le domaine Azure distinct.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-114">Because of the trust relationship, logons made against on-premises domains can be trusted for access to resources in the separate Azure domain.</span></span> 

<span data-ttu-id="ab7c9-115">Parmi les utilisations courantes de cette architecture figurent la conservation d’une séparation de sécurité pour les objets et les identités contenus dans le cloud et la migration de domaines individuels depuis l’environnement local vers le cloud.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-115">Typical uses for this architecture include maintaining security separation for objects and identities held in the cloud, and migrating individual domains from on-premises to the cloud.</span></span> 

<span data-ttu-id="ab7c9-116">Pour plus d’informations, consultez [Choisir une solution pour intégrer l’environnement Active Directory local à Azure][considerations].</span><span class="sxs-lookup"><span data-stu-id="ab7c9-116">For additional considerations, see [Choose a solution for integrating on-premises Active Directory with Azure][considerations].</span></span> 

## <a name="architecture"></a><span data-ttu-id="ab7c9-117">Architecture</span><span class="sxs-lookup"><span data-stu-id="ab7c9-117">Architecture</span></span>

<span data-ttu-id="ab7c9-118">L’architecture possède les composants suivants :</span><span class="sxs-lookup"><span data-stu-id="ab7c9-118">The architecture has the following components.</span></span>

* <span data-ttu-id="ab7c9-119">**Réseau local**.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-119">**On-premises network**.</span></span> <span data-ttu-id="ab7c9-120">Le réseau local contient ses propres forêt et domaines Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-120">The on-premises network contains its own Active Directory forest and domains.</span></span>
* <span data-ttu-id="ab7c9-121">**Serveurs Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-121">**Active Directory servers**.</span></span> <span data-ttu-id="ab7c9-122">Il s’agit de contrôleurs de domaine qui implémentent des services de domaine s’exécutant en tant que machines virtuelles dans le cloud.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-122">These are domain controllers implementing domain services running as VMs in the cloud.</span></span> <span data-ttu-id="ab7c9-123">Ces serveurs hébergent une forêt qui contient un ou plusieurs domaines, distincts de ceux situés dans l’environnement local.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-123">These servers host a forest containing one or more domains, separate from those located on-premises.</span></span>
* <span data-ttu-id="ab7c9-124">**Relation d’approbation à sens unique**.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-124">**One-way trust relationship**.</span></span> <span data-ttu-id="ab7c9-125">L’exemple dans le diagramme montre une approbation à sens unique entre le domaine dans Azure et le domaine local.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-125">The example in the diagram shows a one-way trust from the domain in Azure to the on-premises domain.</span></span> <span data-ttu-id="ab7c9-126">Cette relation permet aux utilisateurs locaux d’accéder aux ressources du domaine dans Azure, mais pas l’inverse.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-126">This relationship enables on-premises users to access resources in the domain in Azure, but not the other way around.</span></span> <span data-ttu-id="ab7c9-127">Il est possible de créer une approbation bidirectionnelle, si les utilisateurs du cloud requièrent également l’accès à des ressources locales.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-127">It is possible to create a two-way trust if cloud users also require access to on-premises resources.</span></span>
* <span data-ttu-id="ab7c9-128">**Sous-réseau Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-128">**Active Directory subnet**.</span></span> <span data-ttu-id="ab7c9-129">Les serveurs AD DS sont hébergés dans un sous-réseau distinct.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-129">The AD DS servers are hosted in a separate subnet.</span></span> <span data-ttu-id="ab7c9-130">Des règles de groupe de sécurité réseau (NSG) protègent les serveurs AD DS et fournissent un pare-feu contre le trafic en provenance de sources inconnues.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-130">Network security group (NSG) rules protect the AD DS servers and provide a firewall against traffic from unexpected sources.</span></span>
* <span data-ttu-id="ab7c9-131">**Passerelle Azure**.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-131">**Azure gateway**.</span></span> <span data-ttu-id="ab7c9-132">La passerelle Azure fournit une connexion entre le réseau local et le réseau virtuel Azure.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-132">The Azure gateway provides a connection between the on-premises network and the Azure VNet.</span></span> <span data-ttu-id="ab7c9-133">Il peut s’agir d’une [connexion VPN][azure-vpn-gateway] ou [d’Azure ExpressRoute][azure-expressroute].</span><span class="sxs-lookup"><span data-stu-id="ab7c9-133">This can be a [VPN connection][azure-vpn-gateway] or [Azure ExpressRoute][azure-expressroute].</span></span> <span data-ttu-id="ab7c9-134">Pour plus d’informations, consultez [Implémentation d’une architecture réseau hybride sécurisée dans Azure][implementing-a-secure-hybrid-network-architecture].</span><span class="sxs-lookup"><span data-stu-id="ab7c9-134">For more information, see [Implementing a secure hybrid network architecture in Azure][implementing-a-secure-hybrid-network-architecture].</span></span>

## <a name="recommendations"></a><span data-ttu-id="ab7c9-135">Recommandations</span><span class="sxs-lookup"><span data-stu-id="ab7c9-135">Recommendations</span></span>

<span data-ttu-id="ab7c9-136">Pour obtenir des recommandations spécifiques sur l’implémentation d’Active Directory dans Azure, consultez les articles suivants :</span><span class="sxs-lookup"><span data-stu-id="ab7c9-136">For specific recommendations on implementing Active Directory in Azure, see the following articles:</span></span>

- <span data-ttu-id="ab7c9-137">[Extension d’Active Directory Domain Services (AD DS) à Azure][adds-extend-domain].</span><span class="sxs-lookup"><span data-stu-id="ab7c9-137">[Extending Active Directory Domain Services (AD DS) to Azure][adds-extend-domain].</span></span> 
- <span data-ttu-id="ab7c9-138">[Recommandations pour déployer Windows Server Active Directory sur des machines virtuelles Azure][ad-azure-guidelines].</span><span class="sxs-lookup"><span data-stu-id="ab7c9-138">[Guidelines for Deploying Windows Server Active Directory on Azure Virtual Machines][ad-azure-guidelines].</span></span>

### <a name="trust"></a><span data-ttu-id="ab7c9-139">Trust</span><span class="sxs-lookup"><span data-stu-id="ab7c9-139">Trust</span></span>

<span data-ttu-id="ab7c9-140">Les domaines locaux sont contenus dans une forêt différente des domaines dans le cloud.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-140">The on-premises domains are contained within a different forest from the domains in the cloud.</span></span> <span data-ttu-id="ab7c9-141">Pour activer l’authentification des utilisateurs locaux dans le cloud, les domaines dans Azure doivent faire confiance au domaine d’ouverture de session dans la forêt locale.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-141">To enable authentication of on-premises users in the cloud, the domains in Azure must trust the logon domain in the on-premises forest.</span></span> <span data-ttu-id="ab7c9-142">De même, si le cloud fournit un domaine d’ouverture de session pour les utilisateurs externes, il peut être nécessaire que la forêt locale fasse confiance au domaine du cloud.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-142">Similarly, if the cloud provides a logon domain for external users, it may be necessary for the on-premises forest to trust the cloud domain.</span></span>

<span data-ttu-id="ab7c9-143">Vous pouvez établir des approbations au niveau forêt, en [créant des approbations de forêt][creating-forest-trusts], ou au niveau domaine, en [créant des approbations externes][creating-external-trusts].</span><span class="sxs-lookup"><span data-stu-id="ab7c9-143">You can establish trusts at the forest level by [creating forest trusts][creating-forest-trusts], or at the domain level by [creating external trusts][creating-external-trusts].</span></span> <span data-ttu-id="ab7c9-144">Une approbation de niveau forêt crée une relation entre tous les domaines dans deux forêts.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-144">A forest level trust creates a relationship between all domains in two forests.</span></span> <span data-ttu-id="ab7c9-145">Une approbation de niveau domaine externe crée uniquement une relation entre deux domaines spécifiés.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-145">An external domain level trust only creates a relationship between two specified domains.</span></span> <span data-ttu-id="ab7c9-146">Vous devez uniquement créer des approbations de niveau domaine externe entre des domaines dans des forêts différentes.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-146">You should only create external domain level trusts between domains in different forests.</span></span>

<span data-ttu-id="ab7c9-147">Les approbations peuvent être unidirectionnelles (à sens unique) ou bidirectionnelles :</span><span class="sxs-lookup"><span data-stu-id="ab7c9-147">Trusts can be unidirectional (one-way) or bidirectional (two-way):</span></span>

* <span data-ttu-id="ab7c9-148">Une approbation à sens unique permet aux utilisateurs d’une forêt ou domaine (forêt ou domaine *entrant*) d’accéder aux ressources contenues dans une autre forêt ou domaine (forêt ou domaine *sortant*).</span><span class="sxs-lookup"><span data-stu-id="ab7c9-148">A one-way trust enables users in one domain or forest (known as the *incoming* domain or forest) to access the resources held in another (the *outgoing* domain or forest).</span></span>
* <span data-ttu-id="ab7c9-149">Une approbation bidirectionnelle permet aux utilisateurs de l’un des domaines ou forêts d’accéder aux ressources contenues dans l’autre domaine ou forêt.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-149">A two-way trust enables users in either domain or forest to access resources held in the other.</span></span>

<span data-ttu-id="ab7c9-150">Le tableau suivant récapitule les configurations d’approbation pour certains scénarios simples :</span><span class="sxs-lookup"><span data-stu-id="ab7c9-150">The following table summarizes trust configurations for some simple scenarios:</span></span>

| <span data-ttu-id="ab7c9-151">Scénario</span><span class="sxs-lookup"><span data-stu-id="ab7c9-151">Scenario</span></span> | <span data-ttu-id="ab7c9-152">Approbation locale</span><span class="sxs-lookup"><span data-stu-id="ab7c9-152">On-premises trust</span></span> | <span data-ttu-id="ab7c9-153">Approbation au niveau du cloud</span><span class="sxs-lookup"><span data-stu-id="ab7c9-153">Cloud trust</span></span> |
| --- | --- | --- |
| <span data-ttu-id="ab7c9-154">Les utilisateurs locaux requièrent l’accès aux ressources dans le cloud, mais l’inverse n’est pas vrai.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-154">On-premises users require access to resources in the cloud, but not vice versa</span></span> |<span data-ttu-id="ab7c9-155">À sens unique, entrante</span><span class="sxs-lookup"><span data-stu-id="ab7c9-155">One-way, incoming</span></span> |<span data-ttu-id="ab7c9-156">À sens unique, sortante</span><span class="sxs-lookup"><span data-stu-id="ab7c9-156">One-way, outgoing</span></span> |
| <span data-ttu-id="ab7c9-157">Les utilisateurs dans le cloud requièrent l’accès aux ressources locales, mais l’inverse n’est pas vrai.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-157">Users in the cloud require access to resources located on-premises, but not vice versa</span></span> |<span data-ttu-id="ab7c9-158">À sens unique, sortante</span><span class="sxs-lookup"><span data-stu-id="ab7c9-158">One-way, outgoing</span></span> |<span data-ttu-id="ab7c9-159">À sens unique, entrante</span><span class="sxs-lookup"><span data-stu-id="ab7c9-159">One-way, incoming</span></span> |
| <span data-ttu-id="ab7c9-160">Les utilisateurs dans le cloud et locaux requièrent l’accès aux ressources contenues dans le cloud et locales.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-160">Users in the cloud and on-premises both requires access to resources held in the cloud and on-premises</span></span> |<span data-ttu-id="ab7c9-161">Bidirectionnelle, entrante et sortante</span><span class="sxs-lookup"><span data-stu-id="ab7c9-161">Two-way, incoming and outgoing</span></span> |<span data-ttu-id="ab7c9-162">Bidirectionnelle, entrante et sortante</span><span class="sxs-lookup"><span data-stu-id="ab7c9-162">Two-way, incoming and outgoing</span></span> |

## <a name="scalability-considerations"></a><span data-ttu-id="ab7c9-163">Considérations relatives à l’extensibilité</span><span class="sxs-lookup"><span data-stu-id="ab7c9-163">Scalability considerations</span></span>

<span data-ttu-id="ab7c9-164">Active Directory peut évoluer automatiquement pour les contrôleurs de domaine qui font partie du même domaine.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-164">Active Directory is automatically scalable for domain controllers that are part of the same domain.</span></span> <span data-ttu-id="ab7c9-165">Les demandes sont distribuées sur tous les contrôleurs d’un domaine.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-165">Requests are distributed across all controllers within a domain.</span></span> <span data-ttu-id="ab7c9-166">Vous pouvez ajouter un contrôleur de domaine, qui se synchronise alors automatiquement avec le domaine.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-166">You can add another domain controller, and it synchronizes automatically with the domain.</span></span> <span data-ttu-id="ab7c9-167">Ne configurez pas d’équilibreur de charge distinct pour diriger le trafic vers des contrôleurs dans le domaine.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-167">Do not configure a separate load balancer to direct traffic to controllers within the domain.</span></span> <span data-ttu-id="ab7c9-168">Vérifiez que tous les contrôleurs de domaine disposent de suffisamment de ressources mémoire et de stockage pour gérer la base de données du domaine.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-168">Ensure that all domain controllers have sufficient memory and storage resources to handle the domain database.</span></span> <span data-ttu-id="ab7c9-169">Attribuez la même taille aux machines virtuelles de contrôleur de domaine.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-169">Make all domain controller VMs the same size.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="ab7c9-170">Considérations relatives à la disponibilité</span><span class="sxs-lookup"><span data-stu-id="ab7c9-170">Availability considerations</span></span>

<span data-ttu-id="ab7c9-171">Provisionnez au moins deux contrôleurs de domaine par domaine.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-171">Provision at least two domain controllers for each domain.</span></span> <span data-ttu-id="ab7c9-172">Cela permet une réplication automatique entre les serveurs.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-172">This enables automatic replication between servers.</span></span> <span data-ttu-id="ab7c9-173">Créez un groupe à haute disponibilité pour les machines virtuelles faisant office de serveurs Active Directory chargés de gérer chaque domaine.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-173">Create an availability set for the VMs acting as Active Directory servers handling each domain.</span></span> <span data-ttu-id="ab7c9-174">Placez au moins deux serveurs dans ce groupe à haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-174">Put at least two servers in this availability set.</span></span>

<span data-ttu-id="ab7c9-175">Envisagez également de désigner un ou plusieurs serveurs dans chaque domaine en tant que [maîtres d’opérations en attente][standby-operations-masters] en cas d’échec de la connectivité à un serveur agissant en tant que rôle de FSMO (Flexible Single Master Operation).</span><span class="sxs-lookup"><span data-stu-id="ab7c9-175">Also, consider designating one or more servers in each domain as [standby operations masters][standby-operations-masters] in case connectivity to a server acting as a flexible single master operation (FSMO) role fails.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="ab7c9-176">Considérations relatives à la facilité de gestion</span><span class="sxs-lookup"><span data-stu-id="ab7c9-176">Manageability considerations</span></span>

<span data-ttu-id="ab7c9-177">Pour plus d’informations sur les considérations relatives à la gestion et à la surveillance, consultez [Extension d’Active Directory à Azure][adds-extend-domain].</span><span class="sxs-lookup"><span data-stu-id="ab7c9-177">For information about management and monitoring considerations, see [Extending Active Directory to Azure][adds-extend-domain].</span></span> 
 
<span data-ttu-id="ab7c9-178">Pour plus d’informations, consultez [Surveillance d’Active Directory][monitoring_ad].</span><span class="sxs-lookup"><span data-stu-id="ab7c9-178">For additional information, see [Monitoring Active Directory][monitoring_ad].</span></span> <span data-ttu-id="ab7c9-179">Vous pouvez installer des outils tels que [Microsoft Systems Center][microsoft_systems_center] sur un serveur de surveillance dans le sous-réseau de gestion pour effectuer ces tâches.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-179">You can install tools such as [Microsoft Systems Center][microsoft_systems_center] on a monitoring server in the management subnet to help perform these tasks.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="ab7c9-180">Considérations relatives à la sécurité</span><span class="sxs-lookup"><span data-stu-id="ab7c9-180">Security considerations</span></span>

<span data-ttu-id="ab7c9-181">Les approbations de niveau forêt sont transitives.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-181">Forest level trusts are transitive.</span></span> <span data-ttu-id="ab7c9-182">Si vous établissez une approbation de niveau forêt entre une forêt locale et une forêt dans le cloud, cette approbation est étendue aux autres domaines créés dans l’une ou l’autre des forêts.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-182">If you establish a forest level trust between an on-premises forest and a forest in the cloud, this trust is extended to other new domains created in either forest.</span></span> <span data-ttu-id="ab7c9-183">Si vous utilisez des domaines pour fournir une séparation à des fins de sécurité, envisagez de créer des approbations au niveau domaine uniquement.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-183">If you use domains to provide separation for security purposes, consider creating trusts at the domain level only.</span></span> <span data-ttu-id="ab7c9-184">Les approbations de niveau domaine sont non transitives.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-184">Domain level trusts are non-transitive.</span></span>

<span data-ttu-id="ab7c9-185">Pour connaître les considérations relatives à la sécurité propres à Active Directory, consultez la section sur les considérations relatives à la sécurité dans [Extension d’Active Directory à Azure][adds-extend-domain].</span><span class="sxs-lookup"><span data-stu-id="ab7c9-185">For Active Directory-specific security considerations, see the security considerations section in [Extending Active Directory to Azure][adds-extend-domain].</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="ab7c9-186">Déployer la solution</span><span class="sxs-lookup"><span data-stu-id="ab7c9-186">Deploy the solution</span></span>

<span data-ttu-id="ab7c9-187">Vous disposez d’une solution sur [GitHub][github] pour déployer cette architecture de référence.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-187">A solution is available on [GitHub][github] to deploy this reference architecture.</span></span> <span data-ttu-id="ab7c9-188">Vous avez besoin de la dernière version de l’interface de ligne de commande Azure pour exécuter le script PowerShell qui déploie la solution.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-188">You will need the latest version of the Azure CLI to run the Powershell script that deploys the solution.</span></span> <span data-ttu-id="ab7c9-189">Pour déployer l’architecture de référence, effectuez les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="ab7c9-189">To deploy the reference architecture, follow these steps:</span></span>

1. <span data-ttu-id="ab7c9-190">Téléchargez ou clonez le dossier de solution à partir de [GitHub][github] sur votre ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-190">Download or clone the solution folder from [GitHub][github] to your local machine.</span></span>

2. <span data-ttu-id="ab7c9-191">Ouvrez l’interface de ligne de commande Azure et accédez au dossier de solution local.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-191">Open the Azure CLI and navigate to the local solution folder.</span></span>

3. <span data-ttu-id="ab7c9-192">Exécutez la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="ab7c9-192">Run the following command:</span></span>
   
    ```Powershell
    .\Deploy-ReferenceArchitecture.ps1 <subscription id> <location> <mode>
    ```
   
    <span data-ttu-id="ab7c9-193">Remplacez `<subscription id>` par l’identifiant de votre abonnement Azure.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-193">Replace `<subscription id>` with your Azure subscription ID.</span></span>
   
    <span data-ttu-id="ab7c9-194">Pour `<location>`, spécifiez une région Azure, telle que `eastus` ou `westus`.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-194">For `<location>`, specify an Azure region, such as `eastus` or `westus`.</span></span>
   
    <span data-ttu-id="ab7c9-195">Le paramètre `<mode>` contrôle la granularité du déploiement, et peut prendre l’une des valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="ab7c9-195">The `<mode>` parameter controls the granularity of the deployment, and can be one of the following values:</span></span>
   
   * <span data-ttu-id="ab7c9-196">`Onpremise` : déploie l’environnement local simulé.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-196">`Onpremise`: deploys the simulated on-premises environment.</span></span>
   * <span data-ttu-id="ab7c9-197">`Infrastructure` : déploie l’infrastructure du réseau virtuel et le serveur de rebond sur Azure.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-197">`Infrastructure`: deploys the VNet infrastructure and jump box in Azure.</span></span>
   * <span data-ttu-id="ab7c9-198">`CreateVpn` : déploie la passerelle réseau virtuel Azure et la connecte au réseau local simulé.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-198">`CreateVpn`: deploys the Azure virtual network gateway and connects it to the simulated on-premises network.</span></span>
   * <span data-ttu-id="ab7c9-199">`AzureADDS` : déploie les machines virtuelles faisant office de serveurs Active Directory DS, déploie Active Directory sur ces machines virtuelles et déploie le domaine sur Azure.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-199">`AzureADDS`: deploys the VMs acting as Active Directory DS servers, deploys Active Directory to these VMs, and deploys the domain in Azure.</span></span>
   * <span data-ttu-id="ab7c9-200">`WebTier` : déploie l’équilibreur de charge et les machines virtuelles de niveau web.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-200">`WebTier`: deploys the web tier VMs and load balancer.</span></span>
   * <span data-ttu-id="ab7c9-201">`Prepare` : déploie tous les déploiements précédents.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-201">`Prepare`: deploys all of the preceding deployments.</span></span> <span data-ttu-id="ab7c9-202">**Il s’agit de l’option recommandée si vous n’avez pas de réseau local, mais que vous souhaitez déployer l’architecture de référence complète décrite ci-dessus à des fins de test ou d’évaluation.**</span><span class="sxs-lookup"><span data-stu-id="ab7c9-202">**This is the recommended option if If you do not have an existing on-premises network but you want to deploy the complete reference architecture described above for testing or evaluation.**</span></span> 
   * <span data-ttu-id="ab7c9-203">`Workload` : déploie les équilibreurs de charge et les machines virtuelles de niveau entreprise et données.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-203">`Workload`: deploys the business and data tier VMs and load balancers.</span></span> <span data-ttu-id="ab7c9-204">Notez que ces machines virtuelles ne sont pas incluses dans le déploiement `Prepare`.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-204">Note that these VMs are not included in the `Prepare` deployment.</span></span>

4. <span data-ttu-id="ab7c9-205">Attendez la fin du déploiement.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-205">Wait for the deployment to complete.</span></span> <span data-ttu-id="ab7c9-206">Si vous déployez le déploiement `Prepare`, l’opération prend plusieurs heures.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-206">If you are deploying the `Prepare` deployment, it will take several hours.</span></span>
     
5. <span data-ttu-id="ab7c9-207">Si vous utilisez la configuration locale simulée, configurez la relation d’approbation entrante :</span><span class="sxs-lookup"><span data-stu-id="ab7c9-207">If you are using the simulated on-premises configuration, configure the incoming trust relationship:</span></span>
   
   1. <span data-ttu-id="ab7c9-208">Connectez-vous au serveur de rebond (<em>ra-adtrust-mgmt-vm1</em> dans le groupe de ressources <em>ra-adtrust-security-rg</em>).</span><span class="sxs-lookup"><span data-stu-id="ab7c9-208">Connect to the jump box (<em>ra-adtrust-mgmt-vm1</em> in the <em>ra-adtrust-security-rg</em> resource group).</span></span> <span data-ttu-id="ab7c9-209">Connectez-vous en tant que <em>testuser</em> avec le mot de passe<em>AweS0me@PW</em>.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-209">Log in as <em>testuser</em> with password <em>AweS0me@PW</em>.</span></span>
   2. <span data-ttu-id="ab7c9-210">Sur le serveur de rebond, ouvrez une session RDP sur la première machine virtuelle dans le domaine <em>contoso.com</em> (le domaine local).</span><span class="sxs-lookup"><span data-stu-id="ab7c9-210">On the jump box open an RDP session on the first VM in the <em>contoso.com</em> domain (the on-premises domain).</span></span> <span data-ttu-id="ab7c9-211">Cette machine virtuelle possède l’adresse IP 192.168.0.4.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-211">This VM has the IP address 192.168.0.4.</span></span> <span data-ttu-id="ab7c9-212">Le nom d’utilisateur est <em>contoso\testuser</em>, et le mot de passe est <em>AweS0me@PW</em>.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-212">The username is <em>contoso\testuser</em> with password <em>AweS0me@PW</em>.</span></span>
   3. <span data-ttu-id="ab7c9-213">Téléchargez le script [incoming-trust.ps1][incoming-trust] et exécutez-le pour créer l’approbation entrante à partir du domaine *treyresearch.com*.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-213">Download the [incoming-trust.ps1][incoming-trust] script and run it to create the incoming trust from the *treyresearch.com* domain.</span></span>

6. <span data-ttu-id="ab7c9-214">Si vous utilisez votre propre infrastructure locale :</span><span class="sxs-lookup"><span data-stu-id="ab7c9-214">If you are using your own on-premises infrastructure:</span></span>
   
   1. <span data-ttu-id="ab7c9-215">Téléchargez le script [incoming-trust.ps1][incoming-trust].</span><span class="sxs-lookup"><span data-stu-id="ab7c9-215">Download the [incoming-trust.ps1][incoming-trust] script.</span></span>
   2. <span data-ttu-id="ab7c9-216">Modifiez le script et remplacez la valeur de la variable `$TrustedDomainName` par le nom de votre domaine.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-216">Edit the script and replace the value of the `$TrustedDomainName` variable with the name of your own domain.</span></span>
   3. <span data-ttu-id="ab7c9-217">Exécutez le script.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-217">Run the script.</span></span>

7. <span data-ttu-id="ab7c9-218">À partir du serveur de rebond, connectez-vous à la première machine virtuelle dans le domaine <em>treyresearch.com</em> (le domaine dans le cloud).</span><span class="sxs-lookup"><span data-stu-id="ab7c9-218">From the jump-box, connect to the first VM in the <em>treyresearch.com</em> domain (the domain in the cloud).</span></span> <span data-ttu-id="ab7c9-219">Cette machine virtuelle possède l’adresse IP 10.0.4.4.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-219">This VM has the IP address 10.0.4.4.</span></span> <span data-ttu-id="ab7c9-220">Le nom d’utilisateur est <em>treyresearch\testuser</em>, et le mot de passe est <em>AweS0me@PW</em>.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-220">The username is <em>treyresearch\testuser</em> with password <em>AweS0me@PW</em>.</span></span>

8. <span data-ttu-id="ab7c9-221">Téléchargez le script [outgoing-trust.ps1][outgoing-trust] et exécutez-le pour créer l’approbation sortante à partir du domaine *treyresearch.com*.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-221">Download the [outgoing-trust.ps1][outgoing-trust] script and run it to create the incoming trust from the *treyresearch.com* domain.</span></span> <span data-ttu-id="ab7c9-222">Si vous utilisez vos propres machines locales, commencez par modifier le script.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-222">If you are using your own on-premises machines, then edit the script first.</span></span> <span data-ttu-id="ab7c9-223">Définissez la variable `$TrustedDomainName` sur le nom de votre domaine local, puis spécifiez les adresses IP des serveurs Active Directory DS pour ce domaine dans la variable `$TrustedDomainDnsIpAddresses`.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-223">Set the `$TrustedDomainName` variable to the name of your on-premises domain, and specify the IP addresses of the Active Directory DS servers for this domain in the `$TrustedDomainDnsIpAddresses` variable.</span></span>

9. <span data-ttu-id="ab7c9-224">Patientez quelques minutes, puis connectez-vous à une machine virtuelle locale et effectuez les étapes décrites dans l’article [Vérifier une approbation][verify-a-trust] pour déterminer si la relation d’approbation entre les domaines *contoso.com* et *treyresearch.com* est configurée correctement.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-224">Wait a few minutes for the previous steps to complete, then connect to an on-premises VM and perform the steps outlined in the article [Verify a Trust][verify-a-trust] to determine whether the trust relationship between the *contoso.com* and *treyresearch.com* domains is correctly configured.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ab7c9-225">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="ab7c9-225">Next steps</span></span>

* <span data-ttu-id="ab7c9-226">Découvrez les bonnes pratiques pour [étendre votre domaine AD DS local à Azure][adds-extend-domain].</span><span class="sxs-lookup"><span data-stu-id="ab7c9-226">Learn the best practices for [extending your on-premises AD DS domain to Azure][adds-extend-domain]</span></span>
* <span data-ttu-id="ab7c9-227">Découvrez les bonnes pratiques pour [créer une infrastructure AD FS][adfs] dans Azure.</span><span class="sxs-lookup"><span data-stu-id="ab7c9-227">Learn the best practices for [creating an AD FS infrastructure][adfs] in Azure.</span></span>

<!-- links -->
[adds-extend-domain]: adds-extend-domain.md
[adfs]: adfs.md

[implementing-a-secure-hybrid-network-architecture]: ../dmz/secure-vnet-hybrid.md
[implementing-a-secure-hybrid-network-architecture-with-internet-access]: ../dmz/secure-vnet-dmz.md

[running-VMs-for-an-N-tier-architecture-on-Azure]: ../virtual-machines-windows/n-tier.md

[ad-azure-guidelines]: https://msdn.microsoft.com/library/azure/jj156090.aspx
[azure-expressroute]: https://azure.microsoft.com/documentation/articles/expressroute-introduction/
[azure-vpn-gateway]: https://azure.microsoft.com/documentation/articles/vpn-gateway-about-vpngateways/
[considerations]: ./considerations.md
[creating-external-trusts]: https://technet.microsoft.com/library/cc816837(v=ws.10).aspx
[creating-forest-trusts]: https://technet.microsoft.com/library/cc816810(v=ws.10).aspx
[github]: https://github.com/mspnp/reference-architectures/tree/master/identity/adds-forest
[incoming-trust]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/identity/adds-forest/extensions/incoming-trust.ps1
[microsoft_systems_center]: https://www.microsoft.com/server-cloud/products/system-center-2016/
[monitoring_ad]: https://msdn.microsoft.com/library/bb727046.aspx
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview
[solution-script]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/identity/adds-forest/Deploy-ReferenceArchitecture.ps1
[standby-operations-masters]: https://technet.microsoft.com/library/cc794737(v=ws.10).aspx
[outgoing-trust]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/identity/adds-forest/extensions/outgoing-trust.ps1
[verify-a-trust]: https://technet.microsoft.com/library/cc753821.aspx
[visio-download]: https://archcenter.blob.core.windows.net/cdn/identity-architectures.vsdx
[0]: ./images/adds-forest.png "Architecture réseau hybride sécurisée avec des domaines Active Directory distincts"