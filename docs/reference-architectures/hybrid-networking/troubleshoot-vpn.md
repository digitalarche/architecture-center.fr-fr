---
title: Résoudre les problèmes d’une connexion VPN hybride
titleSuffix: Azure Reference Architectures
description: Résolvez les problèmes d’une connexion de passerelle VPN entre un réseau local et Azure.
author: telmosampaio
ms.date: 10/08/2018
ms.openlocfilehash: 501429a614fb39177312a374c19ac40213234e42
ms.sourcegitcommit: 8d951fd7e9534054b160be48a1881ae0857561ef
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/13/2018
ms.locfileid: "53329464"
---
# <a name="troubleshoot-a-hybrid-vpn-connection"></a><span data-ttu-id="1fe7d-103">Résoudre les problèmes d’une connexion VPN hybride</span><span class="sxs-lookup"><span data-stu-id="1fe7d-103">Troubleshoot a hybrid VPN connection</span></span>

<span data-ttu-id="1fe7d-104">Cet article donne des conseils pour résoudre les problèmes d’une connexion de passerelle VPN entre un réseau local et Azure.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-104">This article gives some tips for troubleshooting a VPN gateway connection between an on-premises network and Azure.</span></span> <span data-ttu-id="1fe7d-105">Pour obtenir des informations générales sur la résolution des problèmes courants liés au VPN, voir la page correspondante ([Troubleshooting common VPN related errors][troubleshooting-vpn-errors]).</span><span class="sxs-lookup"><span data-stu-id="1fe7d-105">For general information on troubleshooting common VPN-related errors, see [Troubleshooting common VPN related errors][troubleshooting-vpn-errors].</span></span>

## <a name="verify-the-vpn-appliance-is-functioning-correctly"></a><span data-ttu-id="1fe7d-106">Vérifier que l’appliance VPN fonctionne correctement</span><span class="sxs-lookup"><span data-stu-id="1fe7d-106">Verify the VPN appliance is functioning correctly</span></span>

<span data-ttu-id="1fe7d-107">Les recommandations suivantes sont utiles pour déterminer si votre appliance VPN locale fonctionne correctement.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-107">The following recommendations are useful for determining if your on-premises VPN appliance is functioning correctly.</span></span>

<span data-ttu-id="1fe7d-108">**Vérifiez les fichiers journaux générés par l’appliance VPN pour les erreurs ou les échecs.**</span><span class="sxs-lookup"><span data-stu-id="1fe7d-108">**Check any log files generated by the VPN appliance for errors or failures.**</span></span> <span data-ttu-id="1fe7d-109">Cela vous aidera à déterminer si l’appliance VPN fonctionne correctement.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-109">This will help you determine if the VPN appliance is functioning correctly.</span></span> <span data-ttu-id="1fe7d-110">L’emplacement de ces informations varie en fonction de votre application.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-110">The location of this information will vary according to your appliance.</span></span> <span data-ttu-id="1fe7d-111">Par exemple, avec RRAS sur Windows Server 2012, vous pouvez utiliser la commande PowerShell suivante pour afficher des informations sur les événements d’erreur du service RRAS :</span><span class="sxs-lookup"><span data-stu-id="1fe7d-111">For example, if you are using RRAS on Windows Server 2012, you can use the following PowerShell command to display error event information for the RRAS service:</span></span>

```PowerShell
Get-EventLog -LogName System -EntryType Error -Source RemoteAccess | Format-List -Property *
```

<span data-ttu-id="1fe7d-112">La propriété *Message* de chaque entrée fournit une description de l’erreur.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-112">The *Message* property of each entry provides a description of the error.</span></span> <span data-ttu-id="1fe7d-113">Voici quelques exemples courants :</span><span class="sxs-lookup"><span data-stu-id="1fe7d-113">Some common examples are:</span></span>

- <span data-ttu-id="1fe7d-114">Connexion impossible, probablement en raison d’une adresse IP incorrecte spécifiée pour la passerelle VPN Azure dans la configuration de l’interface réseau VPN RRAS</span><span class="sxs-lookup"><span data-stu-id="1fe7d-114">Inability to connect, possibly due to an incorrect IP address specified for the Azure VPN gateway in the RRAS VPN network interface configuration.</span></span>

  ```console
  EventID            : 20111
  MachineName        : on-prem-vm
  Data               : {41, 3, 0, 0}
  Index              : 14231
  Category           : (0)
  CategoryNumber     : 0
  EntryType          : Error
  Message            : RoutingDomainID- {00000000-0000-0000-0000-000000000000}: A demand dial connection to the remote
                          interface AzureGateway on port VPN2-4 was successfully initiated but failed to complete
                          successfully because of the  following error: The network connection between your computer and
                          the VPN server could not be established because the remote server is not responding. This could
                          be because one of the network devices (for example, firewalls, NAT, routers, and so on) between your computer
                          and the remote server is not configured to allow VPN connections. Please contact your
                          Administrator or your service provider to determine which device may be causing the problem.
  Source             : RemoteAccess
  ReplacementStrings : {{00000000-0000-0000-0000-000000000000}, AzureGateway, VPN2-4, The network connection between
                          your computer and the VPN server could not be established because the remote server is not
                          responding. This could be because one of the network devices (for example, firewalls, NAT, routers, and so on)
                          between your computer and the remote server is not configured to allow VPN connections. Please
                          contact your Administrator or your service provider to determine which device may be causing the
                          problem.}
  InstanceId         : 20111
  TimeGenerated      : 3/18/2016 1:26:02 PM
  TimeWritten        : 3/18/2016 1:26:02 PM
  UserName           :
  Site               :
  Container          :
  ```

- <span data-ttu-id="1fe7d-115">Spécification d’une clé partagée incorrecte dans la configuration de l’interface réseau VPN RRAS</span><span class="sxs-lookup"><span data-stu-id="1fe7d-115">The wrong shared key being specified in the RRAS VPN network interface configuration.</span></span>

  ```console
  EventID            : 20111
  MachineName        : on-prem-vm
  Data               : {233, 53, 0, 0}
  Index              : 14245
  Category           : (0)
  CategoryNumber     : 0
  EntryType          : Error
  Message            : RoutingDomainID- {00000000-0000-0000-0000-000000000000}: A demand dial connection to the remote
                          interface AzureGateway on port VPN2-4 was successfully initiated but failed to complete
                          successfully because of the  following error: Internet key exchange (IKE) authentication credentials are unacceptable.

  Source             : RemoteAccess
  ReplacementStrings : {{00000000-0000-0000-0000-000000000000}, AzureGateway, VPN2-4, IKE authentication credentials are
                          unacceptable.
                          }
  InstanceId         : 20111
  TimeGenerated      : 3/18/2016 1:34:22 PM
  TimeWritten        : 3/18/2016 1:34:22 PM
  UserName           :
  Site               :
  Container          :
  ```

<span data-ttu-id="1fe7d-116">Vous pouvez également obtenir des informations de journal des événements sur les tentatives de connexion via le service RRAS à l’aide de la commande PowerShell suivante :</span><span class="sxs-lookup"><span data-stu-id="1fe7d-116">You can also obtain event log information about attempts to connect through the RRAS service using the following PowerShell command:</span></span>

```powershell
Get-EventLog -LogName Application -Source RasClient | Format-List -Property *
```

<span data-ttu-id="1fe7d-117">En cas d’échec de connexion, ce fichier journal contient des erreurs semblables à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="1fe7d-117">In the event of a failure to connect, this log will contain errors that look similar to the following:</span></span>

```console
EventID            : 20227
MachineName        : on-prem-vm
Data               : {}
Index              : 4203
Category           : (0)
CategoryNumber     : 0
EntryType          : Error
Message            : CoId={B4000371-A67F-452F-AA4C-3125AA9CFC78}: The user SYSTEM dialed a connection named
                        AzureGateway that has failed. The error code returned on failure is 809.
Source             : RasClient
ReplacementStrings : {{B4000371-A67F-452F-AA4C-3125AA9CFC78}, SYSTEM, AzureGateway, 809}
InstanceId         : 20227
TimeGenerated      : 3/18/2016 1:29:21 PM
TimeWritten        : 3/18/2016 1:29:21 PM
UserName           :
Site               :
Container          :
```

## <a name="verify-connectivity"></a><span data-ttu-id="1fe7d-118">Vérifier la connectivité</span><span class="sxs-lookup"><span data-stu-id="1fe7d-118">Verify connectivity</span></span>

<span data-ttu-id="1fe7d-119">**Vérifiez la connectivité et le routage sur la passerelle VPN.**</span><span class="sxs-lookup"><span data-stu-id="1fe7d-119">**Verify connectivity and routing across the VPN gateway.**</span></span> <span data-ttu-id="1fe7d-120">L’appliance VPN n’achemine peut-être pas correctement le trafic via la passerelle VPN Azure.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-120">The VPN appliance may not be correctly routing traffic through the Azure VPN Gateway.</span></span> <span data-ttu-id="1fe7d-121">Utilisez un outil tel que [PsPing][psping] pour vérifier la connectivité et le routage sur la passerelle VPN.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-121">Use a tool such as [PsPing][psping] to verify connectivity and routing across the VPN gateway.</span></span> <span data-ttu-id="1fe7d-122">Par exemple, pour tester la connectivité d’un ordinateur local à un serveur web situé sur le réseau virtuel, exécutez la commande suivante (en remplaçant `<<web-server-address>>` par l’adresse du serveur web) :</span><span class="sxs-lookup"><span data-stu-id="1fe7d-122">For example, to test connectivity from an on-premises machine to a web server located on the VNet, run the following command (replacing `<<web-server-address>>` with the address of the web server):</span></span>

```console
PsPing -t <<web-server-address>>:80
```

<span data-ttu-id="1fe7d-123">Si l’ordinateur local peut acheminer le trafic vers le serveur web, vous devriez obtenir une sortie de ce type :</span><span class="sxs-lookup"><span data-stu-id="1fe7d-123">If the on-premises machine can route traffic to the web server, you should see output similar to the following:</span></span>

```console
D:\PSTools>psping -t 10.20.0.5:80

PsPing v2.01 - PsPing - ping, latency, bandwidth measurement utility
Copyright (C) 2012-2014 Mark Russinovich
Sysinternals - www.sysinternals.com

TCP connect to 10.20.0.5:80:
Infinite iterations (warmup 1) connecting test:
Connecting to 10.20.0.5:80 (warmup): 6.21ms
Connecting to 10.20.0.5:80: 3.79ms
Connecting to 10.20.0.5:80: 3.44ms
Connecting to 10.20.0.5:80: 4.81ms

    Sent = 3, Received = 3, Lost = 0 (0% loss),
    Minimum = 3.44ms, Maximum = 4.81ms, Average = 4.01ms
```

<span data-ttu-id="1fe7d-124">Si l’ordinateur local ne peut pas communiquer avec la destination spécifiée, vous verrez des messages de ce type :</span><span class="sxs-lookup"><span data-stu-id="1fe7d-124">If the on-premises machine cannot communicate with the specified destination, you will see messages like this:</span></span>

```console
D:\PSTools>psping -t 10.20.1.6:80

PsPing v2.01 - PsPing - ping, latency, bandwidth measurement utility
Copyright (C) 2012-2014 Mark Russinovich
Sysinternals - www.sysinternals.com

TCP connect to 10.20.1.6:80:
Infinite iterations (warmup 1) connecting test:
Connecting to 10.20.1.6:80 (warmup): This operation returned because the timeout period expired.
Connecting to 10.20.1.6:80: This operation returned because the timeout period expired.
Connecting to 10.20.1.6:80: This operation returned because the timeout period expired.
Connecting to 10.20.1.6:80: This operation returned because the timeout period expired.
Connecting to 10.20.1.6:80:
    Sent = 3, Received = 0, Lost = 3 (100% loss),
    Minimum = 0.00ms, Maximum = 0.00ms, Average = 0.00ms
```

<span data-ttu-id="1fe7d-125">**Vérifiez que le pare-feu local autorise le passage du trafic VPN et que les ports appropriés sont ouverts.**</span><span class="sxs-lookup"><span data-stu-id="1fe7d-125">**Verify that the on-premises firewall allows VPN traffic to pass and that the correct ports are opened.**</span></span>

<span data-ttu-id="1fe7d-126">**Vérifiez que l’appliance VPN locale utilise une méthode de chiffrement compatible avec la passerelle VPN Azure.**</span><span class="sxs-lookup"><span data-stu-id="1fe7d-126">**Verify that the on-premises VPN appliance uses an encryption method that is compatible with the Azure VPN gateway.**</span></span> <span data-ttu-id="1fe7d-127">Pour le routage basé sur des stratégies, la passerelle VPN Azure prend en charge les algorithmes de chiffrement AES256, AES128 et 3DES.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-127">For policy-based routing, the Azure VPN gateway supports the AES256, AES128, and 3DES encryption algorithms.</span></span> <span data-ttu-id="1fe7d-128">Les passerelles basées sur des itinéraires prennent en charge AES256 et 3DES.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-128">Route-based gateways support AES256 and 3DES.</span></span> <span data-ttu-id="1fe7d-129">Pour plus d’informations, consultez [À propos des appareils VPN et des paramètres IPsec/IKE pour les connexions de passerelle VPN site à site][vpn-appliance].</span><span class="sxs-lookup"><span data-stu-id="1fe7d-129">For more information, see [About VPN devices and IPsec/IKE parameters for Site-to-Site VPN Gateway connections][vpn-appliance].</span></span>

## <a name="check-for-problems-with-the-azure-vpn-gateway"></a><span data-ttu-id="1fe7d-130">Vérifier l’existence de problèmes liés à la passerelle VPN Azure</span><span class="sxs-lookup"><span data-stu-id="1fe7d-130">Check for problems with the Azure VPN gateway</span></span>

<span data-ttu-id="1fe7d-131">Les recommandations suivantes sont utiles pour déterminer s’il existe un problème avec la passerelle VPN Azure :</span><span class="sxs-lookup"><span data-stu-id="1fe7d-131">The following recommendations are useful for determining if there is a problem with the Azure VPN gateway:</span></span>

<span data-ttu-id="1fe7d-132">**Examinez les journaux de diagnostic de la passerelle VPN Azure à la recherche de problèmes éventuels.**</span><span class="sxs-lookup"><span data-stu-id="1fe7d-132">**Examine Azure VPN gateway diagnostic logs for potential issues.**</span></span> <span data-ttu-id="1fe7d-133">Consultez [Step-by-Step: Capturing Azure Resource Manager VNET Gateway Diagnostic Logs][gateway-diagnostic-logs].</span><span class="sxs-lookup"><span data-stu-id="1fe7d-133">See [Step-by-Step: Capturing Azure Resource Manager VNET Gateway Diagnostic Logs][gateway-diagnostic-logs].</span></span>

<span data-ttu-id="1fe7d-134">**Vérifiez que la passerelle VPN Azure et l’appliance VPN locale sont configurées avec la même clé d’authentification partagée.**</span><span class="sxs-lookup"><span data-stu-id="1fe7d-134">**Verify that the Azure VPN gateway and on-premises VPN appliance are configured with the same shared authentication key.**</span></span> <span data-ttu-id="1fe7d-135">Vous pouvez afficher la clé partagée stockée par la passerelle VPN Azure à l’aide de la commande CLI Azure suivante :</span><span class="sxs-lookup"><span data-stu-id="1fe7d-135">You can view the shared key stored by the Azure VPN gateway using the following Azure CLI command:</span></span>

```azurecli
azure network vpn-connection shared-key show <<resource-group>> <<vpn-connection-name>>
```

<span data-ttu-id="1fe7d-136">Utilisez la commande appropriée pour votre appliance VPN locale afin d’afficher la clé partagée configurée pour cette application.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-136">Use the command appropriate for your on-premises VPN appliance to show the shared key configured for that appliance.</span></span>

<span data-ttu-id="1fe7d-137">Vérifiez que le sous-réseau *GatewaySubnet* contenant la passerelle VPN Azure n’est pas associé à un groupe de sécurité réseau.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-137">Verify that the *GatewaySubnet* subnet holding the Azure VPN gateway is not associated with an NSG.</span></span>

<span data-ttu-id="1fe7d-138">Vous pouvez afficher les détails du sous-réseau à l’aide de la commande CLI Azure suivante :</span><span class="sxs-lookup"><span data-stu-id="1fe7d-138">You can view the subnet details using the following Azure CLI command:</span></span>

```azurecli
azure network vnet subnet show -g <<resource-group>> -e <<vnet-name>> -n GatewaySubnet
```

<span data-ttu-id="1fe7d-139">Vérifiez qu’il n’existe aucun champ de données nommé *Network Security Group ID*.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-139">Ensure there is no data field named *Network Security Group ID*.</span></span> <span data-ttu-id="1fe7d-140">L’exemple suivant montre les résultats pour une instance du sous-réseau *GatewaySubnet* à laquelle est affectée un groupe de sécurité réseau (*VPN-Gateway-Group*).</span><span class="sxs-lookup"><span data-stu-id="1fe7d-140">The following example shows the results for an instance of the *GatewaySubnet* that has an assigned NSG (*VPN-Gateway-Group*).</span></span> <span data-ttu-id="1fe7d-141">Cela peut empêcher la passerelle de fonctionner correctement si les règles sont définies pour ce groupe de sécurité réseau.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-141">This can prevent the gateway from working correctly if there are any rules defined for this NSG.</span></span>

```console
C:\>azure network vnet subnet show -g profx-prod-rg -e profx-vnet -n GatewaySubnet
    info:    Executing command network vnet subnet show
    + Looking up virtual network "profx-vnet"
    + Looking up the subnet "GatewaySubnet"
    data:    Id                              : /subscriptions/########-####-####-####-############/resourceGroups/profx-prod-rg/providers/Microsoft.Network/virtualNetworks/profx-vnet/subnets/GatewaySubnet
    data:    Name                            : GatewaySubnet
    data:    Provisioning state              : Succeeded
    data:    Address prefix                  : 10.20.3.0/27
    data:    Network Security Group id       : /subscriptions/########-####-####-####-############/resourceGroups/profx-prod-rg/providers/Microsoft.Network/networkSecurityGroups/VPN-Gateway-Group
    info:    network vnet subnet show command OK
```

<span data-ttu-id="1fe7d-142">**Vérifiez que les machines virtuelles du réseau virtuel Azure sont configurés pour autoriser le trafic provenant de l’extérieur du réseau virtuel.**</span><span class="sxs-lookup"><span data-stu-id="1fe7d-142">**Verify that the virtual machines in the Azure VNet are configured to permit traffic coming in from outside the VNet.**</span></span> <span data-ttu-id="1fe7d-143">Vérifiez toutes les règles du groupe de sécurité réseau associées aux sous-réseaux contenant ces machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-143">Check any NSG rules associated with subnets containing these virtual machines.</span></span> <span data-ttu-id="1fe7d-144">Vous pouvez afficher toutes les règles du groupe de sécurité réseau à l’aide de la commande CLI Azure suivante :</span><span class="sxs-lookup"><span data-stu-id="1fe7d-144">You can view all NSG rules using the following Azure CLI command:</span></span>

```azurecli
azure network nsg show -g <<resource-group>> -n <<nsg-name>>
```

<span data-ttu-id="1fe7d-145">**Vérifiez que la passerelle VPN Azure est connectée.**</span><span class="sxs-lookup"><span data-stu-id="1fe7d-145">**Verify that the Azure VPN gateway is connected.**</span></span> <span data-ttu-id="1fe7d-146">Vous pouvez utiliser la commande Azure PowerShell suivante pour vérifier l’état actuel de la connexion VPN Azure.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-146">You can use the following Azure PowerShell command to check the current status of the Azure VPN connection.</span></span> <span data-ttu-id="1fe7d-147">Le paramètre `<<connection-name>>` est le nom de la connexion VPN Azure qui relie la passerelle du réseau virtuel et la passerelle locale.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-147">The `<<connection-name>>` parameter is the name of the Azure VPN connection that links the virtual network gateway and the local gateway.</span></span>

```powershell
Get-AzureRmVirtualNetworkGatewayConnection -Name <<connection-name>> - ResourceGroupName <<resource-group>>
```

<span data-ttu-id="1fe7d-148">Les extraits de code suivants montrent la sortie générée si la passerelle est connectée (premier exemple) et déconnectée (second exemple) :</span><span class="sxs-lookup"><span data-stu-id="1fe7d-148">The following snippets highlight the output generated if the gateway is connected (the first example), and disconnected (the second example):</span></span>

```powershell
PS C:\> Get-AzureRmVirtualNetworkGatewayConnection -Name profx-gateway-connection -ResourceGroupName profx-prod-rg

AuthorizationKey           :
VirtualNetworkGateway1     : Microsoft.Azure.Commands.Network.Models.PSVirtualNetworkGateway
VirtualNetworkGateway2     :
LocalNetworkGateway2       : Microsoft.Azure.Commands.Network.Models.PSLocalNetworkGateway
Peer                       :
ConnectionType             : IPsec
RoutingWeight              : 0
SharedKey                  : ####################################
ConnectionStatus           : Connected
EgressBytesTransferred     : 55254803
IngressBytesTransferred    : 32227221
ProvisioningState          : Succeeded
...
```

```powershell
PS C:\> Get-AzureRmVirtualNetworkGatewayConnection -Name profx-gateway-connection2 -ResourceGroupName profx-prod-rg

AuthorizationKey           :
VirtualNetworkGateway1     : Microsoft.Azure.Commands.Network.Models.PSVirtualNetworkGateway
VirtualNetworkGateway2     :
LocalNetworkGateway2       : Microsoft.Azure.Commands.Network.Models.PSLocalNetworkGateway
Peer                       :
ConnectionType             : IPsec
RoutingWeight              : 0
SharedKey                  : ####################################
ConnectionStatus           : NotConnected
EgressBytesTransferred     : 0
IngressBytesTransferred    : 0
ProvisioningState          : Succeeded
...
```

## <a name="miscellaneous-issues"></a><span data-ttu-id="1fe7d-149">Problèmes divers</span><span class="sxs-lookup"><span data-stu-id="1fe7d-149">Miscellaneous issues</span></span>

<span data-ttu-id="1fe7d-150">Les recommandations suivantes sont utiles pour déterminer s’il existe un problème avec la configuration de machine virtuelle hôte, l’utilisation de la bande passante réseau ou les performances des applications :</span><span class="sxs-lookup"><span data-stu-id="1fe7d-150">The following recommendations are useful for determining if there is an issue with Host VM configuration, network bandwidth utilization, or application performance:</span></span>

<span data-ttu-id="1fe7d-151">**Vérifiez la configuration du pare-feu.**</span><span class="sxs-lookup"><span data-stu-id="1fe7d-151">**Verify firewall configuration.**</span></span> <span data-ttu-id="1fe7d-152">Vérifiez que le pare-feu du système d’exploitation invité s’exécutant sur des machines virtuelles Azure dans le sous-réseau est correctement configuré pour permettre le trafic autorisé provenant des plages d’adresses IP locales.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-152">Verify that the firewall in the guest operating system running on the Azure VMs in the subnet is configured correctly to allow permitted traffic from the on-premises IP ranges.</span></span>

<span data-ttu-id="1fe7d-153">**Vérifiez que le volume de trafic n’est pas proche de la limite de la bande passante disponible pour la passerelle VPN Azure.**</span><span class="sxs-lookup"><span data-stu-id="1fe7d-153">**Verify that the volume of traffic is not close to the limit of the bandwidth available to the Azure VPN gateway.**</span></span> <span data-ttu-id="1fe7d-154">La façon de vérifier cela dépend de l’appliance VPN exécutée localement.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-154">How to verify this depends on the VPN appliance running on-premises.</span></span> <span data-ttu-id="1fe7d-155">Par exemple, avec RRAS sur Windows Server 2012, vous pouvez utiliser l’Analyseur de performances pour suivre le volume de données reçues et transmises sur la connexion VPN.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-155">For example, if you are using RRAS on Windows Server 2012, you can use Performance Monitor to track the volume of data being received and transmitted over the VPN connection.</span></span> <span data-ttu-id="1fe7d-156">À l’aide de l’objet *RAS Total*, sélectionnez les compteurs d’*octets reçus par seconde* et d’*octets transmis par seconde* :</span><span class="sxs-lookup"><span data-stu-id="1fe7d-156">Using the *RAS Total* object, select the *Bytes Received/Sec* and *Bytes Transmitted/Sec* counters:</span></span>

![Compteurs de performances pour superviser le trafic du réseau VPN](../_images/guidance-hybrid-network-vpn/RRAS-perf-counters.png)

<span data-ttu-id="1fe7d-158">Vous devez comparer les résultats à la bande passante disponible pour la passerelle VPN (de 100 Mbits/s pour les références de base à 1,25 Gbits/s pour la référence VpnGw3) :</span><span class="sxs-lookup"><span data-stu-id="1fe7d-158">You should compare the results with the bandwidth available to the VPN gateway (from 100 Mbps for the Basic SKU to 1.25 Gbps for VpnGw3 SKU):</span></span>

![Exemple de graphique de performances du réseau VPN](../_images/guidance-hybrid-network-vpn/RRAS-perf-graph.png)

<span data-ttu-id="1fe7d-160">**Vérifiez que vous avez déployé le nombre approprié de machines virtuelles, avec la taille correcte, pour votre charge applicative.**</span><span class="sxs-lookup"><span data-stu-id="1fe7d-160">**Verify that you have deployed the right number and size of VMs for your application load.**</span></span> <span data-ttu-id="1fe7d-161">Déterminez si toutes les machines virtuelles du réseau virtuel Azure s’exécutent lentement.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-161">Determine if any of the virtual machines in the Azure VNet are running slowly.</span></span> <span data-ttu-id="1fe7d-162">Si c’est le cas, elles peuvent être surchargées, c’est-à-dire pas assez nombreuses pour gérer la charge, ou les équilibreurs de charge ne sont pas configurés correctement.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-162">If so, they may be overloaded, there may be too few to handle the load, or the load-balancers may not be configured correctly.</span></span> <span data-ttu-id="1fe7d-163">Pour le déterminer, [capturez et analysez les informations de diagnostic][azure-vm-diagnostics].</span><span class="sxs-lookup"><span data-stu-id="1fe7d-163">To determine this, [capture and analyze diagnostic information][azure-vm-diagnostics].</span></span> <span data-ttu-id="1fe7d-164">Vous pouvez examiner les résultats à l’aide du portail Azure, mais de nombreux outils tiers sont également disponibles pour obtenir des informations détaillées sur les données de performances.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-164">You can examine the results using the Azure portal, but many third-party tools are also available that can provide detailed insights into the performance data.</span></span>

<span data-ttu-id="1fe7d-165">**Vérifiez que l’application utilise efficacement les ressources cloud.**</span><span class="sxs-lookup"><span data-stu-id="1fe7d-165">**Verify that the application is making efficient use of cloud resources.**</span></span> <span data-ttu-id="1fe7d-166">Servez-vous du code d’application en cours d’exécution sur chaque machine virtuelle afin de déterminer si les applications font un usage optimal des ressources.</span><span class="sxs-lookup"><span data-stu-id="1fe7d-166">Instrument application code running on each VM to determine whether applications are making the best use of resources.</span></span> <span data-ttu-id="1fe7d-167">Vous pouvez utiliser des outils tels qu’[Application Insights][application-insights].</span><span class="sxs-lookup"><span data-stu-id="1fe7d-167">You can use tools such as [Application Insights][application-insights].</span></span>

<!-- links -->

[application-insights]: /azure/application-insights/app-insights-overview-usage
[azure-vm-diagnostics]: https://azure.microsoft.com/blog/windows-azure-virtual-machine-monitoring-with-wad-extension/
[gateway-diagnostic-logs]: https://blogs.technet.microsoft.com/keithmayer/2016/10/12/step-by-step-capturing-azure-resource-manager-arm-vnet-gateway-diagnostic-logs/
[psping]: https://technet.microsoft.com/sysinternals/jj729731.aspx
[troubleshooting-vpn-errors]: https://blogs.technet.microsoft.com/rrasblog/2009/08/12/troubleshooting-common-vpn-related-errors/
[vpn-appliance]: /azure/vpn-gateway/vpn-gateway-about-vpn-devices
