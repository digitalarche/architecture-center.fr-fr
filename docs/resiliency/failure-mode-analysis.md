---
title: "Analyse du mode d’échec"
description: "Instructions pour effectuer l’analyse du mode d’échec pour les solutions cloud basées sur Azure."
author: MikeWasson
ms.date: 03/24/2017
ms.custom: resiliency
pnp.series.title: Design for Resiliency
ms.openlocfilehash: aca2088cb007728c5717a968969000c0a19bcd07
ms.sourcegitcommit: a7aae13569e165d4e768ce0aaaac154ba612934f
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/30/2018
---
# <a name="failure-mode-analysis"></a><span data-ttu-id="99baf-103">Analyse du mode d’échec</span><span class="sxs-lookup"><span data-stu-id="99baf-103">Failure mode analysis</span></span>
[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="99baf-104">L’analyse du mode d’échec (FMA) est un processus de création de résilience dans un système, en identifiant les points de défaillance possibles.</span><span class="sxs-lookup"><span data-stu-id="99baf-104">Failure mode analysis (FMA) is a process for building resiliency into a system, by identifying possible failure points in the system.</span></span> <span data-ttu-id="99baf-105">La FMA doit faire partie des phases de conception et d’architecture, afin que vous puissiez générer une récupération après une défaillance dans le système depuis le début.</span><span class="sxs-lookup"><span data-stu-id="99baf-105">The FMA should be part of the architecture and design phases, so that you can build failure recovery into the system from the beginning.</span></span>

<span data-ttu-id="99baf-106">Voici le processus général pour effectuer une FMA :</span><span class="sxs-lookup"><span data-stu-id="99baf-106">Here is the general process to conduct an FMA:</span></span>

1. <span data-ttu-id="99baf-107">Identifiez tous les composants dans le système.</span><span class="sxs-lookup"><span data-stu-id="99baf-107">Identify all of the components in the system.</span></span> <span data-ttu-id="99baf-108">Incluez les dépendances externes, telles que les fournisseurs d’identité, les services tiers et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="99baf-108">Include external dependencies, such as as identity providers, third-party services, and so on.</span></span>   
2. <span data-ttu-id="99baf-109">Pour chaque composant, identifiez les défaillances qui peuvent se produire.</span><span class="sxs-lookup"><span data-stu-id="99baf-109">For each component, identify potential failures that could occur.</span></span> <span data-ttu-id="99baf-110">Un seul composant peut avoir plusieurs modes d’échec.</span><span class="sxs-lookup"><span data-stu-id="99baf-110">A single component may have more than one failure mode.</span></span> <span data-ttu-id="99baf-111">Par exemple, vous devriez prendre en compte séparément les échecs de lecture et d’écriture, car les solutions et les impacts possibles seront différents.</span><span class="sxs-lookup"><span data-stu-id="99baf-111">For example, you should consider read failures and write failures separately, because the impact and possible mitigations will be different.</span></span>
3. <span data-ttu-id="99baf-112">Évaluez chaque mode d’échec en fonction de son niveau de risque global.</span><span class="sxs-lookup"><span data-stu-id="99baf-112">Rate each failure mode according to its overall risk.</span></span> <span data-ttu-id="99baf-113">Tenez compte de ces facteurs :</span><span class="sxs-lookup"><span data-stu-id="99baf-113">Consider these factors:</span></span>  

   * <span data-ttu-id="99baf-114">Quelle est la probabilité de l’échec.</span><span class="sxs-lookup"><span data-stu-id="99baf-114">What is the likelihood of the failure.</span></span> <span data-ttu-id="99baf-115">Est-il relativement courant ?</span><span class="sxs-lookup"><span data-stu-id="99baf-115">Is it relatively common?</span></span> <span data-ttu-id="99baf-116">Très rare ?</span><span class="sxs-lookup"><span data-stu-id="99baf-116">Extrememly rare?</span></span> <span data-ttu-id="99baf-117">Vous n’avez pas besoin de chiffres exacts, le but est d’aider à classer par ordre priorité.</span><span class="sxs-lookup"><span data-stu-id="99baf-117">You don't need exact numbers; the purpose is to help rank the priority.</span></span>
   * <span data-ttu-id="99baf-118">Quel est l’impact sur l’application, en termes de disponibilité, de pertes de données, de coût monétaire et d’interruption de service ?</span><span class="sxs-lookup"><span data-stu-id="99baf-118">What is the impact on the application, in terms of availability, data loss, monetary cost, and business disruption?</span></span>
4. <span data-ttu-id="99baf-119">Pour chaque mode de défaillance, déterminez comment l’application va répondre et récupérer.</span><span class="sxs-lookup"><span data-stu-id="99baf-119">For each failure mode, determine how the application will respond and recover.</span></span> <span data-ttu-id="99baf-120">Étudiez les compromis au niveau du le coût et de la complexité de l’application.</span><span class="sxs-lookup"><span data-stu-id="99baf-120">Consider tradeoffs in cost and application complexity.</span></span>   

<span data-ttu-id="99baf-121">Point de départ pour votre processus FMA, cet article contient un catalogue des modes de défaillance potentiels et les mesures de corrections associées.</span><span class="sxs-lookup"><span data-stu-id="99baf-121">As a starting point for your FMA process, this article contains a catalog of potential failure modes and their mitigations.</span></span> <span data-ttu-id="99baf-122">Le catalogue est organisé par technologie ou service Azure, ainsi qu’une catégorie générale pour la conception au niveau de l’application.</span><span class="sxs-lookup"><span data-stu-id="99baf-122">The catalog is organized by technology or Azure service, plus a general category for application-level design.</span></span> <span data-ttu-id="99baf-123">Le catalogue n’est pas exhaustif, mais traite beaucoup des principaux services Azure.</span><span class="sxs-lookup"><span data-stu-id="99baf-123">The catalog is not exhaustive, but covers many of the core Azure services.</span></span>

## <a name="app-service"></a><span data-ttu-id="99baf-124">App Service</span><span class="sxs-lookup"><span data-stu-id="99baf-124">App Service</span></span>
### <a name="app-service-app-shuts-down"></a><span data-ttu-id="99baf-125">L’application App Service s’arrête.</span><span class="sxs-lookup"><span data-stu-id="99baf-125">App Service app shuts down.</span></span>
<span data-ttu-id="99baf-126">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-126">**Detection**.</span></span> <span data-ttu-id="99baf-127">Causes possibles :</span><span class="sxs-lookup"><span data-stu-id="99baf-127">Possible causes:</span></span>

* <span data-ttu-id="99baf-128">Arrêt planifié</span><span class="sxs-lookup"><span data-stu-id="99baf-128">Expected shutdown</span></span>

  * <span data-ttu-id="99baf-129">Un opérateur arrête l’application ; via le portail Azure par exemple.</span><span class="sxs-lookup"><span data-stu-id="99baf-129">An operator shuts down the application; for example, using the Azure portal.</span></span>
  * <span data-ttu-id="99baf-130">L’application a été déchargée, car elle était inactive.</span><span class="sxs-lookup"><span data-stu-id="99baf-130">The app was unloaded because it was idle.</span></span> <span data-ttu-id="99baf-131">(Uniquement si le paramètre `Always On` est désactivé.)</span><span class="sxs-lookup"><span data-stu-id="99baf-131">(Only if the `Always On` setting is disabled.)</span></span>
* <span data-ttu-id="99baf-132">Arrêt inattendu</span><span class="sxs-lookup"><span data-stu-id="99baf-132">Unexpected shutdown</span></span>

  * <span data-ttu-id="99baf-133">L’application se bloque.</span><span class="sxs-lookup"><span data-stu-id="99baf-133">The app crashes.</span></span>
  * <span data-ttu-id="99baf-134">Une instance de machine virtuelle de App Service est indisponible.</span><span class="sxs-lookup"><span data-stu-id="99baf-134">An App Service VM instance becomes unavailable.</span></span>

<span data-ttu-id="99baf-135">L’enregistrement Application_End interceptera l’arrêt du domaine d’application (panne de processus logicielle) et il s’agit de la seule façon d’intercepter les arrêts de domaine d’application.</span><span class="sxs-lookup"><span data-stu-id="99baf-135">Application_End logging will catch the app domain shutdown (soft process crash) and is the only way to catch the application domain shutdowns.</span></span>

<span data-ttu-id="99baf-136">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-136">**Recovery**</span></span>

* <span data-ttu-id="99baf-137">Si l’arrêt était attendu, utilisez l’événement d’arrêt de l’application pour arrêter l’application de manière appropriée.</span><span class="sxs-lookup"><span data-stu-id="99baf-137">If the shutdown was expected, use the application's shutdown event to shut down gracefully.</span></span> <span data-ttu-id="99baf-138">Par exemple, dans ASP.NET, utilisez la méthode `Application_End`.</span><span class="sxs-lookup"><span data-stu-id="99baf-138">For example, in ASP.NET, use the `Application_End` method.</span></span>
* <span data-ttu-id="99baf-139">Si l’application a été déchargée une fois inactive, elle est automatiquement redémarrée lors de la prochaine requête.</span><span class="sxs-lookup"><span data-stu-id="99baf-139">If the application was unloaded while idle, it is automatically restarted on the next request.</span></span> <span data-ttu-id="99baf-140">Toutefois, cela occasionne le coût du « démarrage à froid ».</span><span class="sxs-lookup"><span data-stu-id="99baf-140">However, you will incur the "cold start" cost.</span></span>
* <span data-ttu-id="99baf-141">Pour empêcher le déchargement de l’application une fois inactive, vous devez activer la paramètre `Always On` dans l’application web.</span><span class="sxs-lookup"><span data-stu-id="99baf-141">To prevent the application from being unloaded while idle, enable the `Always On` setting in the web app.</span></span> <span data-ttu-id="99baf-142">Voir [Configurer des applications web dans Azure App Service][app-service-configure].</span><span class="sxs-lookup"><span data-stu-id="99baf-142">See [Configure web apps in Azure App Service][app-service-configure].</span></span>
* <span data-ttu-id="99baf-143">Pour empêcher un opérateur d’arrêter l’application, définissez un verrou de ressource avec un niveau `ReadOnly`.</span><span class="sxs-lookup"><span data-stu-id="99baf-143">To prevent an operator from shutting down the app, set a resource lock with `ReadOnly` level.</span></span> <span data-ttu-id="99baf-144">Consultez [Verrouiller des ressources avec Azure Resource Manager][rm-locks].</span><span class="sxs-lookup"><span data-stu-id="99baf-144">See [Lock resources with Azure Resource Manager][rm-locks].</span></span>
* <span data-ttu-id="99baf-145">En cas de blocage de l’application ou si une machine virtuelle de App Service devient indisponible, App Service redémarre automatiquement l’application.</span><span class="sxs-lookup"><span data-stu-id="99baf-145">If the app crashes or an App Service VM becomes unavailable, App Service automatically restarts the app.</span></span>

<span data-ttu-id="99baf-146">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-146">**Diagnostics**.</span></span> <span data-ttu-id="99baf-147">Journaux des serveurs web et d'applications.</span><span class="sxs-lookup"><span data-stu-id="99baf-147">Application logs and web server logs.</span></span> <span data-ttu-id="99baf-148">Consultez la page [Activer la journalisation des diagnostics pour les applications web dans Azure App Service][app-service-logging].</span><span class="sxs-lookup"><span data-stu-id="99baf-148">See [Enable diagnostics logging for web apps in Azure App Service][app-service-logging].</span></span>

### <a name="a-particular-user-repeatedly-makes-bad-requests-or-overloads-the-system"></a><span data-ttu-id="99baf-149">Un utilisateur particulier effectue des requêtes incorrectes ou surcharge le système à plusieurs reprises.</span><span class="sxs-lookup"><span data-stu-id="99baf-149">A particular user repeatedly makes bad requests or overloads the system.</span></span>
<span data-ttu-id="99baf-150">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-150">**Detection**.</span></span> <span data-ttu-id="99baf-151">Authentifiez les utilisateurs et incluez l’ID d’utilisateur dans les journaux d’applications.</span><span class="sxs-lookup"><span data-stu-id="99baf-151">Authenticate users and include user ID in application logs.</span></span>

<span data-ttu-id="99baf-152">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-152">**Recovery**</span></span>

* <span data-ttu-id="99baf-153">Utilisez [Gestion des API Azure][api-management] pour limiter les requêtes de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="99baf-153">Use [Azure API Management][api-management] to throttle requests from the user.</span></span> <span data-ttu-id="99baf-154">Consultez [Limitation de requêtes avancée avec Gestion des API Azure][api-management-throttling]</span><span class="sxs-lookup"><span data-stu-id="99baf-154">See [Advanced request throttling with Azure API Management][api-management-throttling]</span></span>
* <span data-ttu-id="99baf-155">Bloquez l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="99baf-155">Block the user.</span></span>

<span data-ttu-id="99baf-156">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-156">**Diagnostics**.</span></span> <span data-ttu-id="99baf-157">Journalisation de toutes les requêtes d’authentification.</span><span class="sxs-lookup"><span data-stu-id="99baf-157">Log all authentication requests.</span></span>

### <a name="a-bad-update-was-deployed"></a><span data-ttu-id="99baf-158">Une mise à jour incorrecte a été déployée.</span><span class="sxs-lookup"><span data-stu-id="99baf-158">A bad update was deployed.</span></span>
<span data-ttu-id="99baf-159">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-159">**Detection**.</span></span> <span data-ttu-id="99baf-160">Surveillez l’intégrité de l’application via le portail Azure (consultez [Surveiller les performances de l’application web Azure][app-insights-web-apps]) ou implémentez le [modèle de contrôle d’intégrité de point de terminaison][health-endpoint-monitoring-pattern].</span><span class="sxs-lookup"><span data-stu-id="99baf-160">Monitor the application health through the Azure Portal (see [Monitor Azure web app performance][app-insights-web-apps]) or implement the [health endpoint monitoring pattern][health-endpoint-monitoring-pattern].</span></span>

<span data-ttu-id="99baf-161">**Récupération**.</span><span class="sxs-lookup"><span data-stu-id="99baf-161">**Recovery**.</span></span> <span data-ttu-id="99baf-162">Utilisez plusieurs [emplacements de déploiement][app-service-slots] et l’annulation du déploiement vers le dernier déploiement correct.</span><span class="sxs-lookup"><span data-stu-id="99baf-162">Use multiple [deployment slots][app-service-slots] and roll back to the last-known-good deployment.</span></span> <span data-ttu-id="99baf-163">Pour plus d’informations, voir la rubrique [Authentification web de base][ra-web-apps-basic].</span><span class="sxs-lookup"><span data-stu-id="99baf-163">For more information, see [Basic web application][ra-web-apps-basic].</span></span>

## <a name="azure-active-directory"></a><span data-ttu-id="99baf-164">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="99baf-164">Azure Active Directory</span></span>
### <a name="openid-connect-oidc-authentication-fails"></a><span data-ttu-id="99baf-165">L’authentification OpenID Connect (OIDC) échoue.</span><span class="sxs-lookup"><span data-stu-id="99baf-165">OpenID Connect (OIDC) authentication fails.</span></span>
<span data-ttu-id="99baf-166">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-166">**Detection**.</span></span> <span data-ttu-id="99baf-167">Les modes d’échec possibles sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="99baf-167">Possible failure modes include:</span></span>

1. <span data-ttu-id="99baf-168">Azure AD n’est pas disponible ou ne peut pas être atteint en raison d’un problème réseau.</span><span class="sxs-lookup"><span data-stu-id="99baf-168">Azure AD is not available, or cannot be reached due to a network problem.</span></span> <span data-ttu-id="99baf-169">La redirection vers le point de terminaison de l’authentification échoue et l’intergiciel (middleware) OIDC lève une exception.</span><span class="sxs-lookup"><span data-stu-id="99baf-169">Redirection to the authentication endpoint fails, and the OIDC middleware throws an exception.</span></span>
2. <span data-ttu-id="99baf-170">Le locataire Azure AD n’existe pas.</span><span class="sxs-lookup"><span data-stu-id="99baf-170">Azure AD tenant does not exist.</span></span> <span data-ttu-id="99baf-171">La redirection vers le point de terminaison de l’authentification retourne un code d’erreur HTTP, et l’intergiciel (middleware) OIDC lève une exception.</span><span class="sxs-lookup"><span data-stu-id="99baf-171">Redirection to the authentication endpoint returns an HTTP error code, and the OIDC middleware throws an exception.</span></span>
3. <span data-ttu-id="99baf-172">L’utilisateur ne peut pas s’authentifier.</span><span class="sxs-lookup"><span data-stu-id="99baf-172">User cannot authenticate.</span></span> <span data-ttu-id="99baf-173">Aucune stratégie de détection n’est nécessaire ; Azure AD gère les échecs de connexion.</span><span class="sxs-lookup"><span data-stu-id="99baf-173">No detection strategy is necessary; Azure AD handles login failures.</span></span>

<span data-ttu-id="99baf-174">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-174">**Recovery**</span></span>

1. <span data-ttu-id="99baf-175">Interceptez des exceptions non gérées à partir de l’intergiciel (middleware).</span><span class="sxs-lookup"><span data-stu-id="99baf-175">Catch unhandled exceptions from the middleware.</span></span>
2. <span data-ttu-id="99baf-176">Gérez les événements `AuthenticationFailed`.</span><span class="sxs-lookup"><span data-stu-id="99baf-176">Handle `AuthenticationFailed` events.</span></span>
3. <span data-ttu-id="99baf-177">Redirigez l’utilisateur vers une page d’erreur.</span><span class="sxs-lookup"><span data-stu-id="99baf-177">Redirect the user to an error page.</span></span>
4. <span data-ttu-id="99baf-178">L’utilisateur essaye de nouveau.</span><span class="sxs-lookup"><span data-stu-id="99baf-178">User retries.</span></span>

## <a name="azure-search"></a><span data-ttu-id="99baf-179">Recherche Azure</span><span class="sxs-lookup"><span data-stu-id="99baf-179">Azure Search</span></span>
### <a name="writing-data-to-azure-search-fails"></a><span data-ttu-id="99baf-180">L’écriture des données sur Recherche Azure échoue.</span><span class="sxs-lookup"><span data-stu-id="99baf-180">Writing data to Azure Search fails.</span></span>
<span data-ttu-id="99baf-181">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-181">**Detection**.</span></span> <span data-ttu-id="99baf-182">Interceptez les erreurs `Microsoft.Rest.Azure.CloudException`.</span><span class="sxs-lookup"><span data-stu-id="99baf-182">Catch `Microsoft.Rest.Azure.CloudException` errors.</span></span>

<span data-ttu-id="99baf-183">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-183">**Recovery**</span></span>

<span data-ttu-id="99baf-184">Le [kit de développement logiciel .NET][search-sdk] tente automatiquement après des échecs temporaires.</span><span class="sxs-lookup"><span data-stu-id="99baf-184">The [Search .NET SDK][search-sdk] automatically retries after transient failures.</span></span> <span data-ttu-id="99baf-185">Toutes les exceptions levées par le kit de développement logiciel client doivent être traitées comme des erreurs non temporaires.</span><span class="sxs-lookup"><span data-stu-id="99baf-185">Any exceptions thrown by the client SDK should be treated as non-transient errors.</span></span>

<span data-ttu-id="99baf-186">La stratégie de nouvelles tentatives par défaut utilise une temporisation exponentielle.</span><span class="sxs-lookup"><span data-stu-id="99baf-186">The default retry policy uses exponential back-off.</span></span> <span data-ttu-id="99baf-187">Pour utiliser une stratégie de nouvelles tentatives différente, appelez `SetRetryPolicy` sur la classe `SearchIndexClient` ou `SearchServiceClient`.</span><span class="sxs-lookup"><span data-stu-id="99baf-187">To use a different retry policy, call `SetRetryPolicy` on the `SearchIndexClient` or `SearchServiceClient` class.</span></span> <span data-ttu-id="99baf-188">Pour plus d’informations, voir [Nouvelles tentatives automatiques][auto-rest-client-retry].</span><span class="sxs-lookup"><span data-stu-id="99baf-188">For more information, see [Automatic Retries][auto-rest-client-retry].</span></span>

<span data-ttu-id="99baf-189">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-189">**Diagnostics**.</span></span> <span data-ttu-id="99baf-190">Utilisez [Rechercher l’analyse du trafic][search-analytics].</span><span class="sxs-lookup"><span data-stu-id="99baf-190">Use [Search Traffic Analytics][search-analytics].</span></span>

### <a name="reading-data-from-azure-search-fails"></a><span data-ttu-id="99baf-191">La lecture des données à partir de Recherche Azure échoue.</span><span class="sxs-lookup"><span data-stu-id="99baf-191">Reading data from Azure Search fails.</span></span>
<span data-ttu-id="99baf-192">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-192">**Detection**.</span></span> <span data-ttu-id="99baf-193">Interceptez les erreurs `Microsoft.Rest.Azure.CloudException`.</span><span class="sxs-lookup"><span data-stu-id="99baf-193">Catch `Microsoft.Rest.Azure.CloudException` errors.</span></span>

<span data-ttu-id="99baf-194">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-194">**Recovery**</span></span>

<span data-ttu-id="99baf-195">Le [kit de développement logiciel .NET][search-sdk] tente automatiquement après des échecs temporaires.</span><span class="sxs-lookup"><span data-stu-id="99baf-195">The [Search .NET SDK][search-sdk]  automatically retries after transient failures.</span></span> <span data-ttu-id="99baf-196">Toutes les exceptions levées par le kit de développement logiciel client doivent être traitées comme des erreurs non temporaires.</span><span class="sxs-lookup"><span data-stu-id="99baf-196">Any exceptions thrown by the client SDK should be treated as non-transient errors.</span></span>

<span data-ttu-id="99baf-197">La stratégie de nouvelles tentatives par défaut utilise une temporisation exponentielle.</span><span class="sxs-lookup"><span data-stu-id="99baf-197">The default retry policy uses exponential back-off.</span></span> <span data-ttu-id="99baf-198">Pour utiliser une stratégie de nouvelles tentatives différente, appelez `SetRetryPolicy` sur la classe `SearchIndexClient` ou `SearchServiceClient`.</span><span class="sxs-lookup"><span data-stu-id="99baf-198">To use a different retry policy, call `SetRetryPolicy` on the `SearchIndexClient` or `SearchServiceClient` class.</span></span> <span data-ttu-id="99baf-199">Pour plus d’informations, voir [Nouvelles tentatives automatiques][auto-rest-client-retry].</span><span class="sxs-lookup"><span data-stu-id="99baf-199">For more information, see [Automatic Retries][auto-rest-client-retry].</span></span>

<span data-ttu-id="99baf-200">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-200">**Diagnostics**.</span></span> <span data-ttu-id="99baf-201">Utilisez [Rechercher l’analyse du trafic][search-analytics].</span><span class="sxs-lookup"><span data-stu-id="99baf-201">Use [Search Traffic Analytics][search-analytics].</span></span>

## <a name="cassandra"></a><span data-ttu-id="99baf-202">Cassandra</span><span class="sxs-lookup"><span data-stu-id="99baf-202">Cassandra</span></span>
### <a name="reading-or-writing-to-a-node-fails"></a><span data-ttu-id="99baf-203">La lecture ou l’écriture dans un nœud échoue.</span><span class="sxs-lookup"><span data-stu-id="99baf-203">Reading or writing to a node fails.</span></span>
<span data-ttu-id="99baf-204">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-204">**Detection**.</span></span> <span data-ttu-id="99baf-205">Interceptez l’exception.</span><span class="sxs-lookup"><span data-stu-id="99baf-205">Catch the exception.</span></span> <span data-ttu-id="99baf-206">Pour les clients .NET, il s’agira généralement de `System.Web.HttpException`.</span><span class="sxs-lookup"><span data-stu-id="99baf-206">For .NET clients, this will typically be `System.Web.HttpException`.</span></span> <span data-ttu-id="99baf-207">Les autres clients peuvent être sujets à d’autres types d’exceptions.</span><span class="sxs-lookup"><span data-stu-id="99baf-207">Other client may have other exception types.</span></span>  <span data-ttu-id="99baf-208">Pour plus d’informations, consultez [Gestion correcte des erreurs Cassandra](http://www.datastax.com/dev/blog/cassandra-error-handling-done-right).</span><span class="sxs-lookup"><span data-stu-id="99baf-208">For more information, see [Cassandra error handling done right](http://www.datastax.com/dev/blog/cassandra-error-handling-done-right).</span></span>

<span data-ttu-id="99baf-209">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-209">**Recovery**</span></span>

* <span data-ttu-id="99baf-210">Chaque [client de Cassandra](https://wiki.apache.org/cassandra/ClientOptions) possède ses propres fonctionnalités et stratégies de nouvelles tentatives.</span><span class="sxs-lookup"><span data-stu-id="99baf-210">Each [Cassandra client](https://wiki.apache.org/cassandra/ClientOptions) has its own retry policies and capabilities.</span></span> <span data-ttu-id="99baf-211">Pour plus d’informations, consultez [Gestion correcte des erreurs Cassandra][cassandra-error-handling].</span><span class="sxs-lookup"><span data-stu-id="99baf-211">For more information, see [Cassandra error handling done right][cassandra-error-handling].</span></span>
* <span data-ttu-id="99baf-212">Utilisez un déploiement en mode rack, avec les nœuds de données répartis entre les domaines d’erreur.</span><span class="sxs-lookup"><span data-stu-id="99baf-212">Use a rack-aware deployment, with data nodes distributed across the fault domains.</span></span>
* <span data-ttu-id="99baf-213">Déployez dans plusieurs régions avec une cohérence de quorum locale.</span><span class="sxs-lookup"><span data-stu-id="99baf-213">Deploy to multiple regions with local quorum consistency.</span></span> <span data-ttu-id="99baf-214">Si une défaillance non temporaire se produit, basculez vers une autre région.</span><span class="sxs-lookup"><span data-stu-id="99baf-214">If a non-transient failure occurs, fail over to another region.</span></span>

<span data-ttu-id="99baf-215">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-215">**Diagnostics**.</span></span> <span data-ttu-id="99baf-216">Journaux d’application</span><span class="sxs-lookup"><span data-stu-id="99baf-216">Application logs</span></span>

## <a name="cloud-service"></a><span data-ttu-id="99baf-217">Service cloud</span><span class="sxs-lookup"><span data-stu-id="99baf-217">Cloud Service</span></span>
### <a name="web-or-worker-roles-are-unexpectedlybeing-shut-down"></a><span data-ttu-id="99baf-218">Les rôles web ou de travail sont arrêtés de façon inattendue.</span><span class="sxs-lookup"><span data-stu-id="99baf-218">Web or worker roles are unexpectedly being shut down.</span></span>
<span data-ttu-id="99baf-219">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-219">**Detection**.</span></span> <span data-ttu-id="99baf-220">L’événement [RoleEnvironment.Stopping][RoleEnvironment.Stopping] est déclenché.</span><span class="sxs-lookup"><span data-stu-id="99baf-220">The [RoleEnvironment.Stopping][RoleEnvironment.Stopping] event is fired.</span></span>

<span data-ttu-id="99baf-221">**Récupération**.</span><span class="sxs-lookup"><span data-stu-id="99baf-221">**Recovery**.</span></span> <span data-ttu-id="99baf-222">Remplacez la méthode [RoleEntryPoint.OnStop][RoleEntryPoint.OnStop] pour nettoyer de manière appropriée.</span><span class="sxs-lookup"><span data-stu-id="99baf-222">Override the [RoleEntryPoint.OnStop][RoleEntryPoint.OnStop] method to gracefully clean up.</span></span> <span data-ttu-id="99baf-223">Pour plus d’informations, consultez [La bonne manière de gérer les événements de Azure OnStop][onstop-events] (blog).</span><span class="sxs-lookup"><span data-stu-id="99baf-223">For more information, see [The Right Way to Handle Azure OnStop Events][onstop-events] (blog).</span></span>

## <a name="cosmos-db"></a><span data-ttu-id="99baf-224">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="99baf-224">Cosmos DB</span></span> 
### <a name="reading-data-fails"></a><span data-ttu-id="99baf-225">Échec de la lecture des données.</span><span class="sxs-lookup"><span data-stu-id="99baf-225">Reading data fails.</span></span>
<span data-ttu-id="99baf-226">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-226">**Detection**.</span></span> <span data-ttu-id="99baf-227">Interceptez `System.Net.Http.HttpRequestException` ou `Microsoft.Azure.Documents.DocumentClientException`.</span><span class="sxs-lookup"><span data-stu-id="99baf-227">Catch `System.Net.Http.HttpRequestException` or `Microsoft.Azure.Documents.DocumentClientException`.</span></span>

<span data-ttu-id="99baf-228">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-228">**Recovery**</span></span>

* <span data-ttu-id="99baf-229">Le kit de développement logiciel retente automatiquement les tentatives ayant échoué.</span><span class="sxs-lookup"><span data-stu-id="99baf-229">The SDK automatically retries failed attempts.</span></span> <span data-ttu-id="99baf-230">Pour définir le nombre de nouvelles tentatives et le délai d’attente maximal, configurez `ConnectionPolicy.RetryOptions`.</span><span class="sxs-lookup"><span data-stu-id="99baf-230">To set the number of retries and the maximum wait time, configure `ConnectionPolicy.RetryOptions`.</span></span> <span data-ttu-id="99baf-231">Les exceptions déclenchées par le client sont au-delà de la stratégie de nouvelle tentative ou ne sont pas des erreurs temporaires.</span><span class="sxs-lookup"><span data-stu-id="99baf-231">Exceptions that the client raises are either beyond the retry policy or are not transient errors.</span></span>
* <span data-ttu-id="99baf-232">Si Cosmos DB limite le client, il renvoie une erreur HTTP 429.</span><span class="sxs-lookup"><span data-stu-id="99baf-232">If Cosmos DB throttles the client, it returns an HTTP 429 error.</span></span> <span data-ttu-id="99baf-233">Vérifiez le code d’état dans `DocumentClientException`.</span><span class="sxs-lookup"><span data-stu-id="99baf-233">Check the status code in the `DocumentClientException`.</span></span> <span data-ttu-id="99baf-234">Si l’erreur 429 se produit régulièrement, envisagez d’augmenter la valeur de débit de la collection.</span><span class="sxs-lookup"><span data-stu-id="99baf-234">If you are getting error 429 consistently, consider increasing the throughput value of the collection.</span></span>
    * <span data-ttu-id="99baf-235">Si vous utilisez l’API MongoDB, le service retourne le code d’erreur 16500 lors de la limitation.</span><span class="sxs-lookup"><span data-stu-id="99baf-235">If you are using the MongoDB API, the service returns error code 16500 when throttling.</span></span>
* <span data-ttu-id="99baf-236">Répliquez la base de données Cosmos DB entre deux ou plusieurs régions.</span><span class="sxs-lookup"><span data-stu-id="99baf-236">Replicate the Cosmos DB database across two or more regions.</span></span> <span data-ttu-id="99baf-237">Tous les réplicas sont lisibles.</span><span class="sxs-lookup"><span data-stu-id="99baf-237">All replicas are readable.</span></span> <span data-ttu-id="99baf-238">À l’aide des kits de développement logiciel, spécifiez le paramètre `PreferredLocations`.</span><span class="sxs-lookup"><span data-stu-id="99baf-238">Using the client SDKs, specify the `PreferredLocations` parameter.</span></span> <span data-ttu-id="99baf-239">Il s’agit d’une liste ordonnée des régions Azure.</span><span class="sxs-lookup"><span data-stu-id="99baf-239">This is an ordered list of Azure regions.</span></span> <span data-ttu-id="99baf-240">Toutes les lectures sont envoyées vers la première région disponible dans la liste.</span><span class="sxs-lookup"><span data-stu-id="99baf-240">All reads will be sent to the first available region in the list.</span></span> <span data-ttu-id="99baf-241">Si la requête échoue, le client va essayer les autres régions dans la liste, dans l’ordre.</span><span class="sxs-lookup"><span data-stu-id="99baf-241">If the request fails, the client will try the other regions in the list, in order.</span></span> <span data-ttu-id="99baf-242">Pour en savoir plus, voir [Comment configurer la distribution mondiale Azure Cosmos DB à l’aide de l’API SQL][cosmosdb-multi-region].</span><span class="sxs-lookup"><span data-stu-id="99baf-242">For more information, see [How to setup Azure Cosmos DB global distribution using the SQL API][cosmosdb-multi-region].</span></span>

<span data-ttu-id="99baf-243">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-243">**Diagnostics**.</span></span> <span data-ttu-id="99baf-244">Journalisation de toutes les erreurs côté client.</span><span class="sxs-lookup"><span data-stu-id="99baf-244">Log all errors on the client side.</span></span>

### <a name="writing-data-fails"></a><span data-ttu-id="99baf-245">Échec de l’écriture des données.</span><span class="sxs-lookup"><span data-stu-id="99baf-245">Writing data fails.</span></span>
<span data-ttu-id="99baf-246">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-246">**Detection**.</span></span> <span data-ttu-id="99baf-247">Interceptez `System.Net.Http.HttpRequestException` ou `Microsoft.Azure.Documents.DocumentClientException`.</span><span class="sxs-lookup"><span data-stu-id="99baf-247">Catch `System.Net.Http.HttpRequestException` or `Microsoft.Azure.Documents.DocumentClientException`.</span></span>

<span data-ttu-id="99baf-248">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-248">**Recovery**</span></span>

* <span data-ttu-id="99baf-249">Le kit de développement logiciel retente automatiquement les tentatives ayant échoué.</span><span class="sxs-lookup"><span data-stu-id="99baf-249">The SDK automatically retries failed attempts.</span></span> <span data-ttu-id="99baf-250">Pour définir le nombre de nouvelles tentatives et le délai d’attente maximal, configurez `ConnectionPolicy.RetryOptions`.</span><span class="sxs-lookup"><span data-stu-id="99baf-250">To set the number of retries and the maximum wait time, configure `ConnectionPolicy.RetryOptions`.</span></span> <span data-ttu-id="99baf-251">Les exceptions déclenchées par le client sont au-delà de la stratégie de nouvelle tentative ou ne sont pas des erreurs temporaires.</span><span class="sxs-lookup"><span data-stu-id="99baf-251">Exceptions that the client raises are either beyond the retry policy or are not transient errors.</span></span>
* <span data-ttu-id="99baf-252">Si Cosmos DB limite le client, il renvoie une erreur HTTP 429.</span><span class="sxs-lookup"><span data-stu-id="99baf-252">If Cosmos DB throttles the client, it returns an HTTP 429 error.</span></span> <span data-ttu-id="99baf-253">Vérifiez le code d’état dans `DocumentClientException`.</span><span class="sxs-lookup"><span data-stu-id="99baf-253">Check the status code in the `DocumentClientException`.</span></span> <span data-ttu-id="99baf-254">Si l’erreur 429 se produit régulièrement, envisagez d’augmenter la valeur de débit de la collection.</span><span class="sxs-lookup"><span data-stu-id="99baf-254">If you are getting error 429 consistently, consider increasing the throughput value of the collection.</span></span>
* <span data-ttu-id="99baf-255">Répliquez la base de données Cosmos DB entre deux ou plusieurs régions.</span><span class="sxs-lookup"><span data-stu-id="99baf-255">Replicate the Cosmos DB database across two or more regions.</span></span> <span data-ttu-id="99baf-256">Si la région principale échoue, une autre région sera promue pour l’écriture.</span><span class="sxs-lookup"><span data-stu-id="99baf-256">If the primary region fails, another region will be promoted to write.</span></span> <span data-ttu-id="99baf-257">Vous pouvez également déclencher le basculement manuellement.</span><span class="sxs-lookup"><span data-stu-id="99baf-257">You can also trigger a failover manually.</span></span> <span data-ttu-id="99baf-258">Le kit de développement logiciel effectue une découverte et un routage automatique, le code de l’application continue donc de fonctionner après un basculement.</span><span class="sxs-lookup"><span data-stu-id="99baf-258">The SDK does automatic discovery and routing, so application code continues to work after a failover.</span></span> <span data-ttu-id="99baf-259">Pendant la période de basculement (généralement quelques minutes), les opérations d’écriture ont une latence plus élevée, étant donné que le kit de développement logiciel est en train de trouver la nouvelle zone d’écriture.</span><span class="sxs-lookup"><span data-stu-id="99baf-259">During the failover period (typically minutes), write operations will have higher latency, as the SDK finds the new write region.</span></span>
  <span data-ttu-id="99baf-260">Pour en savoir plus, voir [Comment configurer la distribution mondiale Azure Cosmos DB à l’aide de l’API SQL][cosmosdb-multi-region].</span><span class="sxs-lookup"><span data-stu-id="99baf-260">For more information, see [How to setup Azure Cosmos DB global distribution using the SQL API][cosmosdb-multi-region].</span></span>
* <span data-ttu-id="99baf-261">Comme solution de secours, conservez le document dans une file d’attente de sauvegarde et traitez cette file plus tard.</span><span class="sxs-lookup"><span data-stu-id="99baf-261">As a fallback, persist the document to a backup queue, and process the queue later.</span></span>

<span data-ttu-id="99baf-262">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-262">**Diagnostics**.</span></span> <span data-ttu-id="99baf-263">Journalisation de toutes les erreurs côté client.</span><span class="sxs-lookup"><span data-stu-id="99baf-263">Log all errors on the client side.</span></span>

## <a name="elasticsearch"></a><span data-ttu-id="99baf-264">Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="99baf-264">Elasticsearch</span></span>
### <a name="reading-data-from-elasticsearch-fails"></a><span data-ttu-id="99baf-265">La lecture des données à partir de Elasticsearch échoue.</span><span class="sxs-lookup"><span data-stu-id="99baf-265">Reading data from Elasticsearch fails.</span></span>
<span data-ttu-id="99baf-266">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-266">**Detection**.</span></span> <span data-ttu-id="99baf-267">Interceptez l’exception appropriée pour le [client Elasticsearch][elasticsearch-client] utilisé.</span><span class="sxs-lookup"><span data-stu-id="99baf-267">Catch the appropriate exception for the particular [Elasticsearch client][elasticsearch-client] being used.</span></span>

<span data-ttu-id="99baf-268">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-268">**Recovery**</span></span>

* <span data-ttu-id="99baf-269">Utilisez le mécanisme de nouvelle tentative.</span><span class="sxs-lookup"><span data-stu-id="99baf-269">Use a retry mechanism.</span></span> <span data-ttu-id="99baf-270">Chaque client possède ses propres stratégies de nouvelle tentative.</span><span class="sxs-lookup"><span data-stu-id="99baf-270">Each client has its own retry policies.</span></span>
* <span data-ttu-id="99baf-271">Déployez plusieurs nœuds Elasticsearch et utilisez la réplication pour obtenir une haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="99baf-271">Deploy multiple Elasticsearch nodes and use replication for high availability.</span></span>

<span data-ttu-id="99baf-272">Pour plus d’informations, voir [Exécution de Elasticsearch sur Azure][elasticsearch-azure].</span><span class="sxs-lookup"><span data-stu-id="99baf-272">For more information, see [Running Elasticsearch on Azure][elasticsearch-azure].</span></span>

<span data-ttu-id="99baf-273">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-273">**Diagnostics**.</span></span> <span data-ttu-id="99baf-274">Vous pouvez utiliser les outils de surveillance pour Elasticsearch ou enregistrer toutes les erreurs du côté client avec la charge utile.</span><span class="sxs-lookup"><span data-stu-id="99baf-274">You can use monitoring tools for Elasticsearch, or log all errors on the client side with the payload.</span></span> <span data-ttu-id="99baf-275">Consultez la section « Surveillance » dans [Exécution de Elasticsearch sur Azure][elasticsearch-azure].</span><span class="sxs-lookup"><span data-stu-id="99baf-275">See the 'Monitoring' section in [Running Elasticsearch on Azure][elasticsearch-azure].</span></span>

### <a name="writing-data-to-elasticsearch-fails"></a><span data-ttu-id="99baf-276">L’écriture des données sur Elasticsearch échoue.</span><span class="sxs-lookup"><span data-stu-id="99baf-276">Writing data to Elasticsearch fails.</span></span>
<span data-ttu-id="99baf-277">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-277">**Detection**.</span></span> <span data-ttu-id="99baf-278">Interceptez l’exception appropriée pour le [client Elasticsearch][elasticsearch-client] utilisé.</span><span class="sxs-lookup"><span data-stu-id="99baf-278">Catch the appropriate exception for the particular [Elasticsearch client][elasticsearch-client] being used.</span></span>  

<span data-ttu-id="99baf-279">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-279">**Recovery**</span></span>

* <span data-ttu-id="99baf-280">Utilisez le mécanisme de nouvelle tentative.</span><span class="sxs-lookup"><span data-stu-id="99baf-280">Use a retry mechanism.</span></span> <span data-ttu-id="99baf-281">Chaque client possède ses propres stratégies de nouvelle tentative.</span><span class="sxs-lookup"><span data-stu-id="99baf-281">Each client has its own retry policies.</span></span>
* <span data-ttu-id="99baf-282">Si l’application peut tolérer un niveau de cohérence réduit, envisagez l’écriture avec le paramètre `write_consistency` de `quorum`.</span><span class="sxs-lookup"><span data-stu-id="99baf-282">If the application can tolerate a reduced consistency level, consider writing with `write_consistency` setting of `quorum`.</span></span>

<span data-ttu-id="99baf-283">Pour plus d’informations, voir [Exécution de Elasticsearch sur Azure][elasticsearch-azure].</span><span class="sxs-lookup"><span data-stu-id="99baf-283">For more information, see [Running Elasticsearch on Azure][elasticsearch-azure].</span></span>

<span data-ttu-id="99baf-284">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-284">**Diagnostics**.</span></span> <span data-ttu-id="99baf-285">Vous pouvez utiliser les outils de surveillance pour Elasticsearch ou enregistrer toutes les erreurs du côté client avec la charge utile.</span><span class="sxs-lookup"><span data-stu-id="99baf-285">You can use monitoring tools for Elasticsearch, or log all errors on the client side with the payload.</span></span> <span data-ttu-id="99baf-286">Consultez la section « Surveillance » dans [Exécution de Elasticsearch sur Azure][elasticsearch-azure].</span><span class="sxs-lookup"><span data-stu-id="99baf-286">See the 'Monitoring' section in [Running Elasticsearch on Azure][elasticsearch-azure].</span></span>

## <a name="queue-storage"></a><span data-ttu-id="99baf-287">Stockage de files d'attente</span><span class="sxs-lookup"><span data-stu-id="99baf-287">Queue storage</span></span>
### <a name="writing-a-message-to-azure-queue-storage-fails-consistently"></a><span data-ttu-id="99baf-288">L’écriture d’un message sur le Stockage File d’attente Azure échoue régulièrement.</span><span class="sxs-lookup"><span data-stu-id="99baf-288">Writing a message to Azure Queue storage fails consistently.</span></span>
<span data-ttu-id="99baf-289">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-289">**Detection**.</span></span> <span data-ttu-id="99baf-290">Après *N* nouvelles tentatives, l’opération d’écriture échoue encore.</span><span class="sxs-lookup"><span data-stu-id="99baf-290">After *N* retry attempts, the write operation still fails.</span></span>

<span data-ttu-id="99baf-291">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-291">**Recovery**</span></span>

* <span data-ttu-id="99baf-292">Stockez les données dans un cache local et transférez les écritures dans le stockage plus tard, lorsque le service devient disponible.</span><span class="sxs-lookup"><span data-stu-id="99baf-292">Store the data in a local cache, and forward the writes to storage later, when the service becomes available.</span></span>
* <span data-ttu-id="99baf-293">Créez une file d’attente secondaire et écrivez dans cette file d’attente si la file d’attente principale n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="99baf-293">Create a secondary queue, and write to that queue if the primary queue is unavailable.</span></span>

<span data-ttu-id="99baf-294">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-294">**Diagnostics**.</span></span> <span data-ttu-id="99baf-295">Utilisez les [métriques de stockage][storage-metrics].</span><span class="sxs-lookup"><span data-stu-id="99baf-295">Use [storage metrics][storage-metrics].</span></span>

### <a name="the-application-cannot-process-a-particular-message-from-the-queue"></a><span data-ttu-id="99baf-296">L’application ne peut pas traiter un message particulier à partir de la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="99baf-296">The application cannot process a particular message from the queue.</span></span>
<span data-ttu-id="99baf-297">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-297">**Detection**.</span></span> <span data-ttu-id="99baf-298">Spécifique à l’application.</span><span class="sxs-lookup"><span data-stu-id="99baf-298">Application specific.</span></span> <span data-ttu-id="99baf-299">Par exemple, le message contient des données non valides, ou la logique métier échoue pour une raison quelconque.</span><span class="sxs-lookup"><span data-stu-id="99baf-299">For example, the message contains invalid data, or the business logic fails for some reason.</span></span>

<span data-ttu-id="99baf-300">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-300">**Recovery**</span></span>

<span data-ttu-id="99baf-301">Déplacez le message vers une file d’attente distincte.</span><span class="sxs-lookup"><span data-stu-id="99baf-301">Move the message to a separate queue.</span></span> <span data-ttu-id="99baf-302">Exécutez un processus séparé pour examiner les messages dans cette file d’attente.</span><span class="sxs-lookup"><span data-stu-id="99baf-302">Run a separate process to examine the messages in that queue.</span></span>

<span data-ttu-id="99baf-303">Considérez l’utilisation des files d’attente de messagerie Azure Service Bus, fournissant une fonctionnalité de [file d’attente de lettres mortes][sb-dead-letter-queue] à cet effet.</span><span class="sxs-lookup"><span data-stu-id="99baf-303">Consider using Azure Service Bus Messaging queues, which provides a [dead-letter queue][sb-dead-letter-queue] functionality for this purpose.</span></span>

> [!NOTE]
> <span data-ttu-id="99baf-304">Si vous utilisez des files d’attente de stockage avec WebJobs, le kit de développement logiciel WebJobs fournit la gestion intégrée des messages incohérents.</span><span class="sxs-lookup"><span data-stu-id="99baf-304">If you are using Storage queues with WebJobs, the WebJobs SDK provides built-in poison message handling.</span></span> <span data-ttu-id="99baf-305">Voir [Utilisation du stockage de file d’attente Azure avec le Kit de développement logiciel (SDK) WebJobs][sb-poison-message].</span><span class="sxs-lookup"><span data-stu-id="99baf-305">See [How to use Azure queue storage with the WebJobs SDK][sb-poison-message].</span></span>

<span data-ttu-id="99baf-306">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-306">**Diagnostics**.</span></span> <span data-ttu-id="99baf-307">Utilisez la journalisation des applications.</span><span class="sxs-lookup"><span data-stu-id="99baf-307">Use application logging.</span></span>

## <a name="redis-cache"></a><span data-ttu-id="99baf-308">Cache Redis</span><span class="sxs-lookup"><span data-stu-id="99baf-308">Redis Cache</span></span>
### <a name="reading-from-the-cache-fails"></a><span data-ttu-id="99baf-309">La lecture à partir du cache échoue.</span><span class="sxs-lookup"><span data-stu-id="99baf-309">Reading from the cache fails.</span></span>
<span data-ttu-id="99baf-310">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-310">**Detection**.</span></span> <span data-ttu-id="99baf-311">Interceptez `StackExchange.Redis.RedisConnectionException`.</span><span class="sxs-lookup"><span data-stu-id="99baf-311">Catch `StackExchange.Redis.RedisConnectionException`.</span></span>

<span data-ttu-id="99baf-312">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-312">**Recovery**</span></span>

1. <span data-ttu-id="99baf-313">Relance en cas d’échecs temporaires.</span><span class="sxs-lookup"><span data-stu-id="99baf-313">Retry on transient failures.</span></span> <span data-ttu-id="99baf-314">Cache Redis Azure prend en charge l’intégration des nouvelles tentatives Voir [Instructions des nouvelles tentatives de Cache Redis][redis-retry].</span><span class="sxs-lookup"><span data-stu-id="99baf-314">Azure Redis cache supports built-in retry through See [Redis Cache retry guidelines][redis-retry].</span></span>
2. <span data-ttu-id="99baf-315">Traitez les échecs non temporaires comme une absence dans le cache et revenez à la source de données d’origine.</span><span class="sxs-lookup"><span data-stu-id="99baf-315">Treat non-transient failures as a cache miss, and fall back to the original data source.</span></span>

<span data-ttu-id="99baf-316">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-316">**Diagnostics**.</span></span> <span data-ttu-id="99baf-317">Utilisez [Diagnostics de Cache Redis][redis-monitor].</span><span class="sxs-lookup"><span data-stu-id="99baf-317">Use [Redis Cache diagnostics][redis-monitor].</span></span>

### <a name="writing-to-the-cache-fails"></a><span data-ttu-id="99baf-318">L’écriture dans le cache échoue.</span><span class="sxs-lookup"><span data-stu-id="99baf-318">Writing to the cache fails.</span></span>
<span data-ttu-id="99baf-319">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-319">**Detection**.</span></span> <span data-ttu-id="99baf-320">Interceptez `StackExchange.Redis.RedisConnectionException`.</span><span class="sxs-lookup"><span data-stu-id="99baf-320">Catch `StackExchange.Redis.RedisConnectionException`.</span></span>

<span data-ttu-id="99baf-321">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-321">**Recovery**</span></span>

1. <span data-ttu-id="99baf-322">Relance en cas d’échecs temporaires.</span><span class="sxs-lookup"><span data-stu-id="99baf-322">Retry on transient failures.</span></span> <span data-ttu-id="99baf-323">Cache Redis Azure prend en charge l’intégration des nouvelles tentatives Voir [Instructions des nouvelles tentatives de Cache Redis][redis-retry].</span><span class="sxs-lookup"><span data-stu-id="99baf-323">Azure Redis cache supports built-in retry through See [Redis Cache retry guidelines][redis-retry].</span></span>
2. <span data-ttu-id="99baf-324">Si l’erreur est non temporaire, ignorez-la et laissez les autres transactions écrire ultérieurement dans le cache.</span><span class="sxs-lookup"><span data-stu-id="99baf-324">If the error is non-transient, ignore it and let other transactions write to the cache later.</span></span>

<span data-ttu-id="99baf-325">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-325">**Diagnostics**.</span></span> <span data-ttu-id="99baf-326">Utilisez [Diagnostics de Cache Redis][redis-monitor].</span><span class="sxs-lookup"><span data-stu-id="99baf-326">Use [Redis Cache diagnostics][redis-monitor].</span></span>

## <a name="sql-database"></a><span data-ttu-id="99baf-327">Base de données SQL</span><span class="sxs-lookup"><span data-stu-id="99baf-327">SQL Database</span></span>
### <a name="cannot-connect-to-the-database-in-the-primary-region"></a><span data-ttu-id="99baf-328">Impossible de se connecter à la base de données dans la région principale.</span><span class="sxs-lookup"><span data-stu-id="99baf-328">Cannot connect to the database in the primary region.</span></span>
<span data-ttu-id="99baf-329">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-329">**Detection**.</span></span> <span data-ttu-id="99baf-330">La connexion échoue.</span><span class="sxs-lookup"><span data-stu-id="99baf-330">Connection fails.</span></span>

<span data-ttu-id="99baf-331">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-331">**Recovery**</span></span>

<span data-ttu-id="99baf-332">Condition préalable : la base de données doit être configurée pour la géo-réplication active.</span><span class="sxs-lookup"><span data-stu-id="99baf-332">Prerequisite: The database must be configured for active geo-replication.</span></span> <span data-ttu-id="99baf-333">Voir [Géo-réplication active de SQL Database][sql-db-replication].</span><span class="sxs-lookup"><span data-stu-id="99baf-333">See [SQL Database Active Geo-Replication][sql-db-replication].</span></span>

* <span data-ttu-id="99baf-334">Pour les requêtes, lisez à partir d’un réplica secondaire.</span><span class="sxs-lookup"><span data-stu-id="99baf-334">For queries, read from a secondary replica.</span></span>
* <span data-ttu-id="99baf-335">Pour les insertions et les mises à jour, basculez manuellement vers un réplica secondaire.</span><span class="sxs-lookup"><span data-stu-id="99baf-335">For inserts and updates, manually fail over to a secondary replica.</span></span> <span data-ttu-id="99baf-336">Voir [Lancer un basculement planifié ou non planifié pour une Azure SQL Database][sql-db-failover].</span><span class="sxs-lookup"><span data-stu-id="99baf-336">See [Initiate a planned or unplanned failover for Azure SQL Database][sql-db-failover].</span></span>

<span data-ttu-id="99baf-337">Le réplica utilise une chaîne de connexion différente, vous devrez donc la mettre à jour dans votre application.</span><span class="sxs-lookup"><span data-stu-id="99baf-337">The replica uses a different connection string, so you will need to update the connection string in your application.</span></span>

### <a name="client-runs-out-of-connections-in-the-connection-pool"></a><span data-ttu-id="99baf-338">Client à court de connexions dans le pool de connexions.</span><span class="sxs-lookup"><span data-stu-id="99baf-338">Client runs out of connections in the connection pool.</span></span>
<span data-ttu-id="99baf-339">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-339">**Detection**.</span></span> <span data-ttu-id="99baf-340">Interceptez les erreurs `System.InvalidOperationException`.</span><span class="sxs-lookup"><span data-stu-id="99baf-340">Catch `System.InvalidOperationException` errors.</span></span>

<span data-ttu-id="99baf-341">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-341">**Recovery**</span></span>

* <span data-ttu-id="99baf-342">Retentez l’opération.</span><span class="sxs-lookup"><span data-stu-id="99baf-342">Retry the operation.</span></span>
* <span data-ttu-id="99baf-343">En tant qu’un plan d’atténuation, isolez les pools de connexions pour chaque cas d’usage, de sorte qu’un seul cas d’usage ne puisse pas dominer toutes les connexions.</span><span class="sxs-lookup"><span data-stu-id="99baf-343">As a mitigation plan, isolate the connection pools for each use case, so that one use case can't dominate all the connections.</span></span>
* <span data-ttu-id="99baf-344">Augmentez les pools de connexions maximales.</span><span class="sxs-lookup"><span data-stu-id="99baf-344">Increase the maximum connection pools.</span></span>

<span data-ttu-id="99baf-345">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-345">**Diagnostics**.</span></span> <span data-ttu-id="99baf-346">Journaux d’application.</span><span class="sxs-lookup"><span data-stu-id="99baf-346">Application logs.</span></span>

### <a name="database-connection-limit-is-reached"></a><span data-ttu-id="99baf-347">La limite de connexion de base de données est atteinte.</span><span class="sxs-lookup"><span data-stu-id="99baf-347">Database connection limit is reached.</span></span>
<span data-ttu-id="99baf-348">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-348">**Detection**.</span></span> <span data-ttu-id="99baf-349">Azure SQL Database limite le nombre de rôles de travail, de connexions et de sessions simultanés.</span><span class="sxs-lookup"><span data-stu-id="99baf-349">Azure SQL Database limits the number of concurrent workers, logins, and sessions.</span></span> <span data-ttu-id="99baf-350">Les limites dépendent du niveau de service.</span><span class="sxs-lookup"><span data-stu-id="99baf-350">The limits depend on the service tier.</span></span> <span data-ttu-id="99baf-351">Pour en savoir plus, voir [Limites de ressources Microsoft Azure SQL Database][sql-db-limits].</span><span class="sxs-lookup"><span data-stu-id="99baf-351">For more information, see [Azure SQL Database resource limits][sql-db-limits].</span></span>

<span data-ttu-id="99baf-352">Pour détecter ces erreurs, interceptez `System.Data.SqlClient.SqlException` et vérifiez la valeur de `SqlException.Number` pour le code d’erreur SQL.</span><span class="sxs-lookup"><span data-stu-id="99baf-352">To detect these errors, catch `System.Data.SqlClient.SqlException` and check the value of `SqlException.Number` for the SQL error code.</span></span> <span data-ttu-id="99baf-353">Pour connaître les codes d’erreur concernés, consultez la page [Codes d’erreur SQL pour les applications clientes SQL Database : erreur de connexion à la base de données et autres problèmes][sql-db-errors].</span><span class="sxs-lookup"><span data-stu-id="99baf-353">For a list of relevant error codes, see [SQL error codes for SQL Database client applications: Database connection error and other issues][sql-db-errors].</span></span>

<span data-ttu-id="99baf-354">**Récupération**.</span><span class="sxs-lookup"><span data-stu-id="99baf-354">**Recovery**.</span></span> <span data-ttu-id="99baf-355">Ces erreurs sont considérées comme transitoires, une nouvelle tentative peut donc résoudre le problème.</span><span class="sxs-lookup"><span data-stu-id="99baf-355">These errors are considered transient, so retrying may resolve the issue.</span></span> <span data-ttu-id="99baf-356">Si vous rencontrez régulièrement ces erreurs, envisagez une mise à l’échelle de la base de données.</span><span class="sxs-lookup"><span data-stu-id="99baf-356">If you consistently hit these errors, consider scaling the database.</span></span>

<span data-ttu-id="99baf-357">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-357">**Diagnostics**.</span></span> <span data-ttu-id="99baf-358">- La requête [sys.event_log][sys.event_log] renvoie les interblocages, les échecs de connexion et les réussites de connexion de base de données.</span><span class="sxs-lookup"><span data-stu-id="99baf-358">- The [sys.event_log][sys.event_log] query returns successful database connections, connection failures, and deadlocks.</span></span>

* <span data-ttu-id="99baf-359">Créer une [règle d’alerte][azure-alerts] pour les connexions qui ont échoué.</span><span class="sxs-lookup"><span data-stu-id="99baf-359">Create an [alert rule][azure-alerts] for failed connections.</span></span>
* <span data-ttu-id="99baf-360">Activez [l’audit de SQL Database][sql-db-audit] et recherchez les échecs de connexion.</span><span class="sxs-lookup"><span data-stu-id="99baf-360">Enable [SQL Database auditing][sql-db-audit] and check for failed logins.</span></span>

## <a name="service-bus-messaging"></a><span data-ttu-id="99baf-361">Messagerie Service Bus </span><span class="sxs-lookup"><span data-stu-id="99baf-361">Service Bus Messaging</span></span>
### <a name="reading-a-message-from-a-service-bus-queue-fails"></a><span data-ttu-id="99baf-362">Échec de la lecture d’un message à partir d’une file d’attente Service Bus.</span><span class="sxs-lookup"><span data-stu-id="99baf-362">Reading a message from a Service Bus queue fails.</span></span>
<span data-ttu-id="99baf-363">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-363">**Detection**.</span></span> <span data-ttu-id="99baf-364">Interceptez les exceptions à partir du kit de développement logiciel client.</span><span class="sxs-lookup"><span data-stu-id="99baf-364">Catch exceptions from the client SDK.</span></span> <span data-ttu-id="99baf-365">La classe de base pour les exceptions Service Bus est [MessagingException][sb-messagingexception-class].</span><span class="sxs-lookup"><span data-stu-id="99baf-365">The base class for Service Bus exceptions is [MessagingException][sb-messagingexception-class].</span></span> <span data-ttu-id="99baf-366">Si l’erreur est temporaire, la propriété `IsTransient` a la valeur True.</span><span class="sxs-lookup"><span data-stu-id="99baf-366">If the error is transient, the `IsTransient` property is true.</span></span>

<span data-ttu-id="99baf-367">Pour plus d’informations, consultez [Exceptions de la messagerie Service Bus][sb-messaging-exceptions].</span><span class="sxs-lookup"><span data-stu-id="99baf-367">For more information, see [Service Bus messaging exceptions][sb-messaging-exceptions].</span></span>

<span data-ttu-id="99baf-368">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-368">**Recovery**</span></span>

1. <span data-ttu-id="99baf-369">Relance en cas d’échecs temporaires.</span><span class="sxs-lookup"><span data-stu-id="99baf-369">Retry on transient failures.</span></span> <span data-ttu-id="99baf-370">Voir [Instructions relatives aux nouvelles tentatives de Service Bus][sb-retry].</span><span class="sxs-lookup"><span data-stu-id="99baf-370">See [Service Bus retry guidelines][sb-retry].</span></span>
2. <span data-ttu-id="99baf-371">Les messages ne pouvant être remis au récepteur sont placés dans une *file d’attente de lettres mortes*.</span><span class="sxs-lookup"><span data-stu-id="99baf-371">Messages that cannot be delivered to any receiver are placed in a *dead-letter queue*.</span></span> <span data-ttu-id="99baf-372">Utilisez cette file d’attente pour voir les messages non reçus.</span><span class="sxs-lookup"><span data-stu-id="99baf-372">Use this queue to see which messages could not be received.</span></span> <span data-ttu-id="99baf-373">Notez que la file d’attente de lettres mortes n’est pas nettoyée automatiquement.</span><span class="sxs-lookup"><span data-stu-id="99baf-373">There is no automatic cleanup of the dead-letter queue.</span></span> <span data-ttu-id="99baf-374">Les messages y restent jusqu'à ce que vous les récupériez.</span><span class="sxs-lookup"><span data-stu-id="99baf-374">Messages remain there until you explicitly retrieve them.</span></span> <span data-ttu-id="99baf-375">Voir [Vue d’ensemble des files d’attente de lettres mortes Service Bus][sb-dead-letter-queue].</span><span class="sxs-lookup"><span data-stu-id="99baf-375">See [Overview of Service Bus dead-letter queues][sb-dead-letter-queue].</span></span>

### <a name="writing-a-message-to-a-service-bus-queue-fails"></a><span data-ttu-id="99baf-376">Échec de l’écriture d’un message vers une file d’attente Service Bus.</span><span class="sxs-lookup"><span data-stu-id="99baf-376">Writing a message to a Service Bus queue fails.</span></span>
<span data-ttu-id="99baf-377">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-377">**Detection**.</span></span> <span data-ttu-id="99baf-378">Interceptez les exceptions à partir du kit de développement logiciel client.</span><span class="sxs-lookup"><span data-stu-id="99baf-378">Catch exceptions from the client SDK.</span></span> <span data-ttu-id="99baf-379">La classe de base pour les exceptions Service Bus est [MessagingException][sb-messagingexception-class].</span><span class="sxs-lookup"><span data-stu-id="99baf-379">The base class for Service Bus exceptions is [MessagingException][sb-messagingexception-class].</span></span> <span data-ttu-id="99baf-380">Si l’erreur est temporaire, la propriété `IsTransient` a la valeur True.</span><span class="sxs-lookup"><span data-stu-id="99baf-380">If the error is transient, the `IsTransient` property is true.</span></span>

<span data-ttu-id="99baf-381">Pour plus d’informations, consultez [Exceptions de la messagerie Service Bus][sb-messaging-exceptions].</span><span class="sxs-lookup"><span data-stu-id="99baf-381">For more information, see [Service Bus messaging exceptions][sb-messaging-exceptions].</span></span>

<span data-ttu-id="99baf-382">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-382">**Recovery**</span></span>

1. <span data-ttu-id="99baf-383">Le client Service Bus fait automatiquement une nouvelle tentative après les erreurs transitoires.</span><span class="sxs-lookup"><span data-stu-id="99baf-383">The Service Bus client automatically retries after transient errors.</span></span> <span data-ttu-id="99baf-384">Par défaut, il utilise une temporisation exponentielle.</span><span class="sxs-lookup"><span data-stu-id="99baf-384">By default, it uses exponential back-off.</span></span> <span data-ttu-id="99baf-385">Après avoir atteint le nombre de tentatives ou le délai d’attente maximal, le client lève une exception.</span><span class="sxs-lookup"><span data-stu-id="99baf-385">After the maximum retry count or maximum timeout period, the client throws an exception.</span></span> <span data-ttu-id="99baf-386">Pour plus d’informations, consultez [Instructions relatives aux nouvelles tentatives Service Bus][sb-retry].</span><span class="sxs-lookup"><span data-stu-id="99baf-386">For more information, see [Service Bus retry guidelines][sb-retry].</span></span>
2. <span data-ttu-id="99baf-387">Si le quota de file d’attente est dépassé, le client lève [QuotaExceededException][QuotaExceededException].</span><span class="sxs-lookup"><span data-stu-id="99baf-387">If the queue quota is exceeded, the client throws [QuotaExceededException][QuotaExceededException].</span></span> <span data-ttu-id="99baf-388">Le message de l'exception donne plus d'informations.</span><span class="sxs-lookup"><span data-stu-id="99baf-388">The exception message gives more details.</span></span> <span data-ttu-id="99baf-389">Retirez des messages de la file d’attente avant une nouvelle tentative et envisagez l’utilisation du modèle disjoncteur pour éviter les tentatives continues lorsque le quota est dépassé.</span><span class="sxs-lookup"><span data-stu-id="99baf-389">Drain some messages from the queue before retrying, and consider using the Circuit Breaker pattern to avoid continued retries while the quota is exceeded.</span></span> <span data-ttu-id="99baf-390">En outre, assurez-vous que la propriété [BrokeredMessage.TimeToLive] n’est pas définie sur une valeur trop élevée.</span><span class="sxs-lookup"><span data-stu-id="99baf-390">Also, make sure the [BrokeredMessage.TimeToLive] property is not set too high.</span></span>
3. <span data-ttu-id="99baf-391">Dans une région, la résilience peut être améliorée en utilisant des [files d’attente ou rubriques partitionnées][sb-partition].</span><span class="sxs-lookup"><span data-stu-id="99baf-391">Within a region, resiliency can be improved by using [partitioned queues or topics][sb-partition].</span></span> <span data-ttu-id="99baf-392">Une file d’attente ou une rubrique non partitionnée est affectée à une banque de messagerie.</span><span class="sxs-lookup"><span data-stu-id="99baf-392">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="99baf-393">Si cette banque de messagerie n’est pas disponible, toutes les opérations sur cette file d’attente ou rubrique échoueront.</span><span class="sxs-lookup"><span data-stu-id="99baf-393">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span> <span data-ttu-id="99baf-394">Une file d’attente ou une rubrique partitionnée est partitionnée entre plusieurs banques de messagerie.</span><span class="sxs-lookup"><span data-stu-id="99baf-394">A partitioned queue or topic is partitioned across multiple messaging stores.</span></span>
4. <span data-ttu-id="99baf-395">Pour assurer une meilleure résilience, créez deux espaces de noms Service Bus dans différentes régions et répliquez les messages.</span><span class="sxs-lookup"><span data-stu-id="99baf-395">For additional resiliency, create two Service Bus namespaces in different regions, and replicate the messages.</span></span> <span data-ttu-id="99baf-396">Vous pouvez utiliser une réplication active ou passive.</span><span class="sxs-lookup"><span data-stu-id="99baf-396">You can use either active replication or passive replication.</span></span>

   * <span data-ttu-id="99baf-397">Réplication active : le client envoie tous les messages à chaque file d’attente.</span><span class="sxs-lookup"><span data-stu-id="99baf-397">Active replication: The client sends every message to both queues.</span></span> <span data-ttu-id="99baf-398">Le récepteur écoute chaque file d’attente.</span><span class="sxs-lookup"><span data-stu-id="99baf-398">The receiver listens on both queues.</span></span> <span data-ttu-id="99baf-399">Les messages ont une balise avec un identificateur unique, afin que le client puisse ignorer les messages en double.</span><span class="sxs-lookup"><span data-stu-id="99baf-399">Tag messages with a unique identifier, so the client can discard duplicate messages.</span></span>
   * <span data-ttu-id="99baf-400">Réplication passive : le client envoie les messages à une seule file d’attente.</span><span class="sxs-lookup"><span data-stu-id="99baf-400">Passive replication: The client sends the message to one queue.</span></span> <span data-ttu-id="99baf-401">En cas d’erreur, le client effectue un envoi vers une autre file d’attente.</span><span class="sxs-lookup"><span data-stu-id="99baf-401">If there is an error, the client falls back to the other queue.</span></span> <span data-ttu-id="99baf-402">Le récepteur écoute chaque file d’attente.</span><span class="sxs-lookup"><span data-stu-id="99baf-402">The receiver listens on both queues.</span></span> <span data-ttu-id="99baf-403">Cette approche réduit le nombre de messages en double envoyés.</span><span class="sxs-lookup"><span data-stu-id="99baf-403">This approach reduces the number of duplicate messages that are sent.</span></span> <span data-ttu-id="99baf-404">Toutefois, le récepteur doit toujours gérer les messages en double.</span><span class="sxs-lookup"><span data-stu-id="99baf-404">However, the receiver must still handle duplicate messages.</span></span>

     <span data-ttu-id="99baf-405">Pour plus d’informations, consultez la section [Exemple de géoréplication][sb-georeplication-sample] et [Meilleures pratiques pour protéger les applications contre les pannes de Service Bus et les sinistres](/azure/service-bus-messaging/service-bus-outages-disasters/).</span><span class="sxs-lookup"><span data-stu-id="99baf-405">For more information, see [GeoReplication sample][sb-georeplication-sample] and [Best practices for insulating applications against Service Bus outages and disasters](/azure/service-bus-messaging/service-bus-outages-disasters/).</span></span>

### <a name="duplicate-message"></a><span data-ttu-id="99baf-406">Messages en double.</span><span class="sxs-lookup"><span data-stu-id="99baf-406">Duplicate message.</span></span>
<span data-ttu-id="99baf-407">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-407">**Detection**.</span></span> <span data-ttu-id="99baf-408">Examinez les propriété `MessageId` et `DeliveryCount` du message.</span><span class="sxs-lookup"><span data-stu-id="99baf-408">Examine the `MessageId` and `DeliveryCount` properties of the message.</span></span>

<span data-ttu-id="99baf-409">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-409">**Recovery**</span></span>

* <span data-ttu-id="99baf-410">Si possible, concevez vos opérations de traitement des messages de sorte qu’elles soient idempotentes.</span><span class="sxs-lookup"><span data-stu-id="99baf-410">If possible, design your message processing operations to be idempotent.</span></span> <span data-ttu-id="99baf-411">Dans le cas contraire, stockez les ID des messages déjà traités et vérifiez l’ID avant de traiter un message.</span><span class="sxs-lookup"><span data-stu-id="99baf-411">Otherwise, store message IDs of messages that are already processed, and check the ID before processing a message.</span></span>
* <span data-ttu-id="99baf-412">Activez la détection des doublons, en créant la file d’attente avec `RequiresDuplicateDetection` défini sur True.</span><span class="sxs-lookup"><span data-stu-id="99baf-412">Enable duplicate detection, by creating the queue with `RequiresDuplicateDetection` set to true.</span></span> <span data-ttu-id="99baf-413">Avec ce paramètre, Service Bus supprime automatiquement n’importe quel message envoyé avec le même `MessageId` qu’un message précédent.</span><span class="sxs-lookup"><span data-stu-id="99baf-413">With this setting, Service Bus automatically deletes any message that is sent with the same `MessageId` as a previous message.</span></span>  <span data-ttu-id="99baf-414">Notez les points suivants :</span><span class="sxs-lookup"><span data-stu-id="99baf-414">Note the following:</span></span>

  * <span data-ttu-id="99baf-415">Ce paramètre empêche les messages en double d’être placés dans la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="99baf-415">This setting prevents duplicate messages from being put into the queue.</span></span> <span data-ttu-id="99baf-416">Il n’empêche pas un récepteur de traiter le même message plusieurs fois.</span><span class="sxs-lookup"><span data-stu-id="99baf-416">It doesn't prevent a receiver from processing the same message more than once.</span></span>
  * <span data-ttu-id="99baf-417">La détection des doublons est dotée d’une fenêtre de temps.</span><span class="sxs-lookup"><span data-stu-id="99baf-417">Duplicate detection has a time window.</span></span> <span data-ttu-id="99baf-418">Si un doublon est envoyé au-delà de cette fenêtre, il ne sera pas détecté.</span><span class="sxs-lookup"><span data-stu-id="99baf-418">If a duplicate is sent beyond this window, it won't be detected.</span></span>

<span data-ttu-id="99baf-419">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-419">**Diagnostics**.</span></span> <span data-ttu-id="99baf-420">Journalisation des messages en double.</span><span class="sxs-lookup"><span data-stu-id="99baf-420">Log duplicated messages.</span></span>

### <a name="the-application-cannot-process-a-particular-message-from-the-queue"></a><span data-ttu-id="99baf-421">L’application ne peut pas traiter un message particulier à partir de la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="99baf-421">The application cannot process a particular message from the queue.</span></span>
<span data-ttu-id="99baf-422">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-422">**Detection**.</span></span> <span data-ttu-id="99baf-423">Spécifique à l’application.</span><span class="sxs-lookup"><span data-stu-id="99baf-423">Application specific.</span></span> <span data-ttu-id="99baf-424">Par exemple, le message contient des données non valides, ou la logique métier échoue pour une raison quelconque.</span><span class="sxs-lookup"><span data-stu-id="99baf-424">For example, the message contains invalid data, or the business logic fails for some reason.</span></span>

<span data-ttu-id="99baf-425">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-425">**Recovery**</span></span>

<span data-ttu-id="99baf-426">Il existe deux modes d’échec à prendre en compte.</span><span class="sxs-lookup"><span data-stu-id="99baf-426">There are two failure modes to consider.</span></span>

* <span data-ttu-id="99baf-427">Le récepteur détecte l’échec.</span><span class="sxs-lookup"><span data-stu-id="99baf-427">The receiver detects the failure.</span></span> <span data-ttu-id="99baf-428">Dans un tel cas, déplacez le message vers la file d'attente de lettres mortes.</span><span class="sxs-lookup"><span data-stu-id="99baf-428">In this case, move the message to the dead-letter queue.</span></span> <span data-ttu-id="99baf-429">Plus tard, exécutez un processus séparé pour examiner les messages dans cette file d’attente.</span><span class="sxs-lookup"><span data-stu-id="99baf-429">Later, run a separate process to examine the messages in the dead-letter queue.</span></span>
* <span data-ttu-id="99baf-430">Le récepteur échoue au milieu du traitement du message &mdash;, par exemple, en raison d’une exception non prise en charge.</span><span class="sxs-lookup"><span data-stu-id="99baf-430">The receiver fails in the middle of processing the message &mdash; for example, due to an unhandled exception.</span></span> <span data-ttu-id="99baf-431">Pour gérer ce cas, utilisez le mode `PeekLock`.</span><span class="sxs-lookup"><span data-stu-id="99baf-431">To handle this case, use `PeekLock` mode.</span></span> <span data-ttu-id="99baf-432">Dans ce mode, si le verrou expire, le message est rendu disponible aux autres récepteurs.</span><span class="sxs-lookup"><span data-stu-id="99baf-432">In this mode, if the lock expires, the message becomes available to other receivers.</span></span> <span data-ttu-id="99baf-433">Si le message dépasse le nombre maximal de diffusions ou la durée de vie, il est automatiquement déplacé vers la file d’attente de lettres mortes.</span><span class="sxs-lookup"><span data-stu-id="99baf-433">If the message exceeds the maximum delivery count or the time-to-live, the message is automatically moved to the dead-letter queue.</span></span>

<span data-ttu-id="99baf-434">Pour plus d’informations, voir [Vue d’ensemble des files d’attente de lettres mortes Service Bus][sb-dead-letter-queue].</span><span class="sxs-lookup"><span data-stu-id="99baf-434">For more information, see [Overview of Service Bus dead-letter queues][sb-dead-letter-queue].</span></span>

<span data-ttu-id="99baf-435">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-435">**Diagnostics**.</span></span> <span data-ttu-id="99baf-436">Chaque fois que l’application déplace un message dans la file d’attente de lettres mortes, écrivez un événement dans les journaux des applications.</span><span class="sxs-lookup"><span data-stu-id="99baf-436">Whenever the application moves a message to the dead-letter queue, write an event to the application logs.</span></span>

## <a name="service-fabric"></a><span data-ttu-id="99baf-437">Service Fabric</span><span class="sxs-lookup"><span data-stu-id="99baf-437">Service Fabric</span></span>
### <a name="a-request-to-a-service-fails"></a><span data-ttu-id="99baf-438">Une requête vers un service échoue.</span><span class="sxs-lookup"><span data-stu-id="99baf-438">A request to a service fails.</span></span>
<span data-ttu-id="99baf-439">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-439">**Detection**.</span></span> <span data-ttu-id="99baf-440">Le service retourne une erreur.</span><span class="sxs-lookup"><span data-stu-id="99baf-440">The service returns an error.</span></span>

<span data-ttu-id="99baf-441">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-441">**Recovery**</span></span>

* <span data-ttu-id="99baf-442">Recherchez de nouveau un proxy (`ServiceProxy` ou `ActorProxy`) et appelez de nouveau la méthode de service/acteur.</span><span class="sxs-lookup"><span data-stu-id="99baf-442">Locate a proxy again (`ServiceProxy` or `ActorProxy`) and call the service/actor method again.</span></span>
* <span data-ttu-id="99baf-443">**Service avec état**.</span><span class="sxs-lookup"><span data-stu-id="99baf-443">**Stateful service**.</span></span> <span data-ttu-id="99baf-444">Wrappez les opérations sur des collections fiables dans une transaction.</span><span class="sxs-lookup"><span data-stu-id="99baf-444">Wrap operations on reliable collections in a transaction.</span></span> <span data-ttu-id="99baf-445">En cas d’erreur, la transaction sera restaurée.</span><span class="sxs-lookup"><span data-stu-id="99baf-445">If there is an error, the transaction will be rolled back.</span></span> <span data-ttu-id="99baf-446">La requête, si elle est extraite d’une file d’attente, sera traitée à nouveau.</span><span class="sxs-lookup"><span data-stu-id="99baf-446">The request, if pulled from a queue, will be processed again.</span></span>
* <span data-ttu-id="99baf-447">**Service sans état**.</span><span class="sxs-lookup"><span data-stu-id="99baf-447">**Stateless service**.</span></span> <span data-ttu-id="99baf-448">Si le service conserve des données dans un magasin externe, toutes les opérations doivent être idempotentes.</span><span class="sxs-lookup"><span data-stu-id="99baf-448">If the service persists data to an external store, all operations need to be idempotent.</span></span>

<span data-ttu-id="99baf-449">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-449">**Diagnostics**.</span></span> <span data-ttu-id="99baf-450">Journal des application</span><span class="sxs-lookup"><span data-stu-id="99baf-450">Application log</span></span>

### <a name="service-fabric-node-is-shut-down"></a><span data-ttu-id="99baf-451">Le nœud de Service Fabric est arrêté.</span><span class="sxs-lookup"><span data-stu-id="99baf-451">Service Fabric node is shut down.</span></span>
<span data-ttu-id="99baf-452">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-452">**Detection**.</span></span> <span data-ttu-id="99baf-453">Un jeton d’annulation est passé à la méthode `RunAsync` du service.</span><span class="sxs-lookup"><span data-stu-id="99baf-453">A cancellation token is passed to the service's `RunAsync` method.</span></span> <span data-ttu-id="99baf-454">Service Fabric annule la tâche avant l’arrêt du nœud.</span><span class="sxs-lookup"><span data-stu-id="99baf-454">Service Fabric cancels the task before shutting down the node.</span></span>

<span data-ttu-id="99baf-455">**Récupération**.</span><span class="sxs-lookup"><span data-stu-id="99baf-455">**Recovery**.</span></span> <span data-ttu-id="99baf-456">Utilisez le jeton d’annulation pour détecter l’arrêt.</span><span class="sxs-lookup"><span data-stu-id="99baf-456">Use the cancellation token to detect shutdown.</span></span> <span data-ttu-id="99baf-457">Lorsque Service Fabric demande l’annulation, terminez votre travail et quittez `RunAsync` aussi rapidement que possible.</span><span class="sxs-lookup"><span data-stu-id="99baf-457">When Service Fabric requests cancellation, finish any work and exit `RunAsync` as quickly as possible.</span></span>

<span data-ttu-id="99baf-458">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-458">**Diagnostics**.</span></span> <span data-ttu-id="99baf-459">Journaux d’application</span><span class="sxs-lookup"><span data-stu-id="99baf-459">Application logs</span></span>

## <a name="storage"></a><span data-ttu-id="99baf-460">Stockage</span><span class="sxs-lookup"><span data-stu-id="99baf-460">Storage</span></span>
### <a name="writing-data-to-azure-storage-fails"></a><span data-ttu-id="99baf-461">L’écriture de données sur Stockage Azure échoue</span><span class="sxs-lookup"><span data-stu-id="99baf-461">Writing data to Azure Storage fails</span></span>
<span data-ttu-id="99baf-462">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-462">**Detection**.</span></span> <span data-ttu-id="99baf-463">Le client reçoit des erreurs lors de l’écriture.</span><span class="sxs-lookup"><span data-stu-id="99baf-463">The client receives errors when writing.</span></span>

<span data-ttu-id="99baf-464">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-464">**Recovery**</span></span>

1. <span data-ttu-id="99baf-465">Recommencez l’opération pour récupérer après des défaillances temporaires.</span><span class="sxs-lookup"><span data-stu-id="99baf-465">Retry the operation, to recover from transient failures.</span></span> <span data-ttu-id="99baf-466">La [stratégie de nouvelles tentatives][Storage.RetryPolicies] dans le kit de développement logiciel client gère cela automatiquement.</span><span class="sxs-lookup"><span data-stu-id="99baf-466">The [retry policy][Storage.RetryPolicies] in the client SDK handles this automatically.</span></span>
2. <span data-ttu-id="99baf-467">Implémentez le modèle disjoncteur pour éviter une surcharge de stockage.</span><span class="sxs-lookup"><span data-stu-id="99baf-467">Implement the Circuit Breaker pattern to avoid overwhelming storage.</span></span>
3. <span data-ttu-id="99baf-468">Si N tentatives échouent, exécutez une procédure de secours appropriée.</span><span class="sxs-lookup"><span data-stu-id="99baf-468">If N retry attempts fail, perform a graceful fallback.</span></span> <span data-ttu-id="99baf-469">Par exemple : </span><span class="sxs-lookup"><span data-stu-id="99baf-469">For example:</span></span>

   * <span data-ttu-id="99baf-470">Stockez les données dans un cache local et transférez les écritures dans le stockage plus tard, lorsque le service devient disponible.</span><span class="sxs-lookup"><span data-stu-id="99baf-470">Store the data in a local cache, and forward the writes to storage later, when the service becomes available.</span></span>
   * <span data-ttu-id="99baf-471">Si l’action d’écriture se trouvait dans une étendue transactionnelle, compensez la transaction.</span><span class="sxs-lookup"><span data-stu-id="99baf-471">If the write action was in a transactional scope, compensate the transaction.</span></span>

<span data-ttu-id="99baf-472">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-472">**Diagnostics**.</span></span> <span data-ttu-id="99baf-473">Utilisez les [métriques de stockage][storage-metrics].</span><span class="sxs-lookup"><span data-stu-id="99baf-473">Use [storage metrics][storage-metrics].</span></span>

### <a name="reading-data-from-azure-storage-fails"></a><span data-ttu-id="99baf-474">La lecture des données à partir de Stockage Azure échoue.</span><span class="sxs-lookup"><span data-stu-id="99baf-474">Reading data from Azure Storage fails.</span></span>
<span data-ttu-id="99baf-475">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-475">**Detection**.</span></span> <span data-ttu-id="99baf-476">Le client reçoit des erreurs lors de la lecture.</span><span class="sxs-lookup"><span data-stu-id="99baf-476">The client receives errors when reading.</span></span>

<span data-ttu-id="99baf-477">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-477">**Recovery**</span></span>

1. <span data-ttu-id="99baf-478">Recommencez l’opération pour récupérer après des défaillances temporaires.</span><span class="sxs-lookup"><span data-stu-id="99baf-478">Retry the operation, to recover from transient failures.</span></span> <span data-ttu-id="99baf-479">La [stratégie de nouvelles tentatives][Storage.RetryPolicies] dans le kit de développement logiciel client gère cela automatiquement.</span><span class="sxs-lookup"><span data-stu-id="99baf-479">The [retry policy][Storage.RetryPolicies] in the client SDK handles this automatically.</span></span>
2. <span data-ttu-id="99baf-480">Pour le stockage RA-GRS, si la lecture depuis le point de terminaison principal échoue, essayez de lire à partir du point de terminaison secondaire.</span><span class="sxs-lookup"><span data-stu-id="99baf-480">For RA-GRS storage, if reading from the primary endpoint fails, try reading from the secondary endpoint.</span></span> <span data-ttu-id="99baf-481">Le kit de développement logiciel client permet de gérer cela automatiquement.</span><span class="sxs-lookup"><span data-stu-id="99baf-481">The client SDK can handle this automatically.</span></span> <span data-ttu-id="99baf-482">Voir [Réplication Stockage Azure][storage-replication].</span><span class="sxs-lookup"><span data-stu-id="99baf-482">See [Azure Storage replication][storage-replication].</span></span>
3. <span data-ttu-id="99baf-483">Si *N* nouvelles tentatives échouent, effectuez une action de secours pour une dégradation normale.</span><span class="sxs-lookup"><span data-stu-id="99baf-483">If *N* retry attempts fail, take a fallback action to degrade gracefully.</span></span> <span data-ttu-id="99baf-484">Par exemple, si une image du produit ne peut pas être récupérée à partir du stockage, affichez une image générique d’espace réservé.</span><span class="sxs-lookup"><span data-stu-id="99baf-484">For example, if a product image can't be retrieved from storage, show a generic placeholder image.</span></span>

<span data-ttu-id="99baf-485">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-485">**Diagnostics**.</span></span> <span data-ttu-id="99baf-486">Utilisez les [métriques de stockage][storage-metrics].</span><span class="sxs-lookup"><span data-stu-id="99baf-486">Use [storage metrics][storage-metrics].</span></span>

## <a name="virtual-machine"></a><span data-ttu-id="99baf-487">Machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="99baf-487">Virtual Machine</span></span>
### <a name="connection-to-a-backend-vm-fails"></a><span data-ttu-id="99baf-488">Échec de la connexion à une machine virtuelle principale.</span><span class="sxs-lookup"><span data-stu-id="99baf-488">Connection to a backend VM fails.</span></span>
<span data-ttu-id="99baf-489">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-489">**Detection**.</span></span> <span data-ttu-id="99baf-490">Erreurs de connexion réseau.</span><span class="sxs-lookup"><span data-stu-id="99baf-490">Network connection errors.</span></span>

<span data-ttu-id="99baf-491">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-491">**Recovery**</span></span>

* <span data-ttu-id="99baf-492">Déployez au moins deux machines virtuelles principales dans un groupe à haute disponibilité, derrière un équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="99baf-492">Deploy at least two backend VMs in an availability set, behind a load balancer.</span></span>
* <span data-ttu-id="99baf-493">Si l’erreur de connexion est temporaire, il est possible que TCP arrive à envoyer le message correctement lors d’une nouvelle tentative.</span><span class="sxs-lookup"><span data-stu-id="99baf-493">If the connection error is transient, sometimes TCP will successfully retry sending the message.</span></span>
* <span data-ttu-id="99baf-494">Implémentez une stratégie de nouvelles tentatives dans l’application.</span><span class="sxs-lookup"><span data-stu-id="99baf-494">Implement a retry policy in the application.</span></span>
* <span data-ttu-id="99baf-495">Pour les erreurs persistantes ou non temporaires, vous devez implémenter le modèle [disjoncteur][circuit-breaker].</span><span class="sxs-lookup"><span data-stu-id="99baf-495">For persistent or non-transient errors, implement the [Circuit Breaker][circuit-breaker] pattern.</span></span>
* <span data-ttu-id="99baf-496">Si la machine virtuelle appelante dépasse sa limite de sortie réseau, la file d’attente sortante va saturer.</span><span class="sxs-lookup"><span data-stu-id="99baf-496">If the calling VM exceeds its network egress limit, the outbound queue will fill up.</span></span> <span data-ttu-id="99baf-497">Si la file d’attente sortante est constamment pleine, envisagez une montée en charge.</span><span class="sxs-lookup"><span data-stu-id="99baf-497">If the outbound queue is consistently full, consider scaling out.</span></span>

<span data-ttu-id="99baf-498">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-498">**Diagnostics**.</span></span> <span data-ttu-id="99baf-499">Journalisation des événements au niveau des limites de service.</span><span class="sxs-lookup"><span data-stu-id="99baf-499">Log events at service boundaries.</span></span>

### <a name="vm-instance-becomes-unavailable-or-unhealthy"></a><span data-ttu-id="99baf-500">Une instance de machine virtuelle est indisponible ou défectueuse.</span><span class="sxs-lookup"><span data-stu-id="99baf-500">VM instance becomes unavailable or unhealthy.</span></span>
<span data-ttu-id="99baf-501">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-501">**Detection**.</span></span> <span data-ttu-id="99baf-502">Configurez une [sonde d’intégrité][lb-probe] de l’équilibreur de charge qui signale si l’instance de machine virtuelle est saine.</span><span class="sxs-lookup"><span data-stu-id="99baf-502">Configure a Load Balancer [health probe][lb-probe] that signals whether the VM instance is healthy.</span></span> <span data-ttu-id="99baf-503">La sonde devrait vérifier si les fonctions essentielles répondent correctement.</span><span class="sxs-lookup"><span data-stu-id="99baf-503">The probe should check whether critical functions are responding correctly.</span></span>

<span data-ttu-id="99baf-504">**Récupération**.</span><span class="sxs-lookup"><span data-stu-id="99baf-504">**Recovery**.</span></span> <span data-ttu-id="99baf-505">Pour chaque couche d’application, placez plusieurs instances de machine virtuelle dans le même groupe à haute disponibilité et placez un équilibreur de charge devant les machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="99baf-505">For each application tier, put multiple VM instances into the same availability set, and place a load balancer in front of the VMs.</span></span> <span data-ttu-id="99baf-506">Si une sonde ne répond pas, l’équilibreur de charge n’envoie plus de nouvelles connexions à l’instance défectueuse.</span><span class="sxs-lookup"><span data-stu-id="99baf-506">If the health probe fails, the Load Balancer stops sending new connections to the unhealthy instance.</span></span>

<span data-ttu-id="99baf-507">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-507">**Diagnostics**.</span></span> <span data-ttu-id="99baf-508">- Utilisez [l’analyse des journaux][lb-monitor] de l’équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="99baf-508">- Use Load Balancer [log analytics][lb-monitor].</span></span>

* <span data-ttu-id="99baf-509">Configurer votre système de surveillance pour surveiller tous les points de terminaison d’analyse du fonctionnement.</span><span class="sxs-lookup"><span data-stu-id="99baf-509">Configure your monitoring system to monitor all of the health monitoring endpoints.</span></span>

### <a name="operator-accidentally-shuts-down-a-vm"></a><span data-ttu-id="99baf-510">Un opérateur arrête accidentellement une machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="99baf-510">Operator accidentally shuts down a VM.</span></span>
<span data-ttu-id="99baf-511">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-511">**Detection**.</span></span> <span data-ttu-id="99baf-512">N/A</span><span class="sxs-lookup"><span data-stu-id="99baf-512">N/A</span></span>

<span data-ttu-id="99baf-513">**Récupération**.</span><span class="sxs-lookup"><span data-stu-id="99baf-513">**Recovery**.</span></span> <span data-ttu-id="99baf-514">Définissez un verrou de ressource avec un niveau `ReadOnly`.</span><span class="sxs-lookup"><span data-stu-id="99baf-514">Set a resource lock with `ReadOnly` level.</span></span> <span data-ttu-id="99baf-515">Consultez [Verrouiller des ressources avec Azure Resource Manager][rm-locks].</span><span class="sxs-lookup"><span data-stu-id="99baf-515">See [Lock resources with Azure Resource Manager][rm-locks].</span></span>

<span data-ttu-id="99baf-516">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-516">**Diagnostics**.</span></span> <span data-ttu-id="99baf-517">Utilisez les [Journaux d’activité Azure][azure-activity-logs].</span><span class="sxs-lookup"><span data-stu-id="99baf-517">Use [Azure Activity Logs][azure-activity-logs].</span></span>

## <a name="webjobs"></a><span data-ttu-id="99baf-518">WebJobs</span><span class="sxs-lookup"><span data-stu-id="99baf-518">WebJobs</span></span>
### <a name="continuous-job-stops-running-when-the-scm-host-is-idle"></a><span data-ttu-id="99baf-519">La tâche en continu s’arrête lorsque l’hôte SCM est inactif.</span><span class="sxs-lookup"><span data-stu-id="99baf-519">Continuous job stops running when the SCM host is idle.</span></span>
<span data-ttu-id="99baf-520">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-520">**Detection**.</span></span> <span data-ttu-id="99baf-521">Passez un jeton d’annulation à la fonction WebJob.</span><span class="sxs-lookup"><span data-stu-id="99baf-521">Pass a cancellation token to the WebJob function.</span></span> <span data-ttu-id="99baf-522">Pour plus d’informations, consultez [Arrêt correct][web-jobs-shutdown].</span><span class="sxs-lookup"><span data-stu-id="99baf-522">For more information, see [Graceful shutdown][web-jobs-shutdown].</span></span>

<span data-ttu-id="99baf-523">**Récupération**.</span><span class="sxs-lookup"><span data-stu-id="99baf-523">**Recovery**.</span></span> <span data-ttu-id="99baf-524">Activez le paramètre `Always On` dans l’application web.</span><span class="sxs-lookup"><span data-stu-id="99baf-524">Enable the `Always On` setting in the web app.</span></span> <span data-ttu-id="99baf-525">Pour plus d’informations, consultez [Exécuter des tâches en arrière-plan avec Webjobs][web-jobs].</span><span class="sxs-lookup"><span data-stu-id="99baf-525">For more information, see [Run Background tasks with WebJobs][web-jobs].</span></span>

## <a name="application-design"></a><span data-ttu-id="99baf-526">Conception des applications</span><span class="sxs-lookup"><span data-stu-id="99baf-526">Application design</span></span>
### <a name="application-cant-handle-a-spike-in-incoming-requests"></a><span data-ttu-id="99baf-527">L’application ne peut pas gérer un pic de requêtes entrantes.</span><span class="sxs-lookup"><span data-stu-id="99baf-527">Application can't handle a spike in incoming requests.</span></span>
<span data-ttu-id="99baf-528">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-528">**Detection**.</span></span> <span data-ttu-id="99baf-529">Dépend de l’application.</span><span class="sxs-lookup"><span data-stu-id="99baf-529">Depends on the application.</span></span> <span data-ttu-id="99baf-530">Symptômes courants :</span><span class="sxs-lookup"><span data-stu-id="99baf-530">Typical symptoms:</span></span>

* <span data-ttu-id="99baf-531">Le site Web démarre en renvoyant des codes d’erreur HTTP 5xx.</span><span class="sxs-lookup"><span data-stu-id="99baf-531">The website starts returning HTTP 5xx error codes.</span></span>
* <span data-ttu-id="99baf-532">Les services dépendants, tels que la base de données ou le stockage, commencent à limiter les requêtes.</span><span class="sxs-lookup"><span data-stu-id="99baf-532">Dependent services, such as database or storage, start to throttle requests.</span></span> <span data-ttu-id="99baf-533">Recherchez des erreurs HTTP tels que HTTP 429 (trop de demandes), en fonction du service.</span><span class="sxs-lookup"><span data-stu-id="99baf-533">Look for HTTP errors such as HTTP 429 (Too Many Requests), depending on the service.</span></span>
* <span data-ttu-id="99baf-534">La longueur de la file d’attente HTTP augmente.</span><span class="sxs-lookup"><span data-stu-id="99baf-534">HTTP queue length grows.</span></span>

<span data-ttu-id="99baf-535">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-535">**Recovery**</span></span>

* <span data-ttu-id="99baf-536">Montez en charge pour traiter une charge accrue.</span><span class="sxs-lookup"><span data-stu-id="99baf-536">Scale out to handle increased load.</span></span>
* <span data-ttu-id="99baf-537">Atténuez les échecs pour éviter que les pannes en cascade interrompent toute l’application.</span><span class="sxs-lookup"><span data-stu-id="99baf-537">Mitigate failures to avoid having cascading failures disrupt the entire application.</span></span> <span data-ttu-id="99baf-538">Les stratégies d’atténuation comprennent :</span><span class="sxs-lookup"><span data-stu-id="99baf-538">Mitigation strategies include:</span></span>

  * <span data-ttu-id="99baf-539">Implémentez le [Modèle de limitation][throttling-pattern] afin d’éviter de déborder les systèmes principaux.</span><span class="sxs-lookup"><span data-stu-id="99baf-539">Implement the [Throttling Pattern][throttling-pattern] to avoid overwhelming backend systems.</span></span>
  * <span data-ttu-id="99baf-540">Utilisez le [nivellement de la charge basé sur une file d’attente][queue-based-load-leveling] pour mettre les demandes en mémoire tampon et les traiter à un rythme approprié.</span><span class="sxs-lookup"><span data-stu-id="99baf-540">Use [queue-based load leveling][queue-based-load-leveling] to buffer requests and process them at an appropriate pace.</span></span>
  * <span data-ttu-id="99baf-541">Classez certains clients par priorité.</span><span class="sxs-lookup"><span data-stu-id="99baf-541">Prioritize certain clients.</span></span> <span data-ttu-id="99baf-542">Par exemple, si l’application possède des niveaux gratuits et payants, limitez les clients disposant du niveau gratuit, mais pas ceux disposant d’un niveau payant.</span><span class="sxs-lookup"><span data-stu-id="99baf-542">For example, if the application has free and paid tiers, throttle customers on the free tier, but not paid customers.</span></span> <span data-ttu-id="99baf-543">Voir [Modèle de file d’attente de priorité][priority-queue-pattern].</span><span class="sxs-lookup"><span data-stu-id="99baf-543">See [Priority queue pattern][priority-queue-pattern].</span></span>

<span data-ttu-id="99baf-544">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-544">**Diagnostics**.</span></span> <span data-ttu-id="99baf-545">Utilisez la [Journalisation des diagnostics de App Service][app-service-logging].</span><span class="sxs-lookup"><span data-stu-id="99baf-545">Use [App Service diagnostic logging][app-service-logging].</span></span> <span data-ttu-id="99baf-546">Utilisez un service tel que [Azure Log Analytics][azure-log-analytics], [Application Insights][app-insights], ou [New Relic] [ new-relic] pour aider à comprendre les journaux de diagnostic.</span><span class="sxs-lookup"><span data-stu-id="99baf-546">Use a service such as [Azure Log Analytics][azure-log-analytics], [Application Insights][app-insights], or [New Relic][new-relic] to help understand the diagnostic logs.</span></span>

### <a name="one-of-the-operations-in-a-workflow-or-distributed-transaction-fails"></a><span data-ttu-id="99baf-547">L’une des opérations d’un flux de travail ou d’une transaction distribuée a échoué.</span><span class="sxs-lookup"><span data-stu-id="99baf-547">One of the operations in a workflow or distributed transaction fails.</span></span>
<span data-ttu-id="99baf-548">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-548">**Detection**.</span></span> <span data-ttu-id="99baf-549">Après *N* nouvelles tentatives, elle échoue toujours.</span><span class="sxs-lookup"><span data-stu-id="99baf-549">After *N* retry attempts, it still fails.</span></span>

<span data-ttu-id="99baf-550">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-550">**Recovery**</span></span>

* <span data-ttu-id="99baf-551">En tant qu’un plan d’atténuation, implémentez le modèle [Superviseur de l’agent du planificateur][scheduler-agent-supervisor] pour gérer l’intégralité du workflow.</span><span class="sxs-lookup"><span data-stu-id="99baf-551">As a mitigation plan, implement the [Scheduler Agent Supervisor][scheduler-agent-supervisor] pattern to manage the entire workflow.</span></span>
* <span data-ttu-id="99baf-552">N’effectuez pas de nouvelles tentatives après un délai d’expiration.</span><span class="sxs-lookup"><span data-stu-id="99baf-552">Don't retry on timeouts.</span></span> <span data-ttu-id="99baf-553">Cette erreur a un faible taux de réussite.</span><span class="sxs-lookup"><span data-stu-id="99baf-553">There is a low success rate for this error.</span></span>
* <span data-ttu-id="99baf-554">La file d’attente fonctionne, pour réessayer ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="99baf-554">Queue work, in order to retry later.</span></span>

<span data-ttu-id="99baf-555">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-555">**Diagnostics**.</span></span> <span data-ttu-id="99baf-556">Journalisation de toutes les opérations (réussies et échouées), y compris les actions de compensation.</span><span class="sxs-lookup"><span data-stu-id="99baf-556">Log all operations (successful and failed), including compensating actions.</span></span> <span data-ttu-id="99baf-557">Utilisez les ID de corrélation pour suivre toutes les opérations situées dans une même transaction.</span><span class="sxs-lookup"><span data-stu-id="99baf-557">Use correlation IDs, so that you can track all operations within the same transaction.</span></span>

### <a name="a-call-to-a-remote-service-fails"></a><span data-ttu-id="99baf-558">Un appel vers un service distant a échoué.</span><span class="sxs-lookup"><span data-stu-id="99baf-558">A call to a remote service fails.</span></span>
<span data-ttu-id="99baf-559">**Détection**.</span><span class="sxs-lookup"><span data-stu-id="99baf-559">**Detection**.</span></span> <span data-ttu-id="99baf-560">Code d'erreur HTTP.</span><span class="sxs-lookup"><span data-stu-id="99baf-560">HTTP error code.</span></span>

<span data-ttu-id="99baf-561">**Récupération**</span><span class="sxs-lookup"><span data-stu-id="99baf-561">**Recovery**</span></span>

1. <span data-ttu-id="99baf-562">Relance en cas d’échecs temporaires.</span><span class="sxs-lookup"><span data-stu-id="99baf-562">Retry on transient failures.</span></span>
2. <span data-ttu-id="99baf-563">Si l’appel échoue après *N* tentatives, effectuez une action de secours.</span><span class="sxs-lookup"><span data-stu-id="99baf-563">If the call fails after *N* attempts, take a fallback action.</span></span> <span data-ttu-id="99baf-564">(Spécifique à l’application.)</span><span class="sxs-lookup"><span data-stu-id="99baf-564">(Application specific.)</span></span>
3. <span data-ttu-id="99baf-565">Implémentez le [modèle disjoncteur][circuit-breaker] pour éviter des erreurs en cascade.</span><span class="sxs-lookup"><span data-stu-id="99baf-565">Implement the [Circuit Breaker pattern][circuit-breaker] to avoid cascading failures.</span></span>

<span data-ttu-id="99baf-566">**Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="99baf-566">**Diagnostics**.</span></span> <span data-ttu-id="99baf-567">Journalisation de tous les échecs d’appel distant.</span><span class="sxs-lookup"><span data-stu-id="99baf-567">Log all remote call failures.</span></span>

## <a name="next-steps"></a><span data-ttu-id="99baf-568">étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="99baf-568">Next steps</span></span>
<span data-ttu-id="99baf-569">Pour plus d’informations sur le processus FMA, consultez [Résilience par la conception pour les services de cloud computing][resilience-by-design-pdf] (téléchargement PDF).</span><span class="sxs-lookup"><span data-stu-id="99baf-569">For more information about the FMA process, see [Resilience by design for cloud services][resilience-by-design-pdf] (PDF download).</span></span>

<!-- links -->

[api-management]: https://azure.microsoft.com/documentation/services/api-management/
[api-management-throttling]: /azure/api-management/api-management-sample-flexible-throttling/
[app-insights]: /azure/application-insights/app-insights-overview/
[app-insights-web-apps]: /azure/application-insights/app-insights-azure-web-apps/
[app-service-configure]: /azure/app-service-web/web-sites-configure/
[app-service-logging]: /azure/app-service-web/web-sites-enable-diagnostic-log/
[app-service-slots]: /azure/app-service-web/web-sites-staged-publishing/
[auto-rest-client-retry]: https://github.com/Azure/autorest/tree/master/docs
[azure-activity-logs]: /azure/monitoring-and-diagnostics/monitoring-overview-activity-logs/
[azure-alerts]: /azure/monitoring-and-diagnostics/insights-alerts-portal/
[azure-log-analytics]: /azure/log-analytics/log-analytics-overview/
[BrokeredMessage.TimeToLive]: https://msdn.microsoft.com/library/microsoft.servicebus.messaging.brokeredmessage.timetolive.aspx
[cassandra-error-handling]: http://www.datastax.com/dev/blog/cassandra-error-handling-done-right
[circuit-breaker]: https://msdn.microsoft.com/library/dn589784.aspx
[cosmosdb-multi-region]: /azure/cosmos-db/tutorial-global-distribution-sql-api
[elasticsearch-azure]: ../elasticsearch/index.md
[elasticsearch-client]: https://www.elastic.co/guide/en/elasticsearch/client/index.html
[health-endpoint-monitoring-pattern]: https://msdn.microsoft.com/library/dn589789.aspx
[onstop-events]: https://azure.microsoft.com/blog/the-right-way-to-handle-azure-onstop-events/
[lb-monitor]: /azure/load-balancer/load-balancer-monitor-log/
[lb-probe]: /azure/load-balancer/load-balancer-custom-probe-overview/#learn-about-the-types-of-probes
[new-relic]: https://newrelic.com/
[priority-queue-pattern]: https://msdn.microsoft.com/library/dn589794.aspx
[queue-based-load-leveling]: https://msdn.microsoft.com/library/dn589783.aspx
[QuotaExceededException]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.quotaexceededexception.aspx
[ra-web-apps-basic]: ../reference-architectures/app-service-web-app/basic-web-app.md
[redis-monitor]: /azure/redis-cache/cache-how-to-monitor/
[redis-retry]: ../best-practices/retry-service-specific.md#azure-redis-cache-retry-guidelines
[resilience-by-design-pdf]: http://download.microsoft.com/download/D/8/C/D8C599A4-4E8A-49BF-80EE-FE35F49B914D/Resilience_by_Design_for_Cloud_Services_White_Paper.pdf
[RoleEntryPoint.OnStop]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx
[RoleEnvironment.Stopping]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx
[rm-locks]: /azure/azure-resource-manager/resource-group-lock-resources/
[sb-dead-letter-queue]: /azure/service-bus-messaging/service-bus-dead-letter-queues/
[sb-georeplication-sample]: https://github.com/Azure-Samples/azure-servicebus-messaging-samples/tree/master/GeoReplication
[sb-messagingexception-class]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingexception.aspx
[sb-messaging-exceptions]: /azure/service-bus-messaging/service-bus-messaging-exceptions/
[sb-outages]: /azure/service-bus-messaging/service-bus-outages-disasters/#protecting-queues-and-topics-against-datacenter-outages-or-disasters
[sb-partition]: /azure/service-bus-messaging/service-bus-partitioning/
[sb-poison-message]: /azure/app-service-web/websites-dotnet-webjobs-sdk-storage-queues-how-to/#poison
[sb-retry]: ../best-practices/retry-service-specific.md#service-bus-retry-guidelines
[search-sdk]: https://msdn.microsoft.com/library/dn951165.aspx
[scheduler-agent-supervisor]: https://msdn.microsoft.com/library/dn589780.aspx
[search-analytics]: /azure/search/search-traffic-analytics/
[sql-db-audit]: /azure/sql-database/sql-database-auditing-get-started/
[sql-db-errors]: /azure/sql-database/sql-database-develop-error-messages/#resource-governance-errors
[sql-db-failover]: /azure/sql-database/sql-database-geo-replication-failover-portal/
[sql-db-limits]: /azure/sql-database/sql-database-resource-limits/
[sql-db-replication]: /azure/sql-database/sql-database-geo-replication-overview/
[storage-metrics]: https://msdn.microsoft.com/library/dn782843.aspx
[storage-replication]: /azure/storage/storage-redundancy/
[Storage.RetryPolicies]: https://msdn.microsoft.com/library/microsoft.windowsazure.storage.retrypolicies.aspx
[sys.event_log]: https://msdn.microsoft.com/library/dn270018.aspx
[throttling-pattern]: https://msdn.microsoft.com/library/dn589798.aspx
[web-jobs]: /azure/app-service-web/web-sites-create-web-jobs/
[web-jobs-shutdown]: /azure/app-service-web/websites-dotnet-webjobs-sdk-storage-queues-how-to/#graceful
