---
title: Utilisation d’identités basées sur les revendications dans les applications multi-locataires
description: Comment utiliser des revendications pour la validation et l’autorisation de l’émetteur.
author: MikeWasson
ms.date: 07/21/2017
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
pnp.series.title: Manage Identity in Multitenant Applications
pnp.series.prev: authenticate
pnp.series.next: signup
ms.openlocfilehash: 8b8cbd2b857493d94103e80f53f187207feaa11e
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/20/2019
ms.locfileid: "58241560"
---
# <a name="work-with-claims-based-identities"></a><span data-ttu-id="7aead-103">Utilisation d’identités basées sur les revendications</span><span class="sxs-lookup"><span data-stu-id="7aead-103">Work with claims-based identities</span></span>

<span data-ttu-id="7aead-104">[![GitHub](../_images/github.png) Exemple de code][sample application]</span><span class="sxs-lookup"><span data-stu-id="7aead-104">[![GitHub](../_images/github.png) Sample code][sample application]</span></span>

## <a name="claims-in-azure-ad"></a><span data-ttu-id="7aead-105">Revendications dans Azure AD</span><span class="sxs-lookup"><span data-stu-id="7aead-105">Claims in Azure AD</span></span>

<span data-ttu-id="7aead-106">Quand un utilisateur se connecte, Azure AD envoie un jeton d’ID qui contient un ensemble de revendications concernant l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7aead-106">When a user signs in, Azure AD sends an ID token that contains a set of claims about the user.</span></span> <span data-ttu-id="7aead-107">Une revendication est simplement une information, exprimée sous la forme d’une paire clé/valeur.</span><span class="sxs-lookup"><span data-stu-id="7aead-107">A claim is simply a piece of information, expressed as a key/value pair.</span></span> <span data-ttu-id="7aead-108">Par exemple : `email`=`bob@contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="7aead-108">For example, `email`=`bob@contoso.com`.</span></span>  <span data-ttu-id="7aead-109">Les revendications ont un émetteur &mdash; dans ce cas, Azure AD &mdash; qui est l’entité qui authentifie l’utilisateur et crée les revendications.</span><span class="sxs-lookup"><span data-stu-id="7aead-109">Claims have an issuer &mdash; in this case, Azure AD &mdash; which is the entity that authenticates the user and creates the claims.</span></span> <span data-ttu-id="7aead-110">Vous approuvez les revendications, car vous approuvez l’émetteur.</span><span class="sxs-lookup"><span data-stu-id="7aead-110">You trust the claims because you trust the issuer.</span></span> <span data-ttu-id="7aead-111">(À l’inverse, si vous n’approuvez l’émetteur, n’approuvez pas les revendications !)</span><span class="sxs-lookup"><span data-stu-id="7aead-111">(Conversely, if you don't trust the issuer, don't trust the claims!)</span></span>

<span data-ttu-id="7aead-112">De façon générale :</span><span class="sxs-lookup"><span data-stu-id="7aead-112">At a high level:</span></span>

1. <span data-ttu-id="7aead-113">L’utilisateur s’authentifie.</span><span class="sxs-lookup"><span data-stu-id="7aead-113">The user authenticates.</span></span>
2. <span data-ttu-id="7aead-114">Le fournisseur d’identité envoie un ensemble de revendications.</span><span class="sxs-lookup"><span data-stu-id="7aead-114">The IDP sends a set of claims.</span></span>
3. <span data-ttu-id="7aead-115">L’application normalise ou renforce les revendications (facultatif).</span><span class="sxs-lookup"><span data-stu-id="7aead-115">The app normalizes or augments the claims (optional).</span></span>
4. <span data-ttu-id="7aead-116">L’application utilise les revendications pour prendre des décisions d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="7aead-116">The app uses the claims to make authorization decisions.</span></span>

<span data-ttu-id="7aead-117">Dans OpenID Connect, l’ensemble de revendications que vous obtenez est contrôlé par le [paramètre d’étendue] de la demande d’authentification.</span><span class="sxs-lookup"><span data-stu-id="7aead-117">In OpenID Connect, the set of claims that you get is controlled by the [scope parameter] of the authentication request.</span></span> <span data-ttu-id="7aead-118">Toutefois, Azure AD émet un ensemble limité de revendications via OpenID Connect ; voir [Types de jeton et de revendication pris en charge].</span><span class="sxs-lookup"><span data-stu-id="7aead-118">However, Azure AD issues a limited set of claims through OpenID Connect; see [Supported Token and Claim Types].</span></span> <span data-ttu-id="7aead-119">Pour obtenir davantage d’informations sur l’utilisateur, utilisez l’API Graph Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7aead-119">If you want more information about the user, you'll need to use the Azure AD Graph API.</span></span>

<span data-ttu-id="7aead-120">Voici quelques-unes des revendications d’AAD auxquelles une application peut généralement s’intéresser :</span><span class="sxs-lookup"><span data-stu-id="7aead-120">Here are some of the claims from AAD that an app might typically care about:</span></span>

| <span data-ttu-id="7aead-121">Type de revendication dans le jeton d’ID</span><span class="sxs-lookup"><span data-stu-id="7aead-121">Claim type in ID token</span></span> | <span data-ttu-id="7aead-122">Description</span><span class="sxs-lookup"><span data-stu-id="7aead-122">Description</span></span> |
| --- | --- |
| <span data-ttu-id="7aead-123">aud</span><span class="sxs-lookup"><span data-stu-id="7aead-123">aud</span></span> |<span data-ttu-id="7aead-124">Pour qui le jeton a été émis.</span><span class="sxs-lookup"><span data-stu-id="7aead-124">Who the token was issued for.</span></span> <span data-ttu-id="7aead-125">Il s’agit de l’ID client de l’application.</span><span class="sxs-lookup"><span data-stu-id="7aead-125">This will be the application's client ID.</span></span> <span data-ttu-id="7aead-126">En général, vous n’avez pas à vous soucier de cette revendication, car le middleware la valide automatiquement.</span><span class="sxs-lookup"><span data-stu-id="7aead-126">Generally, you shouldn't need to worry about this claim, because the middleware automatically validates it.</span></span> <span data-ttu-id="7aead-127">Exemple : `"91464657-d17a-4327-91f3-2ed99386406f"`</span><span class="sxs-lookup"><span data-stu-id="7aead-127">Example:  `"91464657-d17a-4327-91f3-2ed99386406f"`</span></span> |
| <span data-ttu-id="7aead-128">groups</span><span class="sxs-lookup"><span data-stu-id="7aead-128">groups</span></span> |<span data-ttu-id="7aead-129">Liste de groupes AAD dont l’utilisateur est membre.</span><span class="sxs-lookup"><span data-stu-id="7aead-129">A list of AAD groups of which the user is a member.</span></span> <span data-ttu-id="7aead-130">Exemple : `["93e8f556-8661-4955-87b6-890bc043c30f", "fc781505-18ef-4a31-a7d5-7d931d7b857e"]`</span><span class="sxs-lookup"><span data-stu-id="7aead-130">Example: `["93e8f556-8661-4955-87b6-890bc043c30f", "fc781505-18ef-4a31-a7d5-7d931d7b857e"]`</span></span> |
| <span data-ttu-id="7aead-131">iss</span><span class="sxs-lookup"><span data-stu-id="7aead-131">iss</span></span> |<span data-ttu-id="7aead-132">[Émetteur] du jeton OIDC.</span><span class="sxs-lookup"><span data-stu-id="7aead-132">The [issuer] of the OIDC token.</span></span> <span data-ttu-id="7aead-133">Exemple : `https://sts.windows.net/b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4/`</span><span class="sxs-lookup"><span data-stu-id="7aead-133">Example: `https://sts.windows.net/b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4/`</span></span> |
| <span data-ttu-id="7aead-134">Nom</span><span class="sxs-lookup"><span data-stu-id="7aead-134">name</span></span> |<span data-ttu-id="7aead-135">Nom d’affichage de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7aead-135">The user's display name.</span></span> <span data-ttu-id="7aead-136">Exemple : `"Alice A."`</span><span class="sxs-lookup"><span data-stu-id="7aead-136">Example: `"Alice A."`</span></span> |
| <span data-ttu-id="7aead-137">oid</span><span class="sxs-lookup"><span data-stu-id="7aead-137">oid</span></span> |<span data-ttu-id="7aead-138">Identificateur d’objet pour l’utilisateur dans AAD.</span><span class="sxs-lookup"><span data-stu-id="7aead-138">The object identifier for the user in AAD.</span></span> <span data-ttu-id="7aead-139">Cette valeur est l’identificateur non modifiable et non réutilisable de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7aead-139">This value is the immutable and non-reusable identifier of the user.</span></span> <span data-ttu-id="7aead-140">Utilisez cette valeur, et non pas l’adresse de messagerie, comme identificateur unique pour les utilisateurs ; en effet, les adresses de messagerie peuvent changer.</span><span class="sxs-lookup"><span data-stu-id="7aead-140">Use this value, not email, as a unique identifier for users; email addresses can change.</span></span> <span data-ttu-id="7aead-141">Si vous utilisez l’API Azure AD Graph dans votre application, l’ID objet est cette valeur utilisée pour demander des informations de profil.</span><span class="sxs-lookup"><span data-stu-id="7aead-141">If you use the Azure AD Graph API in your app, object ID is that value used to query profile information.</span></span> <span data-ttu-id="7aead-142">Exemple : `"59f9d2dc-995a-4ddf-915e-b3bb314a7fa4"`</span><span class="sxs-lookup"><span data-stu-id="7aead-142">Example: `"59f9d2dc-995a-4ddf-915e-b3bb314a7fa4"`</span></span> |
| <span data-ttu-id="7aead-143">roles</span><span class="sxs-lookup"><span data-stu-id="7aead-143">roles</span></span> |<span data-ttu-id="7aead-144">Liste des rôles d’application pour l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7aead-144">A list of app roles for the user.</span></span>    <span data-ttu-id="7aead-145">Exemple : `["SurveyCreator"]`</span><span class="sxs-lookup"><span data-stu-id="7aead-145">Example: `["SurveyCreator"]`</span></span> |
| <span data-ttu-id="7aead-146">tid</span><span class="sxs-lookup"><span data-stu-id="7aead-146">tid</span></span> |<span data-ttu-id="7aead-147">ID de locataire.</span><span class="sxs-lookup"><span data-stu-id="7aead-147">Tenant ID.</span></span> <span data-ttu-id="7aead-148">Cette valeur est un identificateur unique pour le client dans Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7aead-148">This value is a unique identifier for the tenant in Azure AD.</span></span> <span data-ttu-id="7aead-149">Exemple : `"b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4"`</span><span class="sxs-lookup"><span data-stu-id="7aead-149">Example: `"b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4"`</span></span> |
| <span data-ttu-id="7aead-150">unique_name</span><span class="sxs-lookup"><span data-stu-id="7aead-150">unique_name</span></span> |<span data-ttu-id="7aead-151">Nom d’affichage explicite de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7aead-151">A human readable display name of the user.</span></span> <span data-ttu-id="7aead-152">Exemple : `"alice@contoso.com"`</span><span class="sxs-lookup"><span data-stu-id="7aead-152">Example: `"alice@contoso.com"`</span></span> |
| <span data-ttu-id="7aead-153">upn</span><span class="sxs-lookup"><span data-stu-id="7aead-153">upn</span></span> |<span data-ttu-id="7aead-154">Nom d’utilisateur principal.</span><span class="sxs-lookup"><span data-stu-id="7aead-154">User principal name.</span></span> <span data-ttu-id="7aead-155">Exemple : `"alice@contoso.com"`</span><span class="sxs-lookup"><span data-stu-id="7aead-155">Example: `"alice@contoso.com"`</span></span> |

<span data-ttu-id="7aead-156">Ce tableau répertorie les types de revendications tels qu’ils apparaissent dans le jeton d’ID.</span><span class="sxs-lookup"><span data-stu-id="7aead-156">This table lists the claim types as they appear in the ID token.</span></span> <span data-ttu-id="7aead-157">Dans ASP.NET Core, le middleware OpenID Connect convertit certains des types de revendications quand il remplit la collection de revendications pour le nom principal de l’utilisateur :</span><span class="sxs-lookup"><span data-stu-id="7aead-157">In ASP.NET Core, the OpenID Connect middleware converts some of the claim types when it populates the Claims collection for the user principal:</span></span>

* <span data-ttu-id="7aead-158">oid > `http://schemas.microsoft.com/identity/claims/objectidentifier`</span><span class="sxs-lookup"><span data-stu-id="7aead-158">oid > `http://schemas.microsoft.com/identity/claims/objectidentifier`</span></span>
* <span data-ttu-id="7aead-159">tid > `http://schemas.microsoft.com/identity/claims/tenantid`</span><span class="sxs-lookup"><span data-stu-id="7aead-159">tid > `http://schemas.microsoft.com/identity/claims/tenantid`</span></span>
* <span data-ttu-id="7aead-160">unique_name > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name`</span><span class="sxs-lookup"><span data-stu-id="7aead-160">unique_name > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name`</span></span>
* <span data-ttu-id="7aead-161">upn > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn`</span><span class="sxs-lookup"><span data-stu-id="7aead-161">upn > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn`</span></span>

## <a name="claims-transformations"></a><span data-ttu-id="7aead-162">Transformations de revendication</span><span class="sxs-lookup"><span data-stu-id="7aead-162">Claims transformations</span></span>

<span data-ttu-id="7aead-163">Pendant le flux d’authentification, vous pouvez modifier les revendications que vous obtenez du fournisseur d’identité.</span><span class="sxs-lookup"><span data-stu-id="7aead-163">During the authentication flow, you might want to modify the claims that you get from the IDP.</span></span> <span data-ttu-id="7aead-164">Dans ASP.NET Core, vous pouvez effectuer une transformation des revendications à l’intérieur de l’événement **AuthenticationValidated** à partir du middleware OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="7aead-164">In ASP.NET Core, you can perform claims transformation inside of the **AuthenticationValidated** event from the OpenID Connect middleware.</span></span> <span data-ttu-id="7aead-165">(Consultez la page [Authentication events].)</span><span class="sxs-lookup"><span data-stu-id="7aead-165">(See [Authentication events].)</span></span>

<span data-ttu-id="7aead-166">Toutes les revendications que vous ajoutez pendant **AuthenticationValidated** sont stockées dans le cookie d’authentification de session.</span><span class="sxs-lookup"><span data-stu-id="7aead-166">Any claims that you add during **AuthenticationValidated** are stored in the session authentication cookie.</span></span> <span data-ttu-id="7aead-167">Elles ne font pas l’objet d’une transmission de type push à Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7aead-167">They don't get pushed back to Azure AD.</span></span>

<span data-ttu-id="7aead-168">Voici quelques exemples de transformation de revendications :</span><span class="sxs-lookup"><span data-stu-id="7aead-168">Here are some examples of claims transformation:</span></span>

* <span data-ttu-id="7aead-169">**Normalisation des revendications**, ou rendre les réclamations cohérentes entre les utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="7aead-169">**Claims normalization**, or making claims consistent across users.</span></span> <span data-ttu-id="7aead-170">Cela est particulièrement approprié si vous obtenez des revendications de plusieurs fournisseurs d’identité, qui peuvent utiliser des types de revendications différents pour des informations similaires.</span><span class="sxs-lookup"><span data-stu-id="7aead-170">This is particularly relevant if you are getting claims from multiple IDPs, which might use different claim types for similar information.</span></span> <span data-ttu-id="7aead-171">Par exemple, Azure AD envoie une revendication « upn » qui contient l’adresse de messagerie de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7aead-171">For example, Azure AD sends a "upn" claim that contains the user's email.</span></span> <span data-ttu-id="7aead-172">D’autres fournisseurs d’identité peuvent envoyer une revendication « email ».</span><span class="sxs-lookup"><span data-stu-id="7aead-172">Other IDPs might send an "email" claim.</span></span> <span data-ttu-id="7aead-173">Le code suivant convertit la revendication « upn » en revendication « email » :</span><span class="sxs-lookup"><span data-stu-id="7aead-173">The following code converts the "upn" claim into an "email" claim:</span></span>

  ```csharp
  var email = principal.FindFirst(ClaimTypes.Upn)?.Value;
  if (!string.IsNullOrWhiteSpace(email))
  {
      identity.AddClaim(new Claim(ClaimTypes.Email, email));
  }
  ```

* <span data-ttu-id="7aead-174">Ajoutez **les valeurs de revendication par défaut** pour les revendications qui ne sont pas présentes &mdash; par exemple, affectation d’un utilisateur à un rôle par défaut.</span><span class="sxs-lookup"><span data-stu-id="7aead-174">Add **default claim values** for claims that aren't present &mdash; for example, assigning a user to a default role.</span></span> <span data-ttu-id="7aead-175">Dans certains cas, cela peut simplifier la logique d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="7aead-175">In some cases this can simplify authorization logic.</span></span>
* <span data-ttu-id="7aead-176">Ajoutez **les types de revendication personnalisée** avec les informations spécifiques à l’application sur l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7aead-176">Add **custom claim types** with application-specific information about the user.</span></span> <span data-ttu-id="7aead-177">Par exemple, vous pouvez stocker des informations sur l’utilisateur dans une base de données.</span><span class="sxs-lookup"><span data-stu-id="7aead-177">For example, you might store some information about the user in a database.</span></span> <span data-ttu-id="7aead-178">Vous pouvez ajouter une revendication personnalisée avec ces informations sur le ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="7aead-178">You could add a custom claim with this information to the authentication ticket.</span></span> <span data-ttu-id="7aead-179">La revendication est stockée dans un cookie. Ainsi, vous n’aurez besoin de la récupérer dans la base de données qu’une seule fois par session de connexion.</span><span class="sxs-lookup"><span data-stu-id="7aead-179">The claim is stored in a cookie, so you only need to get it from the database once per login session.</span></span> <span data-ttu-id="7aead-180">En revanche, vous souhaitez également éviter de créer des cookies trop volumineux. Par conséquent, réfléchissez à un compromis entre la taille des cookies et les recherches dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="7aead-180">On the other hand, you also want to avoid creating excessively large cookies, so you need to consider the trade-off between cookie size versus database lookups.</span></span>

<span data-ttu-id="7aead-181">Une fois le flux d’authentification terminé, les revendications sont disponibles dans `HttpContext.User`.</span><span class="sxs-lookup"><span data-stu-id="7aead-181">After the authentication flow is complete, the claims are available in `HttpContext.User`.</span></span> <span data-ttu-id="7aead-182">À ce stade, vous devez les traiter comme une collection en lecture seule &mdash; vous pouvez par exemple les utiliser pour prendre des décisions d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="7aead-182">At that point, you should treat them as a read-only collection &mdash; e.g., use them to make authorization decisions.</span></span>

## <a name="issuer-validation"></a><span data-ttu-id="7aead-183">Validation de l’émetteur</span><span class="sxs-lookup"><span data-stu-id="7aead-183">Issuer validation</span></span>

<span data-ttu-id="7aead-184">Dans OpenID Connect, la revendication de l’émetteur (« iss ») identifie le fournisseur d’identité qui a émis le jeton d’ID.</span><span class="sxs-lookup"><span data-stu-id="7aead-184">In OpenID Connect, the issuer claim ("iss") identifies the IDP that issued the ID token.</span></span> <span data-ttu-id="7aead-185">Une partie du flux d’authentification OIDC consiste à vérifier que la revendication de l’émetteur correspond à l’émetteur réel.</span><span class="sxs-lookup"><span data-stu-id="7aead-185">Part of the OIDC authentication flow is to verify that the issuer claim matches the actual issuer.</span></span> <span data-ttu-id="7aead-186">Le middleware OIDC gère cela automatiquement.</span><span class="sxs-lookup"><span data-stu-id="7aead-186">The OIDC middleware handles this for you.</span></span>

<span data-ttu-id="7aead-187">Dans Azure AD, la valeur d’émetteur est unique par locataire AD (`https://sts.windows.net/<tenantID>`).</span><span class="sxs-lookup"><span data-stu-id="7aead-187">In Azure AD, the issuer value is unique per AD tenant (`https://sts.windows.net/<tenantID>`).</span></span> <span data-ttu-id="7aead-188">Par conséquent, une application doit effectuer une vérification supplémentaire pour garantir que l’émetteur représente un locataire qui est autorisé à se connecter à l’application.</span><span class="sxs-lookup"><span data-stu-id="7aead-188">Therefore, an application should do an additional check, to make sure the issuer represents a tenant that is allowed to sign in to the app.</span></span>

<span data-ttu-id="7aead-189">Pour une application à locataire unique, vous pouvez simplement vérifier que l’émetteur est votre propre locataire.</span><span class="sxs-lookup"><span data-stu-id="7aead-189">For a single-tenant application, you can just check that the issuer is your own tenant.</span></span> <span data-ttu-id="7aead-190">En fait, le middleware OIDC effectue cette opération automatiquement par défaut.</span><span class="sxs-lookup"><span data-stu-id="7aead-190">In fact, the OIDC middleware does this automatically by default.</span></span> <span data-ttu-id="7aead-191">Dans une application multi-locataire, vous devez autoriser plusieurs émetteurs, correspondant aux différents locataires.</span><span class="sxs-lookup"><span data-stu-id="7aead-191">In a multi-tenant app, you need to allow for multiple issuers, corresponding to the different tenants.</span></span> <span data-ttu-id="7aead-192">Voici une approche générale à utiliser :</span><span class="sxs-lookup"><span data-stu-id="7aead-192">Here is a general approach to use:</span></span>

* <span data-ttu-id="7aead-193">Dans les options de middleware OIDC, affectez à **ValidateIssuer** sur false.</span><span class="sxs-lookup"><span data-stu-id="7aead-193">In the OIDC middleware options, set **ValidateIssuer** to false.</span></span> <span data-ttu-id="7aead-194">Cela désactive la vérification automatique.</span><span class="sxs-lookup"><span data-stu-id="7aead-194">This turns off the automatic check.</span></span>
* <span data-ttu-id="7aead-195">Quand un locataire s’inscrit, stockez le locataire et l’émetteur dans votre base de données utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7aead-195">When a tenant signs up, store the tenant and the issuer in your user DB.</span></span>
* <span data-ttu-id="7aead-196">Chaque fois qu’un utilisateur se connecte, recherchez l’émetteur dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="7aead-196">Whenever a user signs in, look up the issuer in the database.</span></span> <span data-ttu-id="7aead-197">Si l’émetteur est introuvable, cela signifie que le locataire ne s’est pas inscrit.</span><span class="sxs-lookup"><span data-stu-id="7aead-197">If the issuer isn't found, it means that tenant hasn't signed up.</span></span> <span data-ttu-id="7aead-198">Vous pouvez le rediriger vers une page d’inscription.</span><span class="sxs-lookup"><span data-stu-id="7aead-198">You can redirect them to a sign up page.</span></span>
* <span data-ttu-id="7aead-199">Vous pouvez également bloquer certains locataires ; par exemple, pour les clients qui n’ont pas payé leur abonnement.</span><span class="sxs-lookup"><span data-stu-id="7aead-199">You could also blacklist certain tenants; for example, for customers that didn't pay their subscription.</span></span>

<span data-ttu-id="7aead-200">Pour obtenir plus de détails, consultez [Inscription et intégration de locataire dans une application multi-locataire][signup].</span><span class="sxs-lookup"><span data-stu-id="7aead-200">For a more detailed discussion, see [Sign-up and tenant onboarding in a multitenant application][signup].</span></span>

## <a name="using-claims-for-authorization"></a><span data-ttu-id="7aead-201">Utilisation de revendications pour l’autorisation</span><span class="sxs-lookup"><span data-stu-id="7aead-201">Using claims for authorization</span></span>

<span data-ttu-id="7aead-202">Avec les revendications, l’identité d’un utilisateur n’est plus une entité monolithique.</span><span class="sxs-lookup"><span data-stu-id="7aead-202">With claims, a user's identity is no longer a monolithic entity.</span></span> <span data-ttu-id="7aead-203">Par exemple, un utilisateur peut avoir une adresse e-mail, un numéro de téléphone, une date de naissance, un genre, etc. Il est possible que le point de distribution d’émission (IDP) de l’utilisateur stocke toutes ces informations.</span><span class="sxs-lookup"><span data-stu-id="7aead-203">For example, a user might have an email address, phone number, birthday, gender, etc. Maybe the user's IDP stores all of this information.</span></span> <span data-ttu-id="7aead-204">Mais lorsque vous authentifiez l’utilisateur, vous obtiendrez généralement un sous-ensemble de ces informations sous la forme de revendications.</span><span class="sxs-lookup"><span data-stu-id="7aead-204">But when you authenticate the user, you'll typically get a subset of these as claims.</span></span> <span data-ttu-id="7aead-205">Dans ce modèle, l’identité de l’utilisateur est simplement un ensemble de revendications.</span><span class="sxs-lookup"><span data-stu-id="7aead-205">In this model, the user's identity is simply a bundle of claims.</span></span> <span data-ttu-id="7aead-206">Au moment de prendre des décisions d’autorisation à propos d’un utilisateur, vous rechercherez des ensembles de revendications spécifiques.</span><span class="sxs-lookup"><span data-stu-id="7aead-206">When you make authorization decisions about a user, you will look for particular sets of claims.</span></span> <span data-ttu-id="7aead-207">En d’autres termes, la question « L’utilisateur X peut-il effectuer l’action Y ? » devient finalement « L’utilisateur X dispose-t-il de la revendication Z ? ».</span><span class="sxs-lookup"><span data-stu-id="7aead-207">In other words, the question "Can user X perform action Y" ultimately becomes "Does user X have claim Z".</span></span>

<span data-ttu-id="7aead-208">Voici quelques modèles de base pour la vérification des revendications.</span><span class="sxs-lookup"><span data-stu-id="7aead-208">Here are some basic patterns for checking claims.</span></span>

* <span data-ttu-id="7aead-209">Pour vérifier que l’utilisateur a une revendication particulière avec une valeur particulière :</span><span class="sxs-lookup"><span data-stu-id="7aead-209">To check that the user has a particular claim with a particular value:</span></span>

   ```csharp
   if (User.HasClaim(ClaimTypes.Role, "Admin")) { ... }
   ```

   <span data-ttu-id="7aead-210">Ce code vérifie si l’utilisateur a une revendication de rôle avec la valeur « Admin ».</span><span class="sxs-lookup"><span data-stu-id="7aead-210">This code checks whether the user has a Role claim with the value "Admin".</span></span> <span data-ttu-id="7aead-211">Il gère correctement le cas où l’utilisateur n’a aucune revendication de rôle ou a plusieurs revendications de rôle.</span><span class="sxs-lookup"><span data-stu-id="7aead-211">It correctly handles the case where the user has no Role claim or multiple Role claims.</span></span>
  
   <span data-ttu-id="7aead-212">La classe **ClaimTypes** définit des constantes pour les types de revendications couramment utilisés.</span><span class="sxs-lookup"><span data-stu-id="7aead-212">The **ClaimTypes** class defines constants for commonly-used claim types.</span></span> <span data-ttu-id="7aead-213">Toutefois, vous pouvez utiliser n’importe quelle valeur de chaîne pour le type de revendication.</span><span class="sxs-lookup"><span data-stu-id="7aead-213">However, you can use any string value for the claim type.</span></span>
* <span data-ttu-id="7aead-214">Pour obtenir une valeur unique pour un type de revendication, quand vous prévoyez qu’il y aura au plus une valeur :</span><span class="sxs-lookup"><span data-stu-id="7aead-214">To get a single value for a claim type, when you expect there to be at most one value:</span></span>

  ```csharp
  string email = User.FindFirst(ClaimTypes.Email)?.Value;
  ```

* <span data-ttu-id="7aead-215">Pour obtenir toutes les valeurs pour un type de revendication :</span><span class="sxs-lookup"><span data-stu-id="7aead-215">To get all the values for a claim type:</span></span>

  ```csharp
  IEnumerable<Claim> groups = User.FindAll("groups");
  ```

<span data-ttu-id="7aead-216">Pour en savoir plus, consultez [Autorisation basée sur les ressources et les rôles dans les applications multi-locataires][authorization].</span><span class="sxs-lookup"><span data-stu-id="7aead-216">For more information, see [Role-based and resource-based authorization in multitenant applications][authorization].</span></span>

<span data-ttu-id="7aead-217">[**Suivant**][signup]</span><span class="sxs-lookup"><span data-stu-id="7aead-217">[**Next**][signup]</span></span>

<!-- links -->

[paramètre d’étendue]: https://nat.sakimura.org/2012/01/26/scopes-and-claims-in-openid-connect/
[scope parameter]: https://nat.sakimura.org/2012/01/26/scopes-and-claims-in-openid-connect/
[Types de jeton et de revendication pris en charge]: /azure/active-directory/active-directory-token-and-claims/
[Supported Token and Claim Types]: /azure/active-directory/active-directory-token-and-claims/
[Émetteur]: https://openid.net/specs/openid-connect-core-1_0.html#IDToken
[issuer]: https://openid.net/specs/openid-connect-core-1_0.html#IDToken
[Authentication events]: authenticate.md#authentication-events
[signup]: signup.md
[Claims-Based Authorization]: /aspnet/core/security/authorization/claims
[sample application]: https://github.com/mspnp/multitenant-saas-guidance
[authorization]: authorize.md
