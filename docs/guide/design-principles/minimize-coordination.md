---
title: Minimiser la coordination
titleSuffix: Azure Application Architecture Guide
description: Réduisez la coordination entre les services d’application pour atteindre une certaine évolutivité.
author: MikeWasson
ms.date: 08/30/2018
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seojan19
ms.openlocfilehash: e124e6720b909bafc74a4c074454ec0a3ec30c59
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/23/2019
ms.locfileid: "54488577"
---
# <a name="minimize-coordination"></a><span data-ttu-id="ea316-103">Minimiser la coordination</span><span class="sxs-lookup"><span data-stu-id="ea316-103">Minimize coordination</span></span>

## <a name="minimize-coordination-between-application-services-to-achieve-scalability"></a><span data-ttu-id="ea316-104">Minimiser la coordination entre les services d’application pour privilégier la scalabilité</span><span class="sxs-lookup"><span data-stu-id="ea316-104">Minimize coordination between application services to achieve scalability</span></span>

<span data-ttu-id="ea316-105">La plupart des applications cloud sont constituées de plusieurs services d’application : frontends web, bases de données, processus métier, rapport et analyse, etc.</span><span class="sxs-lookup"><span data-stu-id="ea316-105">Most cloud applications consist of multiple application services &mdash; web front ends, databases, business processes, reporting and analysis, and so on.</span></span> <span data-ttu-id="ea316-106">Pour assurer le niveau de scalabilité et de fiabilité attendu, chacun de ces services doit s’exécuter sur plusieurs instances.</span><span class="sxs-lookup"><span data-stu-id="ea316-106">To achieve scalability and reliability, each of those services should run on multiple instances.</span></span>

<span data-ttu-id="ea316-107">Que se passe-t-il quand deux instances essaient d’effectuer des opérations simultanées qui ont des répercussions sur un état partagé ?</span><span class="sxs-lookup"><span data-stu-id="ea316-107">What happens when two instances try to perform concurrent operations that affect some shared state?</span></span> <span data-ttu-id="ea316-108">Dans certains cas, il doit exister une coordination entre les nœuds, par exemple pour préserver les garanties ACID.</span><span class="sxs-lookup"><span data-stu-id="ea316-108">In some cases, there must be coordination across nodes, for example to preserve ACID guarantees.</span></span> <span data-ttu-id="ea316-109">Dans ce diagramme, `Node2` attend que `Node1` libère un verrou de base de données :</span><span class="sxs-lookup"><span data-stu-id="ea316-109">In this diagram, `Node2` is waiting for `Node1` to release a database lock:</span></span>

![Digramme de verrouillage de base de données](./images/database-lock.svg)

<span data-ttu-id="ea316-111">La coordination limite les avantages de la mise à l’échelle horizontale et crée des goulots d’étranglement.</span><span class="sxs-lookup"><span data-stu-id="ea316-111">Coordination limits the benefits of horizontal scale and creates bottlenecks.</span></span> <span data-ttu-id="ea316-112">Dans cet exemple, à mesure que l’application monte en charge et que des instances supplémentaires sont ajoutées, la contention de verrouillage augmente.</span><span class="sxs-lookup"><span data-stu-id="ea316-112">In this example, as you scale out the application and add more instances, you'll see increased lock contention.</span></span> <span data-ttu-id="ea316-113">Dans le pire des cas, les instances frontend passent l’essentiel de leur temps à attendre des verrous.</span><span class="sxs-lookup"><span data-stu-id="ea316-113">In the worst case, the front-end instances will spend most of their time waiting on locks.</span></span>

<span data-ttu-id="ea316-114">La sémantique « exactly once » (une seule fois) est une autre source fréquente de coordination.</span><span class="sxs-lookup"><span data-stu-id="ea316-114">"Exactly once" semantics are another frequent source of coordination.</span></span> <span data-ttu-id="ea316-115">Par exemple, une commande doit être traitée une seule fois.</span><span class="sxs-lookup"><span data-stu-id="ea316-115">For example, an order must be processed exactly once.</span></span> <span data-ttu-id="ea316-116">Deux workers sont à l’écoute des nouvelles commandes.</span><span class="sxs-lookup"><span data-stu-id="ea316-116">Two workers are listening for new orders.</span></span> <span data-ttu-id="ea316-117">`Worker1` récupère une commande pour traitement.</span><span class="sxs-lookup"><span data-stu-id="ea316-117">`Worker1` picks up an order for processing.</span></span> <span data-ttu-id="ea316-118">L’application doit veiller à ce que `Worker2` ne duplique pas le travail, mais aussi à ce que la commande ne soit pas supprimée si `Worker1` subit une défaillance.</span><span class="sxs-lookup"><span data-stu-id="ea316-118">The application must ensure that `Worker2` doesn't duplicate the work, but also if `Worker1` crashes, the order isn't dropped.</span></span>

![Diagramme de coordination](./images/coordination.svg)

<span data-ttu-id="ea316-120">Vous pouvez utiliser un modèle tel que [Superviseur de l’agent du planificateur][sas-pattern] pour assurer la coordination entre les workers, mais dans ce cas, la répartition du travail peut s’avérer une meilleure approche.</span><span class="sxs-lookup"><span data-stu-id="ea316-120">You can use a pattern such as [Scheduler Agent Supervisor][sas-pattern] to coordinate between the workers, but in this case a better approach might be to partition the work.</span></span> <span data-ttu-id="ea316-121">Chaque worker se voit affecter une certaine série de commandes (par exemple, par région de facturation).</span><span class="sxs-lookup"><span data-stu-id="ea316-121">Each worker is assigned a certain range of orders (say, by billing region).</span></span> <span data-ttu-id="ea316-122">Si un worker subit une défaillance, une nouvelle instance reprend là où l’instance précédente s’est arrêtée, mais il n’y a pas de contention entre plusieurs instances.</span><span class="sxs-lookup"><span data-stu-id="ea316-122">If a worker crashes, a new instance picks up where the previous instance left off, but multiple instances aren't contending.</span></span>

## <a name="recommendations"></a><span data-ttu-id="ea316-123">Recommandations</span><span class="sxs-lookup"><span data-stu-id="ea316-123">Recommendations</span></span>

<span data-ttu-id="ea316-124">**Adoptez la cohérence éventuelle** :</span><span class="sxs-lookup"><span data-stu-id="ea316-124">**Embrace eventual consistency**.</span></span> <span data-ttu-id="ea316-125">quand les données sont distribuées, une coordination est nécessaire pour mettre en œuvre des garanties de cohérence forte.</span><span class="sxs-lookup"><span data-stu-id="ea316-125">When data is distributed, it takes coordination to enforce strong consistency guarantees.</span></span> <span data-ttu-id="ea316-126">Par exemple, prenons le cas d’une opération qui met à jour deux bases de données.</span><span class="sxs-lookup"><span data-stu-id="ea316-126">For example, suppose an operation updates two databases.</span></span> <span data-ttu-id="ea316-127">Au lieu de la placer dans l’étendue d’une transaction unique, il est préférable que le système prenne en charge la cohérence éventuelle, peut-être en utilisant le modèle de [transaction de compensation][compensating-transaction], pour procéder à une restauration logique après une défaillance.</span><span class="sxs-lookup"><span data-stu-id="ea316-127">Instead of putting it into a single transaction scope, it's better if the system can accommodate eventual consistency, perhaps by using the [Compensating Transaction][compensating-transaction] pattern to logically roll back after a failure.</span></span>

<span data-ttu-id="ea316-128">**Utilisez des événements de domaine pour synchroniser l’état** :</span><span class="sxs-lookup"><span data-stu-id="ea316-128">**Use domain events to synchronize state**.</span></span> <span data-ttu-id="ea316-129">un [événement de domaine][domain-event] est un événement qui s’inscrit quand quelque chose d’important se produit dans le domaine.</span><span class="sxs-lookup"><span data-stu-id="ea316-129">A [domain event][domain-event] is an event that records when something happens that has significance within the domain.</span></span> <span data-ttu-id="ea316-130">Les services intéressés peuvent écouter l’événement, au lieu d’utiliser une transaction globale pour assurer la coordination entre plusieurs services.</span><span class="sxs-lookup"><span data-stu-id="ea316-130">Interested services can listen for the event, rather than using a global transaction to coordinate across multiple services.</span></span> <span data-ttu-id="ea316-131">Si cette approche est utilisée, le système doit tolérer la cohérence éventuelle (voir l’élément précédent).</span><span class="sxs-lookup"><span data-stu-id="ea316-131">If this approach is used, the system must tolerate eventual consistency (see previous item).</span></span>

<span data-ttu-id="ea316-132">**Envisagez l’utilisation de modèles tels que CQRS et l’approvisionnement en événements (event sourcing)**.</span><span class="sxs-lookup"><span data-stu-id="ea316-132">**Consider patterns such as CQRS and event sourcing**.</span></span> <span data-ttu-id="ea316-133">Ces deux modèles peuvent contribuer à réduire la contention entre les charges de travail de lecture et les charges de travail d’écriture.</span><span class="sxs-lookup"><span data-stu-id="ea316-133">These two patterns can help to reduce contention between read workloads and write workloads.</span></span>

- <span data-ttu-id="ea316-134">Le [modèle CQRS][cqrs-pattern] sépare les opérations de lecture des opérations d’écriture.</span><span class="sxs-lookup"><span data-stu-id="ea316-134">The [CQRS pattern][cqrs-pattern] separates read operations from write operations.</span></span> <span data-ttu-id="ea316-135">Dans certaines implémentations, les données de lecture sont physiquement séparées des données d’écriture.</span><span class="sxs-lookup"><span data-stu-id="ea316-135">In some implementations, the read data is physically separated from the write data.</span></span>

- <span data-ttu-id="ea316-136">Dans le [modèle d’approvisionnement en événements][event-sourcing], les changements d’état sont inscrits comme série d’événements dans une banque de données en ajout seul.</span><span class="sxs-lookup"><span data-stu-id="ea316-136">In the [Event Sourcing pattern][event-sourcing], state changes are recorded as a series of events to an append-only data store.</span></span> <span data-ttu-id="ea316-137">L’ajout d’un événement au flux est une opération atomique, nécessitant un verrouillage minimal.</span><span class="sxs-lookup"><span data-stu-id="ea316-137">Appending an event to the stream is an atomic operation, requiring minimal locking.</span></span>

<span data-ttu-id="ea316-138">Ces deux modèles se complètent mutuellement.</span><span class="sxs-lookup"><span data-stu-id="ea316-138">These two patterns complement each other.</span></span> <span data-ttu-id="ea316-139">Si la banque en écriture seule de CQRS utilise l’approvisionnement en événements, la banque en lecture seule peut écouter les mêmes événements pour créer un instantané accessible en lecture de l’état actif, optimisé pour les requêtes.</span><span class="sxs-lookup"><span data-stu-id="ea316-139">If the write-only store in CQRS uses event sourcing, the read-only store can listen for the same events to create a readable snapshot of the current state, optimized for queries.</span></span> <span data-ttu-id="ea316-140">Cependant, avant d’adopter CQRS ou l’approvisionnement en événements, prenez connaissance des inconvénients de cette approche.</span><span class="sxs-lookup"><span data-stu-id="ea316-140">Before adopting CQRS or event sourcing, however, be aware of the challenges of this approach.</span></span> <span data-ttu-id="ea316-141">Pour plus d’informations, consultez [Style d’architecture CQRS][cqrs-style].</span><span class="sxs-lookup"><span data-stu-id="ea316-141">For more information, see [CQRS architecture style][cqrs-style].</span></span>

<span data-ttu-id="ea316-142">**Répartissez les données** :</span><span class="sxs-lookup"><span data-stu-id="ea316-142">**Partition data**.</span></span>  <span data-ttu-id="ea316-143">évitez de placer toutes vos données dans un même schéma de données partagé entre divers services d’application.</span><span class="sxs-lookup"><span data-stu-id="ea316-143">Avoid putting all of your data into one data schema that is shared across many application services.</span></span> <span data-ttu-id="ea316-144">Une architecture de microservices applique ce principe en rendant chaque service responsable de sa propre banque de données.</span><span class="sxs-lookup"><span data-stu-id="ea316-144">A microservices architecture enforces this principle by making each service responsible for its own data store.</span></span> <span data-ttu-id="ea316-145">Dans une base de données unique, le répartition des données dans différentes partitions peut améliorer la concurrence, car un service qui écrit dans une partition n’affecte pas un service qui écrit dans une autre partition.</span><span class="sxs-lookup"><span data-stu-id="ea316-145">Within a single database, partitioning the data into shards can improve concurrency, because a service writing to one shard does not affect a service writing to a different shard.</span></span>

<span data-ttu-id="ea316-146">**Concevez des opérations idempotent** :</span><span class="sxs-lookup"><span data-stu-id="ea316-146">**Design idempotent operations**.</span></span> <span data-ttu-id="ea316-147">dans la mesure du possible, concevez des opérations idempotent.</span><span class="sxs-lookup"><span data-stu-id="ea316-147">When possible, design operations to be idempotent.</span></span> <span data-ttu-id="ea316-148">De cette façon, elles pourront être traitées à l’aide d’une sémantique « at-least-once » (au moins une fois).</span><span class="sxs-lookup"><span data-stu-id="ea316-148">That way, they can be handled using at-least-once semantics.</span></span> <span data-ttu-id="ea316-149">Par exemple, vous pouvez placer des éléments de travail dans une file d’attente.</span><span class="sxs-lookup"><span data-stu-id="ea316-149">For example, you can put work items on a queue.</span></span> <span data-ttu-id="ea316-150">Si un worker se bloque au milieu d’une opération, un autre travail récupère simplement l’élément de travail.</span><span class="sxs-lookup"><span data-stu-id="ea316-150">If a worker crashes in the middle of an operation, another worker simply picks up the work item.</span></span>

<span data-ttu-id="ea316-151">**Utilisez un traitement parallèle asynchrone** :</span><span class="sxs-lookup"><span data-stu-id="ea316-151">**Use asynchronous parallel processing**.</span></span> <span data-ttu-id="ea316-152">si une opération passe par l’exécution asynchrone de plusieurs étapes (telles que des appels à des services distants), vous pouvez les appeler en parallèle et agréger ensuite les résultats.</span><span class="sxs-lookup"><span data-stu-id="ea316-152">If an operation requires multiple steps that are performed asynchronously (such as remote service calls), you might be able to call them in parallel, and then aggregate the results.</span></span> <span data-ttu-id="ea316-153">Cette approche suppose que chaque étape ne dépend pas des résultats de l’étape précédente.</span><span class="sxs-lookup"><span data-stu-id="ea316-153">This approach assumes that each step does not depend on the results of the previous step.</span></span>

<span data-ttu-id="ea316-154">**Utilisez si possible l’accès concurrentiel optimiste** :</span><span class="sxs-lookup"><span data-stu-id="ea316-154">**Use optimistic concurrency when possible**.</span></span> <span data-ttu-id="ea316-155">le contrôle d’accès concurrentiel pessimiste utilise des verrous de base de données pour éviter les conflits.</span><span class="sxs-lookup"><span data-stu-id="ea316-155">Pessimistic concurrency control uses database locks to prevent conflicts.</span></span> <span data-ttu-id="ea316-156">Cela peut dégrader les performances et réduire la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="ea316-156">This can cause poor performance and reduce availability.</span></span> <span data-ttu-id="ea316-157">Avec le contrôle d’accès concurrentiel optimiste, chaque transaction modifie une copie ou un instantané des données.</span><span class="sxs-lookup"><span data-stu-id="ea316-157">With optimistic concurrency control, each transaction modifies a copy or snapshot of the data.</span></span> <span data-ttu-id="ea316-158">Une fois la transaction engagée, le moteur de base de données valide la transaction et rejette celles qui affecteraient la cohérence de la base de données.</span><span class="sxs-lookup"><span data-stu-id="ea316-158">When the transaction is committed, the database engine validates the transaction and rejects any transactions that would affect database consistency.</span></span>

<span data-ttu-id="ea316-159">Azure SQL Database et SQL Server prennent en charge l’accès concurrentiel optimiste via l’[isolement d’instantané][sql-snapshot-isolation].</span><span class="sxs-lookup"><span data-stu-id="ea316-159">Azure SQL Database and SQL Server support optimistic concurrency through [snapshot isolation][sql-snapshot-isolation].</span></span> <span data-ttu-id="ea316-160">Certains services de stockage Azure prennent en charge l’accès concurrentiel optimiste via l’utilisation d’ETags, notamment [Azure Cosmos DB][cosmosdb-faq] et le [stockage Azure][storage-concurrency].</span><span class="sxs-lookup"><span data-stu-id="ea316-160">Some Azure storage services support optimistic concurrency through the use of Etags, including [Azure Cosmos DB][cosmosdb-faq] and [Azure Storage][storage-concurrency].</span></span>

<span data-ttu-id="ea316-161">**Envisagez d’utiliser MapReduce ou d’autres algorithmes parallèles distribués**.</span><span class="sxs-lookup"><span data-stu-id="ea316-161">**Consider MapReduce or other parallel, distributed algorithms**.</span></span> <span data-ttu-id="ea316-162">Selon les données et le type de travail à effectuer, vous pourrez peut-être répartir le travail en plusieurs tâches indépendantes qui seront effectuées par plusieurs nœuds fonctionnant en parallèle.</span><span class="sxs-lookup"><span data-stu-id="ea316-162">Depending on the data and type of work to be performed, you may be able to split the work into independent tasks that can be performed by multiple nodes working in parallel.</span></span> <span data-ttu-id="ea316-163">Consultez [Style d’architecture Big Compute][big-compute].</span><span class="sxs-lookup"><span data-stu-id="ea316-163">See [Big compute architecture style][big-compute].</span></span>

<span data-ttu-id="ea316-164">**Utilisez l’élection du responsable pour la coordination** :</span><span class="sxs-lookup"><span data-stu-id="ea316-164">**Use leader election for coordination**.</span></span> <span data-ttu-id="ea316-165">dans les cas où vous avez besoin de coordonner les opérations, veillez à ce que le coordinateur ne devienne pas un point de défaillance unique dans l’application.</span><span class="sxs-lookup"><span data-stu-id="ea316-165">In cases where you need to coordinate operations, make sure the coordinator does not become a single point of failure in the application.</span></span> <span data-ttu-id="ea316-166">Avec le [modèle d’élection du responsable][leader-election], seule une instance est responsable à un instant T et joue le rôle de coordinateur.</span><span class="sxs-lookup"><span data-stu-id="ea316-166">Using the [Leader Election pattern][leader-election], one instance is the leader at any time, and acts as the coordinator.</span></span> <span data-ttu-id="ea316-167">En cas d’échec du responsable, une nouvelle instance est élue responsable.</span><span class="sxs-lookup"><span data-stu-id="ea316-167">If the leader fails, a new instance is elected to be the leader.</span></span>

<!-- links -->

[big-compute]: ../architecture-styles/big-compute.md
[compensating-transaction]: ../../patterns/compensating-transaction.md
[cqrs-style]: ../architecture-styles/cqrs.md
[cqrs-pattern]: ../../patterns/cqrs.md
[cosmosdb-faq]: /azure/cosmos-db/faq
[domain-event]: https://martinfowler.com/eaaDev/DomainEvent.html
[event-sourcing]: ../../patterns/event-sourcing.md
[leader-election]: ../../patterns/leader-election.md
[sas-pattern]: ../../patterns/scheduler-agent-supervisor.md
[sql-snapshot-isolation]: /sql/t-sql/statements/set-transaction-isolation-level-transact-sql
[storage-concurrency]: https://azure.microsoft.com/blog/managing-concurrency-in-microsoft-azure-storage-2/