---
title: Conception d’applications résilientes pour Azure
description: 'Comment créer des applications résilientes dans Azure, pour une haute disponibilité et une récupération d’urgence.'
author: MikeWasson
ms.date: 12/18/2018
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.custom: resiliency
---

# <a name="designing-resilient-applications-for-azure"></a><span data-ttu-id="256d4-103">Conception d’applications résilientes pour Azure</span><span class="sxs-lookup"><span data-stu-id="256d4-103">Designing resilient applications for Azure</span></span>

<span data-ttu-id="256d4-104">Dans un système distribué, des défaillances peuvent se produire.</span><span class="sxs-lookup"><span data-stu-id="256d4-104">In a distributed system, failures will happen.</span></span> <span data-ttu-id="256d4-105">Le matériel peut être défaillant.</span><span class="sxs-lookup"><span data-stu-id="256d4-105">Hardware can fail.</span></span> <span data-ttu-id="256d4-106">Le réseau peut subir des échecs temporaires.</span><span class="sxs-lookup"><span data-stu-id="256d4-106">The network can have transient failures.</span></span> <span data-ttu-id="256d4-107">Exceptionnellement, un service ou une région entiers peuvent rencontrer des interruptions, mais même ces dernières doivent être planifiées.</span><span class="sxs-lookup"><span data-stu-id="256d4-107">Rarely, an entire service or region may experience a disruption, but even those must be planned for.</span></span>

<span data-ttu-id="256d4-108">La création d’une application fiable dans le cloud est différente de la création d’une application fiable dans un environnement d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="256d4-108">Building a reliable application in the cloud is different than building a reliable application in an enterprise setting.</span></span> <span data-ttu-id="256d4-109">Si par le passé vous avez acheté du matériel haut de gamme pour gagner en puissance, dans un environnement de cloud vous devez augmenter vos performances de manière horizontale, et pas verticale.</span><span class="sxs-lookup"><span data-stu-id="256d4-109">While historically you may have purchased higher-end hardware to scale up, in a cloud environment you must scale out instead of scaling up.</span></span> <span data-ttu-id="256d4-110">Les coûts pour les environnements de cloud restent faibles via l’utilisation d’un matériel standard.</span><span class="sxs-lookup"><span data-stu-id="256d4-110">Costs for cloud environments are kept low through the use of commodity hardware.</span></span> <span data-ttu-id="256d4-111">Au lieu d’essayer d’éviter tous les échecs, l’objectif est de réduire les effets d’un échec au sein du système.</span><span class="sxs-lookup"><span data-stu-id="256d4-111">Instead of trying to prevent failures altogether, the goal is to minimize the effects of a failure within the system.</span></span>

<span data-ttu-id="256d4-112">Cet article fournit une vue d’ensemble de la création d’applications résilientes dans Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="256d4-112">This article provides an overview of how to build resilient applications in Microsoft Azure.</span></span> <span data-ttu-id="256d4-113">Il commence par une définition du terme *résilience* et de concepts associés.</span><span class="sxs-lookup"><span data-stu-id="256d4-113">It starts with a definition of the term *resiliency* and related concepts.</span></span> <span data-ttu-id="256d4-114">Il décrit ensuite un processus pour atteindre une résilience, à l’aide d’une approche structurée pendant la durée de vie d’une application, depuis la conception et l’implémentation jusqu’au déploiement et aux opérations.</span><span class="sxs-lookup"><span data-stu-id="256d4-114">Then it describes a process for achieving resiliency, using a structured approach over the lifetime of an application, from design and implementation to deployment and operations.</span></span>

<!-- markdownlint-disable MD026 -->

## <a name="what-is-resiliency"></a><span data-ttu-id="256d4-115">Qu’est-ce que la résilience ?</span><span class="sxs-lookup"><span data-stu-id="256d4-115">What is resiliency?</span></span>

<!-- markdownlint-enable MD026 -->

<span data-ttu-id="256d4-116">**La résilience** est la capacité d’un système à récupérer après des défaillances et à continuer de fonctionner.</span><span class="sxs-lookup"><span data-stu-id="256d4-116">**Resiliency** is the ability of a system to recover from failures and continue to function.</span></span> <span data-ttu-id="256d4-117">Il ne s’agit pas d’*éviter* les défaillances, mais d’y *répondre* en évitant les temps d’arrêt ou la perte de données.</span><span class="sxs-lookup"><span data-stu-id="256d4-117">It's not about *avoiding* failures, but *responding* to failures in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="256d4-118">L’objectif de la résilience est que l’application retrouve un état entièrement fonctionnel suite à une défaillance.</span><span class="sxs-lookup"><span data-stu-id="256d4-118">The goal of resiliency is to return the application to a fully functioning state following a failure.</span></span>

<span data-ttu-id="256d4-119">Deux aspects importants de la résilience sont la haute disponibilité et la récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="256d4-119">Two important aspects of resiliency are high availability and disaster recovery.</span></span>

- <span data-ttu-id="256d4-120">**La haute disponibilité** (HA) est la capacité de l’application à continuer de s’exécuter dans un état sain, sans temps d’arrêt significatif.</span><span class="sxs-lookup"><span data-stu-id="256d4-120">**High availability** (HA) is the ability of the application to continue running in a healthy state, without significant downtime.</span></span> <span data-ttu-id="256d4-121">« Sain » signifie que l’application est réactive et que les utilisateurs peuvent s’y connecter et interagir avec elle.</span><span class="sxs-lookup"><span data-stu-id="256d4-121">By "healthy state," we mean the application is responsive, and users can connect to the application and interact with it.</span></span>  
- <span data-ttu-id="256d4-122">**La récupération d’urgence** est la capacité à récupérer après des incidents rares mais majeurs : des échecs non temporaires et à grande échelle, telles que l’interruption de service qui peut affecter une région entière.</span><span class="sxs-lookup"><span data-stu-id="256d4-122">**Disaster recovery** (DR) is the ability to recover from rare but major incidents: non-transient, wide-scale failures, such as service disruption that affects an entire region.</span></span> <span data-ttu-id="256d4-123">La récupération d’urgence inclut la sauvegarde et l’archivage des données. Elle peut également inclure une intervention manuelle, comme la restauration d’une base de données à partir de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="256d4-123">Disaster recovery includes data backup and archiving, and may include manual intervention, such as restoring a database from backup.</span></span>

<span data-ttu-id="256d4-124">Une façon d’associer la haute disponibilité et la récupération d’urgence est que la récupération d’urgence démarre lorsque l’impact d’une erreur dépasse la capacité de la conception de haute disponibilité pour la manipuler.</span><span class="sxs-lookup"><span data-stu-id="256d4-124">One way to think about HA versus DR is that DR starts when the impact of a fault exceeds the ability of the HA design to handle it.</span></span>  

<span data-ttu-id="256d4-125">Lorsque vous concevez la résilience, vous devez comprendre vos exigences en matière de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="256d4-125">When you design resiliency, you must understand your availability requirements.</span></span> <span data-ttu-id="256d4-126">Quel temps d’arrêt maximal est acceptable ?</span><span class="sxs-lookup"><span data-stu-id="256d4-126">How much downtime is acceptable?</span></span> <span data-ttu-id="256d4-127">Cela dépend en partie du coût.</span><span class="sxs-lookup"><span data-stu-id="256d4-127">This is partly a function of cost.</span></span> <span data-ttu-id="256d4-128">Combien les temps d’arrêt vont-ils coûter à votre entreprise ?</span><span class="sxs-lookup"><span data-stu-id="256d4-128">How much will potential downtime cost your business?</span></span> <span data-ttu-id="256d4-129">Combien devriez-vous investir pour rendre l’application hautement disponible ?</span><span class="sxs-lookup"><span data-stu-id="256d4-129">How much should you invest in making the application highly available?</span></span> <span data-ttu-id="256d4-130">Vous devez également définir ce que cela signifie que l’application soit disponible.</span><span class="sxs-lookup"><span data-stu-id="256d4-130">You also have to define what it means for the application to be available.</span></span> <span data-ttu-id="256d4-131">Par exemple, l’application est-elle « inactive » si un client peut envoyer une commande mais que le système ne peut pas la traiter dans les délais d’exécution habituels ?</span><span class="sxs-lookup"><span data-stu-id="256d4-131">For example, is the application "down" if a customer can submit an order but the system cannot process it within the normal timeframe?</span></span> <span data-ttu-id="256d4-132">Envisagez également la probabilité qu’un type particulier de défaillance se produise, et si une stratégie d’atténuation est économique.</span><span class="sxs-lookup"><span data-stu-id="256d4-132">Also consider the probability of a particular type of outage occurring, and whether a mitigation strategy is cost-effective.</span></span>

<span data-ttu-id="256d4-133">Un autre terme courant est la **continuité de l’activité**. Il s’agit de la capacité d’effectuer des fonctions opérationnelles essentielles pendant et après des conditions défavorables, comme une catastrophe naturelle ou la panne d’un service.</span><span class="sxs-lookup"><span data-stu-id="256d4-133">Another common term is **business continuity** (BC), which is the ability to perform essential business functions during and after adverse conditions, such as a natural disaster or a downed service.</span></span> <span data-ttu-id="256d4-134">La continuité de l’activité couvre l’intégralité des opérations de l’entreprise, y compris les installations physiques, les personnes, les communications, le transport, et l’informatique.</span><span class="sxs-lookup"><span data-stu-id="256d4-134">BC covers the entire operation of the business, including physical facilities, people, communications, transportation, and IT.</span></span> <span data-ttu-id="256d4-135">Cet article se concentre sur les applications cloud, mais la planification de résilience doit être effectuée dans le contexte des exigences globales de continuité de l’activité.</span><span class="sxs-lookup"><span data-stu-id="256d4-135">This article focuses on cloud applications, but resilience planning must be done in the context of overall BC requirements.</span></span>

<span data-ttu-id="256d4-136">La **sauvegarde des données** est une composante essentielle de la récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="256d4-136">**Data backup** is a critical part of DR.</span></span> <span data-ttu-id="256d4-137">Si les composants sans état d’une application subissent une défaillance, vous avez toujours la possibilité de les redéployer.</span><span class="sxs-lookup"><span data-stu-id="256d4-137">If the stateless components of an application fail, you can always redeploy them.</span></span> <span data-ttu-id="256d4-138">Cependant, si des données sont perdues, le système ne peut retrouver sa stabilité.</span><span class="sxs-lookup"><span data-stu-id="256d4-138">But if data is lost, the system can't return to a stable state.</span></span> <span data-ttu-id="256d4-139">Les données doivent être sauvegardées, idéalement dans une région différente, ceci pour éviter tout risque en cas d’incident se produisant à l’échelle régionale.</span><span class="sxs-lookup"><span data-stu-id="256d4-139">Data must be backed up, ideally in a different region in case of a region-wide disaster.</span></span>

<span data-ttu-id="256d4-140">La sauvegarde et la *réplication des données* sont deux processus distincts.</span><span class="sxs-lookup"><span data-stu-id="256d4-140">Backup is distinct from *data replication*.</span></span> <span data-ttu-id="256d4-141">La réplication des données consiste en leur copie quasiment en temps réel, de manière à ce que le système puisse basculer rapidement vers un réplica.</span><span class="sxs-lookup"><span data-stu-id="256d4-141">Data replication involves copying data in near-real-time, so that the system can fail over quickly to a replica.</span></span> <span data-ttu-id="256d4-142">De nombreux systèmes de bases de données prennent en charge la réplication. Par exemple, SQL Server prend en charge les groupes de disponibilité SQL Server AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="256d4-142">Many databases systems support replication; for example, SQL Server supports SQL Server Always On Availability Groups.</span></span> <span data-ttu-id="256d4-143">La réplication des données peut réduire les intervalles de récupération après une panne, en garantissant la conservation permanente d’un réplica des données.</span><span class="sxs-lookup"><span data-stu-id="256d4-143">Data replication can reduce how long it takes to recover from an outage, by ensuring that a replica of the data is always standing by.</span></span> <span data-ttu-id="256d4-144">Toutefois, la réplication des données ne vous protège pas contre les erreurs humaines.</span><span class="sxs-lookup"><span data-stu-id="256d4-144">However, data replication won't protect against human error.</span></span> <span data-ttu-id="256d4-145">Les données corrompues en raison d’une erreur humaine sont elles aussi copiées sur les réplicas.</span><span class="sxs-lookup"><span data-stu-id="256d4-145">If data gets corrupted because of human error, the corrupted data just gets copied to the replicas.</span></span> <span data-ttu-id="256d4-146">Par conséquent, il vous faut intégrer une stratégie de sauvegarde à long terme dans votre stratégie de récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="256d4-146">Therefore, you still need to include long-term backup in your DR strategy.</span></span>

## <a name="process-to-achieve-resiliency"></a><span data-ttu-id="256d4-147">Processus pour obtenir la résilience</span><span class="sxs-lookup"><span data-stu-id="256d4-147">Process to achieve resiliency</span></span>

<span data-ttu-id="256d4-148">La résilience n’est pas un module complémentaire.</span><span class="sxs-lookup"><span data-stu-id="256d4-148">Resiliency is not an add-on.</span></span> <span data-ttu-id="256d4-149">Elle doit être conçue dans le système et mise en pratique opérationnelle.</span><span class="sxs-lookup"><span data-stu-id="256d4-149">It must be designed into the system and put into operational practice.</span></span> <span data-ttu-id="256d4-150">Voici un modèle général à suivre :</span><span class="sxs-lookup"><span data-stu-id="256d4-150">Here is a general model to follow:</span></span>

1. <span data-ttu-id="256d4-151">**Définissez** vos exigences en matière de disponibilité, en fonction des besoins de l’entreprise.</span><span class="sxs-lookup"><span data-stu-id="256d4-151">**Define** your availability requirements, based on business needs.</span></span>
2. <span data-ttu-id="256d4-152">**Concevez** l’application pour assurer la résilience.</span><span class="sxs-lookup"><span data-stu-id="256d4-152">**Design** the application for resiliency.</span></span> <span data-ttu-id="256d4-153">Démarrez avec une architecture qui suit des pratiques éprouvées, puis identifiez les points de défaillance possibles de cette architecture.</span><span class="sxs-lookup"><span data-stu-id="256d4-153">Start with an architecture that follows proven practices, and then identify the possible failure points in that architecture.</span></span>
3. <span data-ttu-id="256d4-154">**Implémentez** des stratégies pour détecter les défaillances et récupérer en cas de panne.</span><span class="sxs-lookup"><span data-stu-id="256d4-154">**Implement** strategies to detect and recover from failures.</span></span>
4. <span data-ttu-id="256d4-155">**Testez** l’implémentation en simulant des erreurs et en déclenchant des basculements forcés.</span><span class="sxs-lookup"><span data-stu-id="256d4-155">**Test** the implementation by simulating faults and triggering forced failovers.</span></span>
5. <span data-ttu-id="256d4-156">**Déployez** l’application en production à l’aide d’un processus fiable et renouvelable.</span><span class="sxs-lookup"><span data-stu-id="256d4-156">**Deploy** the application into production using a reliable, repeatable process.</span></span>
6. <span data-ttu-id="256d4-157">**Surveillez** l’application pour détecter les défaillances.</span><span class="sxs-lookup"><span data-stu-id="256d4-157">**Monitor** the application to detect failures.</span></span> <span data-ttu-id="256d4-158">En surveillant le système, vous pouvez évaluer la santé de l’application et répondre aux incidents si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="256d4-158">By monitoring the system, you can gauge the health of the application and respond to incidents if necessary.</span></span>
7. <span data-ttu-id="256d4-159">**Répondez** aux défaillances qui nécessitent des interventions manuelles.</span><span class="sxs-lookup"><span data-stu-id="256d4-159">**Respond** if there are failure that require manual interventions.</span></span>

<span data-ttu-id="256d4-160">Dans le reste de l’article, nous expliquons plus en détail chacune de ces étapes.</span><span class="sxs-lookup"><span data-stu-id="256d4-160">In the remainder of this article, we discuss each of these steps in more detail.</span></span>

## <a name="define-your-availability-requirements"></a><span data-ttu-id="256d4-161">Définir vos exigences de disponibilité</span><span class="sxs-lookup"><span data-stu-id="256d4-161">Define your availability requirements</span></span>

<span data-ttu-id="256d4-162">La planification de la résilience démarre avec les besoins de l’entreprise.</span><span class="sxs-lookup"><span data-stu-id="256d4-162">Resiliency planning starts with business requirements.</span></span> <span data-ttu-id="256d4-163">Voici certaines approches pour aborder la résilience dans ces termes.</span><span class="sxs-lookup"><span data-stu-id="256d4-163">Here are some approaches for thinking about resiliency in those terms.</span></span>

### <a name="decompose-by-workload"></a><span data-ttu-id="256d4-164">Décomposez par charge de travail</span><span class="sxs-lookup"><span data-stu-id="256d4-164">Decompose by workload</span></span>

<span data-ttu-id="256d4-165">De nombreuses solutions cloud sont constituées de plusieurs charges de travail d’application.</span><span class="sxs-lookup"><span data-stu-id="256d4-165">Many cloud solutions consist of multiple application workloads.</span></span> <span data-ttu-id="256d4-166">Le terme « charge de travail » dans ce contexte renvoie à une fonctionnalité discrète ou une tâche informatique, qui peut être séparée logiquement des autres tâches, en termes de logique métier et de besoins de stockage des données.</span><span class="sxs-lookup"><span data-stu-id="256d4-166">The term "workload" in this context means a discrete capability or computing task, which can be logically separated from other tasks, in terms of business logic and data storage requirements.</span></span> <span data-ttu-id="256d4-167">Par exemple, une application e-commerce peut inclure les charges de travail suivantes :</span><span class="sxs-lookup"><span data-stu-id="256d4-167">For example, an e-commerce app might include the following workloads:</span></span>

- <span data-ttu-id="256d4-168">Parcourir et rechercher un catalogue de produits.</span><span class="sxs-lookup"><span data-stu-id="256d4-168">Browse and search a product catalog.</span></span>
- <span data-ttu-id="256d4-169">Créer et suivre des commandes.</span><span class="sxs-lookup"><span data-stu-id="256d4-169">Create and track orders.</span></span>
- <span data-ttu-id="256d4-170">Afficher les recommandations.</span><span class="sxs-lookup"><span data-stu-id="256d4-170">View recommendations.</span></span>

<span data-ttu-id="256d4-171">Ces charges de travail peuvent avoir des exigences différentes concernant la disponibilité, la scalabilité, la cohérence des données et la reprise d’activité.</span><span class="sxs-lookup"><span data-stu-id="256d4-171">These workloads might have different requirements for availability, scalability, data consistency, and disaster recovery.</span></span> <span data-ttu-id="256d4-172">L’entreprise doit choisir si elle préfère privilégier les coûts par rapport aux risques ou inversement.</span><span class="sxs-lookup"><span data-stu-id="256d4-172">There are business decisions to be made in terms of balancing cost versus risk.</span></span>

<span data-ttu-id="256d4-173">Envisagez également des modèles d’utilisation.</span><span class="sxs-lookup"><span data-stu-id="256d4-173">Also consider usage patterns.</span></span> <span data-ttu-id="256d4-174">Y a-t-il certaines périodes critiques durant lesquelles le système doit être disponible ?</span><span class="sxs-lookup"><span data-stu-id="256d4-174">Are there certain critical periods when the system must be available?</span></span> <span data-ttu-id="256d4-175">Par exemple, un service de déclaration d’impôts ne peut pas s’arrêter juste avant la date limite de dépôt, un service de diffusion de vidéo en continu doit continuer de fonctionner pendant un événement sportif important, etc.</span><span class="sxs-lookup"><span data-stu-id="256d4-175">For example, a tax-filing service can't go down right before the filing deadline, a video streaming service must stay up during a big sports event, and so on.</span></span> <span data-ttu-id="256d4-176">Pendant les périodes critiques, vous pouvez avoir des déploiements redondants dans plusieurs régions. L’application pourrait donc rencontrer un échec en cas de défaillance d’une région.</span><span class="sxs-lookup"><span data-stu-id="256d4-176">During the critical periods, you might have redundant deployments across several regions, so the application could fail over if one region failed.</span></span> <span data-ttu-id="256d4-177">Toutefois, comme un déploiement multirégion est plus coûteux, durant les périodes moins critiques, vous pouvez exécuter l’application dans une seule région.</span><span class="sxs-lookup"><span data-stu-id="256d4-177">However, a multi-region deployment is potentially more expensive, so during less critical times, you might run the application in a single region.</span></span> <span data-ttu-id="256d4-178">Dans certains cas, les dépenses supplémentaires peuvent être atténuées avec des techniques serverless modernes, qui utilisent une facturation basée sur la consommation pour ne pas vous facturer les ressources de calcul sous-utilisées.</span><span class="sxs-lookup"><span data-stu-id="256d4-178">In some cases, the additional expense can be mitigated by using modern serverless techniques, which use consumption-based billing, so you are not charged for under-utilitzed compute resources.</span></span>

### <a name="rto-and-rpo"></a><span data-ttu-id="256d4-179">RTO et RPO</span><span class="sxs-lookup"><span data-stu-id="256d4-179">RTO and RPO</span></span>

<span data-ttu-id="256d4-180">Deux métriques importantes sont à prendre en considération : l’objectif de délai de récupération et l’objectif de point de récupération, puisqu’ils entrent dans le cadre de la reprise d’activité.</span><span class="sxs-lookup"><span data-stu-id="256d4-180">Two important metrics to consider are the recovery time objective and recovery point objective, as they pertain to disaster recovery.</span></span>

- <span data-ttu-id="256d4-181">L’**objectif de délai de récupération** (RTO) est la durée maximale acceptable pendant laquelle une application peut être indisponible après un incident.</span><span class="sxs-lookup"><span data-stu-id="256d4-181">**Recovery time objective** (RTO) is the maximum acceptable time that an application can be unavailable after an incident.</span></span> <span data-ttu-id="256d4-182">Si votre objectif RTO est de 90 minutes, vous devez être en mesure de remettre l’application en état de fonctionnement dans les 90 minutes à partir du début d’une panne.</span><span class="sxs-lookup"><span data-stu-id="256d4-182">If your RTO is 90 minutes, you must be able to restore the application to a running state within 90 minutes from the start of a disaster.</span></span> <span data-ttu-id="256d4-183">Si vous avez un objectif RTO très bas, vous pouvez conserver un deuxième déploiement régional exécuté sur une configuration active/passive en veille, pour vous protéger d’une panne régionale.</span><span class="sxs-lookup"><span data-stu-id="256d4-183">If you have a very low RTO, you might keep a second regional deployment continually running an active/passive configuration on standby, to protect against a regional outage.</span></span> <span data-ttu-id="256d4-184">Dans certains cas, vous pouvez déployer une configuration active/active pour obtenir un RTO encore plus bas.</span><span class="sxs-lookup"><span data-stu-id="256d4-184">In some cases you might deploy an active/active configuration to achieve even lower RTO.</span></span>

- <span data-ttu-id="256d4-185">L’**objectif de point de récupération** (RPO) est la durée maximale de perte de données acceptable pendant une panne.</span><span class="sxs-lookup"><span data-stu-id="256d4-185">**Recovery point objective** (RPO) is the maximum duration of data loss that is acceptable during a disaster.</span></span> <span data-ttu-id="256d4-186">Par exemple, si vous stockez des données dans une base de données unique, sans aucune réplication vers d’autres bases de données, et effectuez des sauvegardes toutes les heures, vous risquez de perdre jusqu’à une heure de données.</span><span class="sxs-lookup"><span data-stu-id="256d4-186">For example, if you store data in a single database, with no replication to other databases, and perform hourly backups, you could lose up to an hour of data.</span></span>

<span data-ttu-id="256d4-187">Les objectifs RTO et RPO sont des exigences non opérationnelles d’un système et doivent être définis selon les besoins de l’entreprise.</span><span class="sxs-lookup"><span data-stu-id="256d4-187">RTO and RPO are non-functional requirements of a system, and should be dictated by business requirements.</span></span> <span data-ttu-id="256d4-188">Pour dériver ces valeurs, évaluez les risques ainsi que le coût d’une perte de données et d’un temps d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="256d4-188">To derive these values, it's a good idea to conduct a risk assessment, and clearly understanding the cost of downtime or data loss.</span></span>

### <a name="mttr-and-mtbf"></a><span data-ttu-id="256d4-189">MTTR et MTBF</span><span class="sxs-lookup"><span data-stu-id="256d4-189">MTTR and MTBF</span></span>

<span data-ttu-id="256d4-190">Deux autres mesures courantes de la disponibilité sont le temps moyen de récupération (MTTR) et le temps moyen entre échecs (MTBF).</span><span class="sxs-lookup"><span data-stu-id="256d4-190">Two other common measures of availability are mean time to recover (MTTR) and mean time between failures (MTBF).</span></span> <span data-ttu-id="256d4-191">Ces mesures sont généralement utilisées en interne par les fournisseurs de services pour déterminer les services cloud pour lesquels ajouter la redondance et les contrats SLA à fournir aux clients.</span><span class="sxs-lookup"><span data-stu-id="256d4-191">These measures are usually used internally by service providers to determine where to add redundancy to cloud services, and which SLAs to provide to customers.</span></span>

<span data-ttu-id="256d4-192">Le **temps moyen de récupération** (MTTR) est la durée moyenne nécessaire à la restauration d’un composant après un échec.</span><span class="sxs-lookup"><span data-stu-id="256d4-192">**Mean time to recover** (MTTR) is the average time that it takes to restore a component after a failure.</span></span> <span data-ttu-id="256d4-193">Le MTTR est un fait empirique concernant un système.</span><span class="sxs-lookup"><span data-stu-id="256d4-193">MTTR is an empirical fact about a component.</span></span> <span data-ttu-id="256d4-194">À partir du MTTR de chaque composant, vous pouvez estimer le MTTR d’une application entière.</span><span class="sxs-lookup"><span data-stu-id="256d4-194">Based on the MTTR of each component, you can estimate the MTTR of an entire application.</span></span> <span data-ttu-id="256d4-195">Une application créée à partir de plusieurs composants avec des valeurs MTTR basses est une application avec un MTTR général bas, c’est-à-dire qu’elle récupère rapidement après un échec.</span><span class="sxs-lookup"><span data-stu-id="256d4-195">Building applications from multiple components with low MTTR values results in an application with a low overall MTTR &mdash; one that recovers quickly from failures.</span></span>

<span data-ttu-id="256d4-196">Le **temps moyen entre échecs** (MTBF) est la durée d’exécution raisonnable d’un composant entre les pannes.</span><span class="sxs-lookup"><span data-stu-id="256d4-196">**Mean time between failures** (MTBF) is the runtime that a component can reasonably expect to last between outages.</span></span> <span data-ttu-id="256d4-197">Cette métrique peut vous aider à calculer la fréquence à laquelle un service devient indisponible.</span><span class="sxs-lookup"><span data-stu-id="256d4-197">This metric can help you to calculate how frequently a service will become unavailable.</span></span> <span data-ttu-id="256d4-198">Un composant non fiable a un MTBF bas, ce qui entraîne un chiffre de contrat SLA bas pour ce composant.</span><span class="sxs-lookup"><span data-stu-id="256d4-198">An unreliable component has a low MTBF, resulting in a low SLA number for that component.</span></span> <span data-ttu-id="256d4-199">Toutefois, un MTBF bas peut être atténué en déployant plusieurs instances du composant qui peuvent être basculées l’une sur l’autre.</span><span class="sxs-lookup"><span data-stu-id="256d4-199">However, a low MTBF can be mitigated by deploying multiple instances of the component and implementing failover between them.</span></span>

> [!NOTE]
> <span data-ttu-id="256d4-200">Si UNE valeur MTTR des composants d’une configuration à haute disponibilité dépasse le RTO du système, un échec dans le système entraîne une interruption inacceptable de l’activité.</span><span class="sxs-lookup"><span data-stu-id="256d4-200">If ANY of the MTTR values of components in a high-availability setup exceed the RTO of the system, then a failure in the system will cause an unacceptable business disruption.</span></span> <span data-ttu-id="256d4-201">Le système ne peut alors pas être restauré dans l’objectif RTO défini.</span><span class="sxs-lookup"><span data-stu-id="256d4-201">It won't be possible to restore the system within the defined RTO.</span></span>

### <a name="slas"></a><span data-ttu-id="256d4-202">Contrats SLA</span><span class="sxs-lookup"><span data-stu-id="256d4-202">SLAs</span></span>

<span data-ttu-id="256d4-203">Dans Azure, les [contrats de niveau de service][sla] (SLA) décrivent les engagements de Microsoft en matière de temps de fonctionnement et de connectivité.</span><span class="sxs-lookup"><span data-stu-id="256d4-203">In Azure, the [Service Level Agreement][sla] (SLA) describes Microsoft’s commitments for uptime and connectivity.</span></span> <span data-ttu-id="256d4-204">Si le contrat SLA pour un service particulier est de 99,9 %, cela signifie que le service doit être disponible 99,9 % du temps.</span><span class="sxs-lookup"><span data-stu-id="256d4-204">If the SLA for a particular service is 99.9%, it means you should expect the service to be available 99.9% of the time.</span></span>

> [!NOTE]
> <span data-ttu-id="256d4-205">Le contrat SLA Azure comprend également des dispositions permettant d’obtenir un crédit de service si le contrat SLA n’est pas rempli, ainsi que des définitions spécifiques de « disponibilité » pour chaque service.</span><span class="sxs-lookup"><span data-stu-id="256d4-205">The Azure SLA also includes provisions for obtaining a service credit if the SLA is not met, along with specific definitions of "availability" for each service.</span></span> <span data-ttu-id="256d4-206">Cet aspect du contrat SLA agit comme une stratégie d’application.</span><span class="sxs-lookup"><span data-stu-id="256d4-206">That aspect of the SLA acts as an enforcement policy.</span></span>

<span data-ttu-id="256d4-207">Vous devez définir vos propres contrats SLA cibles pour chaque charge de travail dans votre solution.</span><span class="sxs-lookup"><span data-stu-id="256d4-207">You should define your own target SLAs for each workload in your solution.</span></span> <span data-ttu-id="256d4-208">Un contrat SLA permet d’évaluer si l’architecture répond aux exigences de l’entreprise.</span><span class="sxs-lookup"><span data-stu-id="256d4-208">An SLA makes it possible to evaluate whether the architecture meets the business requirements.</span></span> <span data-ttu-id="256d4-209">Effectuez un exercice de mappage des dépendances pour identifier les dépendances internes et externes, notamment Active Directory ou des services tiers tels qu’un fournisseur de paiement ou un service de messagerie.</span><span class="sxs-lookup"><span data-stu-id="256d4-209">Perform a dependency mapping exercise to identify internal and external dependencies, such as Active Directory or third-party services such as a payment provider or e-mail messaging service.</span></span> <span data-ttu-id="256d4-210">Faites particulièrement attention aux dépendances externes, celles-ci pouvant constituer un point de défaillance unique ou causer des goulots d’étranglement durant un événement.</span><span class="sxs-lookup"><span data-stu-id="256d4-210">In particular, pay attention to any external dependencies that can be single point of failure or cause bottlenecks during an event.</span></span> <span data-ttu-id="256d4-211">Par exemple, si une charge de travail requiert une disponibilité de 99,99 %, mais dépend d’un service avec un contrat SLA de 99,9 %, ce service ne peut pas être un point de défaillance unique dans le système.</span><span class="sxs-lookup"><span data-stu-id="256d4-211">For example, if a workload requires 99.99% uptime, but depends on a service with a 99.9% SLA, that service cannot be a single-point of failure in the system.</span></span> <span data-ttu-id="256d4-212">Une solution consiste à posséder un chemin d’accès de secours en cas d’échec du service, ou à prendre d’autres mesures pour récupérer suite à un échec dans ce service.</span><span class="sxs-lookup"><span data-stu-id="256d4-212">One remedy is to have a fallback path in case the service fails, or take other measures to recover from a failure in that service.</span></span>

<span data-ttu-id="256d4-213">Le tableau suivant présente les temps d’arrêt cumulatifs potentiels pour différents niveaux de contrat SLA.</span><span class="sxs-lookup"><span data-stu-id="256d4-213">The following table shows the potential cumulative downtime for various SLA levels.</span></span>

| <span data-ttu-id="256d4-214">Contrat SLA</span><span class="sxs-lookup"><span data-stu-id="256d4-214">SLA</span></span> | <span data-ttu-id="256d4-215">Temps d’arrêt par semaine</span><span class="sxs-lookup"><span data-stu-id="256d4-215">Downtime per week</span></span> | <span data-ttu-id="256d4-216">Temps d’arrêt par mois</span><span class="sxs-lookup"><span data-stu-id="256d4-216">Downtime per month</span></span> | <span data-ttu-id="256d4-217">Temps d’arrêt par an</span><span class="sxs-lookup"><span data-stu-id="256d4-217">Downtime per year</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="256d4-218">99 %</span><span class="sxs-lookup"><span data-stu-id="256d4-218">99%</span></span> |<span data-ttu-id="256d4-219">1,68 heure</span><span class="sxs-lookup"><span data-stu-id="256d4-219">1.68 hours</span></span> |<span data-ttu-id="256d4-220">7,2 heures</span><span class="sxs-lookup"><span data-stu-id="256d4-220">7.2 hours</span></span> |<span data-ttu-id="256d4-221">3,65 jours</span><span class="sxs-lookup"><span data-stu-id="256d4-221">3.65 days</span></span> |
| <span data-ttu-id="256d4-222">99,9 %</span><span class="sxs-lookup"><span data-stu-id="256d4-222">99.9%</span></span> |<span data-ttu-id="256d4-223">10,1 minutes</span><span class="sxs-lookup"><span data-stu-id="256d4-223">10.1 minutes</span></span> |<span data-ttu-id="256d4-224">43,2 minutes</span><span class="sxs-lookup"><span data-stu-id="256d4-224">43.2 minutes</span></span> |<span data-ttu-id="256d4-225">8,76 heures</span><span class="sxs-lookup"><span data-stu-id="256d4-225">8.76 hours</span></span> |
| <span data-ttu-id="256d4-226">99,95 %</span><span class="sxs-lookup"><span data-stu-id="256d4-226">99.95%</span></span> |<span data-ttu-id="256d4-227">5 minutes</span><span class="sxs-lookup"><span data-stu-id="256d4-227">5 minutes</span></span> |<span data-ttu-id="256d4-228">21,6 minutes</span><span class="sxs-lookup"><span data-stu-id="256d4-228">21.6 minutes</span></span> |<span data-ttu-id="256d4-229">4,38 heures</span><span class="sxs-lookup"><span data-stu-id="256d4-229">4.38 hours</span></span> |
| <span data-ttu-id="256d4-230">99,99 %</span><span class="sxs-lookup"><span data-stu-id="256d4-230">99.99%</span></span> |<span data-ttu-id="256d4-231">1,01 minute</span><span class="sxs-lookup"><span data-stu-id="256d4-231">1.01 minutes</span></span> |<span data-ttu-id="256d4-232">4,32 minutes</span><span class="sxs-lookup"><span data-stu-id="256d4-232">4.32 minutes</span></span> |<span data-ttu-id="256d4-233">52,56 minutes</span><span class="sxs-lookup"><span data-stu-id="256d4-233">52.56 minutes</span></span> |
| <span data-ttu-id="256d4-234">99, 999 %</span><span class="sxs-lookup"><span data-stu-id="256d4-234">99.999%</span></span> |<span data-ttu-id="256d4-235">6 secondes</span><span class="sxs-lookup"><span data-stu-id="256d4-235">6 seconds</span></span> |<span data-ttu-id="256d4-236">25,9 secondes</span><span class="sxs-lookup"><span data-stu-id="256d4-236">25.9 seconds</span></span> |<span data-ttu-id="256d4-237">5,26 minutes</span><span class="sxs-lookup"><span data-stu-id="256d4-237">5.26 minutes</span></span> |

<span data-ttu-id="256d4-238">Bien entendu, une plus grande disponibilité est préférable, tout le reste étant égal.</span><span class="sxs-lookup"><span data-stu-id="256d4-238">Of course, higher availability is better, everything else being equal.</span></span> <span data-ttu-id="256d4-239">Mais si vous cherchez à obtenir davantage de 9, le coût et la complexité nécessaires pour atteindre ce niveau augmenteront.</span><span class="sxs-lookup"><span data-stu-id="256d4-239">But as you strive for more 9s, the cost and complexity to achieve that level of availability grows.</span></span> <span data-ttu-id="256d4-240">Une disponibilité de 99,99 % se traduit par environ 5 minutes de temps d’arrêt total par mois.</span><span class="sxs-lookup"><span data-stu-id="256d4-240">An uptime of 99.99% translates to about 5 minutes of total downtime per month.</span></span> <span data-ttu-id="256d4-241">L’augmentation du coût et de la complexité en vaut-elle la peine pour atteindre cinq 9 (99,999 %) de disponibilité ?</span><span class="sxs-lookup"><span data-stu-id="256d4-241">Is it worth the additional complexity and cost to reach five 9s?</span></span> <span data-ttu-id="256d4-242">La réponse dépend des exigences de l’entreprise.</span><span class="sxs-lookup"><span data-stu-id="256d4-242">The answer depends on the business requirements.</span></span>

<span data-ttu-id="256d4-243">Voici quelques autres considérations à prendre en compte lors de la définition d’un contrat SLA :</span><span class="sxs-lookup"><span data-stu-id="256d4-243">Here are some other considerations when defining an SLA:</span></span>

- <span data-ttu-id="256d4-244">Pour obtenir les quatre 9 (99,99 %), vous ne pouvez probablement pas avoir recours à une intervention manuelle pour récupérer en cas de défaillances.</span><span class="sxs-lookup"><span data-stu-id="256d4-244">To achieve four 9's (99.99%), you probably can't rely on manual intervention to recover from failures.</span></span> <span data-ttu-id="256d4-245">L’application doit pouvoir effectuer des diagnostics et se réparer elle-même.</span><span class="sxs-lookup"><span data-stu-id="256d4-245">The application must be self-diagnosing and self-healing.</span></span>
- <span data-ttu-id="256d4-246">Au-delà de quatre 9, il devient difficile de détecter les pannes assez rapidement pour respecter les engagements du contrat SLA.</span><span class="sxs-lookup"><span data-stu-id="256d4-246">Beyond four 9's, it is challenging to detect outages quickly enough to meet the SLA.</span></span>
- <span data-ttu-id="256d4-247">Pensez à la fenêtre de temps contre laquelle est mesuré votre contrat SLA.</span><span class="sxs-lookup"><span data-stu-id="256d4-247">Think about the time window that your SLA is measured against.</span></span> <span data-ttu-id="256d4-248">Plus la fenêtre est petite, plus les tolérances seront strictes.</span><span class="sxs-lookup"><span data-stu-id="256d4-248">The smaller the window, the tighter the tolerances.</span></span> <span data-ttu-id="256d4-249">Cela n’a pas de sens de définir votre contrat SLA en termes de temps de fonctionnement par heure ou par jour.</span><span class="sxs-lookup"><span data-stu-id="256d4-249">It probably doesn't make sense to define your SLA in terms of hourly or daily uptime.</span></span>
- <span data-ttu-id="256d4-250">Utilisez les mesures MTBF et MTTR.</span><span class="sxs-lookup"><span data-stu-id="256d4-250">Consider the MTBF and MTTR measurements.</span></span> <span data-ttu-id="256d4-251">Plus votre SLA est bas, moins le service sera indisponible et plus vite il récupèrera.</span><span class="sxs-lookup"><span data-stu-id="256d4-251">The lower your SLA, the less frequently the service can go down, and the quicker the service must recover.</span></span>

### <a name="composite-slas"></a><span data-ttu-id="256d4-252">Contrats SLA composites</span><span class="sxs-lookup"><span data-stu-id="256d4-252">Composite SLAs</span></span>

<span data-ttu-id="256d4-253">Envisagez une application web App Service qui écrit à Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="256d4-253">Consider an App Service web app that writes to Azure SQL Database.</span></span> <span data-ttu-id="256d4-254">Au moment de la rédaction, ces services Azure possèdent les contrats SLA suivants :</span><span class="sxs-lookup"><span data-stu-id="256d4-254">At the time of this writing, these Azure services have the following SLAs:</span></span>

- <span data-ttu-id="256d4-255">Applications web App Service = 99,95%</span><span class="sxs-lookup"><span data-stu-id="256d4-255">App Service Web Apps = 99.95%</span></span>
- <span data-ttu-id="256d4-256">SQL Database = 99,99%</span><span class="sxs-lookup"><span data-stu-id="256d4-256">SQL Database = 99.99%</span></span>

![Contrat SLA composite](./images/sla1.png)

<span data-ttu-id="256d4-258">Quel est le temps d’arrêt maximal attendu pour cette application ?</span><span class="sxs-lookup"><span data-stu-id="256d4-258">What is the maximum downtime you would expect for this application?</span></span> <span data-ttu-id="256d4-259">En cas d’échec d’un service, l’application entière échoue.</span><span class="sxs-lookup"><span data-stu-id="256d4-259">If either service fails, the whole application fails.</span></span> <span data-ttu-id="256d4-260">En règle générale, la probabilité d’échec de chaque service est indépendante, par conséquent le contrat SLA composite pour cette application est de 99,95 % &times; 99,99 % = 99,94 %.</span><span class="sxs-lookup"><span data-stu-id="256d4-260">In general, the probability of each service failing is independent, so the composite SLA for this application is 99.95% &times; 99.99% = 99.94%.</span></span> <span data-ttu-id="256d4-261">Ce taux est inférieur aux contrats SLA individuels, ce qui n’est pas surprenant, car une application qui repose sur plusieurs services possède davantage de points de défaillance potentiels.</span><span class="sxs-lookup"><span data-stu-id="256d4-261">That's lower than the individual SLAs, which isn't surprising, because an application that relies on multiple services has more potential failure points.</span></span>

<span data-ttu-id="256d4-262">En revanche, vous pouvez améliorer le contrat SLA composite en créant des chemins d’accès de secours indépendants.</span><span class="sxs-lookup"><span data-stu-id="256d4-262">On the other hand, you can improve the composite SLA by creating independent fallback paths.</span></span> <span data-ttu-id="256d4-263">Par exemple, si SQL Database n’est pas disponible, placez des transactions dans une file d’attente pour un traitement ultérieur.</span><span class="sxs-lookup"><span data-stu-id="256d4-263">For example, if SQL Database is unavailable, put transactions into a queue, to be processed later.</span></span>

![Contrat SLA composite](./images/sla2.png)

<span data-ttu-id="256d4-265">Grâce à cette conception, l’application est toujours disponible, même si elle ne peut pas se connecter à la base de données.</span><span class="sxs-lookup"><span data-stu-id="256d4-265">With this design, the application is still available even if it can't connect to the database.</span></span> <span data-ttu-id="256d4-266">Toutefois, cela échoue si la base de données et la file d’attente échouent en même temps.</span><span class="sxs-lookup"><span data-stu-id="256d4-266">However, it fails if the database and the queue both fail at the same time.</span></span> <span data-ttu-id="256d4-267">Le pourcentage de temps attendu pour une défaillance simultanée est 0,0001 &times; 0,001, donc le contrat SLA composite pour ce chemin d’accès combiné est :</span><span class="sxs-lookup"><span data-stu-id="256d4-267">The expected percentage of time for a simultaneous failure is 0.0001 &times; 0.001, so the composite SLA for this combined path is:</span></span>  

- <span data-ttu-id="256d4-268">Base de données OU file d’attente = 1,0 &minus; (0,0001 &times; 0,001) = 99,99999 %</span><span class="sxs-lookup"><span data-stu-id="256d4-268">Database OR queue = 1.0 &minus; (0.0001 &times; 0.001) = 99.99999%</span></span>

<span data-ttu-id="256d4-269">Le contrat SLA composite total est de :</span><span class="sxs-lookup"><span data-stu-id="256d4-269">The total composite SLA is:</span></span>

- <span data-ttu-id="256d4-270">Application web ET (base de données OU file d’attente) = 99,95 % &times; 99,99999 % = ~99,95%</span><span class="sxs-lookup"><span data-stu-id="256d4-270">Web app AND (database OR queue) = 99.95% &times; 99.99999% = ~99.95%</span></span>

<span data-ttu-id="256d4-271">Mais il existe des compromis à cette approche.</span><span class="sxs-lookup"><span data-stu-id="256d4-271">But there are tradeoffs to this approach.</span></span> <span data-ttu-id="256d4-272">La logique d’application est plus complexe, vous payez pour la file d’attente, et il peut y avoir des problèmes de cohérence des données à prendre en compte.</span><span class="sxs-lookup"><span data-stu-id="256d4-272">The application logic is more complex, you are paying for the queue, and there may be data consistency issues to consider.</span></span>

<span data-ttu-id="256d4-273">**Contrat SLA pour déploiement multi-région**.</span><span class="sxs-lookup"><span data-stu-id="256d4-273">**SLA for multi-region deployments**.</span></span> <span data-ttu-id="256d4-274">Une autre technique de haute disponibilité consiste à déployer l’application dans plusieurs régions, et à utiliser Azure Traffic Manager pour basculer au cas où l’application échoue dans une région.</span><span class="sxs-lookup"><span data-stu-id="256d4-274">Another HA technique is to deploy the application in more than one region, and use Azure Traffic Manager to fail over if the application fails in one region.</span></span> <span data-ttu-id="256d4-275">Pour un déploiement multirégion, le contrat SLA composite est calculé comme suit.</span><span class="sxs-lookup"><span data-stu-id="256d4-275">For a multi-region deployment, the composite SLA is calculated as follows.</span></span>

<span data-ttu-id="256d4-276">*N* est le contrat SLA composite de l’application déployée dans une région, et *R* est le nombre de régions où l’application est déployée.</span><span class="sxs-lookup"><span data-stu-id="256d4-276">Let *N* be the composite SLA for the application deployed in one region, and *R* be the number of regions where the application is deployed.</span></span> <span data-ttu-id="256d4-277">Le risque que l’application échoue dans toutes les régions en même temps est ((1 &minus; N) ^ R).</span><span class="sxs-lookup"><span data-stu-id="256d4-277">The expected chance that the application will fail in all regions at the same time is ((1 &minus; N) ^ R).</span></span>

<span data-ttu-id="256d4-278">Par exemple, si le contrat SLA d’une seule région est 99,95 %,</span><span class="sxs-lookup"><span data-stu-id="256d4-278">For example, if the single-region SLA is 99.95%,</span></span>

- <span data-ttu-id="256d4-279">le contrat SLA combiné des deux régions = (1 &minus; (1 &minus; 0,9995) ^ 2) = 99,999975 %</span><span class="sxs-lookup"><span data-stu-id="256d4-279">The combined SLA for two regions = (1 &minus; (1 &minus; 0.9995) ^ 2) = 99.999975%</span></span>
- <span data-ttu-id="256d4-280">le contrat SLA combiné pour quatre régions = (1 &minus; (1 &minus; 0,9995) ^ 4) = 99,999999 %</span><span class="sxs-lookup"><span data-stu-id="256d4-280">The combined SLA for four regions = (1 &minus; (1 &minus; 0.9995) ^ 4) = 99.999999%</span></span>

<span data-ttu-id="256d4-281">Vous devez aussi prendre en compte le [contrat SLA pour Traffic Manager][tm-sla].</span><span class="sxs-lookup"><span data-stu-id="256d4-281">You must also factor in the [SLA for Traffic Manager][tm-sla].</span></span> <span data-ttu-id="256d4-282">Au moment de la rédaction, le contrat SLA pour Traffic Manager est de 99,99 %.</span><span class="sxs-lookup"><span data-stu-id="256d4-282">At the time of this writing, the SLA for Traffic Manager SLA is 99.99%.</span></span>

<span data-ttu-id="256d4-283">Par ailleurs, le basculement n’est pas instantané dans les configurations actives-passives, ce qui peut entraîner un temps d’arrêt pendant le basculement.</span><span class="sxs-lookup"><span data-stu-id="256d4-283">Also, failing over is not instantaneous in active-passive configurations, which can result in some downtime during a failover.</span></span> <span data-ttu-id="256d4-284">Consultez [Surveillance et basculement des points de terminaison Traffic Manager][tm-failover].</span><span class="sxs-lookup"><span data-stu-id="256d4-284">See [Traffic Manager endpoint monitoring and failover][tm-failover].</span></span>

<span data-ttu-id="256d4-285">Le numéro de contrat SLA calculé est une base utile, mais il ne dit pas tout sur la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="256d4-285">The calculated SLA number is a useful baseline, but it doesn't tell the whole story about availability.</span></span> <span data-ttu-id="256d4-286">Souvent, il arrive qu’une application se dégrade normalement lorsqu’un chemin d’accès non critique échoue.</span><span class="sxs-lookup"><span data-stu-id="256d4-286">Often, an application can degrade gracefully when a non-critical path fails.</span></span> <span data-ttu-id="256d4-287">Imaginez une application qui propose un catalogue de livres.</span><span class="sxs-lookup"><span data-stu-id="256d4-287">Consider an application that shows a catalog of books.</span></span> <span data-ttu-id="256d4-288">Si l’application ne peut pas récupérer l’image miniature de la couverture, elle affichera une image de substitution.</span><span class="sxs-lookup"><span data-stu-id="256d4-288">If the application can't retrieve the thumbnail image for the cover, it might show a placeholder image.</span></span> <span data-ttu-id="256d4-289">Dans ce cas, le fait que l’application n’ait pas réussi à obtenir l’image ne réduit pas son temps de fonctionnement, mais cela affecte l’expérience utilisateur.</span><span class="sxs-lookup"><span data-stu-id="256d4-289">In that case, failing to get the image does not reduce the application's uptime, although it affects the user experience.</span></span>  

## <a name="design-for-resiliency"></a><span data-ttu-id="256d4-290">Conception pour la résilience</span><span class="sxs-lookup"><span data-stu-id="256d4-290">Design for resiliency</span></span>

<span data-ttu-id="256d4-291">Pendant la phase de conception, vous devez effectuer une analyse du mode d’échec (FMA).</span><span class="sxs-lookup"><span data-stu-id="256d4-291">During the design phase, you should perform a failure mode analysis (FMA).</span></span> <span data-ttu-id="256d4-292">Une analyse FMA vise à identifier les points de défaillance possibles et à définir la manière dont l’application y répondra.</span><span class="sxs-lookup"><span data-stu-id="256d4-292">The goal of an FMA is to identify possible points of failure, and define how the application will respond to those failures.</span></span>

- <span data-ttu-id="256d4-293">Comment l’application détectera-t-elle ce type d’échec ?</span><span class="sxs-lookup"><span data-stu-id="256d4-293">How will the application detect this type of failure?</span></span>
- <span data-ttu-id="256d4-294">Comment l’application répondra-t-elle à ce type d’échec ?</span><span class="sxs-lookup"><span data-stu-id="256d4-294">How will the application respond to this type of failure?</span></span>
- <span data-ttu-id="256d4-295">Comment enregistrerez-vous et surveillerez-vous ce type d’échec ?</span><span class="sxs-lookup"><span data-stu-id="256d4-295">How will you log and monitor this type of failure?</span></span>

<span data-ttu-id="256d4-296">Pour plus d’informations sur le processus FMA, avec des recommandations spécifiques pour Azure, consultez [Guide de résilience Azure : Analyse du mode d’échec][fma].</span><span class="sxs-lookup"><span data-stu-id="256d4-296">For more information about the FMA process, with specific recommendations for Azure, see [Azure resiliency guidance: Failure mode analysis][fma].</span></span>

### <a name="example-of-identifying-failure-modes-and-detection-strategy"></a><span data-ttu-id="256d4-297">Exemple d’identification des modes d’échec et de stratégie de détection</span><span class="sxs-lookup"><span data-stu-id="256d4-297">Example of identifying failure modes and detection strategy</span></span>

<span data-ttu-id="256d4-298">**Point d’échec :** Appel à un service web externe / une API.</span><span class="sxs-lookup"><span data-stu-id="256d4-298">**Failure point:** Call to an external web service / API.</span></span>

| <span data-ttu-id="256d4-299">Mode d’échec</span><span class="sxs-lookup"><span data-stu-id="256d4-299">Failure mode</span></span> | <span data-ttu-id="256d4-300">Stratégie de détection</span><span class="sxs-lookup"><span data-stu-id="256d4-300">Detection strategy</span></span> |
| --- | --- |
| <span data-ttu-id="256d4-301">Le service est indisponible</span><span class="sxs-lookup"><span data-stu-id="256d4-301">Service is unavailable</span></span> |<span data-ttu-id="256d4-302">HTTP 5xx</span><span class="sxs-lookup"><span data-stu-id="256d4-302">HTTP 5xx</span></span> |
| <span data-ttu-id="256d4-303">Limitation</span><span class="sxs-lookup"><span data-stu-id="256d4-303">Throttling</span></span> |<span data-ttu-id="256d4-304">HTTP 429 (Trop de demandes)</span><span class="sxs-lookup"><span data-stu-id="256d4-304">HTTP 429 (Too Many Requests)</span></span> |
| <span data-ttu-id="256d4-305">Authentication</span><span class="sxs-lookup"><span data-stu-id="256d4-305">Authentication</span></span> |<span data-ttu-id="256d4-306">HTTP 401 (Non autorisé)</span><span class="sxs-lookup"><span data-stu-id="256d4-306">HTTP 401 (Unauthorized)</span></span> |
| <span data-ttu-id="256d4-307">Temps de réponse lent</span><span class="sxs-lookup"><span data-stu-id="256d4-307">Slow response</span></span> |<span data-ttu-id="256d4-308">Délai d’expiration de la requête</span><span class="sxs-lookup"><span data-stu-id="256d4-308">Request times out</span></span> |

### <a name="redundancy-and-designing-for-failure"></a><span data-ttu-id="256d4-309">Redondance et conception pour les défaillances</span><span class="sxs-lookup"><span data-stu-id="256d4-309">Redundancy and designing for failure</span></span>

<span data-ttu-id="256d4-310">Les défaillances n’ont pas toutes la même incidence.</span><span class="sxs-lookup"><span data-stu-id="256d4-310">Failures can vary in the scope of their impact.</span></span> <span data-ttu-id="256d4-311">Certaines défaillances matérielles, comme une panne de disque, peuvent affecter un seul ordinateur hôte.</span><span class="sxs-lookup"><span data-stu-id="256d4-311">Some hardware failures, such as a failed disk, may affect a single host machine.</span></span> <span data-ttu-id="256d4-312">Un commutateur réseau défaillant peut impacter un rack entier de serveurs.</span><span class="sxs-lookup"><span data-stu-id="256d4-312">A failed network switch could affect a whole server rack.</span></span> <span data-ttu-id="256d4-313">Vous déplorerez moins fréquemment des défaillances perturbant un centre de données tout entier, comme une panne d’alimentation.</span><span class="sxs-lookup"><span data-stu-id="256d4-313">Less common are failures that disrupt a whole datacenter, such as loss of power in a datacenter.</span></span> <span data-ttu-id="256d4-314">Exceptionnellement, une région entière peut être indisponible.</span><span class="sxs-lookup"><span data-stu-id="256d4-314">Rarely, an entire region could become unavailable.</span></span>

<span data-ttu-id="256d4-315">La redondance est l’un des moyens de rendre une application résiliente.</span><span class="sxs-lookup"><span data-stu-id="256d4-315">One of the main ways to make an application resilient is through redundancy.</span></span> <span data-ttu-id="256d4-316">Toutefois, vous devez planifier en fonction de cette redondance lorsque vous concevez l’application.</span><span class="sxs-lookup"><span data-stu-id="256d4-316">But you need to plan for this redundancy when you design the application.</span></span> <span data-ttu-id="256d4-317">Par ailleurs, le niveau de redondance dont vous avez besoin dépend des exigences de votre entreprise. Toutes les applications ne nécessitent pas une redondance entre les régions à titre de prévention contre les pannes régionales.</span><span class="sxs-lookup"><span data-stu-id="256d4-317">Also, the level of redundancy that you need depends on your business requirements &mdash; not every application needs redundancy across regions to guard against a regional outage.</span></span> <span data-ttu-id="256d4-318">En général, il existe un compromis entre redondance et fiabilité supérieures d’un côté contre complexité et coûts plus élevés de l’autre.</span><span class="sxs-lookup"><span data-stu-id="256d4-318">In general, there is a tradeoff between greater redundancy and reliability versus higher cost and complexity.</span></span>  

<span data-ttu-id="256d4-319">Azure offre un certain nombre de fonctionnalités servant à rendre une application redondante à tous les nivaux de défaillances, d’une machine virtuelle unique à une région entière.</span><span class="sxs-lookup"><span data-stu-id="256d4-319">Azure has a number of features to make an application redundant at every level of failure, from an individual VM to an entire region.</span></span>

![Fonctionnalités de résilience Azure](./images/redundancy.svg)

<span data-ttu-id="256d4-321">**Machine virtuelle unique**.</span><span class="sxs-lookup"><span data-stu-id="256d4-321">**Single VM**.</span></span> <span data-ttu-id="256d4-322">Azure fournit un [contrat SLA de durée de fonctionnement](https://azure.microsoft.com/support/legal/sla/virtual-machines) pour les machines virtuelles individuelles.</span><span class="sxs-lookup"><span data-stu-id="256d4-322">Azure provides an [uptime SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines) for single VMs.</span></span> <span data-ttu-id="256d4-323">(La machine virtuelle doit utiliser le stockage Premium pour tous les disques de système d’exploitation et disques de données). Bien que vous puissiez obtenir un contrat supérieur en exécutant deux machines virtuelles ou plus, une machine virtuelle unique peut présenter une fiabilité suffisante pour certaines charges de travail.</span><span class="sxs-lookup"><span data-stu-id="256d4-323">(The VM must use premium storage for all Operating System Disks and Data Disks.) Although you can get a higher SLA by running two or more VMs, a single VM may be reliable enough for some workloads.</span></span> <span data-ttu-id="256d4-324">Toutefois, pour les charges de travail de production, nous vous recommandons d’utiliser au moins deux machines virtuelles pour la redondance.</span><span class="sxs-lookup"><span data-stu-id="256d4-324">For production workloads, however, we recommend using two or more VMs for redundancy.</span></span>

<span data-ttu-id="256d4-325">**Groupes à haute disponibilité**.</span><span class="sxs-lookup"><span data-stu-id="256d4-325">**Availability sets**.</span></span> <span data-ttu-id="256d4-326">Pour vous protéger contre les défaillances matérielles localisées, comme une panne de disque ou de commutateur réseau, déployez au moins deux machines virtuelles dans un groupe à haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="256d4-326">To protect against localized hardware failures, such as a disk or network switch failing, deploy two or more VMs in an availability set.</span></span> <span data-ttu-id="256d4-327">Un groupe à haute disponibilité se compose d’au moins deux *domaines d’erreur* qui partagent une source d’alimentation et un commutateur réseau.</span><span class="sxs-lookup"><span data-stu-id="256d4-327">An availability set consists of two or more *fault domains* that share a common power source and network switch.</span></span> <span data-ttu-id="256d4-328">Les machines virtuelles d’un groupe à haute disponibilité sont distribuées entre les domaines d’erreur. Ainsi, si une défaillance matérielle affecte un domaine d’erreur, le trafic réseau peut toujours être acheminé vers les machines virtuelles des autres domaines d’erreur.</span><span class="sxs-lookup"><span data-stu-id="256d4-328">VMs in an availability set are distributed across the fault domains, so if a hardware failure affects one fault domain, network traffic can still be routed the VMs in the other fault domains.</span></span> <span data-ttu-id="256d4-329">Pour plus d’informations sur les groupes à haute disponibilité, consultez la section [Gestion de la disponibilité des machines virtuelles Windows dans Azure](/azure/virtual-machines/windows/manage-availability).</span><span class="sxs-lookup"><span data-stu-id="256d4-329">For more information about Availability Sets, see [Manage the availability of Windows virtual machines in Azure](/azure/virtual-machines/windows/manage-availability).</span></span>

<span data-ttu-id="256d4-330">**Zones de disponibilité**.</span><span class="sxs-lookup"><span data-stu-id="256d4-330">**Availability zones**.</span></span>  <span data-ttu-id="256d4-331">Une zone de disponibilité est une zone physiquement séparée au sein d’une région Azure.</span><span class="sxs-lookup"><span data-stu-id="256d4-331">An Availability Zone is a physically separate zone within an Azure region.</span></span> <span data-ttu-id="256d4-332">Chaque zone de disponibilité possède une source d’alimentation, un réseau et un système de refroidissement propres.</span><span class="sxs-lookup"><span data-stu-id="256d4-332">Each Availability Zone has a distinct power source, network, and cooling.</span></span> <span data-ttu-id="256d4-333">Le déploiement des machines virtuelles entre les zones de disponibilité aide à protéger une application contre les défaillances à l’échelle du centre de données.</span><span class="sxs-lookup"><span data-stu-id="256d4-333">Deploying VMs across availability zones helps to protect an application against datacenter-wide failures.</span></span> <span data-ttu-id="256d4-334">Les régions ne prennent pas toutes en charge les zones de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="256d4-334">Not all regions support Availability Zones.</span></span> <span data-ttu-id="256d4-335">Pour obtenir la liste des régions et services pris en charge, consultez [Que sont les zones de disponibilité dans Azure ?](/azure/availability-zones/az-overview).</span><span class="sxs-lookup"><span data-stu-id="256d4-335">For a list of supported regions and services, see [What are Availability Zones in Azure?](/azure/availability-zones/az-overview).</span></span>

<span data-ttu-id="256d4-336">Si vous envisagez d’utiliser des zones de disponibilité dans votre déploiement, commencez par vérifier que votre architecture d’application et votre base de code peuvent prendre en charge cette configuration.</span><span class="sxs-lookup"><span data-stu-id="256d4-336">If you are planning to use Availability Zones in your deployment, first validate that your application architecture and code base can support this configuration.</span></span> <span data-ttu-id="256d4-337">Si vous déployez des logiciels du commerce, consultez le fournisseur des logiciels et effectuez des tests avant de les déployer en production.</span><span class="sxs-lookup"><span data-stu-id="256d4-337">If you are deploying commercial off-the-shelf software, consult with the software vendor and test adequately before deploying into production.</span></span> <span data-ttu-id="256d4-338">Une application doit être en mesure de maintenir son état et d’éviter la perte de données en cas de panne dans la zone configurée.</span><span class="sxs-lookup"><span data-stu-id="256d4-338">An application must be able to maintain state and prevent loss of data during an outage within the configured zone.</span></span> <span data-ttu-id="256d4-339">L’application doit prendre en charge l’exécution dans une infrastructure distribuée élastique sans composant d’infrastructure codé en dur spécifié dans la base de code.</span><span class="sxs-lookup"><span data-stu-id="256d4-339">The application must support running in an elastic and distributed infrastructure with no hard-coded infrastructure components specified in the code base.</span></span>

<span data-ttu-id="256d4-340">**Azure Site Recovery**.</span><span class="sxs-lookup"><span data-stu-id="256d4-340">**Azure Site Recovery**.</span></span>  <span data-ttu-id="256d4-341">Répliquez des machines virtuelles Azure dans une autre région Azure pour couvrir les besoins en termes de continuité d’activité et de reprise d’activité.</span><span class="sxs-lookup"><span data-stu-id="256d4-341">Replicate Azure virtual machines to another Azure region for business continuity and disaster recovery needs.</span></span> <span data-ttu-id="256d4-342">Vous pouvez effectuer régulièrement des exercices de reprise d’activité pour garantir que vous répondez aux besoins de conformité.</span><span class="sxs-lookup"><span data-stu-id="256d4-342">You can conduct periodic DR drills to ensure you meet the compliance needs.</span></span> <span data-ttu-id="256d4-343">La machine virtuelle est répliquée avec les paramètres spécifiés dans la région sélectionnée afin que vous puissiez récupérer vos applications en cas de panne dans la région source.</span><span class="sxs-lookup"><span data-stu-id="256d4-343">The VM will be replicated with the specified settings to the selected region so that you can recover your applications in the event of outages in the source region.</span></span> <span data-ttu-id="256d4-344">Pour plus d’informations, consultez [Replicate Azure VMs using ASR][site-recovery] (Répliquer des machines virtuelles Azure à l’aide d’ASR).</span><span class="sxs-lookup"><span data-stu-id="256d4-344">For more information, see [Replicate Azure VMs using ASR][site-recovery].</span></span> <span data-ttu-id="256d4-345">Prenez en compte les chiffres de RTO et RPO pour votre solution ici et vérifiez pendant les tests que le point de récupération et le temps de récupération sont adaptés à vos besoins.</span><span class="sxs-lookup"><span data-stu-id="256d4-345">Consider the RTO and RPO numbers for your solution here and ensure that when testing, the recovery time and recovery point is appropriate for your needs.</span></span>

<span data-ttu-id="256d4-346">**Régions jumelées**.</span><span class="sxs-lookup"><span data-stu-id="256d4-346">**Paired regions**.</span></span> <span data-ttu-id="256d4-347">Pour protéger une application contre une panne régionale, vous pouvez la déployer dans plusieurs régions, en vous appuyant sur Azure Traffic Manager pour distribuer le trafic Internet entre les différentes régions.</span><span class="sxs-lookup"><span data-stu-id="256d4-347">To protect an application against a regional outage, you can deploy the application across multiple regions, using Azure Traffic Manager to distribute internet traffic to the different regions.</span></span> <span data-ttu-id="256d4-348">Chaque région Azure est jumelée à une autre région.</span><span class="sxs-lookup"><span data-stu-id="256d4-348">Each Azure region is paired with another region.</span></span> <span data-ttu-id="256d4-349">Ensemble, elles forment une [paire régionale](/azure/best-practices-availability-paired-regions).</span><span class="sxs-lookup"><span data-stu-id="256d4-349">Together, these form a [regional pair](/azure/best-practices-availability-paired-regions).</span></span> <span data-ttu-id="256d4-350">Une région se trouve dans la même zone géographique que la région avec laquelle elle est jumelée (à l’exception de Brésil Sud) pour répondre aux exigences de la résidence de données en termes d’impôts et d’application de la loi.</span><span class="sxs-lookup"><span data-stu-id="256d4-350">With the exception of Brazil South, regional pairs are located within the same geography in order to meet data residency requirements for tax and law enforcement jurisdiction purposes.</span></span>

<span data-ttu-id="256d4-351">Lorsque vous concevez une application multirégion, tenez compte du fait que la latence du réseau entre les régions et plus importante qu’au sein d’une région unique.</span><span class="sxs-lookup"><span data-stu-id="256d4-351">When you design a multi-region application, take into account that network latency across regions is higher than within a region.</span></span> <span data-ttu-id="256d4-352">Par exemple, si vous répliquez une base de données pour prendre en charge un basculement, utilisez la réplication des données synchrone au sein d’une région unique, mais la réplication des données asynchrones entre plusieurs régions.</span><span class="sxs-lookup"><span data-stu-id="256d4-352">For example, if you are replicating a database to enable failover, use synchronous data replication within a region, but asynchronous data replication across regions.</span></span>

<span data-ttu-id="256d4-353">Quand vous sélectionnez des régions jumelées, vérifiez que les deux régions disposent des services Azure nécessaires.</span><span class="sxs-lookup"><span data-stu-id="256d4-353">When you select paired regions, ensure both regions have required Azure services.</span></span> <span data-ttu-id="256d4-354">Pour obtenir la liste des services par région, consultez [Disponibilité des produits par région](https://azure.microsoft.com/global-infrastructure/services/).</span><span class="sxs-lookup"><span data-stu-id="256d4-354">For a list of services by region, see [Products available by region](https://azure.microsoft.com/global-infrastructure/services/).</span></span> <span data-ttu-id="256d4-355">Il est également essentiel de sélectionner la topologie de déploiement appropriée pour la reprise d’activité, en particulier si vos objectifs RPO/RTO sont bas.</span><span class="sxs-lookup"><span data-stu-id="256d4-355">It's also critical to select the right deployment topology for disaster recovery, especially if your RPO/RTO are short.</span></span> <span data-ttu-id="256d4-356">Pour garantir que la région de basculement dispose d’une capacité suffisante pour prendre en charge votre charge de travail, sélectionnez une topologie de type actif/passif (réplica complet) ou une topologie de type actif/actif.</span><span class="sxs-lookup"><span data-stu-id="256d4-356">To ensure the failover region has enough capacity to support your workload, select either an active/passive (full replica) topology or an active/active topology.</span></span> <span data-ttu-id="256d4-357">N’oubliez pas que ces topologies de déploiement peuvent augmenter la complexité et les coûts dans la mesure où les ressources dans la région secondaire sont préprovisionnées et peuvent rester inactives.</span><span class="sxs-lookup"><span data-stu-id="256d4-357">Keep in mind these deployment topologies might increase complexity and cost as resources in the secondary region are pre-provisioned and may sit idle.</span></span> <span data-ttu-id="256d4-358">Pour plus d’informations, consultez [Topologies de déploiement pour la reprise d’activité][deployment-topologies].</span><span class="sxs-lookup"><span data-stu-id="256d4-358">For more information, see [Deployment topologies for disaster recovery][deployment-topologies]</span></span>

| &nbsp; | <span data-ttu-id="256d4-359">Groupe à haute disponibilité</span><span class="sxs-lookup"><span data-stu-id="256d4-359">Availability Set</span></span> | <span data-ttu-id="256d4-360">Zone de disponibilité</span><span class="sxs-lookup"><span data-stu-id="256d4-360">Availability Zone</span></span> | <span data-ttu-id="256d4-361">Azure Site Recovery/Région jumelée</span><span class="sxs-lookup"><span data-stu-id="256d4-361">Azure Site Recovery/Paired region</span></span> |
|--------|------------------|-------------------|---------------|
| <span data-ttu-id="256d4-362">Étendue de la défaillance</span><span class="sxs-lookup"><span data-stu-id="256d4-362">Scope of failure</span></span> | <span data-ttu-id="256d4-363">Rack</span><span class="sxs-lookup"><span data-stu-id="256d4-363">Rack</span></span> | <span data-ttu-id="256d4-364">Centre de données</span><span class="sxs-lookup"><span data-stu-id="256d4-364">Datacenter</span></span> | <span data-ttu-id="256d4-365">Région</span><span class="sxs-lookup"><span data-stu-id="256d4-365">Region</span></span> |
| <span data-ttu-id="256d4-366">Routage des requêtes</span><span class="sxs-lookup"><span data-stu-id="256d4-366">Request routing</span></span> | <span data-ttu-id="256d4-367">Load Balancer</span><span class="sxs-lookup"><span data-stu-id="256d4-367">Load Balancer</span></span> | <span data-ttu-id="256d4-368">Équilibreur de charge entre les zones</span><span class="sxs-lookup"><span data-stu-id="256d4-368">Cross-zone Load Balancer</span></span> | <span data-ttu-id="256d4-369">Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="256d4-369">Traffic Manager</span></span> |
| <span data-ttu-id="256d4-370">Latence du réseau</span><span class="sxs-lookup"><span data-stu-id="256d4-370">Network latency</span></span> | <span data-ttu-id="256d4-371">Très faible</span><span class="sxs-lookup"><span data-stu-id="256d4-371">Very low</span></span> | <span data-ttu-id="256d4-372">Faible</span><span class="sxs-lookup"><span data-stu-id="256d4-372">Low</span></span> | <span data-ttu-id="256d4-373">Moyenne à élevée</span><span class="sxs-lookup"><span data-stu-id="256d4-373">Mid to high</span></span> |
| <span data-ttu-id="256d4-374">Réseau virtuel</span><span class="sxs-lookup"><span data-stu-id="256d4-374">Virtual network</span></span>  | <span data-ttu-id="256d4-375">Réseau virtuel</span><span class="sxs-lookup"><span data-stu-id="256d4-375">VNet</span></span> | <span data-ttu-id="256d4-376">Réseau virtuel</span><span class="sxs-lookup"><span data-stu-id="256d4-376">VNet</span></span> | <span data-ttu-id="256d4-377">Homologation de réseaux virtuels entre régions</span><span class="sxs-lookup"><span data-stu-id="256d4-377">Cross-region VNet peering</span></span> |

## <a name="implement-resiliency-strategies"></a><span data-ttu-id="256d4-378">Implémenter des stratégies de résilience</span><span class="sxs-lookup"><span data-stu-id="256d4-378">Implement resiliency strategies</span></span>

<span data-ttu-id="256d4-379">Cette section contient une enquête concernant quelques stratégies de résilience courantes.</span><span class="sxs-lookup"><span data-stu-id="256d4-379">This section provides a survey of some common resiliency strategies.</span></span> <span data-ttu-id="256d4-380">La plupart d’entre elles ne sont pas limitées à une technologie particulière.</span><span class="sxs-lookup"><span data-stu-id="256d4-380">Most of these are not limited to a particular technology.</span></span> <span data-ttu-id="256d4-381">Les descriptions de cette section résument l’idée générale de chaque technique, avec des liens pour obtenir des informations supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="256d4-381">The descriptions in this section summarize the general idea behind each technique, with links to further reading.</span></span>

<span data-ttu-id="256d4-382">**Relancez des échecs temporaires**.</span><span class="sxs-lookup"><span data-stu-id="256d4-382">**Retry transient failures**.</span></span> <span data-ttu-id="256d4-383">Les échecs temporaires peuvent résulter d’une perte momentanée de la connectivité réseau, d’une connexion à une base de données interrompue ou d’un délai d’attente lorsqu’un service est occupé.</span><span class="sxs-lookup"><span data-stu-id="256d4-383">Transient failures can be caused by momentary loss of network connectivity, a dropped database connection, or a timeout when a service is busy.</span></span> <span data-ttu-id="256d4-384">Parfois, un échec temporaire peut être résolu simplement en relançant la requête.</span><span class="sxs-lookup"><span data-stu-id="256d4-384">Often, a transient failure can be resolved simply by retrying the request.</span></span> <span data-ttu-id="256d4-385">Pour de nombreux services Azure, le Kit de développement logiciel client implémente des relances automatiques, d’une façon transparente pour l’appelant ; consultez [Guide spécifique relatif au service de relance][retry-service-specific guidance].</span><span class="sxs-lookup"><span data-stu-id="256d4-385">For many Azure services, the client SDK implements automatic retries, in a way that is transparent to the caller; see [Retry service specific guidance][retry-service-specific guidance].</span></span>

<span data-ttu-id="256d4-386">Chaque tentative de relance augmente la latence totale.</span><span class="sxs-lookup"><span data-stu-id="256d4-386">Each retry attempt adds to the total latency.</span></span> <span data-ttu-id="256d4-387">En outre, un trop grand nombre de demandes en échec peut provoquer un goulot d’étranglement, étant donné que les demandes s’accumulent dans la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="256d4-387">Also, too many failed requests can cause a bottleneck, as pending requests accumulate in the queue.</span></span> <span data-ttu-id="256d4-388">Ces demandes bloquées peuvent contenir des ressources système critiques telles que la mémoire, des threads, les connexions de la base de données, etc. Cela peut provoquer une succession d’échecs.</span><span class="sxs-lookup"><span data-stu-id="256d4-388">These blocked requests might hold critical system resources such as memory, threads, database connections, and so on, which can cause cascading failures.</span></span> <span data-ttu-id="256d4-389">Pour éviter ce problème, augmentez le délai entre chaque relance et limitez le nombre total de demandes en échec.</span><span class="sxs-lookup"><span data-stu-id="256d4-389">To avoid this, increase the delay between each retry attempt, and limit the total number of failed requests.</span></span>

![Diagramme des nouvelles tentatives](./images/retry.png)

<span data-ttu-id="256d4-391">**Équilibrez la charge sur les instances**.</span><span class="sxs-lookup"><span data-stu-id="256d4-391">**Load balance across instances**.</span></span> <span data-ttu-id="256d4-392">Pour l’extensibilité, une application cloud doit être en mesure de monter en charge en ajoutant d’autres instances.</span><span class="sxs-lookup"><span data-stu-id="256d4-392">For scalability, a cloud application should be able to scale out by adding more instances.</span></span> <span data-ttu-id="256d4-393">Cette approche améliore également la résilience, car des instances défectueuses peuvent être supprimées de la rotation.</span><span class="sxs-lookup"><span data-stu-id="256d4-393">This approach also improves resiliency, because unhealthy instances can be removed from rotation.</span></span> <span data-ttu-id="256d4-394">Par exemple : </span><span class="sxs-lookup"><span data-stu-id="256d4-394">For example:</span></span>

- <span data-ttu-id="256d4-395">Placez au moins deux machines virtuelles derrière un équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="256d4-395">Put two or more VMs behind a load balancer.</span></span> <span data-ttu-id="256d4-396">L’équilibreur de charge répartit le trafic vers toutes les machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="256d4-396">The load balancer distributes traffic to all the VMs.</span></span> <span data-ttu-id="256d4-397">Consultez [Exécuter des machines virtuelles à charge équilibrée à des fins d’extensibilité et de disponibilité][ra-multi-vm].</span><span class="sxs-lookup"><span data-stu-id="256d4-397">See [Run load-balanced VMs for scalability and availability][ra-multi-vm].</span></span>
- <span data-ttu-id="256d4-398">Montez en charge une application Azure App Service à plusieurs instances.</span><span class="sxs-lookup"><span data-stu-id="256d4-398">Scale out an Azure App Service app to multiple instances.</span></span> <span data-ttu-id="256d4-399">App Service équilibre automatiquement la charge entre les instances.</span><span class="sxs-lookup"><span data-stu-id="256d4-399">App Service automatically balances load across instances.</span></span> <span data-ttu-id="256d4-400">Consultez [Application web de base][ra-basic-web].</span><span class="sxs-lookup"><span data-stu-id="256d4-400">See [Basic web application][ra-basic-web].</span></span>
- <span data-ttu-id="256d4-401">Utilisez [Azure Traffic Manager] [ tm] pour répartir le trafic sur un ensemble de points de terminaison.</span><span class="sxs-lookup"><span data-stu-id="256d4-401">Use [Azure Traffic Manager][tm] to distribute traffic across a set of endpoints.</span></span>

<span data-ttu-id="256d4-402">**Répliquez des données**.</span><span class="sxs-lookup"><span data-stu-id="256d4-402">**Replicate data**.</span></span> <span data-ttu-id="256d4-403">La réplication de données est une stratégie générale pour gérer les échecs non temporaires dans un magasin de données.</span><span class="sxs-lookup"><span data-stu-id="256d4-403">Replicating data is a general strategy for handling non-transient failures in a data store.</span></span> <span data-ttu-id="256d4-404">De nombreuses technologies de stockage fournissent une réplication intégrée, notamment Stockage Azure, Azure SQL Database, Cosmos DB et Apache Cassandra.</span><span class="sxs-lookup"><span data-stu-id="256d4-404">Many storage technologies provide built-in replication, including Azure Storage, Azure SQL Database, Cosmos DB, and Apache Cassandra.</span></span> <span data-ttu-id="256d4-405">Il est important de tenir compte des chemins d’accès de lecture et d’écriture.</span><span class="sxs-lookup"><span data-stu-id="256d4-405">It's important to consider both the read and write paths.</span></span> <span data-ttu-id="256d4-406">Selon la technologie de stockage, vous pouvez trouver plusieurs réplicas accessibles en écriture, ou un seul réplica accessible en écriture et plusieurs réplicas en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="256d4-406">Depending on the storage technology, you might have multiple writable replicas, or a single writable replica and multiple read-only replicas.</span></span>

<span data-ttu-id="256d4-407">Pour optimiser la disponibilité, les réplicas peuvent être placés dans plusieurs régions.</span><span class="sxs-lookup"><span data-stu-id="256d4-407">To maximize availability, replicas can be placed in multiple regions.</span></span> <span data-ttu-id="256d4-408">Toutefois, cela augmente la latence lors de la réplication des données.</span><span class="sxs-lookup"><span data-stu-id="256d4-408">However, this increases the latency when replicating the data.</span></span> <span data-ttu-id="256d4-409">En règle générale, la réplication entre les régions est effectuée de manière asynchrone, ce qui implique un modèle de cohérence éventuel et une perte de données potentielle si un réplica échoue.</span><span class="sxs-lookup"><span data-stu-id="256d4-409">Typically, replicating across regions is done asynchronously, which implies an eventual consistency model and potential data loss if a replica fails.</span></span>

<span data-ttu-id="256d4-410">Vous pouvez utiliser [Azure Site Recovery][site-recovery] pour répliquer des machines virtuelles Azure d’une région vers une autre.</span><span class="sxs-lookup"><span data-stu-id="256d4-410">You can use [Azure Site Recovery][site-recovery] to replicate Azure virtual machines from one region to another region.</span></span> <span data-ttu-id="256d4-411">Site Recovery réplique les données en continu dans la région cible.</span><span class="sxs-lookup"><span data-stu-id="256d4-411">Site Recovery replicates data continuously to the target region.</span></span> <span data-ttu-id="256d4-412">En cas de panne au niveau de votre site principal, vous basculez vers l’emplacement secondaire.</span><span class="sxs-lookup"><span data-stu-id="256d4-412">When an outage occurs at your primary site, you fail over to secondary location</span></span>

<span data-ttu-id="256d4-413">**Appliquer une dégradation normale**.</span><span class="sxs-lookup"><span data-stu-id="256d4-413">**Degrade gracefully**.</span></span> <span data-ttu-id="256d4-414">Si un service échoue et qu’il n’existe aucun chemin d’accès de basculement, l’application devrait se dégrader normalement, tout en offrant une expérience utilisateur acceptable.</span><span class="sxs-lookup"><span data-stu-id="256d4-414">If a service fails and there is no failover path, the application may be able to degrade gracefully while still providing an acceptable user experience.</span></span> <span data-ttu-id="256d4-415">Par exemple : </span><span class="sxs-lookup"><span data-stu-id="256d4-415">For example:</span></span>

- <span data-ttu-id="256d4-416">Placer un élément de travail dans une file d’attente, pour qu’il soit traité ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="256d4-416">Put a work item on a queue, to be handled later.</span></span>
- <span data-ttu-id="256d4-417">Retourner une valeur estimée.</span><span class="sxs-lookup"><span data-stu-id="256d4-417">Return an estimated value.</span></span>
- <span data-ttu-id="256d4-418">Utiliser des données mises en cache localement.</span><span class="sxs-lookup"><span data-stu-id="256d4-418">Use locally cached data.</span></span>
- <span data-ttu-id="256d4-419">Afficher un message d’erreur pour l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="256d4-419">Show the user an error message.</span></span> <span data-ttu-id="256d4-420">(Cette option est préférable plutôt que l’application cesse de répondre aux demandes.)</span><span class="sxs-lookup"><span data-stu-id="256d4-420">(This option is better than having the application stop responding to requests.)</span></span>

<span data-ttu-id="256d4-421">**Limitez les utilisateurs à volume important**.</span><span class="sxs-lookup"><span data-stu-id="256d4-421">**Throttle high-volume users**.</span></span> <span data-ttu-id="256d4-422">Parfois, un petit nombre d’utilisateurs peut créer une charge excessive.</span><span class="sxs-lookup"><span data-stu-id="256d4-422">Sometimes a small number of users create excessive load.</span></span> <span data-ttu-id="256d4-423">Cela peut avoir un impact sur les autres utilisateurs, réduisant ainsi la disponibilité globale de votre application.</span><span class="sxs-lookup"><span data-stu-id="256d4-423">That can have an impact on other users, reducing the overall availability of your application.</span></span>

<span data-ttu-id="256d4-424">Si un seul client soumet un nombre excessif de demandes, l’application peut limiter le client pendant un certain temps.</span><span class="sxs-lookup"><span data-stu-id="256d4-424">When a single client makes an excessive number of requests, the application might throttle the client for a certain period of time.</span></span> <span data-ttu-id="256d4-425">Pendant la période de limitation, l’application refuse certaines ou toutes les demandes de ce client (en fonction de la stratégie de limitation exacte).</span><span class="sxs-lookup"><span data-stu-id="256d4-425">During the throttling period, the application refuses some or all of the requests from that client (depending on the exact throttling strategy).</span></span> <span data-ttu-id="256d4-426">Le seuil de limitation peut dépendre du niveau de service du client.</span><span class="sxs-lookup"><span data-stu-id="256d4-426">The threshold for throttling might depend on the customer's service tier.</span></span>

<span data-ttu-id="256d4-427">La limitation n’implique pas que le client agissait à des fins malveillantes, uniquement qu’il a dépassé son quota de service.</span><span class="sxs-lookup"><span data-stu-id="256d4-427">Throttling does not imply the client was necessarily acting maliciously, only that it exceeded its service quota.</span></span> <span data-ttu-id="256d4-428">Dans certains cas, un consommateur peut constamment dépasser son quota, ou bien mal se comporter.</span><span class="sxs-lookup"><span data-stu-id="256d4-428">In some cases, a consumer might consistently exceed their quota or otherwise behave badly.</span></span> <span data-ttu-id="256d4-429">Dans ce cas, vous pouvez aller plus loin et bloquer l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="256d4-429">In that case, you might go further and block the user.</span></span> <span data-ttu-id="256d4-430">En règle générale, cela se fait en bloquant une clé API ou une plage d’adresses IP.</span><span class="sxs-lookup"><span data-stu-id="256d4-430">Typically, this is done by blocking an API key or an IP address range.</span></span> <span data-ttu-id="256d4-431">Pour en savoir plus, consultez le [Modèle de limitation][throttling-pattern].</span><span class="sxs-lookup"><span data-stu-id="256d4-431">For more information, see [Throttling Pattern][throttling-pattern].</span></span>

<span data-ttu-id="256d4-432">**Utilisez un disjoncteur**.</span><span class="sxs-lookup"><span data-stu-id="256d4-432">**Use a circuit breaker**.</span></span> <span data-ttu-id="256d4-433">Le modèle [Disjoncteur][circuit-breaker-pattern] peut empêcher qu’une application ne tente d’exécuter à plusieurs reprises une opération qui risque d’échouer.</span><span class="sxs-lookup"><span data-stu-id="256d4-433">The [Circuit Breaker][circuit-breaker-pattern] pattern can prevent an application from repeatedly trying an operation that is likely to fail.</span></span> <span data-ttu-id="256d4-434">Le disjoncteur inclut dans un wrapper des appels vers un service et suit le nombre d’échecs récents.</span><span class="sxs-lookup"><span data-stu-id="256d4-434">The circuit breaker wraps calls to a service and tracks the number of recent failures.</span></span> <span data-ttu-id="256d4-435">Si le nombre d’échec dépasse un seuil, le disjoncteur renvoie un code d’erreur sans avoir appelé le service.</span><span class="sxs-lookup"><span data-stu-id="256d4-435">If the failure count exceeds a threshold, the circuit breaker starts returning an error code without calling the service.</span></span> <span data-ttu-id="256d4-436">Le service a ainsi le temps de récupérer.</span><span class="sxs-lookup"><span data-stu-id="256d4-436">This gives the service time to recover.</span></span>

<span data-ttu-id="256d4-437">**Utilisez le nivellement de charge pour lisser les pics de trafic**.</span><span class="sxs-lookup"><span data-stu-id="256d4-437">**Use load leveling to smooth out spikes in traffic**.</span></span>
<span data-ttu-id="256d4-438">Les applications peuvent rencontrer des pics soudains dans le trafic, ce qui peut surcharger les services sur le serveur principal.</span><span class="sxs-lookup"><span data-stu-id="256d4-438">Applications may experience sudden spikes in traffic, which can overwhelm services on the backend.</span></span> <span data-ttu-id="256d4-439">Si un serveur principal ne parvient pas à répondre aux demandes assez rapidement, cela peut provoquer un envoi des demandes en file d’attente (sauvegarde) ou une limitation de l’application par le service.</span><span class="sxs-lookup"><span data-stu-id="256d4-439">If a backend service cannot respond to requests quickly enough, it may cause requests to queue (back up), or cause the service to throttle the application.</span></span> <span data-ttu-id="256d4-440">Pour éviter ce problème, vous pouvez utiliser une file d’attente en tant que mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="256d4-440">To avoid this, you can use a queue as a buffer.</span></span> <span data-ttu-id="256d4-441">Lorsqu’il y a un nouvel élément de travail, au lieu d’appeler le serveur principal immédiatement, l’application met un élément de travail en file d’attente pour qu’il soit exécuté de façon asynchrone.</span><span class="sxs-lookup"><span data-stu-id="256d4-441">When there is a new work item, instead of calling the backend service immediately, the application queues a work item to run asynchronously.</span></span> <span data-ttu-id="256d4-442">La file d’attente agit comme une mémoire tampon qui lisse des pics de charge.</span><span class="sxs-lookup"><span data-stu-id="256d4-442">The queue acts as a buffer that smooths out peaks in the load.</span></span> <span data-ttu-id="256d4-443">Pour en savoir plus, consultez [Modèle de nivellement de la charge basé sur une file d’attente][load-leveling-pattern].</span><span class="sxs-lookup"><span data-stu-id="256d4-443">For more information, see [Queue-Based Load Leveling Pattern][load-leveling-pattern].</span></span>

<span data-ttu-id="256d4-444">**Isolez les ressources critiques**.</span><span class="sxs-lookup"><span data-stu-id="256d4-444">**Isolate critical resources**.</span></span> <span data-ttu-id="256d4-445">Des successions d’échecs peuvent parfois se produire dans un sous-système, provoquant des défaillances dans d’autres parties de l’application.</span><span class="sxs-lookup"><span data-stu-id="256d4-445">Failures in one subsystem can sometimes cascade, causing failures in other parts of the application.</span></span> <span data-ttu-id="256d4-446">Cela peut se produire si une défaillance empêche que certaines ressources, telles que des threads ou des sockets, ne soient libérées en temps voulu, menant à un épuisement des ressources.</span><span class="sxs-lookup"><span data-stu-id="256d4-446">This can happen if a failure causes some resources, such as threads or sockets, not to get freed in a timely manner, leading to resource exhaustion.</span></span>

<span data-ttu-id="256d4-447">Pour éviter ce problème, vous pouvez partitionner un système en groupes isolés, de manière à ce qu’une défaillance présente dans une partition ne détériore pas l’ensemble du système.</span><span class="sxs-lookup"><span data-stu-id="256d4-447">To avoid this, you can partition a system into isolated groups, so that a failure in one partition does not bring down the entire system.</span></span> <span data-ttu-id="256d4-448">Cette technique est parfois appelée « [modèle de cloisonnement][bulkhead-pattern] ».</span><span class="sxs-lookup"><span data-stu-id="256d4-448">This technique is sometimes called the [Bulkhead pattern][bulkhead-pattern].</span></span>

<span data-ttu-id="256d4-449">Exemples :</span><span class="sxs-lookup"><span data-stu-id="256d4-449">Examples:</span></span>

- <span data-ttu-id="256d4-450">Partitionnez une base de données (par exemple, par le client) et affectez un pool distinct d’instances de serveur web pour chaque partition.</span><span class="sxs-lookup"><span data-stu-id="256d4-450">Partition a database (for example, by tenant) and assign a separate pool of web server instances for each partition.</span></span>  
- <span data-ttu-id="256d4-451">Utilisez des pools de threads distincts pour isoler différents services.</span><span class="sxs-lookup"><span data-stu-id="256d4-451">Use separate thread pools to isolate calls to different services.</span></span> <span data-ttu-id="256d4-452">Cela permet d’éviter les successions d’échecs en cas de défaillance d’un des services.</span><span class="sxs-lookup"><span data-stu-id="256d4-452">This helps to prevent cascading failures if one of the services fails.</span></span> <span data-ttu-id="256d4-453">Pour obtenir un exemple, consultez la bibliothèque [Netflix Hystrix][hystrix].</span><span class="sxs-lookup"><span data-stu-id="256d4-453">For an example, see the Netflix [Hystrix library][hystrix].</span></span>
- <span data-ttu-id="256d4-454">Utilisez des [conteneurs][containers] pour limiter les ressources disponibles pour un sous-système spécifique.</span><span class="sxs-lookup"><span data-stu-id="256d4-454">Use [containers][containers] to limit the resources available to a particular subsystem.</span></span>

![Diagramme du modèle de cloisonnement](./images/bulkhead.png)

<span data-ttu-id="256d4-456">**Appliquez des transactions de compensation**.</span><span class="sxs-lookup"><span data-stu-id="256d4-456">**Apply compensating transactions**.</span></span> <span data-ttu-id="256d4-457">Une [transaction de compensation][compensating-transaction-pattern] est une transaction qui annule les effets d’une autre transaction terminée.</span><span class="sxs-lookup"><span data-stu-id="256d4-457">A [compensating transaction][compensating-transaction-pattern] is a transaction that undoes the effects of another completed transaction.</span></span> <span data-ttu-id="256d4-458">Dans un système distribué, il est parfois difficile d’obtenir une cohérence transactionnelle élevée.</span><span class="sxs-lookup"><span data-stu-id="256d4-458">In a distributed system, it can be very difficult to achieve strong transactional consistency.</span></span> <span data-ttu-id="256d4-459">Les transactions de compensation sont un moyen de garantir la cohérence à l’aide d’une série de transactions individuelles plus petites, qui peuvent être annulées à chaque étape.</span><span class="sxs-lookup"><span data-stu-id="256d4-459">Compensating transactions are a way to achieve consistency by using a series of smaller, individual transactions that can be undone at each step.</span></span>

<span data-ttu-id="256d4-460">Par exemple, pour réserver un voyage, un client peut réserver une voiture, un hôtel et un vol.</span><span class="sxs-lookup"><span data-stu-id="256d4-460">For example, to book a trip, a customer might reserve a car, a hotel room, and a flight.</span></span> <span data-ttu-id="256d4-461">Si une de ces étapes échoue, l’opération entière échoue.</span><span class="sxs-lookup"><span data-stu-id="256d4-461">If any of these steps fails, the entire operation fails.</span></span> <span data-ttu-id="256d4-462">Au lieu de tenter d’utiliser une unique transaction distribuée pour l’intégralité de l’opération, vous pouvez définir une transaction de compensation pour chaque étape.</span><span class="sxs-lookup"><span data-stu-id="256d4-462">Instead of trying to use a single distributed transaction for the entire operation, you can define a compensating transaction for each step.</span></span> <span data-ttu-id="256d4-463">Par exemple, pour annuler la réservation d’une voiture, vous annulez la réservation.</span><span class="sxs-lookup"><span data-stu-id="256d4-463">For example, to undo a car reservation, you cancel the reservation.</span></span> <span data-ttu-id="256d4-464">Pour exécuter l’ensemble de l’opération, un coordinateur exécute chaque étape.</span><span class="sxs-lookup"><span data-stu-id="256d4-464">In order to complete the whole operation, a coordinator executes each step.</span></span> <span data-ttu-id="256d4-465">Si une étape échoue, le coordinateur applique des transactions de compensation pour annuler toutes les étapes déjà effectuées.</span><span class="sxs-lookup"><span data-stu-id="256d4-465">If any step fails, the coordinator applies compensating transactions to undo any steps that were completed.</span></span>

## <a name="test-for-resiliency"></a><span data-ttu-id="256d4-466">Tester la résilience</span><span class="sxs-lookup"><span data-stu-id="256d4-466">Test for resiliency</span></span>

<span data-ttu-id="256d4-467">En règle générale, vous ne pouvez pas tester la résilience de la même façon que vous testez les fonctionnalités de l’application (en exécutant des tests unitaires, etc).</span><span class="sxs-lookup"><span data-stu-id="256d4-467">Generally, you can't test resiliency in the same way that you test application functionality (by running unit tests and so on).</span></span> <span data-ttu-id="256d4-468">Au lieu de cela, vous devez tester le fonctionnement de la charge de travail de bout en bout dans les conditions d’échec qui ne se produisent que par intermittence.</span><span class="sxs-lookup"><span data-stu-id="256d4-468">Instead, you must test how the end-to-end workload performs under failure conditions which only occur intermittently.</span></span>

<span data-ttu-id="256d4-469">Les tests sont un processus itératif.</span><span class="sxs-lookup"><span data-stu-id="256d4-469">Testing is an iterative process.</span></span> <span data-ttu-id="256d4-470">Testez l’application, mesurez le résultat, analysez et résolvez tous les échecs résultants, puis répétez le processus.</span><span class="sxs-lookup"><span data-stu-id="256d4-470">Test the application, measure the outcome, analyze and address any failures that result, and repeat the process.</span></span>

<span data-ttu-id="256d4-471">**Test d’injection d’erreurs**.</span><span class="sxs-lookup"><span data-stu-id="256d4-471">**Fault injection testing**.</span></span> <span data-ttu-id="256d4-472">Testez la résilience du système lors de pannes, en déclenchant des échecs réels ou simulés.</span><span class="sxs-lookup"><span data-stu-id="256d4-472">Test the resiliency of the system during failures, either by triggering actual failures or by simulating them.</span></span> <span data-ttu-id="256d4-473">Voici quelques scénarios courants de défaillance à tester :</span><span class="sxs-lookup"><span data-stu-id="256d4-473">Here are some common failure scenarios to test:</span></span>

- <span data-ttu-id="256d4-474">Arrêt des instances de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="256d4-474">Shut down VM instances.</span></span>
- <span data-ttu-id="256d4-475">Blocage des processus.</span><span class="sxs-lookup"><span data-stu-id="256d4-475">Crash processes.</span></span>
- <span data-ttu-id="256d4-476">Expiration des certificats.</span><span class="sxs-lookup"><span data-stu-id="256d4-476">Expire certificates.</span></span>
- <span data-ttu-id="256d4-477">Changement des clés d’accès.</span><span class="sxs-lookup"><span data-stu-id="256d4-477">Change access keys.</span></span>
- <span data-ttu-id="256d4-478">Arrêt du service DNS sur les contrôleurs de domaine.</span><span class="sxs-lookup"><span data-stu-id="256d4-478">Shut down the DNS service on domain controllers.</span></span>
- <span data-ttu-id="256d4-479">Limitation des ressources système disponibles, comme la RAM ou le nombre de threads.</span><span class="sxs-lookup"><span data-stu-id="256d4-479">Limit available system resources, such as RAM or number of threads.</span></span>
- <span data-ttu-id="256d4-480">Démontage des disques.</span><span class="sxs-lookup"><span data-stu-id="256d4-480">Unmount disks.</span></span>
- <span data-ttu-id="256d4-481">Redéploiement d’une machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="256d4-481">Redeploy a VM.</span></span>

<span data-ttu-id="256d4-482">Mesurez les temps de récupération et vérifiez qu’ils répondent aux exigences de votre entreprise.</span><span class="sxs-lookup"><span data-stu-id="256d4-482">Measure the recovery times and verify that your business requirements are met.</span></span> <span data-ttu-id="256d4-483">Testez également des combinaisons de mode d’échec.</span><span class="sxs-lookup"><span data-stu-id="256d4-483">Test combinations of failure modes as well.</span></span> <span data-ttu-id="256d4-484">Assurez-vous que les échecs ne produisent de manière successive et soient gérés de manière isolée.</span><span class="sxs-lookup"><span data-stu-id="256d4-484">Make sure that failures don't cascade, and are handled in an isolated way.</span></span>

<span data-ttu-id="256d4-485">C’est une autre raison qui démontre pourquoi il est important d’analyser les points de défaillance possibles pendant la phase de conception.</span><span class="sxs-lookup"><span data-stu-id="256d4-485">This is another reason why it's important to analyze possible failure points during the design phase.</span></span> <span data-ttu-id="256d4-486">Les résultats de cette analyse doivent être entrés dans votre plan de test.</span><span class="sxs-lookup"><span data-stu-id="256d4-486">The results of that analysis should be inputs into your test plan.</span></span>

<span data-ttu-id="256d4-487">**Test de charge**.</span><span class="sxs-lookup"><span data-stu-id="256d4-487">**Load testing**.</span></span> <span data-ttu-id="256d4-488">Le test de charge est essentiel pour identifier les défaillances qui se produisent uniquement lors du chargement, telles que la saturation de la base de données principale ou la limitation du service.</span><span class="sxs-lookup"><span data-stu-id="256d4-488">Load testing is crucial for identifying failures that only happen under load, such as the backend database being overwhelmed or service throttling.</span></span> <span data-ttu-id="256d4-489">Testez la charge maximale à l’aide des données de production ou de données synthétiques qui soient aussi proches que possible des données de production.</span><span class="sxs-lookup"><span data-stu-id="256d4-489">Test for peak load, using production data or synthetic data that is as close to production data as possible.</span></span> <span data-ttu-id="256d4-490">L’objectif est de voir comment se comporte l’application dans des conditions réelles.</span><span class="sxs-lookup"><span data-stu-id="256d4-490">The goal is to see how the application behaves under real-world conditions.</span></span>

<span data-ttu-id="256d4-491">**Exercices de reprise d’activité après sinistre**.</span><span class="sxs-lookup"><span data-stu-id="256d4-491">**Disaster recovery drills**.</span></span> <span data-ttu-id="256d4-492">La mise en place d’un plan de reprise d’activité après sinistre, aussi bon soit-il, ne suffit pas.</span><span class="sxs-lookup"><span data-stu-id="256d4-492">It is not enough if you have a good disaster recovery plan in place.</span></span> <span data-ttu-id="256d4-493">Vous devez le tester régulièrement pour vérifier son bon fonctionnement dans une situation critique.</span><span class="sxs-lookup"><span data-stu-id="256d4-493">You need to test it periodically to ensure your recovery plan works fine when it matters.</span></span> <span data-ttu-id="256d4-494">Pour les machines virtuelles Azure, vous pouvez utiliser [Azure Site Recovery][site-recovery] pour répliquer et [effectuer des exercices de reprise d’activité après sinistre][site-recovery-test-failover] sans affecter les applications de production ou la réplication continue.</span><span class="sxs-lookup"><span data-stu-id="256d4-494">For Azure virtual machines, you can use [Azure Site Recovery][site-recovery] to replicate and [perform DR drills][site-recovery-test-failover] without affecting production applications or ongoing replication.</span></span>

## <a name="deploy-using-reliable-processes"></a><span data-ttu-id="256d4-495">Déployer à l’aide de processus fiables</span><span class="sxs-lookup"><span data-stu-id="256d4-495">Deploy using reliable processes</span></span>

<span data-ttu-id="256d4-496">Une fois qu’une application est déployée en production, les mises à jour deviennent une source possible d’erreurs.</span><span class="sxs-lookup"><span data-stu-id="256d4-496">Once an application is deployed to production, updates are a possible source of errors.</span></span> <span data-ttu-id="256d4-497">Dans le pire des cas, une mise à jour incorrecte peut entraîner un temps d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="256d4-497">In the worst case, a bad update can cause downtime.</span></span> <span data-ttu-id="256d4-498">Pour éviter cela, le processus de déploiement doit être prévisible et renouvelable.</span><span class="sxs-lookup"><span data-stu-id="256d4-498">To avoid this, the deployment process must be predictable and repeatable.</span></span> <span data-ttu-id="256d4-499">Le déploiement inclut l’approvisionnement des ressources Azure, le déploiement du code de l’application, et l’application des paramètres de configuration.</span><span class="sxs-lookup"><span data-stu-id="256d4-499">Deployment includes provisioning Azure resources, deploying application code, and applying configuration settings.</span></span> <span data-ttu-id="256d4-500">Une mise à jour peut impliquer les trois, ou un sous-ensemble.</span><span class="sxs-lookup"><span data-stu-id="256d4-500">An update may involve all three, or a subset.</span></span>

<span data-ttu-id="256d4-501">Le point essentiel est que les déploiements manuels sont sujets à l’erreur.</span><span class="sxs-lookup"><span data-stu-id="256d4-501">The crucial point is that manual deployments are prone to error.</span></span> <span data-ttu-id="256d4-502">Par conséquent, il est recommandé d’avoir un processus idempotent automatisé, que vous pouvez exécuter à la demande et exécutez de nouveau si quelque chose échoue.</span><span class="sxs-lookup"><span data-stu-id="256d4-502">Therefore, it's recommended to have an automated, idempotent process that you can run on demand, and re-run if something fails.</span></span>

- <span data-ttu-id="256d4-503">Pour automatiser le provisionnement des ressources Azure, vous pouvez utiliser [Terraform][terraform], [Ansible][ansible], [Chef][chef], [Puppet][puppet], [PowerShell][powershell], [CLI][cli] ou des [modèles Azure Resource Manager][template-deployment].</span><span class="sxs-lookup"><span data-stu-id="256d4-503">To automate provisioning of Azure resources you can use [Terraform][terraform], [Ansible][ansible], [Chef][chef], [Puppet][puppet], [PowerShell][powershell], [CLI][cli] or [Azure Resource Manager templates][template-deployment]</span></span>
- <span data-ttu-id="256d4-504">Utilisez la [Configuration de l’état souhaité Azure Automation][dsc] (DSC) pour configurer les machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="256d4-504">Use [Azure Automation Desired State Configuration][dsc] (DSC) to configure VMs.</span></span> <span data-ttu-id="256d4-505">Pour les machines virtuelles Linux, vous pouvez utiliser [Cloud-init][cloud-init].</span><span class="sxs-lookup"><span data-stu-id="256d4-505">For Linux VMs, you can use [Cloud-init][cloud-init].</span></span>
- <span data-ttu-id="256d4-506">Vous pouvez automatiser le déploiement d’applications avec [Azure DevOps Services][azure-devops-services] ou [Jenkins][jenkins].</span><span class="sxs-lookup"><span data-stu-id="256d4-506">You can automate application deployment using [Azure DevOps Services][azure-devops-services] or [Jenkins][jenkins].</span></span>

<span data-ttu-id="256d4-507">Voici deux concepts liés au déploiement résilient : *l’infrastructure en tant que code* et *l’infrastructure immuable*.</span><span class="sxs-lookup"><span data-stu-id="256d4-507">Two concepts related to resilient deployment are *infrastructure as code* and *immutable infrastructure*.</span></span>

- <span data-ttu-id="256d4-508">**L’infrastructure en tant que code** consiste à utiliser un code pour gérer et configurer l’infrastructure.</span><span class="sxs-lookup"><span data-stu-id="256d4-508">**Infrastructure as code** is the practice of using code to provision and configure infrastructure.</span></span> <span data-ttu-id="256d4-509">L’infrastructure en tant que code peut utiliser une approche déclarative ou une approche impérative (ou une combinaison des deux).</span><span class="sxs-lookup"><span data-stu-id="256d4-509">Infrastructure as code may use a declarative approach or an imperative approach (or a combination of both).</span></span> <span data-ttu-id="256d4-510">Les modèles Resource Manager sont un exemple d’approche déclarative.</span><span class="sxs-lookup"><span data-stu-id="256d4-510">Resource Manager templates are an example of a declarative approach.</span></span> <span data-ttu-id="256d4-511">Les scripts PowerShell sont un exemple d’approche impérative.</span><span class="sxs-lookup"><span data-stu-id="256d4-511">PowerShell scripts are an example of an imperative approach.</span></span>
- <span data-ttu-id="256d4-512">**L’infrastructure immuable** est le principe selon lequel vous ne devez pas modifier l’infrastructure après son déploiement en production.</span><span class="sxs-lookup"><span data-stu-id="256d4-512">**Immutable infrastructure** is the principle that you shouldn’t modify infrastructure after it’s deployed to production.</span></span> <span data-ttu-id="256d4-513">Dans le cas contraire, vous pouvez parvenir à un état dans lequel les modifications ad hoc ont été appliquées. Il est alors difficile de savoir avec exactitude ce qui a changé et de raisonner sur le système.</span><span class="sxs-lookup"><span data-stu-id="256d4-513">Otherwise, you can get into a state where ad hoc changes have been applied, so it's hard to know exactly what changed, and hard to reason about the system.</span></span>

<span data-ttu-id="256d4-514">Une autre question qui se pose est comment déployer une mise à jour de l’application.</span><span class="sxs-lookup"><span data-stu-id="256d4-514">Another question is how to roll out an application update.</span></span> <span data-ttu-id="256d4-515">Nous vous recommandons des techniques telles que le déploiement bleu-vert ou les versions de contrôle de validité, qui envoient les mises à jour de manière hautement contrôlée, afin de limiter les conséquences possibles d’un déploiement incorrect.</span><span class="sxs-lookup"><span data-stu-id="256d4-515">We recommend techniques such as blue-green deployment or canary releases, which push updates in highly controlled way to minimize possible impacts from a bad deployment.</span></span>

- <span data-ttu-id="256d4-516">[le déploiement bleu-vert][blue-green] est une technique dans laquelle une mise à jour est déployée dans un environnement de production distinct de l’application en temps réel.</span><span class="sxs-lookup"><span data-stu-id="256d4-516">[Blue-green deployment][blue-green] is a technique where an update is deployed into a production environment separate from the live application.</span></span> <span data-ttu-id="256d4-517">Après avoir validé le déploiement, passez le routage du trafic vers la version mise à jour.</span><span class="sxs-lookup"><span data-stu-id="256d4-517">After you validate the deployment, switch the traffic routing to the updated version.</span></span> <span data-ttu-id="256d4-518">Cela est permis, par exemple, par Azure App Service Web Apps avec des [emplacements de préproduction][staging-slots].</span><span class="sxs-lookup"><span data-stu-id="256d4-518">For example, Azure App Service Web Apps enables this with [staging slots][staging-slots].</span></span>
- <span data-ttu-id="256d4-519">[Les versions de contrôle de validité][canary-release] sont similaires aux déploiements bleu-vert.</span><span class="sxs-lookup"><span data-stu-id="256d4-519">[Canary releases][canary-release] are similar to blue-green deployments.</span></span> <span data-ttu-id="256d4-520">Au lieu de passer tout le trafic vers la version mise à jour, vous déployez la mise à jour pour un petit pourcentage d’utilisateurs, en routant une partie du trafic vers le nouveau déploiement.</span><span class="sxs-lookup"><span data-stu-id="256d4-520">Instead of switching all traffic to the updated version, you roll out the update to a small percentage of users, by routing a portion of the traffic to the new deployment.</span></span> <span data-ttu-id="256d4-521">Si un problème se produit, arrêtez et revenez à l’ancien déploiement.</span><span class="sxs-lookup"><span data-stu-id="256d4-521">If there is a problem, back off and revert to the old deployment.</span></span> <span data-ttu-id="256d4-522">Dans le cas contraire, routez davantage du trafic vers la nouvelle version, jusqu’à ce qu’elle obtienne 100 % du trafic.</span><span class="sxs-lookup"><span data-stu-id="256d4-522">Otherwise, route more of the traffic to the new version, until it gets 100% of the traffic.</span></span>

<span data-ttu-id="256d4-523">Peu importe l’approche que vous choisissez, assurez-vous que vous pouvez revenir au dernier déploiement correct, au cas où la nouvelle version ne fonctionne pas.</span><span class="sxs-lookup"><span data-stu-id="256d4-523">Whatever approach you take, make sure that you can roll back to the last-known-good deployment, in case the new version is not functioning.</span></span> <span data-ttu-id="256d4-524">Mettez également en place une stratégie pour restaurer les modifications apportées à la base de données et aux services dépendants.</span><span class="sxs-lookup"><span data-stu-id="256d4-524">Also have a strategy in place to roll back database changes and any other changes to dependent services.</span></span> <span data-ttu-id="256d4-525">Si une erreur se produit, les journaux d’application doivent indiquer la version qui en est à l’origine.</span><span class="sxs-lookup"><span data-stu-id="256d4-525">If errors occur, the application logs must indicate which version caused the error.</span></span>

## <a name="monitor-to-detect-failures"></a><span data-ttu-id="256d4-526">Surveiller et détecter des défaillances</span><span class="sxs-lookup"><span data-stu-id="256d4-526">Monitor to detect failures</span></span>

<span data-ttu-id="256d4-527">La supervision est essentielle pour assurer la résilience.</span><span class="sxs-lookup"><span data-stu-id="256d4-527">Monitoring is crucial for resiliency.</span></span> <span data-ttu-id="256d4-528">En cas de problème, vous devez savoir qu’il y a un échec, et vous devez en comprendre la cause.</span><span class="sxs-lookup"><span data-stu-id="256d4-528">If something fails, you need to know that it failed, and you need insights into the cause of the failure.</span></span>

<span data-ttu-id="256d4-529">La surveillance d’un système distribué à grande échelle constitue une difficulté importante.</span><span class="sxs-lookup"><span data-stu-id="256d4-529">Monitoring a large-scale distributed system poses a significant challenge.</span></span> <span data-ttu-id="256d4-530">Pensez à une application qui s’exécute sur quelques dizaines de machines virtuelles &mdash; il n’est pas pratique de se connecter à chaque machine virtuelle une à une, et d’examiner les fichiers journaux, en essayant de résoudre un problème.</span><span class="sxs-lookup"><span data-stu-id="256d4-530">Think about an application that runs on a few dozen VMs &mdash; it's not practical to log into each VM, one at a time, and look through log files, trying to troubleshoot a problem.</span></span> <span data-ttu-id="256d4-531">De plus, le nombre d’instances de machine virtuelle n’est probablement pas statique. Les machines virtuelles sont ajoutées et supprimées à mesure que l’application effectue un scale-in/scale-out. Parfois, une instance peut échouer et doit être reprovisionnée.</span><span class="sxs-lookup"><span data-stu-id="256d4-531">Moreover, the number of VM instances is probably not static VMs get added and removed as the application scales in and out, and occasionally an instance may fail and need to be reprovisioned.</span></span> <span data-ttu-id="256d4-532">En outre, une application cloud classique peut utiliser plusieurs banques de données (stockage Azure, SQL Database, Cosmos DB, cache Redis), et une seule action utilisateur peut couvrir plusieurs sous-systèmes.</span><span class="sxs-lookup"><span data-stu-id="256d4-532">In addition, a typical cloud application might use multiple data stores (Azure storage, SQL Database, Cosmos DB, Redis cache), and a single user action may span multiple subsystems.</span></span>

<span data-ttu-id="256d4-533">Vous pouvez considérer le processus de supervision comme un pipeline avec plusieurs étapes distinctes :</span><span class="sxs-lookup"><span data-stu-id="256d4-533">You can think of the monitoring process as a pipeline with several distinct stages:</span></span>

![Contrat SLA composite](./images/monitoring.png)

- <span data-ttu-id="256d4-535">**Instrumentation**.</span><span class="sxs-lookup"><span data-stu-id="256d4-535">**Instrumentation**.</span></span> <span data-ttu-id="256d4-536">Les données brutes pour la supervision proviennent de sources diverses, notamment les [journaux d’application](/azure/application-insights/app-insights-overview?toc=/azure/azure-monitor/toc.json), les [métriques de performances des systèmes d’exploitation](/azure/azure-monitor/platform/agents-overview), les [ressources Azure](/azure/monitoring-and-diagnostics/monitoring-supported-metrics?toc=/azure/azure-monitor/toc.json), les [abonnements Azure](/azure/service-health/service-health-overview) et les [locataires Azure](/azure/active-directory/reports-monitoring/howto-integrate-activity-logs-with-log-analytics).</span><span class="sxs-lookup"><span data-stu-id="256d4-536">The raw data for monitoring comes from a variety of sources, including [application logs](/azure/application-insights/app-insights-overview?toc=/azure/azure-monitor/toc.json), [operating systems performance metrics](/azure/azure-monitor/platform/agents-overview), [Azure resources](/azure/monitoring-and-diagnostics/monitoring-supported-metrics?toc=/azure/azure-monitor/toc.json), [Azure subscriptions](/azure/service-health/service-health-overview) and [Azure tenants](/azure/active-directory/reports-monitoring/howto-integrate-activity-logs-with-log-analytics).</span></span> <span data-ttu-id="256d4-537">La plupart des services Azure exposent des [métriques](/azure/azure-monitor/platform/data-collection) que vous pouvez configurer pour analyser et déterminer la cause des problèmes.</span><span class="sxs-lookup"><span data-stu-id="256d4-537">Most Azure services expose [metrics](/azure/azure-monitor/platform/data-collection) that you can configure to analyze and determine the cause of problems.</span></span>
- <span data-ttu-id="256d4-538">**Collecte et stockage**.</span><span class="sxs-lookup"><span data-stu-id="256d4-538">**Collection and storage**.</span></span> <span data-ttu-id="256d4-539">Les données d’instrumentation brutes peuvent être contenues dans divers emplacements et sous des formats variés (par exemple, journaux des traces au niveau de l’application, les journaux IIS, les compteurs de performances).</span><span class="sxs-lookup"><span data-stu-id="256d4-539">Raw instrumentation data can be held in various locations and with various formats (e.g., application trace logs, IIS logs, performance counters).</span></span> <span data-ttu-id="256d4-540">Ces sources distinctes sont collectées, consolidées et placées dans des magasins de données fiables : Application Insights, métriques Azure Monitor, Service Health, comptes de stockage, Log Analytics, etc.</span><span class="sxs-lookup"><span data-stu-id="256d4-540">These disparate sources are collected, consolidated, and put into reliable data stores such as Application Insights, Azure Monitor metrics, Service Health, storage accounts and Log Analytics.</span></span>
- <span data-ttu-id="256d4-541">**Analyse et diagnostic**.</span><span class="sxs-lookup"><span data-stu-id="256d4-541">**Analysis and diagnosis**.</span></span> <span data-ttu-id="256d4-542">Une fois les données consolidées dans ces différents magasins de données, elles peuvent être analysées pour résoudre les problèmes et fournir une vue d’ensemble de l’intégrité de l’application.</span><span class="sxs-lookup"><span data-stu-id="256d4-542">After the data is consolidated in these different data stores, it can be analyzed to troubleshoot issues and provide an overall view of application health.</span></span> <span data-ttu-id="256d4-543">En règle générale, vous pouvez rechercher les données dans Application Insights et Log Analytics à l’aide de [requêtes Kusto](/azure/log-analytics/log-analytics-queries).</span><span class="sxs-lookup"><span data-stu-id="256d4-543">Generally, you can search for the data in Application Insights and Log Analytics using [Kusto queries](/azure/log-analytics/log-analytics-queries).</span></span> <span data-ttu-id="256d4-544">Azure Advisor fournit des recommandations axées sur la [résilience](/azure/advisor/advisor-high-availability-recommendations) et l’[optimisation](/azure/advisor/advisor-performance-recommendations).</span><span class="sxs-lookup"><span data-stu-id="256d4-544">Azure Advisor provides recommendations with a focus on [resiliency](/azure/advisor/advisor-high-availability-recommendations) and [optimization](/azure/advisor/advisor-performance-recommendations).</span></span>
- <span data-ttu-id="256d4-545">**Visualisation et alertes**.</span><span class="sxs-lookup"><span data-stu-id="256d4-545">**Visualization and alerts**.</span></span> <span data-ttu-id="256d4-546">Dans cette étape, les données de télémétrie sont présentées de manière à ce qu’un opérateur puisse repérer rapidement les problèmes ou les tendances.</span><span class="sxs-lookup"><span data-stu-id="256d4-546">In this stage, telemetry data is presented in such a way that an operator can quickly notice problems or trends.</span></span> <span data-ttu-id="256d4-547">Les exemples comprennent des tableaux de bord ou des alertes par e-mail.</span><span class="sxs-lookup"><span data-stu-id="256d4-547">Examples include dashboards or email alerts.</span></span> <span data-ttu-id="256d4-548">Les [tableaux de bord Azure](/azure/azure-portal/azure-portal-dashboards) vous permettent de générer un volet unique qui regroupe les graphes de supervision provenant d’Application Insights, de Log Analytics, des métriques Azure Monitor et de Service Health.</span><span class="sxs-lookup"><span data-stu-id="256d4-548">With [Azure dashboards](/azure/azure-portal/azure-portal-dashboards), you can build a single-pane of glass view of monitoring graphs originating from Application Insights, Log Analytics, Azure Monitor metrics and service health.</span></span> <span data-ttu-id="256d4-549">Quant aux [alertes Azure Monitor](/azure/monitoring-and-diagnostics/monitoring-overview-alerts?toc=/azure/azure-monitor/toc.json), elles vous permettent de créer des alertes sur l’intégrité du service et des ressources.</span><span class="sxs-lookup"><span data-stu-id="256d4-549">With [Azure Monitor alerts](/azure/monitoring-and-diagnostics/monitoring-overview-alerts?toc=/azure/azure-monitor/toc.json), you can create alerts on service health and resource health.</span></span>

<span data-ttu-id="256d4-550">La surveillance est différente de la détection de défaillance.</span><span class="sxs-lookup"><span data-stu-id="256d4-550">Monitoring is not the same as failure detection.</span></span> <span data-ttu-id="256d4-551">Par exemple, votre application peut détecter un échec temporaire et réessayer, n’entraînant aucun temps d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="256d4-551">For example, your application might detect a transient error and retry, resulting in no downtime.</span></span> <span data-ttu-id="256d4-552">Mais il doit également connecter l’opération de relance pour que vous puissiez surveiller le taux d’échec, afin d’obtenir une vue d’ensemble de l’intégrité de l’application.</span><span class="sxs-lookup"><span data-stu-id="256d4-552">But it should also log the retry operation, so that you can monitor the error rate, in order to get an overall picture of application health.</span></span>

<span data-ttu-id="256d4-553">Les journaux d’application sont une source importante de données de diagnostic.</span><span class="sxs-lookup"><span data-stu-id="256d4-553">Application logs are an important source of diagnostics data.</span></span> <span data-ttu-id="256d4-554">Les meilleures pratiques pour la journalisation de l’application sont :</span><span class="sxs-lookup"><span data-stu-id="256d4-554">Best practices for application logging include:</span></span>

- <span data-ttu-id="256d4-555">Journalisation en production.</span><span class="sxs-lookup"><span data-stu-id="256d4-555">Log in production.</span></span> <span data-ttu-id="256d4-556">Autrement, vous perdez de la vision où vous en avez le plus besoin.</span><span class="sxs-lookup"><span data-stu-id="256d4-556">Otherwise, you lose insight where you need it most.</span></span>
- <span data-ttu-id="256d4-557">Journalisation des événements au niveau des limites de service.</span><span class="sxs-lookup"><span data-stu-id="256d4-557">Log events at service boundaries.</span></span> <span data-ttu-id="256d4-558">Vous devez inclure un ID de corrélation qui franchit les limites de service.</span><span class="sxs-lookup"><span data-stu-id="256d4-558">Include a correlation ID that flows across service boundaries.</span></span> <span data-ttu-id="256d4-559">Si une transaction passe par plusieurs services et que l’un d’entre eux échoue, l’ID de corrélation vous aidera à déterminer la raison pour laquelle la transaction a échoué.</span><span class="sxs-lookup"><span data-stu-id="256d4-559">If a transaction flows through multiple services and one of them fails, the correlation ID will help you pinpoint why the transaction failed.</span></span>
- <span data-ttu-id="256d4-560">Utilisez la journalisation sémantique, également appelée journalisation structurée.</span><span class="sxs-lookup"><span data-stu-id="256d4-560">Use semantic logging, also known as structured logging.</span></span> <span data-ttu-id="256d4-561">Les journaux non structurés rendent difficile l’automatisation de la consommation et de l’analyse des données du journal, qui est nécessaire à l’échelle du cloud.</span><span class="sxs-lookup"><span data-stu-id="256d4-561">Unstructured logs make it hard to automate the consumption and analysis of the log data, which is needed at cloud scale.</span></span>
- <span data-ttu-id="256d4-562">Utilisez la journalisation asynchrone.</span><span class="sxs-lookup"><span data-stu-id="256d4-562">Use asynchronous logging.</span></span> <span data-ttu-id="256d4-563">Dans le cas contraire, le système de journalisation peut provoquer l’échec de l’application en provoquant la sauvegarde des demandes, comme elles sont bloquées en attendant d’écrire un événement de Journalisation.</span><span class="sxs-lookup"><span data-stu-id="256d4-563">Otherwise, the logging system itself can cause the application to fail by causing requests to back up, as they block while waiting to write a logging event.</span></span>
- <span data-ttu-id="256d4-564">La journalisation de l’application est différente de l’audit.</span><span class="sxs-lookup"><span data-stu-id="256d4-564">Application logging is not the same as auditing.</span></span> <span data-ttu-id="256d4-565">L’audit peut être effectué pour des raisons réglementaires ou de conformité.</span><span class="sxs-lookup"><span data-stu-id="256d4-565">Auditing may be done for compliance or regulatory reasons.</span></span> <span data-ttu-id="256d4-566">Par conséquent, les enregistrements d’audit doivent être complets, et il n’est pas acceptable d’en supprimer lors du traitement des transactions.</span><span class="sxs-lookup"><span data-stu-id="256d4-566">As such, audit records must be complete, and it's not acceptable to drop any while processing transactions.</span></span> <span data-ttu-id="256d4-567">Si une application nécessite un audit, il doit être maintenu séparé de la journalisation des diagnostics.</span><span class="sxs-lookup"><span data-stu-id="256d4-567">If an application requires auditing, this should be kept separate from diagnostics logging.</span></span>

<span data-ttu-id="256d4-568">Pour plus d’informations sur la surveillance et les diagnostics, consultez [Guide de surveillance et de diagnostics][monitoring-guidance].</span><span class="sxs-lookup"><span data-stu-id="256d4-568">For more information about monitoring and diagnostics, see [Monitoring and diagnostics guidance][monitoring-guidance].</span></span>

## <a name="respond-to-failures"></a><span data-ttu-id="256d4-569">Répondre aux défaillances</span><span class="sxs-lookup"><span data-stu-id="256d4-569">Respond to failures</span></span>

<span data-ttu-id="256d4-570">Les sections précédentes ont porté sur les stratégies de récupération automatique, qui sont critiques pour la haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="256d4-570">Previous sections have focused on automated recovery strategies, which are critical for high availability.</span></span> <span data-ttu-id="256d4-571">Toutefois, une intervention manuelle est parfois nécessaire.</span><span class="sxs-lookup"><span data-stu-id="256d4-571">However, sometimes manual intervention is needed.</span></span>

- <span data-ttu-id="256d4-572">**Alertes**.</span><span class="sxs-lookup"><span data-stu-id="256d4-572">**Alerts**.</span></span> <span data-ttu-id="256d4-573">Surveillez votre application pour trouver des signes précurseurs pouvant nécessiter une intervention proactive.</span><span class="sxs-lookup"><span data-stu-id="256d4-573">Monitor your application for warning signs that may require proactive intervention.</span></span> <span data-ttu-id="256d4-574">Par exemple, si vous voyez que SQL Database ou Cosmos DB limitent régulièrement votre application, vous devrez peut-être améliorer la capacité de votre base de données ou optimiser vos requêtes.</span><span class="sxs-lookup"><span data-stu-id="256d4-574">For example, if you see that SQL Database or Cosmos DB consistently throttles your application, you might need to increase your database capacity or optimize your queries.</span></span> <span data-ttu-id="256d4-575">Dans cet exemple, même si l’application peut gérer les erreurs de limitation en toute transparence, votre télémétrie doit toujours déclencher une alerte afin que vous puissiez suivre l’activité.</span><span class="sxs-lookup"><span data-stu-id="256d4-575">In this example, even though the application might handle the throttling errors transparently, your telemetry should still raise an alert so that you can follow up.</span></span> <span data-ttu-id="256d4-576">Il est recommandé de configurer des alertes sur les journaux de diagnostic et les métriques de ressources Azure par rapport aux limites de services et aux seuils de quotas.</span><span class="sxs-lookup"><span data-stu-id="256d4-576">It is recommended to configure alerts on Azure resources metrics and diagnostics logs against the services limits and quotas thresholds.</span></span> <span data-ttu-id="256d4-577">Nous vous recommandons de configurer des alertes sur les métriques en raison de leur latence qui plus faible que celle des journaux de diagnostic.</span><span class="sxs-lookup"><span data-stu-id="256d4-577">We recommend to setup alerts on metrics as they are lower latency vs. diagnostics logs.</span></span> <span data-ttu-id="256d4-578">De plus, Azure peut fournir par le biais de [Resource Health ](/azure/service-health/resource-health-checks-resource-types) certains états d’intégrité prêts à l’emploi à l’aide desquels vous pouvez diagnostiquer la limitation des services Azure.</span><span class="sxs-lookup"><span data-stu-id="256d4-578">In addition, Azure is able to provide with some out-of-the-box health status through [resource health](/azure/service-health/resource-health-checks-resource-types) which can help diagnose throttling of Azure services.</span></span>
- <span data-ttu-id="256d4-579">**Effectuez le basculement**.</span><span class="sxs-lookup"><span data-stu-id="256d4-579">**Failover**.</span></span> <span data-ttu-id="256d4-580">Configurez une stratégie de reprise d’activité pour votre application.</span><span class="sxs-lookup"><span data-stu-id="256d4-580">Configure a disaster recovery strategy for your application.</span></span> <span data-ttu-id="256d4-581">La stratégie appropriée dépend de vos contrats SLA.</span><span class="sxs-lookup"><span data-stu-id="256d4-581">The appropriate strategy will depend on your SLAs.</span></span> <span data-ttu-id="256d4-582">Pour la plupart des scénarios, une implémentation de type actif/passif est suffisante.</span><span class="sxs-lookup"><span data-stu-id="256d4-582">For most scenarous, an active-passive implementation is sufficient.</span></span> <span data-ttu-id="256d4-583">Pour plus d’informations, consultez [Topologies de déploiement pour la reprise d’activité](./disaster-recovery-azure-applications.md#deployment-topologies-for-disaster-recovery).</span><span class="sxs-lookup"><span data-stu-id="256d4-583">For more information, see [Deployment topologies for disaster recovery ](./disaster-recovery-azure-applications.md#deployment-topologies-for-disaster-recovery).</span></span> <span data-ttu-id="256d4-584">La plupart des services Azure prennent en charge le basculement manuel ou automatisé.</span><span class="sxs-lookup"><span data-stu-id="256d4-584">Most Azure services allow for either manual or automated failover.</span></span> <span data-ttu-id="256d4-585">Par exemple, dans une application IaaS, utilisez [Azure Site Recovery](/azure/site-recovery/azure-to-azure-architecture) pour les niveaux web et logique, et des [groupes de disponibilité AlwaysOn SQL](/azure/virtual-machines/windows/sql/virtual-machines-windows-portal-sql-availability-group-dr) pour le niveau base de données.</span><span class="sxs-lookup"><span data-stu-id="256d4-585">For example, in an IaaS application, use [Azure Site Recovery](/azure/site-recovery/azure-to-azure-architecture) for the web and logic tiers and [SQL AlwaysOn Availability Groups](/azure/virtual-machines/windows/sql/virtual-machines-windows-portal-sql-availability-group-dr) for the database tier.</span></span> <span data-ttu-id="256d4-586">[Traffic Manager](/azure/traffic-manager/traffic-manager-overview) permet d’effectuer un basculement automatisé sur plusieurs régions.</span><span class="sxs-lookup"><span data-stu-id="256d4-586">[Traffic Manager](/azure/traffic-manager/traffic-manager-overview) provides automated failover across regions.</span></span>
- <span data-ttu-id="256d4-587">**Test de disponibilité opérationnelle**.</span><span class="sxs-lookup"><span data-stu-id="256d4-587">**Operational readiness testing**.</span></span> <span data-ttu-id="256d4-588">Effectuez un test de disponibilité opérationnelle pour le basculement vers la région secondaire et la restauration automatique vers la région primaire.</span><span class="sxs-lookup"><span data-stu-id="256d4-588">Perform an operational readiness test for both failover to the secondary region and failback to the primary region.</span></span> <span data-ttu-id="256d4-589">De nombreux services Azure prennent en charge les basculements manuels ou les tests de basculement dans le cadre de simulations de reprise d’activité.</span><span class="sxs-lookup"><span data-stu-id="256d4-589">Many Azure services support manual failover or test failover for disaster recovery drills.</span></span> <span data-ttu-id="256d4-590">Vous pouvez également simuler une panne en arrêtant ou en supprimant des services.</span><span class="sxs-lookup"><span data-stu-id="256d4-590">Alternatively, you can simulate an outage by shutting down or removing services.</span></span>
- <span data-ttu-id="256d4-591">**Vérification de la cohérence des données**.</span><span class="sxs-lookup"><span data-stu-id="256d4-591">**Data consistency check**.</span></span> <span data-ttu-id="256d4-592">Si une défaillance se produit dans un magasin de données, des incohérences de données pourront être trouvées lorsque le magasin sera de nouveau disponible, en particulier si les données ont été répliquées.</span><span class="sxs-lookup"><span data-stu-id="256d4-592">If a failure happens in a data store, there may be data inconsistencies when the store becomes available again, especially if the data was replicated.</span></span> <span data-ttu-id="256d4-593">Pour les services Azure proposant la réplication interrégion, examinez les objectifs RTO et RPO pour comprendre la perte de données attendue en cas de défaillance.</span><span class="sxs-lookup"><span data-stu-id="256d4-593">For Azure services that provide cross-regional replication, look at the RTO and RPO to understand the expected data loss in a failure.</span></span> <span data-ttu-id="256d4-594">Passez en revue les contrats SLA pour les services Azure afin de déterminer si un basculement interrégion peut être lancé manuellement ou s’il est lancé par Microsoft.</span><span class="sxs-lookup"><span data-stu-id="256d4-594">Review the SLAs for Azure services to understand whether cross-regional failover can be initiated manually or is initiated by Microsoft.</span></span> <span data-ttu-id="256d4-595">Pour certains services, Microsoft décide à quel moment effectuer le basculement.</span><span class="sxs-lookup"><span data-stu-id="256d4-595">For some services, Microsoft decides when to perform the failover.</span></span> <span data-ttu-id="256d4-596">Microsoft peut donner la priorité à la récupération des données dans la région primaire et procéder uniquement au basculement vers une région secondaire si les données de la région primaire sont considérées comme irrécupérables.</span><span class="sxs-lookup"><span data-stu-id="256d4-596">Microsoft may prioritize the recovery of data in the primary region, only failing over to a secondary region if data in the primary region is deemed unrecoverable.</span></span> <span data-ttu-id="256d4-597">Par exemple, le [stockage géoredondant](/azure/storage/common/storage-redundancy-grs) et [Key Vault](/azure/key-vault/key-vault-disaster-recovery-guidance) suivent ce modèle.</span><span class="sxs-lookup"><span data-stu-id="256d4-597">For example, [Geo-redundant storage](/azure/storage/common/storage-redundancy-grs) and [Key Vault](/azure/key-vault/key-vault-disaster-recovery-guidance) follow this model.</span></span>
- <span data-ttu-id="256d4-598">**Restauration à partir de la sauvegarde**.</span><span class="sxs-lookup"><span data-stu-id="256d4-598">**Restoring from backup**.</span></span> <span data-ttu-id="256d4-599">Dans certains scénarios, la restauration à partir d’une sauvegarde n’est possible que dans la même région.</span><span class="sxs-lookup"><span data-stu-id="256d4-599">In some scenarios, restoring from backup is only possible within the same region.</span></span> <span data-ttu-id="256d4-600">C’est le cas pour la [sauvegarde de machines virtuelles Azure](/azure/backup/backup-azure-vms-first-look-arm).</span><span class="sxs-lookup"><span data-stu-id="256d4-600">This is the case for [Azure VMs Backup](/azure/backup/backup-azure-vms-first-look-arm).</span></span> <span data-ttu-id="256d4-601">D’autres services Azure, comme les [géoréplicas Redis Cache](/azure/redis-cache/cache-how-to-geo-replication), fournissent des sauvegardes géorépliquées.</span><span class="sxs-lookup"><span data-stu-id="256d4-601">Other Azure services provide geo-replicated backups, such as [Redis Cache Geo-Replicas](/azure/redis-cache/cache-how-to-geo-replication).</span></span> <span data-ttu-id="256d4-602">Le but d’une sauvegarde est d’éviter la suppression accidentelle ou l’endommagement des données. En cas de besoin, une version fonctionnelle antérieure de l’application est restaurée.</span><span class="sxs-lookup"><span data-stu-id="256d4-602">The purpose of backups is to protect against accidental deletion or corruption of data, restoring the application to a functional version earlier in time.</span></span> <span data-ttu-id="256d4-603">Par conséquent, bien que les sauvegardes puissent parfois servir de solution de reprise d’activité, l’inverse n’est pas toujours vrai dans la mesure où la reprise d’activité ne vous protège pas contre la suppression accidentelle ou l’endommagement des données.</span><span class="sxs-lookup"><span data-stu-id="256d4-603">Therefore, while backups can serve as a disaster recovery solution in some cases, the inverse is not always true: Disaster recovery won't protect you against accidental deletion or corruption a data.</span></span>  

<span data-ttu-id="256d4-604">Documentez et testez votre plan de récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="256d4-604">Document and test your disaster recovery plan.</span></span> <span data-ttu-id="256d4-605">Évaluez l’impact commercial des défaillances d’application.</span><span class="sxs-lookup"><span data-stu-id="256d4-605">Evaluate the business impact of application failures.</span></span> <span data-ttu-id="256d4-606">Automatisez le processus autant que possible et documentez toutes les étapes manuelles, telles que le basculement manuel ou la restauration des données à partir des sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="256d4-606">Automate the process as much as possible, and document any manual steps, such as manual failover or data restoration from backups.</span></span> <span data-ttu-id="256d4-607">Testez régulièrement votre processus de récupération d’urgence pour valider et améliorer le plan.</span><span class="sxs-lookup"><span data-stu-id="256d4-607">Regularly test your disaster recovery process to validate and improve the plan.</span></span> <span data-ttu-id="256d4-608">Configurez des alertes pour les services Azure consommés par votre application.</span><span class="sxs-lookup"><span data-stu-id="256d4-608">Set up alerts for the Azure services consumed by your application.</span></span>

## <a name="summary"></a><span data-ttu-id="256d4-609">Résumé</span><span class="sxs-lookup"><span data-stu-id="256d4-609">Summary</span></span>

<span data-ttu-id="256d4-610">Cet article décrit la résilience d’un point de vue global, en mettant en évidence certains des défis uniques du cloud.</span><span class="sxs-lookup"><span data-stu-id="256d4-610">This article discussed resiliency from a holistic perspective, emphasizing some of the unique challenges of the cloud.</span></span> <span data-ttu-id="256d4-611">Ceux-ci incluent la nature distribuée du cloud computing, l’utilisation de matériel standard, et la présence des défaillances réseau temporaires.</span><span class="sxs-lookup"><span data-stu-id="256d4-611">These include the distributed nature of cloud computing, the use of commodity hardware, and the presence of transient network faults.</span></span>

<span data-ttu-id="256d4-612">Voici les principaux points de l’article à retenir :</span><span class="sxs-lookup"><span data-stu-id="256d4-612">Here are the major points to take away from this article:</span></span>

- <span data-ttu-id="256d4-613">La résilience entraîne une plus grande disponibilité et une réduction du délai moyen pour récupérer en cas de panne.</span><span class="sxs-lookup"><span data-stu-id="256d4-613">Resiliency leads to higher availability, and lower mean time to recover from failures.</span></span>
- <span data-ttu-id="256d4-614">L’obtention de la résilience dans le cloud requiert un ensemble de techniques diverses à partir de solutions traditionnelles locales.</span><span class="sxs-lookup"><span data-stu-id="256d4-614">Achieving resiliency in the cloud requires a different set of techniques from traditional on-premises solutions.</span></span>
- <span data-ttu-id="256d4-615">La résilience ne se produit pas par accident.</span><span class="sxs-lookup"><span data-stu-id="256d4-615">Resiliency does not happen by accident.</span></span> <span data-ttu-id="256d4-616">Elle doit être conçue et intégrée dès le début.</span><span class="sxs-lookup"><span data-stu-id="256d4-616">It must be designed and built in from the start.</span></span>
- <span data-ttu-id="256d4-617">La résilience touche chaque partie du cycle de vie de l’application, depuis la planification et le codage jusqu’aux opérations.</span><span class="sxs-lookup"><span data-stu-id="256d4-617">Resiliency touches every part of the application lifecycle, from planning and coding to operations.</span></span>
- <span data-ttu-id="256d4-618">Testez et surveillez !</span><span class="sxs-lookup"><span data-stu-id="256d4-618">Test and monitor!</span></span>

<!-- links -->

[blue-green]: https://martinfowler.com/bliki/BlueGreenDeployment.html
[canary-release]: https://martinfowler.com/bliki/CanaryRelease.html
[circuit-breaker-pattern]: ../patterns/circuit-breaker.md
[compensating-transaction-pattern]: ../patterns/compensating-transaction.md
[containers]: https://en.wikipedia.org/wiki/Operating-system-level_virtualization
[dsc]: /azure/automation/automation-dsc-overview
[contingency-planning-guide]: https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-34r1.pdf
[fma]: ./failure-mode-analysis.md
[hystrix]: https://medium.com/netflix-techblog/introducing-hystrix-for-resilience-engineering-13531c1ab362
[jmeter]: https://jmeter.apache.org/
[load-leveling-pattern]: ../patterns/queue-based-load-leveling.md
[monitoring-guidance]: ../best-practices/monitoring.md
[ra-basic-web]: ../reference-architectures/app-service-web-app/basic-web-app.md
[ra-multi-vm]: ../reference-architectures/virtual-machines-windows/multi-vm.md
[checklist]: ../checklist/resiliency.md
[retry-pattern]: ../patterns/retry.md
[retry-service-specific guidance]: ../best-practices/retry-service-specific.md
[sla]: https://azure.microsoft.com/support/legal/sla/
[throttling-pattern]: ../patterns/throttling.md
[tm]: https://azure.microsoft.com/services/traffic-manager/
[tm-failover]: /azure/traffic-manager/traffic-manager-monitoring
[tm-sla]: https://azure.microsoft.com/support/legal/sla/traffic-manager
[site-recovery]: /azure/site-recovery/azure-to-azure-quickstart/
[site-recovery-test-failover]: /azure/site-recovery/azure-to-azure-tutorial-dr-drill/
[site-recovery-failover]: /azure/site-recovery/azure-to-azure-tutorial-failover-failback/
[deployment-topologies]: ./disaster-recovery-azure-applications.md#deployment-topologies-for-disaster-recovery
[bulkhead-pattern]: ../patterns/bulkhead.md
[terraform]: /azure/virtual-machines/windows/infrastructure-automation#terraform
[ansible]: /azure/virtual-machines/windows/infrastructure-automation#ansible
[chef]: /azure/virtual-machines/windows/infrastructure-automation#chef
[puppet]: /azure/virtual-machines/windows/infrastructure-automation#puppet
[template-deployment]: /azure/azure-resource-manager/resource-group-overview#template-deployment
[cloud-init]: /azure/virtual-machines/windows/infrastructure-automation#cloud-init
[azure-devops-services]: /azure/virtual-machines/windows/infrastructure-automation#azure-devops-services
[jenkins]: /azure/virtual-machines/windows/infrastructure-automation#jenkins
[staging-slots]: /azure/app-service/deploy-staging-slots
[powershell]: /powershell/azure/overview
[cli]: /cli/azure
