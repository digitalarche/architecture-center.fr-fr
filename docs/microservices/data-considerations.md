---
title: Considérations relatives aux données pour les microservices
description: Considérations relatives aux données pour les microservices
author: MikeWasson
ms.date: 12/08/2017
ms.openlocfilehash: 9bd7a8424309b5753b42cfb70559836288a3ce9d
ms.sourcegitcommit: c7f46b14ad7d55cf553b2d0b01045c9c25aefcdb
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/09/2017
ms.locfileid: "26587754"
---
# <a name="designing-microservices-data-considerations"></a><span data-ttu-id="18bbe-103">Conception des microservices : Considérations relatives aux données</span><span class="sxs-lookup"><span data-stu-id="18bbe-103">Designing microservices: Data considerations</span></span>

<span data-ttu-id="18bbe-104">Ce chapitre décrit les considérations relatives à la gestion des données au sein d’une architecture de microservices.</span><span class="sxs-lookup"><span data-stu-id="18bbe-104">This chapter describes considerations for managing data in a microservices architecture.</span></span> <span data-ttu-id="18bbe-105">Dans la mesure où chaque microservice gère ses propres données, l’intégrité et la cohérence des données sont des problématiques majeures.</span><span class="sxs-lookup"><span data-stu-id="18bbe-105">Because every microservice manages its own data, data integrity and data consistency are critical challenges.</span></span>

![](./images/data-considerations.png)

<span data-ttu-id="18bbe-106">L’un des principes fondamentaux des microservices est que chaque service gère ses propres données.</span><span class="sxs-lookup"><span data-stu-id="18bbe-106">A basic principle of microservices is that each service manages its own data.</span></span> <span data-ttu-id="18bbe-107">Deux services ne devraient pas partager un magasin de données.</span><span class="sxs-lookup"><span data-stu-id="18bbe-107">Two services should not share a data store.</span></span> <span data-ttu-id="18bbe-108">A contrario, chaque service est responsable de son propre magasin de données privé, auquel les autres services ne peuvent pas accéder directement.</span><span class="sxs-lookup"><span data-stu-id="18bbe-108">Instead, each service is responsible for its own private data store, which other services cannot access directly.</span></span>

<span data-ttu-id="18bbe-109">Cette règle a vocation à éviter tout couplage non intentionnel entre les services, problème qui peut se produire dans les cas de figure où les services partagent des schémas de données sous-jacents.</span><span class="sxs-lookup"><span data-stu-id="18bbe-109">The reason for this rule is to avoid unintentional coupling between services, which can result if services share the same underlying data schemas.</span></span> <span data-ttu-id="18bbe-110">Si un schéma de données est modifié, le changement doit être coordonné sur chacun des services pris en charge par la base de données considérée.</span><span class="sxs-lookup"><span data-stu-id="18bbe-110">If there is a change to the data schema, the change must be coordinated across every service that relies on that database.</span></span> <span data-ttu-id="18bbe-111">En isolant le magasin de données de chaque service, nous sommes en mesure de limiter la portée du changement et de préserver l’agilité de déploiements véritablement indépendants.</span><span class="sxs-lookup"><span data-stu-id="18bbe-111">By isolating each service's data store, we can limit the scope of change, and preserve the agility of truly independent deployments.</span></span> <span data-ttu-id="18bbe-112">Cela s’explique également par le fait que chaque microservice peut posséder ses propres modèles de données, requêtes ou modèles de lecture/écriture.</span><span class="sxs-lookup"><span data-stu-id="18bbe-112">Another reason is that each microservice may have its own data models, queries, or read/write patterns.</span></span> <span data-ttu-id="18bbe-113">En recourant à un magasin de données partagé, vous limitez la capacité des équipes à optimiser le stockage de données sur leur service respectif.</span><span class="sxs-lookup"><span data-stu-id="18bbe-113">Using a shared data store limits each team's ability to optimize data storage for their particular service.</span></span> 

![](../guide/architecture-styles/images/cqrs-microservices-wrong.png)

<span data-ttu-id="18bbe-114">Cette approche entraîne naturellement une [persistance polyglotte](https://martinfowler.com/bliki/PolyglotPersistence.html) &mdash;, l’utilisation de plusieurs technologies de stockage de données au sein d’une application unique.</span><span class="sxs-lookup"><span data-stu-id="18bbe-114">This approach naturally leads to [polyglot persistence](https://martinfowler.com/bliki/PolyglotPersistence.html) &mdash; the use of multiple data storage technologies within a single application.</span></span> <span data-ttu-id="18bbe-115">Un service peut avoir besoin des fonctionnalités de schéma à la lecture d’une base de données documentaire.</span><span class="sxs-lookup"><span data-stu-id="18bbe-115">One service might require the schema-on-read capabilities of a document database.</span></span> <span data-ttu-id="18bbe-116">Un autre peut nécessiter l’intégrité référentielle fournie par un SGBDR.</span><span class="sxs-lookup"><span data-stu-id="18bbe-116">Another might need the referential integrity provided by an RDBMS.</span></span> <span data-ttu-id="18bbe-117">Chaque équipe est libre de prendre la décision la mieux adaptée pour son service.</span><span class="sxs-lookup"><span data-stu-id="18bbe-117">Each team is free to make the best choice for their service.</span></span> <span data-ttu-id="18bbe-118">Pour plus d’informations sur le principe général de la persistance polyglotte, consultez la section [Utiliser la meilleure banque de données pour le travail](../guide/design-principles/use-the-best-data-store.md).</span><span class="sxs-lookup"><span data-stu-id="18bbe-118">For more about the general principle of polyglot persistence, see [Use the best data store for the job](../guide/design-principles/use-the-best-data-store.md).</span></span> 

> [!NOTE]
> <span data-ttu-id="18bbe-119">Il est tout à fait acceptable que les services partagent le même serveur de base de données physique.</span><span class="sxs-lookup"><span data-stu-id="18bbe-119">It's fine for services to share the same physical database server.</span></span> <span data-ttu-id="18bbe-120">Le problème survient quand les services partagent le même schéma, ou lisent et écrivent sur le même jeu de tables de base de données.</span><span class="sxs-lookup"><span data-stu-id="18bbe-120">The problem occurs when services share the same schema, or read and write to the same set of database tables.</span></span>


## <a name="challenges"></a><span data-ttu-id="18bbe-121">Défis</span><span class="sxs-lookup"><span data-stu-id="18bbe-121">Challenges</span></span>

<span data-ttu-id="18bbe-122">Certains problèmes sont provoqués par cette approche distribuée de la gestion des données.</span><span class="sxs-lookup"><span data-stu-id="18bbe-122">Some challenges arise from this distributed approach to managing data.</span></span> <span data-ttu-id="18bbe-123">Tout d’abord, une redondance peut être identifiée entre les magasins de données, le même élément de données apparaissant à plusieurs endroits.</span><span class="sxs-lookup"><span data-stu-id="18bbe-123">First, there may be redundancy across the data stores, with the same item of data appearing in multiple places.</span></span> <span data-ttu-id="18bbe-124">Par exemple, les données peuvent être stockées dans le cadre d’une transaction, puis déplacées ailleurs à des fins d’analyse, de génération de rapport ou d’archivage.</span><span class="sxs-lookup"><span data-stu-id="18bbe-124">For example, data might be stored as part of a transaction, then stored elsewhere for analytics, reporting, or archiving.</span></span> <span data-ttu-id="18bbe-125">Les données dupliquées ou partitionnées peuvent entraîner des problèmes d’intégrité et de cohérence des données.</span><span class="sxs-lookup"><span data-stu-id="18bbe-125">Duplicated or partitioned data can lead to issues of data integrity and consistency.</span></span> <span data-ttu-id="18bbe-126">Lorsque les relations de données s’étendent sur plusieurs services, vous ne pouvez pas recourir aux techniques traditionnelles de gestion des données pour appliquer les relations.</span><span class="sxs-lookup"><span data-stu-id="18bbe-126">When data relationships span multiple services, you can't use traditional data management techniques to enforce the relationships.</span></span>

<span data-ttu-id="18bbe-127">La modélisation traditionnelle des données valorise la règle « chaque événement à sa place ».</span><span class="sxs-lookup"><span data-stu-id="18bbe-127">Traditional data modeling uses the rule of "one fact in one place."</span></span> <span data-ttu-id="18bbe-128">Chaque entité apparaît exactement une fois dans le schéma.</span><span class="sxs-lookup"><span data-stu-id="18bbe-128">Every entity appears exactly once in the schema.</span></span> <span data-ttu-id="18bbe-129">D’autres entités peuvent y faire référence, sans qu’il n’y ait duplication.</span><span class="sxs-lookup"><span data-stu-id="18bbe-129">Other entities may hold references to it but not duplicate it.</span></span> <span data-ttu-id="18bbe-130">L’avantage évident de l’approche traditionnelle est identifié au niveau des mises à jour, qui sont effectuées de manière centralisée, ce qui permet d’éviter les soucis d’incohérence des données.</span><span class="sxs-lookup"><span data-stu-id="18bbe-130">The obvious advantage to the traditional approach is that updates are made in a single place, which avoids problems with data consistency.</span></span> <span data-ttu-id="18bbe-131">Dans une architecture de microservices, vous devez réfléchir à la propagation des mises à jour entre les services et trouver un moyen d’obtenir la cohérence finale au sein d’un système où les données apparaissent à différents endroits sans forte cohérence initiale.</span><span class="sxs-lookup"><span data-stu-id="18bbe-131">In a microservices architecture, you have to consider how updates are propagated across services, and how to manage eventual consistency when data appears in multiple places without strong consistency.</span></span> 

## <a name="approaches-to-managing-data"></a><span data-ttu-id="18bbe-132">Approches de la gestion des données</span><span class="sxs-lookup"><span data-stu-id="18bbe-132">Approaches to managing data</span></span>

<span data-ttu-id="18bbe-133">Il n’existe aucune approche unique adaptée à tous les cas de figure, mais voici quelques recommandations relatives à la gestion des données dans une architecture de microservices.</span><span class="sxs-lookup"><span data-stu-id="18bbe-133">There is no single approach that's correct in all cases, but here are some general guidelines for managing data in a microservices architecture.</span></span>

- <span data-ttu-id="18bbe-134">Adoptez la cohérence éventuelle dans la mesure du possible.</span><span class="sxs-lookup"><span data-stu-id="18bbe-134">Embrace eventual consistency where possible.</span></span> <span data-ttu-id="18bbe-135">Appréhendez les emplacements du système qui nécessitent une forte cohérence ou des transactions ACID, et les secteurs où une cohérence finale est acceptable.</span><span class="sxs-lookup"><span data-stu-id="18bbe-135">Understand the places in the system where you need strong consistency or ACID transactions, and the places where eventual consistency is acceptable.</span></span>

- <span data-ttu-id="18bbe-136">Lorsque vous avez un besoin crucial de cohérence, un service peut représenter la source de vérité pour une entité donnée, exposée via une API.</span><span class="sxs-lookup"><span data-stu-id="18bbe-136">When you need strong consistency guarantees, one service may represent the source of truth for a given entity, which is exposed through an API.</span></span> <span data-ttu-id="18bbe-137">Les autres services peuvent conserver leur propre copie des données, ou un sous-ensemble des données qui présentent une cohérence finale avec les données de référence mais qui ne sont pas considérés comme la source de vérité.</span><span class="sxs-lookup"><span data-stu-id="18bbe-137">Other services might hold their own copy of the data, or a subset of the data, that is eventually consistent with the master data but not considered the source of truth.</span></span> <span data-ttu-id="18bbe-138">Par exemple, imaginez un système de commerce électronique pourvu d’un service de commande client et d’un service de recommandation.</span><span class="sxs-lookup"><span data-stu-id="18bbe-138">For example, imagine an e-commerce system with a customer order service and a recommendation service.</span></span> <span data-ttu-id="18bbe-139">Le service de recommandation peut être à l’écoute des événements du service de commande, mais si un client sollicite un remboursement, il s’agit du service de commande et non du service de recommandation qui dispose de l’historique des transactions.</span><span class="sxs-lookup"><span data-stu-id="18bbe-139">The recommendation service might listen to events from the order service, but if a customer requests a refund, it is the order service, not the recommendation service, that has the complete transaction history.</span></span>

- <span data-ttu-id="18bbe-140">Pour les transactions, utilisez des modèles comme [Superviseur de l’agent du planificateur](../patterns/scheduler-agent-supervisor.md) et [Transaction de compensation](../patterns/compensating-transaction.md) pour garantir la cohérence des données entre les différents services.</span><span class="sxs-lookup"><span data-stu-id="18bbe-140">For transactions, use patterns such as [Scheduler Agent Supervisor](../patterns/scheduler-agent-supervisor.md) and [Compensating Transaction](../patterns/compensating-transaction.md) to keep data consistent across several services.</span></span>  <span data-ttu-id="18bbe-141">Il vous faudra éventuellement stocker un volume supplémentaire de données capturant l’état d’une unité de travail s’étendant sur plusieurs services, afin d’éviter toute défaillance partielle entre plusieurs services.</span><span class="sxs-lookup"><span data-stu-id="18bbe-141">You may need to store an additional piece of data that captures the state of a unit of work that spans multiple services, to avoid partial failure among multiple services.</span></span> <span data-ttu-id="18bbe-142">Par exemple, conservez un élément de travail dans une file d’attente durable lorsqu’une transaction à plusieurs étapes est en cours.</span><span class="sxs-lookup"><span data-stu-id="18bbe-142">For example, keep a work item on a durable queue while a multi-step transaction is in progress.</span></span> 

- <span data-ttu-id="18bbe-143">Stockez uniquement les données dont un service a besoin.</span><span class="sxs-lookup"><span data-stu-id="18bbe-143">Store only the data that a service needs.</span></span> <span data-ttu-id="18bbe-144">Un service peut nécessiter uniquement un sous-ensemble des informations sur une entité de domaine.</span><span class="sxs-lookup"><span data-stu-id="18bbe-144">A service might only need a subset of information about a domain entity.</span></span> <span data-ttu-id="18bbe-145">Par exemple, dans une limite de contexte Expédition, nous devons savoir quel client est associé à une livraison spécifique.</span><span class="sxs-lookup"><span data-stu-id="18bbe-145">For example, in the Shipping bounded context, we need to know which customer is associated to a particular delivery.</span></span> <span data-ttu-id="18bbe-146">Nous n’avons toutefois pas besoin de l’adresse de facturation du client, qui est gérée par la limite de contexte Comptes.</span><span class="sxs-lookup"><span data-stu-id="18bbe-146">But we don't need the customer's billing address &mdash; that's managed by the Accounts bounded context.</span></span> <span data-ttu-id="18bbe-147">Une analyse approfondie du domaine et l’application d’une approche de conception pilotée par domaine sont vos alliés.</span><span class="sxs-lookup"><span data-stu-id="18bbe-147">Thinking carefully about the domain, and using a DDD approach, can help here.</span></span> 

- <span data-ttu-id="18bbe-148">Vérifiez si vos services sont cohérents et couplés souplement.</span><span class="sxs-lookup"><span data-stu-id="18bbe-148">Consider whether your services are coherent and loosely coupled.</span></span> <span data-ttu-id="18bbe-149">Si deux services échangent continuellement des informations entre eux, entraînant de fait une riche interaction entre les API, il vous faudra redessiner vos limites de service, en fusionnant deux services ou en refactorisant leur fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="18bbe-149">If two services are continually exchanging information with each other, resulting in chatty APIs, you may need to redraw your service boundaries, by merging two services or refactoring their functionality.</span></span>

- <span data-ttu-id="18bbe-150">Valorisez un [style d’architecture basée sur les événements](../guide/architecture-styles/event-driven.md).</span><span class="sxs-lookup"><span data-stu-id="18bbe-150">Use an [event driven architecture style](../guide/architecture-styles/event-driven.md).</span></span> <span data-ttu-id="18bbe-151">Dans ce style d’architecture, un service publie un événement si des modifications sont apportées à ses entités ou modèles publics.</span><span class="sxs-lookup"><span data-stu-id="18bbe-151">In this architecture style, a service publishes an event when there are changes to its public models or entities.</span></span> <span data-ttu-id="18bbe-152">Les services intéressés peuvent s’abonner à ces événements.</span><span class="sxs-lookup"><span data-stu-id="18bbe-152">Interested services can subscribe to these events.</span></span> <span data-ttu-id="18bbe-153">Par exemple, un autre service peut utiliser les événements pour établir une vue matérialisée des données, davantage adaptée au modèle de requête.</span><span class="sxs-lookup"><span data-stu-id="18bbe-153">For example, another service could use the events to construct a materialized view of the data that is more suitable for querying.</span></span> 

- <span data-ttu-id="18bbe-154">Un service détenant les événements doit publier un schéma servant à automatiser la sérialisation et la désérialisation des événements, ceci pour éviter tout couplage étroit entre les éditeurs et les abonnés.</span><span class="sxs-lookup"><span data-stu-id="18bbe-154">A service that owns events should publish a schema that can be used to automate serializing and deserializing the events, to avoid tight coupling between publishers and subscribers.</span></span> <span data-ttu-id="18bbe-155">Envisagez le schéma JSON ou une infrastructure comme [Microsoft Bond](https://github.com/Microsoft/bond), Protobuf ou Avro.</span><span class="sxs-lookup"><span data-stu-id="18bbe-155">Consider JSON schema or a framework like [Microsoft Bond](https://github.com/Microsoft/bond), Protobuf, or Avro.</span></span>  
 
- <span data-ttu-id="18bbe-156">À grande échelle, les événements peuvent constituer un goulot d’étranglement sur le système ; aussi, envisagez l’agrégation ou le traitement par lot afin de réduire la charge totale.</span><span class="sxs-lookup"><span data-stu-id="18bbe-156">At high scale, events can become a bottleneck on the system, so consider using aggregation or batching to reduce the total load.</span></span> 

## <a name="drone-delivery-choosing-the-data-stores"></a><span data-ttu-id="18bbe-157">Drone Delivery : Sélection des magasins de données</span><span class="sxs-lookup"><span data-stu-id="18bbe-157">Drone Delivery: Choosing the data stores</span></span> 

<span data-ttu-id="18bbe-158">Même avec un nombre limité de services, la limite de contexte Expédition illustre plusieurs des points évoqués dans cette section.</span><span class="sxs-lookup"><span data-stu-id="18bbe-158">Even with only a few services, the Shipping bounded context illustrates several of the points discussed in this section.</span></span> 

<span data-ttu-id="18bbe-159">Lorsqu’un utilisateur planifie une nouvelle livraison, la requête du client comprend des informations sur la livraison, comme les emplacements de la collecte et du dépôt, mais aussi sur le colis, comme la taille et le poids.</span><span class="sxs-lookup"><span data-stu-id="18bbe-159">When a user schedules a new delivery, the client request includes information about the both the delivery, such as the pickup and dropoff locations, and about the package, such as the size and weight.</span></span> <span data-ttu-id="18bbe-160">Ces informations définissent une unité de travail, que le service d’ingestion transmet aux unités de débit Event Hub.</span><span class="sxs-lookup"><span data-stu-id="18bbe-160">This information defines a unit of work, which the Ingestion service sends to Event Hubs.</span></span> <span data-ttu-id="18bbe-161">Il est primordial que l’unité de travail demeure au sein du stockage persistant quand le service Planificateur exécute le workflow, de manière à ce qu’aucune requête de livraison ne soit perdue.</span><span class="sxs-lookup"><span data-stu-id="18bbe-161">It's important that the unit of work stays in persistent storage while the Scheduler service is executing the workflow, so that no delivery requests are lost.</span></span> <span data-ttu-id="18bbe-162">Pour plus d’informations sur le workflow, voir [Ingestion et workflow](./ingestion-workflow.md).</span><span class="sxs-lookup"><span data-stu-id="18bbe-162">For more discussion of the workflow, see [Ingestion and workflow](./ingestion-workflow.md).</span></span> 

<span data-ttu-id="18bbe-163">Les divers services principaux s’intéressent à différentes portions des données de la requête, et présentent par ailleurs différents profils de lecture et d’écriture.</span><span class="sxs-lookup"><span data-stu-id="18bbe-163">The various backend services care about different portions of the information in the request, and also have different read and write profiles.</span></span> 

### <a name="delivery-service"></a><span data-ttu-id="18bbe-164">Service de livraison</span><span class="sxs-lookup"><span data-stu-id="18bbe-164">Delivery service</span></span>

<span data-ttu-id="18bbe-165">Le service de livraison stocke les données sur les livraisons qui sont planifiées ou en cours.</span><span class="sxs-lookup"><span data-stu-id="18bbe-165">The Delivery service stores information about every delivery that is currently scheduled or in progress.</span></span> <span data-ttu-id="18bbe-166">Il est à l’écoute des événements des drones, et effectue le suivi de l’état des livraisons en cours.</span><span class="sxs-lookup"><span data-stu-id="18bbe-166">It listens for events from the drones, and tracks the status of deliveries that are in progress.</span></span> <span data-ttu-id="18bbe-167">Il transmet également les événements de domaine avec les mises à jour des états de livraison.</span><span class="sxs-lookup"><span data-stu-id="18bbe-167">It also sends domain events with delivery status updates.</span></span>

<span data-ttu-id="18bbe-168">Il est probable que les utilisateurs attendant un colis contrôlent régulièrement l’état de la livraison associée.</span><span class="sxs-lookup"><span data-stu-id="18bbe-168">It's expected that users will frequently check the status of a delivery while they are waiting for their package.</span></span> <span data-ttu-id="18bbe-169">Par conséquent, le service de livraison doit pouvoir compter sur un magasin de données qui mette l’accent sur le débit (en lecture et en écriture) de traitement des données stockées sur le long terme.</span><span class="sxs-lookup"><span data-stu-id="18bbe-169">Therefore, the Delivery service requires a data store that emphasizes throughput (read and write) over long-term storage.</span></span> <span data-ttu-id="18bbe-170">En outre, le service de livraison n’effectue aucune requête ni analyse complexes ; il récupère simplement l’état d’une livraison donnée.</span><span class="sxs-lookup"><span data-stu-id="18bbe-170">Also, the Delivery service does not perform any complex queries or analysis, it simply fetches the latest status for a given delivery.</span></span> <span data-ttu-id="18bbe-171">Son équipe a opté pour le cache Redis Azure pour ses hautes performances de lecture-écriture.</span><span class="sxs-lookup"><span data-stu-id="18bbe-171">The Delivery service team chose Azure Redis Cache for its high read-write performance.</span></span> <span data-ttu-id="18bbe-172">Les données stockées dans Redis présentent une durée de vie relativement courte.</span><span class="sxs-lookup"><span data-stu-id="18bbe-172">The information stored in Redis is relatively short-lived.</span></span> <span data-ttu-id="18bbe-173">Une fois la livraison effectuée, le service d’historique des livraisons constitue le système d’enregistrement.</span><span class="sxs-lookup"><span data-stu-id="18bbe-173">Once a delivery is complete, the Delivery History service is the system of record.</span></span>

### <a name="delivery-history-service"></a><span data-ttu-id="18bbe-174">Service d’historique des livraisons</span><span class="sxs-lookup"><span data-stu-id="18bbe-174">Delivery History service</span></span>

<span data-ttu-id="18bbe-175">Ce service est à l’écoute des événements d’état de livraison du service de livraison.</span><span class="sxs-lookup"><span data-stu-id="18bbe-175">The Delivery History service listens for delivery status events from the Delivery service.</span></span> <span data-ttu-id="18bbe-176">Il stocke ces données dans un système de stockage à long terme.</span><span class="sxs-lookup"><span data-stu-id="18bbe-176">It stores this data in long-term storage.</span></span> <span data-ttu-id="18bbe-177">Il existe deux cas d’utilisation différents pour ces données d’historique, qui présentent des exigences propres en matière de stockage des données.</span><span class="sxs-lookup"><span data-stu-id="18bbe-177">There are two different use-cases for this historical data, which have different data storage requirements.</span></span> 

<span data-ttu-id="18bbe-178">Le premier scénario consiste en l’agrégation des données à des fins d’analyse, dans l’objectif d’optimiser les activités ou d’améliorer la qualité de service.</span><span class="sxs-lookup"><span data-stu-id="18bbe-178">The first scenario is aggregating the data for the purpose of data analytics, in order to optimize the business or improve the quality of the service.</span></span> <span data-ttu-id="18bbe-179">Notez que le service d’historique des données n’effectue pas l’analyse des données en tant que telle.</span><span class="sxs-lookup"><span data-stu-id="18bbe-179">Note that the Delivery History service doesn't perform the actual analysis of the data.</span></span> <span data-ttu-id="18bbe-180">Il est seulement en charge de l’ingestion et du stockage.</span><span class="sxs-lookup"><span data-stu-id="18bbe-180">It's only responsible for the ingestion and storage.</span></span> <span data-ttu-id="18bbe-181">Pour ce scénario, le stockage doit être optimisé pour l’analyse de données sur un grand ensemble de données, à l’aide d’une approche de schéma à la lecture prenant en charge diverses sources de données.</span><span class="sxs-lookup"><span data-stu-id="18bbe-181">For this scenario, the storage must be optimized for data analysis over a large set of data, using a schema-on-read approach to accommodate a variety of data sources.</span></span> <span data-ttu-id="18bbe-182">[Azure Data Lake Store](/azure/data-lake-store/) convient parfaitement pour ce scénario.</span><span class="sxs-lookup"><span data-stu-id="18bbe-182">[Azure Data Lake Store](/azure/data-lake-store/) is a good fit for this scenario.</span></span> <span data-ttu-id="18bbe-183">Azure Data Lake Store est un système de fichiers Apache Hadoop compatible avec Hadoop Distributed File System (HDFS) ; il est parfaitement adapté aux scénarios d’analyse des données.</span><span class="sxs-lookup"><span data-stu-id="18bbe-183">Data Lake Store is an Apache Hadoop file system compatible with Hadoop Distributed File System (HDFS), and is tuned for performance for data analytics scenarios.</span></span> 

<span data-ttu-id="18bbe-184">L’autre scénario permet aux utilisateurs d’effectuer une recherche dans l’historique d’une livraison effectuée.</span><span class="sxs-lookup"><span data-stu-id="18bbe-184">The other scenario is enabling users to look up the history of a delivery after the delivery is completed.</span></span> <span data-ttu-id="18bbe-185">La solution Azure Data Lake n’est pas particulièrement optimisée pour ce scénario.</span><span class="sxs-lookup"><span data-stu-id="18bbe-185">Azure Data Lake is not particularly optimized for this scenario.</span></span> <span data-ttu-id="18bbe-186">Pour des performances optimales, Microsoft recommande de stocker les données de séries chronologiques dans Data Lake, dans des dossiers partitionnés par date.</span><span class="sxs-lookup"><span data-stu-id="18bbe-186">For optimal performance, Microsoft recommends storing time-series data in Data Lake in folders partitioned by date.</span></span> <span data-ttu-id="18bbe-187">(Voir [Paramétrage d’Azure Data Lake Store pour les performances](/azure/data-lake-store/data-lake-store-performance-tuning-guidance)).</span><span class="sxs-lookup"><span data-stu-id="18bbe-187">(See [Tuning Azure Data Lake Store for performance](/azure/data-lake-store/data-lake-store-performance-tuning-guidance)).</span></span> <span data-ttu-id="18bbe-188">Toutefois, cette structure n’est pas optimale pour rechercher des enregistrements individuels par identifiant.</span><span class="sxs-lookup"><span data-stu-id="18bbe-188">However, that structure is not optimal for looking up individual records by ID.</span></span> <span data-ttu-id="18bbe-189">Sauf si vous connaissez également l’horodatage, une recherche par identifiant nécessite d’analyser l’ensemble de la collection.</span><span class="sxs-lookup"><span data-stu-id="18bbe-189">Unless you also know the timestamp, a lookup by ID requires scanning the entire collection.</span></span> <span data-ttu-id="18bbe-190">Par conséquent, le service en charge de l’historique des livraisons stocke également un sous-ensemble des données d’historique dans Cosmos DB, à des fins d’accélération des procédures de recherche.</span><span class="sxs-lookup"><span data-stu-id="18bbe-190">Therefore, the Delivery History service also stores a subset of the historical data in Cosmos DB for quicker lookup.</span></span> <span data-ttu-id="18bbe-191">Il n’est pas nécessaire de conserver indéfiniment les enregistrements dans Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="18bbe-191">The records don't need to stay in Cosmos DB indefinitely.</span></span> <span data-ttu-id="18bbe-192">Les livraisons plus anciennes peuvent être archivées, après un mois par exemple.</span><span class="sxs-lookup"><span data-stu-id="18bbe-192">Older deliveries can be archived &mdash; say, after a month.</span></span> <span data-ttu-id="18bbe-193">Cela peut se faire en exécutant un processus régulier par lot.</span><span class="sxs-lookup"><span data-stu-id="18bbe-193">This could be done by running an occasional batch process.</span></span>

### <a name="package-service"></a><span data-ttu-id="18bbe-194">Service de package</span><span class="sxs-lookup"><span data-stu-id="18bbe-194">Package service</span></span>

<span data-ttu-id="18bbe-195">Le service en charge des packages stocke les informations relatives à tous les packages.</span><span class="sxs-lookup"><span data-stu-id="18bbe-195">The Package service stores information about all of the packages.</span></span> <span data-ttu-id="18bbe-196">Les exigences de stockage du service sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="18bbe-196">The storage requirements for the Package are:</span></span> 

- <span data-ttu-id="18bbe-197">Un stockage à long terme.</span><span class="sxs-lookup"><span data-stu-id="18bbe-197">Long-term storage.</span></span>
- <span data-ttu-id="18bbe-198">Capacité à gérer un volume important de packages, nécessitant un débit élevé en écriture.</span><span class="sxs-lookup"><span data-stu-id="18bbe-198">Able to handle a high volume of packages, requiring high write throughput.</span></span>
- <span data-ttu-id="18bbe-199">Prise en charge de requêtes simples par ID de package.</span><span class="sxs-lookup"><span data-stu-id="18bbe-199">Support simple queries by package ID.</span></span> <span data-ttu-id="18bbe-200">Aucune jointure complexe ni exigence pour l’intégrité référentielle.</span><span class="sxs-lookup"><span data-stu-id="18bbe-200">No complex joins or requirements for referential integrity.</span></span>

<span data-ttu-id="18bbe-201">Les données de package n’étant pas relationnelles, une base de données documentaire est adaptée, tandis que Cosmos DB peut prendre en charge un débit très élevé en valorisant les collections partagées.</span><span class="sxs-lookup"><span data-stu-id="18bbe-201">Because the package data is not relational, a document oriented database is appropriate, and Cosmos DB can achieve very high throughput by using sharded collections.</span></span> <span data-ttu-id="18bbe-202">L’équipe en charge du service Package, qui maîtrise la pile MEAN (MongoDB, Express.js, AngularJS et Node.js), sélectionne l’[API MongoDB](/azure/cosmos-db/mongodb-introduction) pour Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="18bbe-202">The team that works on the Package service is familiar with the MEAN stack (MongoDB, Express.js, AngularJS, and Node.js), so they select the [MongoDB API](/azure/cosmos-db/mongodb-introduction) for Cosmos DB.</span></span> <span data-ttu-id="18bbe-203">Cela lui permet de valoriser son expérience avec MongoDB, tout en profitant des avantages de Cosmos DB, qui est un service géré Azure.</span><span class="sxs-lookup"><span data-stu-id="18bbe-203">That lets them leverage their existing experience with MongoDB, while getting the benefits of Cosmos DB, which is a managed Azure service.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="18bbe-204">Communication entre les services</span><span class="sxs-lookup"><span data-stu-id="18bbe-204">Interservice communication</span></span>](./interservice-communication.md)