---
title: Modèle ambassadeur
titleSuffix: Cloud Design Patterns
description: Créez des services d’assistance qui envoient des requêtes réseau pour le compte d’applications ou d’un service consommateur.
keywords: modèle de conception
author: dragon119
ms.date: 06/23/2017
ms.topic: design-pattern
ms.service: architecture-center
ms.subservice: cloud-fundamentals
ms.custom: seodec18
ms.openlocfilehash: bbf83cdd4bc850c641a0559942f71013e9ce9553
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/23/2019
ms.locfileid: "54486286"
---
# <a name="ambassador-pattern"></a><span data-ttu-id="f52a6-104">Modèle ambassadeur</span><span class="sxs-lookup"><span data-stu-id="f52a6-104">Ambassador pattern</span></span>

<span data-ttu-id="f52a6-105">Créez des services d’assistance qui envoient des requêtes réseau pour le compte d’applications ou d’un service consommateur.</span><span class="sxs-lookup"><span data-stu-id="f52a6-105">Create helper services that send network requests on behalf of a consumer service or application.</span></span> <span data-ttu-id="f52a6-106">Un service Ambassadeur peut être considéré comme un proxy hors processus colocalisé avec le client.</span><span class="sxs-lookup"><span data-stu-id="f52a6-106">An ambassador service can be thought of as an out-of-process proxy that is co-located with the client.</span></span>

<span data-ttu-id="f52a6-107">Ce modèle peut être utile pour décharger des tâches de connectivité client courantes telles que la surveillance, la journalisation, le routage, la sécurité (par exemple, TLS), mais aussi des [modèles de résilience][resiliency-patterns] sans dépendance à un quelconque langage.</span><span class="sxs-lookup"><span data-stu-id="f52a6-107">This pattern can be useful for offloading common client connectivity tasks such as monitoring, logging, routing, security (such as TLS), and [resiliency patterns][resiliency-patterns] in a language agnostic way.</span></span> <span data-ttu-id="f52a6-108">Il est souvent utilisé avec des applications héritées ou d’autres applications qui sont difficiles à modifier afin d’étendre leurs capacités de mise en réseau.</span><span class="sxs-lookup"><span data-stu-id="f52a6-108">It is often used with legacy applications, or other applications that are difficult to modify, in order to extend their networking capabilities.</span></span> <span data-ttu-id="f52a6-109">Il peut également être utilisé par une équipe spécialisée pour implémenter ces fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="f52a6-109">It can also enable a specialized team to implement those features.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="f52a6-110">Contexte et problème</span><span class="sxs-lookup"><span data-stu-id="f52a6-110">Context and problem</span></span>

<span data-ttu-id="f52a6-111">Les applications cloud résilientes nécessitent des fonctionnalités telles que [le disjoncteur](./circuit-breaker.md), le routage, le contrôle et la supervision ainsi que la possibilité d’effectuer des mises à jour de configuration au niveau du réseau.</span><span class="sxs-lookup"><span data-stu-id="f52a6-111">Resilient cloud-based applications require features such as [circuit breaking](./circuit-breaker.md), routing, metering and monitoring, and the ability to make network-related configuration updates.</span></span> <span data-ttu-id="f52a6-112">Il peut être difficile, voire impossible, de mettre à jour les applications héritées ou les bibliothèques de code existantes pour ajouter ces fonctionnalités, car le code n’est pas conservé ou qu’il est difficilement modifiable par l’équipe de développement.</span><span class="sxs-lookup"><span data-stu-id="f52a6-112">It may be difficult or impossible to update legacy applications or existing code libraries to add these features, because the code is no longer maintained or can't be easily modified by the development team.</span></span>

<span data-ttu-id="f52a6-113">Les appels réseau peuvent également nécessiter une configuration importante en matière de connexion, d’authentification et d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="f52a6-113">Network calls may also require substantial configuration for connection, authentication, and authorization.</span></span> <span data-ttu-id="f52a6-114">Si ces appels sont utilisés dans plusieurs applications et générés à l’aide de plusieurs langages et infrastructures, ils doivent être configurés pour chacune de ces instances.</span><span class="sxs-lookup"><span data-stu-id="f52a6-114">If these calls are used across multiple applications, built using multiple languages and frameworks, the calls must be configured for each of these instances.</span></span> <span data-ttu-id="f52a6-115">En outre, il est possible que les fonctionnalités réseau et de sécurité doivent être gérées par une équipe centrale au sein de votre organisation.</span><span class="sxs-lookup"><span data-stu-id="f52a6-115">In addition, network and security functionality may need to be managed by a central team within your organization.</span></span> <span data-ttu-id="f52a6-116">En présence d’une base de code volumineuse, il peut être risqué pour cette équipe de mettre à jour un code d’application qu’elle ne connait pas bien.</span><span class="sxs-lookup"><span data-stu-id="f52a6-116">With a large code base, it can be risky for that team to update application code they aren't familiar with.</span></span>

## <a name="solution"></a><span data-ttu-id="f52a6-117">Solution</span><span class="sxs-lookup"><span data-stu-id="f52a6-117">Solution</span></span>

<span data-ttu-id="f52a6-118">Placez les bibliothèques et les infrastructures client dans un processus externe qui agit comme un proxy entre votre application et les services externes.</span><span class="sxs-lookup"><span data-stu-id="f52a6-118">Put client frameworks and libraries into an external process that acts as a proxy between your application and external services.</span></span> <span data-ttu-id="f52a6-119">Déployez le proxy dans le même environnement d’hôte que votre application pour pouvoir contrôler les fonctionnalités de routage, de résilience et de sécurité, et éviter toute restriction d’accès liée à l’hôte.</span><span class="sxs-lookup"><span data-stu-id="f52a6-119">Deploy the proxy on the same host environment as your application to allow control over routing, resiliency, security features, and to avoid any host-related access restrictions.</span></span> <span data-ttu-id="f52a6-120">Vous pouvez également utiliser le modèle ambassadeur pour normaliser et étendre l’instrumentation.</span><span class="sxs-lookup"><span data-stu-id="f52a6-120">You can also use the ambassador pattern to standardize and extend instrumentation.</span></span> <span data-ttu-id="f52a6-121">Le proxy peut analyser les indicateurs de performance tels que la latence ou l’utilisation des ressources, et ce dans le même environnement que celui de l’application.</span><span class="sxs-lookup"><span data-stu-id="f52a6-121">The proxy can monitor performance metrics such as latency or resource usage, and this monitoring happens in the same host environment as the application.</span></span>

![Diagramme du modèle Ambassadeur](./_images/ambassador.png)

<span data-ttu-id="f52a6-123">Les fonctionnalités qui sont déchargées vers l’ambassadeur peuvent être gérées indépendamment de l’application.</span><span class="sxs-lookup"><span data-stu-id="f52a6-123">Features that are offloaded to the ambassador can be managed independently of the application.</span></span> <span data-ttu-id="f52a6-124">Vous pouvez mettre à jour et modifier l’ambassadeur sans que cela n’ait d’incidence sur les fonctionnalités héritées de l’application.</span><span class="sxs-lookup"><span data-stu-id="f52a6-124">You can update and modify the ambassador without disturbing the application's legacy functionality.</span></span> <span data-ttu-id="f52a6-125">Les différentes équipes spécialisées peuvent également implémenter et gérer les fonctionnalités de sécurité, de mise en réseau ou d’authentification qui ont été déplacées vers l’ambassadeur.</span><span class="sxs-lookup"><span data-stu-id="f52a6-125">It also allows for separate, specialized teams to implement and maintain security, networking, or authentication features that have been moved to the ambassador.</span></span>

<span data-ttu-id="f52a6-126">Les services Ambassadeur peuvent être déployés en tant que [side-car](./sidecar.md) pour accompagner le cycle de vie d’une application ou d’un service consommateur.</span><span class="sxs-lookup"><span data-stu-id="f52a6-126">Ambassador services can be deployed as a [sidecar](./sidecar.md) to accompany the lifecycle of a consuming application or service.</span></span> <span data-ttu-id="f52a6-127">Si un ambassadeur est partagé par plusieurs processus distincts sur un ordinateur hôte commun, vous pouvez aussi le déployer en tant que démon ou service Windows.</span><span class="sxs-lookup"><span data-stu-id="f52a6-127">Alternatively, if an ambassador is shared by multiple separate processes on a common host, it can be deployed as a daemon or Windows service.</span></span> <span data-ttu-id="f52a6-128">Si le service consommateur est exécuté en conteneur, l’ambassadeur doit être créé en tant que conteneur distinct sur le même ordinateur hôte et les liaisons appropriées doivent être configurées pour établir la communication entre les deux instances.</span><span class="sxs-lookup"><span data-stu-id="f52a6-128">If the consuming service is containerized, the ambassador should be created as a separate container on the same host, with the appropriate links configured for communication.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="f52a6-129">Problèmes et considérations</span><span class="sxs-lookup"><span data-stu-id="f52a6-129">Issues and considerations</span></span>

- <span data-ttu-id="f52a6-130">Le proxy provoque une augmentation de la latence.</span><span class="sxs-lookup"><span data-stu-id="f52a6-130">The proxy adds some latency overhead.</span></span> <span data-ttu-id="f52a6-131">Demandez-vous si une bibliothèque cliente, appelée directement par l’application, pourrait être une meilleure approche.</span><span class="sxs-lookup"><span data-stu-id="f52a6-131">Consider whether a client library, invoked directly by the application, is a better approach.</span></span>
- <span data-ttu-id="f52a6-132">Demandez-vous quel impact pourrait avoir l’intégration de fonctionnalités généralisées au proxy.</span><span class="sxs-lookup"><span data-stu-id="f52a6-132">Consider the possible impact of including generalized features in the proxy.</span></span> <span data-ttu-id="f52a6-133">L’ambassadeur pourrait par exemple gérer de nouvelles tentatives, mais cela pourrait s’avérer risqué, sauf si toutes les opérations sont idempotentes.</span><span class="sxs-lookup"><span data-stu-id="f52a6-133">For example, the ambassador could handle retries, but that might not be safe unless all operations are idempotent.</span></span>
- <span data-ttu-id="f52a6-134">Envisagez de déployer un mécanisme qui permettrait au client de transférer du contexte au proxy, et inversement.</span><span class="sxs-lookup"><span data-stu-id="f52a6-134">Consider a mechanism to allow the client to pass some context to the proxy, as well as back to the client.</span></span> <span data-ttu-id="f52a6-135">Par exemple, ajoutez des en-têtes de requête HTTP pour refuser de nouvelles tentatives ou spécifiez le nombre maximal de tentatives autorisées.</span><span class="sxs-lookup"><span data-stu-id="f52a6-135">For example, include HTTP request headers to opt out of retry or specify the maximum number of times to retry.</span></span>
- <span data-ttu-id="f52a6-136">Déterminez de quelle manière vous allez empaqueter et déployer le proxy.</span><span class="sxs-lookup"><span data-stu-id="f52a6-136">Consider how you will package and deploy the proxy.</span></span>
- <span data-ttu-id="f52a6-137">Choisissez d’utiliser une instance partagée unique pour tous les clients ou une instance pour chaque client.</span><span class="sxs-lookup"><span data-stu-id="f52a6-137">Consider whether to use a single shared instance for all clients or an instance for each client.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="f52a6-138">Quand utiliser ce modèle</span><span class="sxs-lookup"><span data-stu-id="f52a6-138">When to use this pattern</span></span>

<span data-ttu-id="f52a6-139">Utilisez ce modèle dans les situations suivantes :</span><span class="sxs-lookup"><span data-stu-id="f52a6-139">Use this pattern when you:</span></span>

- <span data-ttu-id="f52a6-140">Vous devez générer un ensemble commun de fonctionnalités de connectivité client pour plusieurs langages ou infrastructures.</span><span class="sxs-lookup"><span data-stu-id="f52a6-140">Need to build a common set of client connectivity features for multiple languages or frameworks.</span></span>
- <span data-ttu-id="f52a6-141">Vous devez décharger des problèmes de connectivité client transversaux vers les développeurs d’infrastructure ou d’autres équipes plus spécialisées.</span><span class="sxs-lookup"><span data-stu-id="f52a6-141">Need to offload cross-cutting client connectivity concerns to infrastructure developers or other more specialized teams.</span></span>
- <span data-ttu-id="f52a6-142">Vous devez répondre à des exigences de connectivité cloud ou de cluster dans une application héritée ou une application qui est difficile à modifier.</span><span class="sxs-lookup"><span data-stu-id="f52a6-142">Need to support cloud or cluster connectivity requirements in a legacy application or an application that is difficult to modify.</span></span>

<span data-ttu-id="f52a6-143">Ce modèle peut ne pas convenir :</span><span class="sxs-lookup"><span data-stu-id="f52a6-143">This pattern may not be suitable:</span></span>

- <span data-ttu-id="f52a6-144">Lorsque la latence des requêtes réseau est critique.</span><span class="sxs-lookup"><span data-stu-id="f52a6-144">When network request latency is critical.</span></span> <span data-ttu-id="f52a6-145">Un proxy introduira un surcroît de latence qui, bien que minimal, pourrait dans certains cas affecter l’application.</span><span class="sxs-lookup"><span data-stu-id="f52a6-145">A proxy will introduce some overhead, although minimal, and in some cases this may affect the application.</span></span>
- <span data-ttu-id="f52a6-146">Lorsque les fonctionnalités de connectivité client sont consommées par un seul langage.</span><span class="sxs-lookup"><span data-stu-id="f52a6-146">When client connectivity features are consumed by a single language.</span></span> <span data-ttu-id="f52a6-147">Dans ce cas, il peut être plus judicieux d’utiliser une bibliothèque cliente qui est distribuée aux équipes de développement sous la forme d’un package.</span><span class="sxs-lookup"><span data-stu-id="f52a6-147">In that case, a better option might be a client library that is distributed to the development teams as a package.</span></span>
- <span data-ttu-id="f52a6-148">Lorsque les fonctionnalités de connectivité ne peuvent pas être généralisées et nécessitent une intégration plus étroite avec l’application cliente.</span><span class="sxs-lookup"><span data-stu-id="f52a6-148">When connectivity features cannot be generalized and require deeper integration with the client application.</span></span>

## <a name="example"></a><span data-ttu-id="f52a6-149">Exemples</span><span class="sxs-lookup"><span data-stu-id="f52a6-149">Example</span></span>

<span data-ttu-id="f52a6-150">Le diagramme suivant illustre une application envoyant une requête à un service distant via un proxy Ambassadeur.</span><span class="sxs-lookup"><span data-stu-id="f52a6-150">The following diagram shows an application making a request to a remote service via an ambassador proxy.</span></span> <span data-ttu-id="f52a6-151">L’ambassadeur assure le routage, la rupture de circuit et la journalisation.</span><span class="sxs-lookup"><span data-stu-id="f52a6-151">The ambassador provides routing, circuit breaking, and logging.</span></span> <span data-ttu-id="f52a6-152">Il appelle le service distant, puis renvoie la réponse à l’application cliente :</span><span class="sxs-lookup"><span data-stu-id="f52a6-152">It calls the remote service and then returns the response to the client application:</span></span>

![Exemple du modèle Ambassadeur](./_images/ambassador-example.png)

## <a name="related-guidance"></a><span data-ttu-id="f52a6-154">Aide connexe</span><span class="sxs-lookup"><span data-stu-id="f52a6-154">Related guidance</span></span>

- [<span data-ttu-id="f52a6-155">Modèle side-car</span><span class="sxs-lookup"><span data-stu-id="f52a6-155">Sidecar pattern</span></span>](./sidecar.md)

<!-- links -->

[resiliency-patterns]: ./category/resiliency.md
