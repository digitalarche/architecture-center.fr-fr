---
title: Liste de contrôle de disponibilité
titleSuffix: Azure Design Review Framework
description: Liste de contrôle fournissant des indications relatives aux problématiques de disponibilité durant la conception.
author: dragon119
ms.date: 11/26/2018
ms.custom: checklist
ms.openlocfilehash: 37e61b35d73007b9bac1ebaecfbf42792ae3903b
ms.sourcegitcommit: 4ba3304eebaa8c493c3e5307bdd9d723cd90b655
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/12/2018
ms.locfileid: "53307229"
---
# <a name="availability-checklist"></a>Liste de contrôle de disponibilité

La disponibilité est la proportion de temps pendant laquelle un système est fonctionnel ; elle est l’un des [piliers de la qualité logicielle](../guide/pillars.md). Utilisez cette liste de vérification pour passer en revue l’architecture de votre application en termes de disponibilité.

## <a name="application-design"></a>Conception des applications

**Évitez tout point de défaillance.**  L’ensemble des instances de composants, de services, de ressources et de calcul doivent être déployées en tant qu’instances multiples afin d’empêcher qu’un point de défaillance unique affecte la disponibilité du système. Cela concerne les mécanismes d’authentification. Concevez l’application afin qu’elle puisse être configurable pour l’utilisation de plusieurs instances et pour la détection automatique des défaillances, ainsi que pour la redirection des requêtes vers les instances non défaillantes dans les situations où la plateforme n’effectue pas automatiquement cette action.

**Décomposez les charges de travail par objectif de niveau de service.**  Si un service est composé de charges de travail critiques et moins critiques, gérez-les de manière distincte et définissez les fonctions de service et le nombre d’instances nécessaires à la satisfaction de leurs exigences de disponibilité.

**Réduisez et comprenez les dépendances de services.**  Dans la mesure du possible, réduisez le nombre de services utilisés et assurez-vous de comprendre l’ensemble des dépendances de fonctions et de services existant dans le système. Il s’agit notamment de la nature de ces dépendances et de l’incidence des défaillances ou de la réduction des performances respectives dans l’application.

**Concevez des tâches et des messages pour qu’ils soient idempotents lorsque cela est possible**. Une opération est idempotente si elle peut être répétée plusieurs fois et produire le même résultat. L’idempotence peut garantir que les demandes dupliquées ne provoquent pas de problèmes. Les consommateurs de messages et les opérations qu’ils exécutent doivent être idempotents, de manière que la réitération d’une opération exécutée auparavant n’invalide pas les résultats. Cela peut impliquer la détection des messages dupliqués ou la garantie de la cohérence à l’aide d’une approche optimiste de traitement des conflits.

**Utilisez un Service Broker de message qui implémente une haute disponibilité pour les transactions critiques.** De nombreuses applications cloud utilisent la messagerie pour initier des tâches qui sont exécutées de façon asynchrone. Pour garantir la remise des messages, le système de messagerie doit proposer une haute disponibilité. La [messagerie Azure Service Bus](/azure/service-bus-messaging) implémente la sémantique *au moins une fois*. De cette façon, un message publié sur une file d’attente n’est pas perdu, même si des copies dupliquées peuvent être transmises dans certains cas. Si le traitement des messages est idempotent (voir le point précédent), la remise répétée ne posera pas de problèmes.

**Concevez des applications pour appliquer une dégradation normale.** La charge sur une application peut dépasser la capacité d’une ou de plusieurs portions, ce qui entraîne une réduction de la disponibilité et la mise en échec des connexions. La mise à l’échelle peut aider à pallier ces problématiques, mais vous pouvez vous heurter à des restrictions de disponibilité de ressources ou de coûts. Lorsqu’une application atteint une limite de ressource, elle doit agir en conséquence pour minimiser l’impact de l’utilisateur. Par exemple, dans un système d’e-commerce, si le sous-système de traitement des commandes est sous contrainte ou échoue, vous pouvez le désactiver temporairement, tout en permettant l’exécution d’une autre fonctionnalité telle que la consultation du catalogue de produits. Il peut être utile de reporter les requêtes dirigées vers un sous-système défaillant. Par exemple, vous pouvez permettre aux clients de soumettre des commandes et enregistrer ces dernières en vue de les traiter quand le sous-système est de nouveau disponible.

**Traitez de manière appropriée les événements de rafales rapides.** La plupart des applications doivent gérer des charges de travail variables au fil du temps. La mise à l’échelle automatique peut aider à traiter la charge, mais la mise en ligne des instances supplémentaires dédiées au traitement des requêtes peut prendre un certain temps. Empêchez les rafales soudaines et imprévues d’activité de surcharger l’application. Concevez l’application de sorte que les requêtes soient mises en file d’attente dans les services qu’elle utilise et qu’elle se dégrade de manière appropriée quand la capacité maximale des files d’attente est proche d’être atteinte. Veillez à conserver des niveaux appropriés de performances et de capacité dans des conditions normales, afin de traiter efficacement les files et de gérer les requêtes en attente. Pour plus d’informations, consultez [Modèle de nivellement de charge basé sur une file d’attente](../patterns/queue-based-load-leveling.md).

## <a name="deployment-and-maintenance"></a>Déploiement et maintenance

**Déployez plusieurs instances des services.** Si votre application repose sur une seule instance unique d’un service, cela crée un point de défaillance unique. L’approvisionnement de plusieurs instances améliore à la fois la résilience et l’extensibilité. Pour [Azure App Service](/azure/app-service/app-service-value-prop-what-is/), sélectionnez un [plan App Service](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/) qui offre plusieurs instances. Pour les Azure Cloud Services, configurez chacun de vos rôles de manière à utiliser [plusieurs instances](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management). Pour [Machines virtuelles Azure](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), assurez-vous que votre architecture de machine virtuelle inclut plusieurs machines virtuelles et que chaque machine virtuelle est incluse dans un [groupe à haute disponibilité][availability-sets].

**Envisagez de déployer votre application dans plusieurs régions.** Si votre application est déployée dans une seule région, si la région entière devient indisponible (éventualité hautement improbable), votre application sera elle aussi indisponible. Il se peut que cette situation soit inacceptable au regard des conditions du SLA de votre application. Si c’est le cas, envisagez de déployer votre application et ses services dans plusieurs régions.

**Automatisez et testez les tâches de déploiement et de maintenance.** Les applications distribuées se composent de plusieurs parties qui doivent fonctionner ensemble. Le déploiement doit être automatisé à l’aide de mécanismes testés et éprouvés, comme des scripts. Ces mécanismes permettent de mettre à jour et de valider la configuration, ainsi que d’automatiser le processus de déploiement. Utilisez les [modèles Azure Resource Manager](/azure/azure-resource-manager/resource-group-authoring-templates) pour approvisionner des ressources Azure. Utilisez aussi des techniques automatisées pour effectuer des mises à jour sur l’application. Il est essentiel de tester intégralement l’ensemble de ces processus, afin de garantir que les erreurs ne provoquent pas de temps d’arrêt supplémentaires. L’ensemble des outils de déploiement doivent présenter des restrictions appropriées de sécurité afin de protéger l’application déployée. Définissez et appliquez avec rigueur les stratégies de déploiement et réduisez le recours à l’intervention humaine.

**Utilisez les fonctionnalités de mise en lots et de production de la plateforme.**. Par exemple, Azure App Service prend en charge [les emplacements de déploiement](/azure/app-service/web-sites-staged-publishing), que vous pouvez utiliser pour mettre en lots un déploiement avant de le basculer en production. Azure Service Fabric prend en charge les [mises à niveau propagées](/azure/service-fabric/service-fabric-application-upgrade) aux services d’application.

**Placez les machines virtuelles dans un groupe à haute disponibilité.** Pour optimiser la disponibilité, créez plusieurs instances de chaque rôle de machine virtuelle et placez ces instances dans le même groupe à haute disponibilité. Si vous avez plusieurs machines virtuelles qui servent différents rôles, tels que plusieurs niveaux d’application, créez un groupe à haute disponibilité pour chaque rôle de machine virtuelle. Par exemple, créez un groupe à haute disponibilité pour la couche web et un autre pour la couche Données.

**Répliquez les machines virtuelles à l’aide d’Azure Site Recovery.** Pour optimiser la disponibilité, répliquez toutes vos machines virtuelles dans une autre région Azure avec [Site Recovery][site-recovery]. Vérifiez que toutes les machines virtuelles de toutes les couches de votre application sont répliquées. S’il y a une interruption dans la région source, vous pouvez basculer les machines virtuelles dans l’autre région en quelques minutes.

## <a name="data-management"></a>Gestion des données

**Géorépliquez les données du service Stockage Azure**. Les données du service Stockage Azure sont automatiquement répliquées dans un centre de données. Pour accroître encore davantage la disponibilité, utilisez un stockage géoredondant avec accès en lecture (RAGRS) qui réplique vos données dans une région secondaire et offre un accès en lecture seule aux données à l’emplacement secondaire. Les données sont durables, même en cas de panne régionale totale ou de situation d’urgence. Pour plus d’informations, consultez l’article [Réplication de Stockage Azure](/azure/storage/storage-redundancy).

**Géorépliquez les bases de données**. Azure SQL Database et Cosmos DB prennent tous deux en charge la géoréplication, ce qui vous permet de configurer des réplicas des bases de données secondaires dans d’autres régions. Les bases de données secondaires sont disponibles pour l’interrogation et le basculement en cas d’indisponibilité d’un centre de données ou l’incapacité à se connecter à la base de données primaire. Pour plus d’informations, consultez les articles [Vue d’ensemble : groupes de basculement et géo-réplication active](/azure/sql-database/sql-database-geo-replication-overview) (SQL Database) et [Comment distribuer des données mondialement avec Azure Cosmos DB](/azure/cosmos-db/distribute-data-globally).

**Utilisez l’accès concurrentiel optimiste et la cohérence éventuelle**. Les transactions qui bloquent l’accès aux ressources au moyen du verrouillage (accès concurrentiel optimiste) peuvent réduire sensiblement les performances et la disponibilité. Ces problèmes peuvent se révéler particulièrement sérieux au sein des systèmes distribués. Dans de nombreux cas, une conception et des techniques étudiées, comme le partitionnement, permettent de réduire la probabilité de conflits entre les mises à jour. Quand les données sont répliquées ou lues à partir d’un magasin mis à jour séparément, seule la cohérence des données est assurée. Toutefois, les avantages compensent largement la perte de disponibilité causée par l’utilisation de transactions pour garantir la cohérence immédiate.

**Utilisez la sauvegarde périodique et la limite de restauration dans le temps**. Sauvegardez de manière régulière et automatique les données qui ne sont conservées à aucun emplacement et vérifiez que vous pouvez récupérer les données et l’application en cas de défaillance. Assurez-vous que les sauvegardes respectent votre objectif de point de récupération. La réplication des données n’est pas une fonctionnalité de sauvegarde, car des erreurs humaines ou des opérations nuisibles peuvent endommager les données sur tous les réplicas. Le processus de sauvegarde doit être sécurisé afin de protéger les données stockées et en transit. Les bases de données ou portions de magasins de données peuvent habituellement être récupérées à un point dans le temps, à l’aide de journaux de transactions. Pour plus d’informations, consultez [Guide technique de la résilience Azure : récupération suite à une altération de données ou à une suppression accidentelle](../resiliency/recovery-data-corruption.md)

**Répliquez des disques de machine virtuelle à l’aide d’Azure Site Recovery.** Quand vous répliquez des machines virtuelles Azure à l’aide de [Site Recovery][site-recovery], tous les disques de machine virtuelle sont répliqués en continu sur la région cible en mode asynchrone. Les points de récupération sont créés à intervalle de quelques minutes. Cela vous donne un RPO de l’ordre de quelques minutes.

## <a name="errors-and-failures"></a>Erreurs et défaillances

**Configurez les délais d’expiration des requêtes.**  Les services et les ressources peuvent devenir indisponibles, ce qui provoque l’échec des requêtes. Assurez-vous que les délais d’expiration que vous appliquez sont adaptés à chaque service ou ressource, ainsi qu’au client qui y accède. Dans certains cas, vous pouvez prévoir un délai d’expiration plus long pour une instance de client donnée, selon le contexte et les autres actions que le client effectue. Les délais d’expiration très courts peuvent entraîner un nombre excessif de tentatives pour les services et les ressources ayant une latence importante. Les délais d’expiration très longs peuvent entraîner un blocage si de nombreuses requêtes sont placées en file d’attente, dans l’attente de la réponse d’un service ou d’une ressource.

**Réessayez les opérations mises en échec par des erreurs temporaires.**  Concevez une stratégie de nouvelle tentative permettant d’accéder à l’ensemble des services et des ressources lorsque les tentatives de nouvelle connexion automatiques ne sont pas prises en charge par héritage. Valorisez une stratégie prévoyant un délai croissant entre les tentatives à mesure que le nombre de défaillances augmente, ceci pour éviter de surcharger la ressource, qui est alors en mesure de récupérer et traiter les requêtes mises en attente de manière appropriée. Les tentatives répétées dans des délais très courts auront probablement pour effet d’aggraver le problème. Pour plus d’informations, consultez [Guide du mécanisme de nouvelle tentative relatif aux différents services](../best-practices/retry-service-specific.md).

**Implémentez le disjoncteur pour éviter des défaillances en cascade.** Il peut arriver que des erreurs temporaires ou autres, allant d’une perte partielle de connectivité à la défaillance intégrale d’un service, nécessitent un délai de retour à la normale plus long que prévu. Si un service est très occupé, une défaillance dans une portion du système peut générer des défaillances en cascade et conduire au blocage de différentes opérations lors de l’utilisation de ressources critiques du système comme la mémoire, les threads et les connexions de bases de données. Au lieu de tenter à nouveau de relancer une opération qui ne va vraisemblablement pas réussir, l’application doit rapidement accepter que l’opération a été mise en échec et traiter de manière appropriée cette défaillance. Utilisez le modèle Disjoncteur pour rejeter les requêtes liées à des opérations spécifiques sur des périodes définies. Pour plus d’informations, consultez [Modèle Disjoncteur](../patterns/circuit-breaker.md).

**Composez ou revenez à plusieurs composants.** Concevez des applications pour utiliser plusieurs instances sans affecter les opérations ou les connexions existantes, dans la mesure du possible. Utilisez plusieurs instances et distribuez les requêtes entre elles, détectez les instances défaillantes et évitez de leur envoyer des requêtes, afin d’optimiser la disponibilité.

**Revenez à un service ou flux de travail différent.** Par exemple, si l’écriture dans SQL Database échoue, stockez temporairement les données dans le stockage blob ou Cache Redis. Fournissez à SQL Database une fonctionnalité permettant de relire les écritures quand le service redevient disponible. Dans certains cas, une opération mise en échec peut présenter une action alternative qui permet à l’application de continuer à fonctionner même quand un composant ou un service est défaillant. Si possible, détectez les défaillances et redirigez les requêtes vers d’autres services offrant une fonctionnalité appropriée, ou bien vers une fonctionnalité de sauvegarde ou des instances de fonctionnalités réduites pouvant maintenir les opérations principales pendant que le service principal est hors connexion.

## <a name="monitoring-and-disaster-recovery"></a>Surveillance et récupération d’urgence

**Proposez des instruments avancés dédiés aux défaillances courantes et aux événements de défaillance** afin de communiquer la situation au personnel en charge des opérations. Pour les défaillances qui ne sont probablement pas encore survenues, fournissez un volume suffisant de données afin de donner les moyens au personnel en charge des opérations d’identifier la cause, d’atténuer la situation et de garantir la disponibilité du système. Pour les défaillances qui se sont déjà produites, l’application doit renvoyer un message d’erreur approprié à l’utilisateur tout en essayant de continuer à s’exécuter, avec une fonctionnalité réduite. Dans tous les cas, le système de surveillance doit collecter des détails complets mis à profit par le personnel des opérations pour pratiquer une récupération rapide, et si nécessaire par les concepteurs et les développeurs pour modifier le système afin de prévenir toute nouvelle situation de ce type.

**Surveillez l’intégrité du système en implémentant des fonctions de contrôle.**  L’intégrité et les performances d’une application peuvent se dégrader au fil du temps, sans qu’aucun signe avant-coureur n’apparaisse avant la défaillance. Implémentez des sondes ou des fonctions de contrôle qui sont exécutées régulièrement à l’extérieur de l’application. Il peut s’agir d’une mesure simple du temps de réponse de l’application en tant qu’entité, de portions de l’application, des services utilisés par l’application ou de composants individuels. Les fonctions de contrôle peuvent exécuter des processus garantissant la validité des résultats produits, mesurer la latence, surveiller la disponibilité et extraire les informations du système.

**Testez régulièrement tous les systèmes de secours et basculement.** Les modifications apportées aux systèmes et aux opérations peuvent affecter les fonctions de basculement et de secours, mais les conséquences peuvent ne pas être détectées avant la défaillance ou la surcharge du système. Faites des tests avant d’avoir recours aux systèmes pour pallier un problème au moment de l’exécution. Si vous utilisez [Azure Site Recovery][site-recovery] pour répliquer des machines virtuelles, exécutez périodiquement des exercices de reprise d’activité après sinistre en effectuant un basculement de test. Pour plus d’informations, consultez [Effectuer un exercice de reprise d’activité sur Azure][site-recovery-test].

**Testez les systèmes de surveillance.**  Les systèmes automatisés de basculement et de secours, et la visualisation manuelle de l’intégrité et des performances du système à l’aide de tableaux de bord sont tributaires du bon fonctionnement des systèmes et des instruments de surveillance. Si ces éléments subissent des défaillances, laissent échapper des informations critiques ou signalent des données inexactes, l’opérateur peut ne pas avoir connaissance du défaut d’intégrité ou de la défaillance du système.

**Suivez la progression des longs flux de travail et réessayez en cas d’échec.** Les longs workflows sont souvent composés de plusieurs étapes. Veillez à ce que chaque étape soit indépendante et puisse être recommencée individuellement afin d’éviter la restauration de l’intégralité du workflow ou l’exécution de plusieurs transactions de compensation. Surveillez et gérez la progression des longs workflows en implémentant un modèle comme [Modèle de superviseur de l’agent du planificateur](../patterns/scheduler-agent-supervisor.md).

**Plan de récupération d’urgence.** Créez un plan de récupération accepté et entièrement testé pour faire face à tout type de défaillance susceptible d’affecter la disponibilité du système. Choisissez une architecture de récupération d’urgence multisite pour toutes les applications stratégiques. Identifiez un propriétaire spécifique du plan de récupération d’urgence, incluant des phases d’automatisation et de test. Assurez-vous que le plan est suffisamment documenté et automatisez le processus autant que possible. Établissez une stratégie de sauvegarde pour toutes les données de référence et transactionnelles, et testez régulièrement la restauration de ces sauvegardes. Formez l’équipe des opérations à l’exécution du plan et effectuez des simulations d’urgence régulières pour valider et améliorer le plan. Si vous utilisez [Azure Site Recovery][site-recovery] pour répliquer des machines virtuelles, créez un plan de récupération entièrement automatisé pour basculer l’application entière en quelques minutes.

<!-- links -->
[availability-sets]:/azure/virtual-machines/virtual-machines-windows-manage-availability/
[site-recovery]: /azure/site-recovery/
[site-recovery-test]: /azure/site-recovery/site-recovery-test-failover-to-azure
