---
title: Exécuter des machines virtuelles Linux dans plusieurs régions à des fins de haute disponibilité
description: Découvrez comment déployer des machines virtuelles dans plusieurs régions Azure à des fins de haute disponibilité et de résilience.
author: MikeWasson
ms.date: 11/22/2016
pnp.series.title: Linux VM workloads
pnp.series.prev: n-tier
ms.openlocfilehash: 07ccf44f28203e6d5001475b47adce01437e9600
ms.sourcegitcommit: c441fd165e6bebbbbbc19854ec6f3676be9c3b25
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/30/2018
---
# <a name="run-linux-vms-in-multiple-regions-for-high-availability"></a><span data-ttu-id="c0f80-103">Exécuter des machines virtuelles Linux dans plusieurs régions à des fins de haute disponibilité</span><span class="sxs-lookup"><span data-stu-id="c0f80-103">Run Linux VMs in multiple regions for high availability</span></span>

<span data-ttu-id="c0f80-104">Cette architecture de référence présente un ensemble de pratiques éprouvées pour l’exécution d’une application multiniveau dans plusieurs régions Azure, afin de bénéficier d’une haute disponibilité et d’une infrastructure de récupération d’urgence fiable.</span><span class="sxs-lookup"><span data-stu-id="c0f80-104">This reference architecture shows a set of proven practices for running an N-tier application in multiple Azure regions, in order to achieve availability and a robust disaster recovery infrastructure.</span></span> 

<span data-ttu-id="c0f80-105">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="c0f80-105">![[0]][0]</span></span>

<span data-ttu-id="c0f80-106">*Téléchargez un [fichier Visio][visio-download] de cette architecture.*</span><span class="sxs-lookup"><span data-stu-id="c0f80-106">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="c0f80-107">Architecture</span><span class="sxs-lookup"><span data-stu-id="c0f80-107">Architecture</span></span> 

<span data-ttu-id="c0f80-108">Cette architecture repose sur celle décrite dans l’article [Exécuter des machines virtuelles Linux pour une application multiniveau](n-tier.md).</span><span class="sxs-lookup"><span data-stu-id="c0f80-108">This architecture builds on the one shown in [Run Linux VMs for an N-tier application](n-tier.md).</span></span> 

* <span data-ttu-id="c0f80-109">**Régions primaires et secondaires**.</span><span class="sxs-lookup"><span data-stu-id="c0f80-109">**Primary and secondary regions**.</span></span> <span data-ttu-id="c0f80-110">Pour obtenir une plus haute disponibilité, utilisez deux régions.</span><span class="sxs-lookup"><span data-stu-id="c0f80-110">Use two regions to achieve higher availability.</span></span> <span data-ttu-id="c0f80-111">L’une est la région primaire, tandis que l’autre sert au basculement.</span><span class="sxs-lookup"><span data-stu-id="c0f80-111">One is the primary region.The other region is for failover.</span></span>
* <span data-ttu-id="c0f80-112">**Azure DNS**.</span><span class="sxs-lookup"><span data-stu-id="c0f80-112">**Azure DNS**.</span></span> <span data-ttu-id="c0f80-113">[Azure DNS][azure-dns] est un service d’hébergement pour les domaines DNS qui offre une résolution de noms à l’aide de l’infrastructure Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="c0f80-113">[Azure DNS][azure-dns] is a hosting service for DNS domains, providing name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="c0f80-114">En hébergeant vos domaines dans Azure, vous pouvez gérer vos enregistrements DNS avec les mêmes informations d’identification, les mêmes API, les mêmes outils et la même facturation que vos autres services Azure.</span><span class="sxs-lookup"><span data-stu-id="c0f80-114">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>
* <span data-ttu-id="c0f80-115">**Azure Traffic Manager**.</span><span class="sxs-lookup"><span data-stu-id="c0f80-115">**Azure Traffic Manager**.</span></span> <span data-ttu-id="c0f80-116">[Traffic Manager][traffic-manager] achemine les requêtes entrantes vers l’une des régions.</span><span class="sxs-lookup"><span data-stu-id="c0f80-116">[Traffic Manager][traffic-manager] routes incoming requests to one of the regions.</span></span> <span data-ttu-id="c0f80-117">Pendant le fonctionnement normal, il achemine les requêtes vers la région primaire.</span><span class="sxs-lookup"><span data-stu-id="c0f80-117">During normal operations, it routes requests to the primary region.</span></span> <span data-ttu-id="c0f80-118">Si cette région n’est plus disponible, Traffic Manager bascule vers la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="c0f80-118">If that region becomes unavailable, Traffic Manager fails over to the secondary region.</span></span> <span data-ttu-id="c0f80-119">Pour plus d’informations, consultez la section [Configuration de Traffic Manager](#traffic-manager-configuration).</span><span class="sxs-lookup"><span data-stu-id="c0f80-119">For more information, see the section [Traffic Manager configuration](#traffic-manager-configuration).</span></span>
* <span data-ttu-id="c0f80-120">**Groupes de ressources**.</span><span class="sxs-lookup"><span data-stu-id="c0f80-120">**Resource groups**.</span></span> <span data-ttu-id="c0f80-121">Créez des [groupes de ressources][resource groups] distincts pour la région primaire, la région secondaire et Traffic Manager.</span><span class="sxs-lookup"><span data-stu-id="c0f80-121">Create separate [resource groups][resource groups] for the primary region, the secondary region, and for Traffic Manager.</span></span> <span data-ttu-id="c0f80-122">Vous obtenez ainsi la flexibilité nécessaire pour gérer chaque région comme une collection de ressources unique.</span><span class="sxs-lookup"><span data-stu-id="c0f80-122">This gives you the flexibility to manage each region as a single collection of resources.</span></span> <span data-ttu-id="c0f80-123">Par exemple, vous pourriez redéployer une région sans arrêter l’autre.</span><span class="sxs-lookup"><span data-stu-id="c0f80-123">For example, you could redeploy one region, without taking down the other one.</span></span> <span data-ttu-id="c0f80-124">[Liez les groupes de ressources][resource-group-links] afin de pouvoir exécuter une requête pour répertorier toutes les ressources de l’application.</span><span class="sxs-lookup"><span data-stu-id="c0f80-124">[Link the resource groups][resource-group-links], so that you can run a query to list all the resources for the application.</span></span>
* <span data-ttu-id="c0f80-125">**Réseaux virtuels**.</span><span class="sxs-lookup"><span data-stu-id="c0f80-125">**VNets**.</span></span> <span data-ttu-id="c0f80-126">Créez un réseau virtuel distinct pour chaque région.</span><span class="sxs-lookup"><span data-stu-id="c0f80-126">Create a separate VNet for each region.</span></span> <span data-ttu-id="c0f80-127">Vérifiez que les espaces d’adressage ne se chevauchent pas.</span><span class="sxs-lookup"><span data-stu-id="c0f80-127">Make sure the address spaces do not overlap.</span></span>
* <span data-ttu-id="c0f80-128">**Apache Cassandra**.</span><span class="sxs-lookup"><span data-stu-id="c0f80-128">**Apache Cassandra**.</span></span> <span data-ttu-id="c0f80-129">Déployez Cassandra dans des centres de données dans plusieurs régions Azure pour bénéficier d’une haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="c0f80-129">Deploy Cassandra in data centers across Azure regions for high availability.</span></span> <span data-ttu-id="c0f80-130">Dans chaque région, les nœuds sont configurés en mode rack avec des domaines d’erreur et de mise à niveau, afin d’assurer la résilience à l’intérieur de la région.</span><span class="sxs-lookup"><span data-stu-id="c0f80-130">Within each region, nodes are configured in rack-aware mode with fault and upgrade domains, for resiliency inside the region.</span></span>

## <a name="recommendations"></a><span data-ttu-id="c0f80-131">Recommandations</span><span class="sxs-lookup"><span data-stu-id="c0f80-131">Recommendations</span></span>

<span data-ttu-id="c0f80-132">Une architecture multirégion peut offrir une meilleure disponibilité qu’un déploiement dans une seule région.</span><span class="sxs-lookup"><span data-stu-id="c0f80-132">A multi-region architecture can provide higher availability than deploying to a single region.</span></span> <span data-ttu-id="c0f80-133">Si une interruption de service régionale affecte la région primaire, vous pouvez utiliser [Traffic Manager][traffic-manager] pour basculer vers la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="c0f80-133">If a regional outage affects the primary region, you can use [Traffic Manager][traffic-manager] to fail over to the secondary region.</span></span> <span data-ttu-id="c0f80-134">Cette architecture peut également se révéler utile en cas de défaillance d’un sous-système spécifique de l’application.</span><span class="sxs-lookup"><span data-stu-id="c0f80-134">This architecture can also help if an individual subsystem of the application fails.</span></span>

<span data-ttu-id="c0f80-135">Plusieurs approches générales permettent de bénéficier d’une haute disponibilité dans l’ensemble des régions :</span><span class="sxs-lookup"><span data-stu-id="c0f80-135">There are several general approaches to achieving high availability across regions:</span></span>   

* <span data-ttu-id="c0f80-136">Mode actif/passif avec serveur de secours.</span><span class="sxs-lookup"><span data-stu-id="c0f80-136">Active/passive with hot standby.</span></span> <span data-ttu-id="c0f80-137">Le trafic est dirigé vers une région, tandis que l’autre région est en attente sur le serveur de secours.</span><span class="sxs-lookup"><span data-stu-id="c0f80-137">Traffic goes to one region, while the other waits on hot standby.</span></span> <span data-ttu-id="c0f80-138">Le terme « serveur de secours » signifie que les machines virtuelles de la région secondaire sont allouées et en cours d’exécution en permanence.</span><span class="sxs-lookup"><span data-stu-id="c0f80-138">Hot standby means the VMs in the secondary region are allocated and running at all times.</span></span>
* <span data-ttu-id="c0f80-139">Mode actif/passif avec reprise progressive.</span><span class="sxs-lookup"><span data-stu-id="c0f80-139">Active/passive with cold standby.</span></span> <span data-ttu-id="c0f80-140">Le trafic est dirigé vers une région, tandis que l’autre région est en attente sur le centre de données de reprise progressive.</span><span class="sxs-lookup"><span data-stu-id="c0f80-140">Traffic goes to one region, while the other waits on cold standby.</span></span> <span data-ttu-id="c0f80-141">Le terme « reprise progressive » signifie que les machines virtuelles de la région secondaire ne sont pas allouées tant qu’elles ne sont pas requises pour le basculement.</span><span class="sxs-lookup"><span data-stu-id="c0f80-141">Cold standby means the VMs in the secondary region are not allocated until needed for failover.</span></span> <span data-ttu-id="c0f80-142">La mise en œuvre de cette approche se révèle moins coûteuse, mais nécessite davantage de temps en cas de défaillance.</span><span class="sxs-lookup"><span data-stu-id="c0f80-142">This approach costs less to run, but will generally take longer to come online during a failure.</span></span>
* <span data-ttu-id="c0f80-143">Mode actif/actif.</span><span class="sxs-lookup"><span data-stu-id="c0f80-143">Active/active.</span></span> <span data-ttu-id="c0f80-144">Les deux régions sont actives, et la charge de travail des requêtes est équilibrée entre les régions.</span><span class="sxs-lookup"><span data-stu-id="c0f80-144">Both regions are active, and requests are load balanced between them.</span></span> <span data-ttu-id="c0f80-145">Si l’une des régions n’est plus disponible, elle est mise hors service.</span><span class="sxs-lookup"><span data-stu-id="c0f80-145">If one region becomes unavailable, it is taken out of rotation.</span></span> 

<span data-ttu-id="c0f80-146">Cette architecture est axée sur le mode actif/passif avec serveur de secours, et utilise Traffic Manager pour le basculement.</span><span class="sxs-lookup"><span data-stu-id="c0f80-146">This architecture focuses on active/passive with hot standby, using Traffic Manager for failover.</span></span> <span data-ttu-id="c0f80-147">Notez que vous pouvez déployer un petit nombre de machines virtuelles pour le serveur de secours, puis monter en charge en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="c0f80-147">Note that you could deploy a small number of VMs for hot standby and then scale out as needed.</span></span>


### <a name="regional-pairing"></a><span data-ttu-id="c0f80-148">Association régionale</span><span class="sxs-lookup"><span data-stu-id="c0f80-148">Regional pairing</span></span>

<span data-ttu-id="c0f80-149">Chaque région Azure est associée à une autre région de la même zone géographique.</span><span class="sxs-lookup"><span data-stu-id="c0f80-149">Each Azure region is paired with another region within the same geography.</span></span> <span data-ttu-id="c0f80-150">En général, vous devez choisir des régions de la même paire régionale (par exemple, Est des États-Unis 2 et Centre des États-Unis).</span><span class="sxs-lookup"><span data-stu-id="c0f80-150">In general, choose regions from the same regional pair (for example, East US 2 and US Central).</span></span> <span data-ttu-id="c0f80-151">Cette approche offre les avantages suivants :</span><span class="sxs-lookup"><span data-stu-id="c0f80-151">Benefits of doing so include:</span></span>

* <span data-ttu-id="c0f80-152">En cas d’interruption de service générale, la récupération d’au moins une région de chaque paire est prioritaire.</span><span class="sxs-lookup"><span data-stu-id="c0f80-152">If there is a broad outage, recovery of at least one region out of every pair is prioritized.</span></span>
* <span data-ttu-id="c0f80-153">Les mises à jour planifiées du système Azure sont déployées dans les régions associées de manière séquentielle, afin de minimiser les temps d’arrêt possibles.</span><span class="sxs-lookup"><span data-stu-id="c0f80-153">Planned Azure system updates are rolled out to paired regions sequentially, to minimize possible downtime.</span></span>
* <span data-ttu-id="c0f80-154">Les paires régionales appartiennent à la même zone géographique, afin de répondre aux exigences en matière de résidence des données.</span><span class="sxs-lookup"><span data-stu-id="c0f80-154">Pairs reside within the same geography, to meet data residency requirements.</span></span>

<span data-ttu-id="c0f80-155">Toutefois, vous devez vérifier que les deux régions prennent en charge tous les services Azure nécessaires pour votre application (voir [Services par région][services-by-region]).</span><span class="sxs-lookup"><span data-stu-id="c0f80-155">However, make sure that both regions support all of the Azure services needed for your application (see [Services by region][services-by-region]).</span></span> <span data-ttu-id="c0f80-156">Pour plus d’informations sur les paires régionales, consultez l’article [Continuité des activités et récupération d’urgence (BCDR) : régions jumelées d’Azure][regional-pairs].</span><span class="sxs-lookup"><span data-stu-id="c0f80-156">For more information about regional pairs, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions][regional-pairs].</span></span>

### <a name="traffic-manager-configuration"></a><span data-ttu-id="c0f80-157">Configuration de Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="c0f80-157">Traffic Manager configuration</span></span>

<span data-ttu-id="c0f80-158">Considérez les points suivants lors de la configuration de Traffic Manager :</span><span class="sxs-lookup"><span data-stu-id="c0f80-158">Consider the following points when configuring Traffic Manager:</span></span>

* <span data-ttu-id="c0f80-159">**Routage**.</span><span class="sxs-lookup"><span data-stu-id="c0f80-159">**Routing**.</span></span> <span data-ttu-id="c0f80-160">Traffic Manager prend en charge plusieurs [algorithmes de routage][tm-routing].</span><span class="sxs-lookup"><span data-stu-id="c0f80-160">Traffic Manager supports several [routing algorithms][tm-routing].</span></span> <span data-ttu-id="c0f80-161">Pour le scénario décrit dans cet article, utilisez le routage *par priorité* (auparavant désigné sous le terme de routage *par basculement*).</span><span class="sxs-lookup"><span data-stu-id="c0f80-161">For the scenario described in this article, use *priority* routing (formerly called *failover* routing).</span></span> <span data-ttu-id="c0f80-162">Quand cette méthode de routage est configurée, Traffic Manager envoie toutes les requêtes à la région primaire, sauf si elle devient inaccessible.</span><span class="sxs-lookup"><span data-stu-id="c0f80-162">With this setting, Traffic Manager sends all requests to the primary region, unless the primary region becomes unreachable.</span></span> <span data-ttu-id="c0f80-163">À ce moment-là, les requêtes basculent automatiquement vers la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="c0f80-163">At that point, it automatically fails over to the secondary region.</span></span> <span data-ttu-id="c0f80-164">Consultez [Configurer la méthode de routage de basculement][tm-configure-failover].</span><span class="sxs-lookup"><span data-stu-id="c0f80-164">See [Configure Failover routing method][tm-configure-failover].</span></span>
* <span data-ttu-id="c0f80-165">**Sonde d’intégrité**.</span><span class="sxs-lookup"><span data-stu-id="c0f80-165">**Health probe**.</span></span> <span data-ttu-id="c0f80-166">Traffic Manager utilise une [sonde][tm-monitoring] HTTP (ou HTTPS) pour surveiller la disponibilité de chaque région.</span><span class="sxs-lookup"><span data-stu-id="c0f80-166">Traffic Manager uses an HTTP (or HTTPS) [probe][tm-monitoring] to monitor the availability of each region.</span></span> <span data-ttu-id="c0f80-167">La sonde vérifie la présence d’une réponse HTTP 200 pour un chemin d’URL spécifié.</span><span class="sxs-lookup"><span data-stu-id="c0f80-167">The probe checks for an HTTP 200 response for a specified URL path.</span></span> <span data-ttu-id="c0f80-168">Une bonne pratique consiste à créer un point de terminaison qui signale l’intégrité globale de l’application et à utiliser ce point de terminaison pour la sonde d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="c0f80-168">As a best practice, create an endpoint that reports the overall health of the application, and use this endpoint for the health probe.</span></span> <span data-ttu-id="c0f80-169">Dans le cas contraire, la sonde risque de signaler un point de terminaison intègre alors que des parties critiques de l’application sont défaillantes.</span><span class="sxs-lookup"><span data-stu-id="c0f80-169">Otherwise, the probe might report a healthy endpoint when critical parts of the application are actually failing.</span></span> <span data-ttu-id="c0f80-170">Pour plus d’informations, consultez [Modèle de surveillance de point de terminaison d’intégrité][health-endpoint-monitoring-pattern].</span><span class="sxs-lookup"><span data-stu-id="c0f80-170">For more information, see [Health Endpoint Monitoring Pattern][health-endpoint-monitoring-pattern].</span></span>

<span data-ttu-id="c0f80-171">Quand Traffic Manager déclenche un basculement, l’application reste inaccessible aux clients pendant un certain laps de temps.</span><span class="sxs-lookup"><span data-stu-id="c0f80-171">When Traffic Manager fails over there is a period of time when clients cannot reach the application.</span></span> <span data-ttu-id="c0f80-172">Ce laps de temps dépend des facteurs suivants :</span><span class="sxs-lookup"><span data-stu-id="c0f80-172">The duration is affected by the following factors:</span></span>

* <span data-ttu-id="c0f80-173">La sonde d’intégrité doit détecter que la région primaire est devenue inaccessible.</span><span class="sxs-lookup"><span data-stu-id="c0f80-173">The health probe must detect that the primary region has become unreachable.</span></span>
* <span data-ttu-id="c0f80-174">Les serveurs DNS (Domain Name Service) doivent mettre à jour les enregistrements DNS mis en cache pour l’adresse IP, qui dépend de la durée de vie (TTL) DNS.</span><span class="sxs-lookup"><span data-stu-id="c0f80-174">DNS servers must update the cached DNS records for the IP address, which depends on the DNS time-to-live (TTL).</span></span> <span data-ttu-id="c0f80-175">La valeur TTL par défaut est de 300 secondes (5 minutes), mais vous pouvez configurer cette valeur quand vous créez le profil Traffic Manager.</span><span class="sxs-lookup"><span data-stu-id="c0f80-175">The default TTL is 300 seconds (5 minutes), but you can configure this value when you create the Traffic Manager profile.</span></span>

<span data-ttu-id="c0f80-176">Pour plus d’informations, consultez [À propos de la surveillance de Traffic Manager][tm-monitoring].</span><span class="sxs-lookup"><span data-stu-id="c0f80-176">For details, see [About Traffic Manager Monitoring][tm-monitoring].</span></span>

<span data-ttu-id="c0f80-177">En cas de basculement de Traffic Manager, nous vous recommandons de procéder à une restauration manuelle plutôt que d’implémenter une restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="c0f80-177">If Traffic Manager fails over, we recommend performing a manual failback rather than implementing an automatic failback.</span></span> <span data-ttu-id="c0f80-178">Dans le cas contraire, l’application risque d’alterner continuellement entre les régions.</span><span class="sxs-lookup"><span data-stu-id="c0f80-178">Otherwise, you can create a situation where the application flips back and forth between regions.</span></span> <span data-ttu-id="c0f80-179">Vérifiez que tous les sous-systèmes de l’application sont intègres avant d’effectuer la restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="c0f80-179">Verify that all application subsystems are healthy before failing back.</span></span>

<span data-ttu-id="c0f80-180">Notez que Traffic Manager procède à une restauration automatique par défaut.</span><span class="sxs-lookup"><span data-stu-id="c0f80-180">Note that Traffic Manager automatically fails back by default.</span></span> <span data-ttu-id="c0f80-181">Pour éviter cela, diminuez manuellement la priorité de la région primaire après un événement de basculement.</span><span class="sxs-lookup"><span data-stu-id="c0f80-181">To prevent this, manually lower the priority of the primary region after a failover event.</span></span> <span data-ttu-id="c0f80-182">Par exemple, supposez que la région primaire a la priorité 1, et que la base de données secondaire a la priorité 2.</span><span class="sxs-lookup"><span data-stu-id="c0f80-182">For example, suppose the primary region is priority 1 and the secondary is priority 2.</span></span> <span data-ttu-id="c0f80-183">Après un basculement, définissez la priorité de la région primaire sur la valeur 3 afin d’empêcher la restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="c0f80-183">After a failover, set the primary region to priority 3, to prevent automatic failback.</span></span> <span data-ttu-id="c0f80-184">Quand vous êtes prêt à rebasculer vers cette région, redéfinissez sa priorité sur la valeur 1.</span><span class="sxs-lookup"><span data-stu-id="c0f80-184">When you are ready to switch back, update the priority to 1.</span></span>

<span data-ttu-id="c0f80-185">La commande [Azure CLI][install-azure-cli] suivante met à jour la priorité :</span><span class="sxs-lookup"><span data-stu-id="c0f80-185">The following [Azure CLI][install-azure-cli] command updates the priority:</span></span>

```bat
azure network traffic-manager  endpoint set --resource-group <resource-group> --profile-name <profile>
    --name <traffic-manager-name> --type AzureEndpoints --priority 3
```    

<span data-ttu-id="c0f80-186">Une autre approche consiste à désactiver temporairement le point de terminaison jusqu’à ce que vous soyez prêt à effectuer la restauration automatique :</span><span class="sxs-lookup"><span data-stu-id="c0f80-186">Another approach is to temporarily disable the endpoint until you are ready to fail back:</span></span>

```bat
azure network traffic-manager  endpoint set --resource-group <resource-group> --profile-name <profile>
    --name <traffic-manager-name> --type AzureEndpoints --status Disabled
```    

<span data-ttu-id="c0f80-187">En fonction de la cause d’un basculement, vous devrez peut-être redéployer les ressources au sein d’une région.</span><span class="sxs-lookup"><span data-stu-id="c0f80-187">Depending on the cause of a failover, you might need to redeploy the resources within a region.</span></span> <span data-ttu-id="c0f80-188">Avant d’effectuer une restauration automatique, exécutez un test de disponibilité opérationnelle.</span><span class="sxs-lookup"><span data-stu-id="c0f80-188">Before failing back, perform an operational readiness test.</span></span> <span data-ttu-id="c0f80-189">Le test doit vérifier entre autres ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="c0f80-189">The test should verify things like:</span></span>

* <span data-ttu-id="c0f80-190">Les machines virtuelles sont configurées correctement.</span><span class="sxs-lookup"><span data-stu-id="c0f80-190">VMs are configured correctly.</span></span> <span data-ttu-id="c0f80-191">(Tous les logiciels nécessaires sont installés, IIS est en cours d’exécution, et ainsi de suite.)</span><span class="sxs-lookup"><span data-stu-id="c0f80-191">(All required software is installed, IIS is running, and so on.)</span></span>
* <span data-ttu-id="c0f80-192">Les sous-systèmes d’application sont intègres.</span><span class="sxs-lookup"><span data-stu-id="c0f80-192">Application subsystems are healthy.</span></span>
* <span data-ttu-id="c0f80-193">Test fonctionnel.</span><span class="sxs-lookup"><span data-stu-id="c0f80-193">Functional testing.</span></span> <span data-ttu-id="c0f80-194">(Par exemple, le niveau de la base de données est accessible à partir du niveau Web.)</span><span class="sxs-lookup"><span data-stu-id="c0f80-194">(For example, the database tier is reachable from the web tier.)</span></span>

### <a name="cassandra-deployment-across-multiple-regions"></a><span data-ttu-id="c0f80-195">Déploiement de Cassandra dans plusieurs régions</span><span class="sxs-lookup"><span data-stu-id="c0f80-195">Cassandra deployment across multiple regions</span></span>

<span data-ttu-id="c0f80-196">Les centres de données Cassandra sont un groupe de nœuds de données associés qui sont configurés dans un cluster à des fins de répartition de charge de travail et de réplication.</span><span class="sxs-lookup"><span data-stu-id="c0f80-196">Cassandra data centers are a group of related data nodes that are configured together within a cluster for replication and workload segregation.</span></span>

<span data-ttu-id="c0f80-197">Nous vous recommandons [DataStax Enterprise][datastax] pour une utilisation en production.</span><span class="sxs-lookup"><span data-stu-id="c0f80-197">We recommend [DataStax Enterprise][datastax] for production use.</span></span> <span data-ttu-id="c0f80-198">Pour plus d’informations sur l’exécution de DataStax dans Azure, consultez le [Guide de déploiement de DataStax Enterprise pour Azure][cassandra-in-azure].</span><span class="sxs-lookup"><span data-stu-id="c0f80-198">For more information on running DataStax in Azure, see [DataStax Enterprise Deployment Guide for Azure][cassandra-in-azure].</span></span> <span data-ttu-id="c0f80-199">Les recommandations générales suivantes s’appliquent à toute édition de Cassandra :</span><span class="sxs-lookup"><span data-stu-id="c0f80-199">The following general recommendations apply to any Cassandra edition:</span></span> 

* <span data-ttu-id="c0f80-200">Attribuez une adresse IP publique à chaque nœud.</span><span class="sxs-lookup"><span data-stu-id="c0f80-200">Assign a public IP address to each node.</span></span> <span data-ttu-id="c0f80-201">Cela permet aux clusters de communiquer d’une région à une autre à l’aide de l’infrastructure principale Azure, et de bénéficier ainsi d’un débit élevé à faible coût.</span><span class="sxs-lookup"><span data-stu-id="c0f80-201">This enables the clusters to communicate across regions using the Azure backbone infrastructure, providing high throughput at low cost.</span></span>
* <span data-ttu-id="c0f80-202">Sécurisez les nœuds à l’aide des configurations de pare-feu et de groupe de sécurité réseau appropriées, en autorisant le trafic uniquement vers et à partir des hôtes connus, notamment les clients et les autres nœuds du cluster.</span><span class="sxs-lookup"><span data-stu-id="c0f80-202">Secure nodes using the appropriate firewall and network security group (NSG) configurations, allowing traffic only to and from known hosts, including clients and other cluster nodes.</span></span> <span data-ttu-id="c0f80-203">Notez que Cassandra utilise différents ports pour la communication : OpsCenter, Spark et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="c0f80-203">Note that Cassandra uses different ports for communication, OpsCenter, Spark, and so forth.</span></span> <span data-ttu-id="c0f80-204">Pour plus d’informations sur l’utilisation des ports dans Cassandra, consultez [Configuration de l’accès aux ports de pare-feu][cassandra-ports].</span><span class="sxs-lookup"><span data-stu-id="c0f80-204">For port usage in Cassandra, see [Configuring firewall port access][cassandra-ports].</span></span>
* <span data-ttu-id="c0f80-205">Utiliser le chiffrement SSL pour toutes les communications [client à nœud][ssl-client-node] et [nœud à nœud][ssl-node-node].</span><span class="sxs-lookup"><span data-stu-id="c0f80-205">Use SSL encryption for all [client-to-node][ssl-client-node] and [node-to-node][ssl-node-node] communications.</span></span>
* <span data-ttu-id="c0f80-206">Dans une région, suivez les instructions fournies dans [Recommandations relatives à Cassandra](n-tier.md#cassandra).</span><span class="sxs-lookup"><span data-stu-id="c0f80-206">Within a region, follow the guidelines in [Cassandra recommendations](n-tier.md#cassandra).</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="c0f80-207">Considérations relatives à la disponibilité</span><span class="sxs-lookup"><span data-stu-id="c0f80-207">Availability considerations</span></span>

<span data-ttu-id="c0f80-208">Avec une application multiniveau complexe, vous n’aurez peut-être pas besoin de répliquer l’ensemble de l’application dans la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="c0f80-208">With a complex N-tier app, you may not need to replicate the entire application in the secondary region.</span></span> <span data-ttu-id="c0f80-209">Au lieu de cela, vous pourrez simplement répliquer un sous-système critique nécessaire pour prendre en charge la continuité d’activité.</span><span class="sxs-lookup"><span data-stu-id="c0f80-209">Instead, you might just replicate a critical subsystem that is needed to support business continuity.</span></span>

<span data-ttu-id="c0f80-210">Traffic Manager est un point de défaillance possible dans le système.</span><span class="sxs-lookup"><span data-stu-id="c0f80-210">Traffic Manager is a possible failure point in the system.</span></span> <span data-ttu-id="c0f80-211">Si le service Traffic Manager échoue, les clients ne peuvent plus accéder à votre application pendant le temps d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="c0f80-211">If the Traffic Manager service fails, clients cannot access your application during the downtime.</span></span> <span data-ttu-id="c0f80-212">Examinez le [Contrat de niveau de service (SLA) pour Traffic Manager][tm-sla] et déterminez si Traffic Manager peut à lui seul répondre à vos exigences métiers en matière de haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="c0f80-212">Review the [Traffic Manager SLA][tm-sla], and determine whether using Traffic Manager alone meets your business requirements for high availability.</span></span> <span data-ttu-id="c0f80-213">Si ce n’est pas le cas, ajoutez une autre solution de gestion du trafic en tant que restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="c0f80-213">If not, consider adding another traffic management solution as a failback.</span></span> <span data-ttu-id="c0f80-214">Si le service Azure Traffic Manager échoue, modifiez vos enregistrements CNAME dans DNS pour qu’ils pointent vers l’autre service de gestion du trafic.</span><span class="sxs-lookup"><span data-stu-id="c0f80-214">If the Azure Traffic Manager service fails, change your CNAME records in DNS to point to the other traffic management service.</span></span> <span data-ttu-id="c0f80-215">(Cette opération doit être effectuée manuellement, et votre application reste inaccessible tant que ces modifications DNS n’ont pas été propagées.)</span><span class="sxs-lookup"><span data-stu-id="c0f80-215">(This step must be performed manually, and your application will be unavailable until the DNS changes are propagated.)</span></span>

<span data-ttu-id="c0f80-216">Pour le cluster Cassandra, les scénarios de basculement à prendre en compte dépendent des niveaux de cohérence utilisés par l’application, ainsi que du nombre de réplicas utilisés.</span><span class="sxs-lookup"><span data-stu-id="c0f80-216">For the Cassandra cluster, the failover scenarios to consider depend on the consistency levels used by the application, as well as the number of replicas used.</span></span> <span data-ttu-id="c0f80-217">Pour plus d’informations sur l’utilisation et les niveaux de cohérence dans Cassandra, consultez [Configuring data consistency ][cassandra-consistency] (Configuration de la cohérence des données) et [Cassandra: How many nodes are talked to with Quorum?][cassandra-consistency-usage] (Cassandra : quel est le nombre de nœuds en communication avec le quorum ?)</span><span class="sxs-lookup"><span data-stu-id="c0f80-217">For consistency levels and usage in Cassandra, see [Configuring data consistency][cassandra-consistency] and [Cassandra: How many nodes are talked to with Quorum?][cassandra-consistency-usage]</span></span> <span data-ttu-id="c0f80-218">La disponibilité des données dans Cassandra est déterminée par le niveau de cohérence utilisé par l’application et le mécanisme de réplication.</span><span class="sxs-lookup"><span data-stu-id="c0f80-218">Data availability in Cassandra is determined by the consistency level used by the application and the replication mechanism.</span></span> <span data-ttu-id="c0f80-219">Pour plus d’informations sur la réplication dans Cassandra, consultez [Data Replication in NoSQL Databases Explained][cassandra-replication] (Explication de la réplication des données dans les bases de données NoSQL).</span><span class="sxs-lookup"><span data-stu-id="c0f80-219">For replication in Cassandra, see [Data Replication in NoSQL Databases Explained][cassandra-replication].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="c0f80-220">Considérations relatives à la facilité de gestion</span><span class="sxs-lookup"><span data-stu-id="c0f80-220">Manageability considerations</span></span>

<span data-ttu-id="c0f80-221">Quand vous mettez à jour votre déploiement, mettez à jour une seule région à la fois, afin de réduire le risque de défaillance globale due à une configuration incorrecte ou à une erreur dans l’application.</span><span class="sxs-lookup"><span data-stu-id="c0f80-221">When you update your deployment, update one region at a time to reduce the chance of a global failure from an incorrect configuration or an error in the application.</span></span>

<span data-ttu-id="c0f80-222">Testez la résilience aux défaillances du système.</span><span class="sxs-lookup"><span data-stu-id="c0f80-222">Test the resiliency of the system to failures.</span></span> <span data-ttu-id="c0f80-223">Voici quelques scénarios courants de défaillance à tester :</span><span class="sxs-lookup"><span data-stu-id="c0f80-223">Here are some common failure scenarios to test:</span></span>

* <span data-ttu-id="c0f80-224">Arrêt des instances de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="c0f80-224">Shut down VM instances.</span></span>
* <span data-ttu-id="c0f80-225">Pression sur les ressources telles que le processeur et la mémoire.</span><span class="sxs-lookup"><span data-stu-id="c0f80-225">Pressure resources such as CPU and memory.</span></span>
* <span data-ttu-id="c0f80-226">Déconnexion/délai de réseau.</span><span class="sxs-lookup"><span data-stu-id="c0f80-226">Disconnect/delay network.</span></span>
* <span data-ttu-id="c0f80-227">Blocage de processus.</span><span class="sxs-lookup"><span data-stu-id="c0f80-227">Crash processes.</span></span>
* <span data-ttu-id="c0f80-228">Expiration de certificats.</span><span class="sxs-lookup"><span data-stu-id="c0f80-228">Expire certificates.</span></span>
* <span data-ttu-id="c0f80-229">Simulation de défaillances matérielles.</span><span class="sxs-lookup"><span data-stu-id="c0f80-229">Simulate hardware faults.</span></span>
* <span data-ttu-id="c0f80-230">Arrêt du service DNS sur les contrôleurs de domaine.</span><span class="sxs-lookup"><span data-stu-id="c0f80-230">Shut down the DNS service on the domain controllers.</span></span>

<span data-ttu-id="c0f80-231">Mesurez les temps de récupération et vérifiez qu’ils répondent aux besoins de votre entreprise.</span><span class="sxs-lookup"><span data-stu-id="c0f80-231">Measure the recovery times and verify they meet your business requirements.</span></span> <span data-ttu-id="c0f80-232">Testez également des combinaisons de défaillances.</span><span class="sxs-lookup"><span data-stu-id="c0f80-232">Test combinations of failure modes, as well.</span></span>


<!-- Links -->
[hybrid-vpn]: ../hybrid-networking/vpn.md
[azure-dns]: /azure/dns/dns-overview
[cassandra-in-azure]: https://academy.datastax.com/resources/deployment-guide-azure
[cassandra-consistency]: http://docs.datastax.com/en/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html
[cassandra-replication]: http://www.planetcassandra.org/data-replication-in-nosql-databases-explained/
[cassandra-consistency-usage]: https://medium.com/@foundev/cassandra-how-many-nodes-are-talked-to-with-quorum-also-should-i-use-it-98074e75d7d5#.b4pb4alb2
[cassandra-ports]: https://docs.datastax.com/en/datastax_enterprise/5.0/datastax_enterprise/sec/configFirewallPorts.html
[datastax]: https://www.datastax.com/products/datastax-enterprise
[health-endpoint-monitoring-pattern]: https://msdn.microsoft.com/library/dn589789.aspx
[install-azure-cli]: /azure/xplat-cli-install
[regional-pairs]: /azure/best-practices-availability-paired-regions
[resource groups]: /azure/azure-resource-manager/resource-group-overview
[resource-group-links]: /azure/resource-group-link-resources
[services-by-region]: https://azure.microsoft.com/regions/#services
[ssl-client-node]: http://docs.datastax.com/en/cassandra/2.0/cassandra/security/secureSSLClientToNode_t.html
[ssl-node-node]: http://docs.datastax.com/en/cassandra/2.0/cassandra/security/secureSSLNodeToNode_t.html
[tablediff]: https://msdn.microsoft.com/library/ms162843.aspx
[tm-configure-failover]: /azure/traffic-manager/traffic-manager-configure-failover-routing-method
[tm-monitoring]: /azure/traffic-manager/traffic-manager-monitoring
[tm-routing]: /azure/traffic-manager/traffic-manager-routing-methods
[tm-sla]: https://azure.microsoft.com/support/legal/sla/traffic-manager/v1_0/
[traffic-manager]: https://azure.microsoft.com/services/traffic-manager/
[visio-download]: https://archcenter.blob.core.windows.net/cdn/vm-reference-architectures.vsdx
[wsfc]: https://msdn.microsoft.com/library/hh270278.aspx
[0]: ./images/multi-region-application-diagram.png "Architecture réseau hautement disponible pour les applications multiniveaux Azure"
