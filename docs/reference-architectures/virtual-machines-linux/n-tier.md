---
title: Exécuter des machines virtuelles Linux pour une application multiniveau dans Azure
description: Découvrez comment exécuter des machines virtuelles Linux pour une architecture multiniveau dans Microsoft Azure.
author: MikeWasson
ms.date: 11/22/2017
pnp.series.title: Linux VM workloads
pnp.series.next: multi-region-application
pnp.series.prev: multi-vm
ms.openlocfilehash: 8d3e6e5124a0abb27a3c72e1ecbd52a1a1da2a33
ms.sourcegitcommit: e67b751f230792bba917754d67789a20810dc76b
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/06/2018
---
# <a name="run-linux-vms-for-an-n-tier-application"></a><span data-ttu-id="bf4b7-103">Exécuter des machines virtuelles Linux pour une application multiniveau</span><span class="sxs-lookup"><span data-stu-id="bf4b7-103">Run Linux VMs for an N-tier application</span></span>

<span data-ttu-id="bf4b7-104">Cette architecture de référence présente un ensemble de pratiques éprouvées pour l’exécution de machines virtuelles Linux pour une application multiniveau.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-104">This reference architecture shows a set of proven practices for running Linux virtual machines (VMs) for an N-tier application.</span></span> [<span data-ttu-id="bf4b7-105">**Déployez cette solution**.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-105">**Deploy this solution**.</span></span>](#deploy-the-solution)  

<span data-ttu-id="bf4b7-106">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="bf4b7-106">![[0]][0]</span></span>

<span data-ttu-id="bf4b7-107">*Téléchargez un [fichier Visio][visio-download] de cette architecture.*</span><span class="sxs-lookup"><span data-stu-id="bf4b7-107">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="bf4b7-108">Architecture</span><span class="sxs-lookup"><span data-stu-id="bf4b7-108">Architecture</span></span>

<span data-ttu-id="bf4b7-109">Il existe de nombreuses façons d’implémenter une architecture multiniveau.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-109">There are many ways to implement an N-tier architecture.</span></span> <span data-ttu-id="bf4b7-110">Le diagramme illustre une application web à 3 niveaux standard.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-110">The diagram shows a typical 3-tier web application.</span></span> <span data-ttu-id="bf4b7-111">Cette architecture repose sur celle décrite dans [Exécuter des machines virtuelles à charge équilibrée pour la scalabilité et la disponibilité][multi-vm].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-111">This architecture builds on [Run load-balanced VMs for scalability and availability][multi-vm].</span></span> <span data-ttu-id="bf4b7-112">Les niveaux Web et Business utilisent des machines virtuelles à charge équilibrée.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-112">The web and business tiers use load-balanced VMs.</span></span>

* <span data-ttu-id="bf4b7-113">**Groupes à haute disponibilité.**</span><span class="sxs-lookup"><span data-stu-id="bf4b7-113">**Availability sets.**</span></span> <span data-ttu-id="bf4b7-114">Créez un [groupe à haute disponibilité][azure-availability-sets] pour chaque niveau et configurez au moins deux machines virtuelles dans chaque niveau.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-114">Create an [availability set][azure-availability-sets] for each tier, and provision at least two VMs in each tier.</span></span>  <span data-ttu-id="bf4b7-115">Cela rend les machines virtuelles éligibles pour un [niveau contrat de service (SLA)][vm-sla] plus élevé.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-115">This makes the VMs eligible for a higher [service level agreement (SLA)][vm-sla] for VMs.</span></span> <span data-ttu-id="bf4b7-116">Vous pouvez déployer une seule machine virtuelle dans un groupe à haute disponibilité, mais cette machine virtuelle unique ne sera pas éligible à la garantie de contrat de niveau de service, à moins qu’elle n’utilise le stockage Premium Azure pour tous les systèmes d’exploitation et disques de données.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-116">You can deploy a single VM in an availability set, but the single VM will not qualify for an SLA guarantee unless the single VM is using Azure Premium Storage for all OS and data disks.</span></span>  
* <span data-ttu-id="bf4b7-117">**Sous-réseaux.**</span><span class="sxs-lookup"><span data-stu-id="bf4b7-117">**Subnets.**</span></span> <span data-ttu-id="bf4b7-118">Créez un sous-réseau distinct pour chaque niveau.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-118">Create a separate subnet for each tier.</span></span> <span data-ttu-id="bf4b7-119">Spécifiez la plage d’adresses et le masque de sous-réseau d’après la notation [CIDR].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-119">Specify the address range and subnet mask using [CIDR] notation.</span></span> 
* <span data-ttu-id="bf4b7-120">**Équilibreurs de charge.**</span><span class="sxs-lookup"><span data-stu-id="bf4b7-120">**Load balancers.**</span></span> <span data-ttu-id="bf4b7-121">Utilisez un [équilibreur de charge accessible sur Internet][load-balancer-external] pour distribuer le trafic Internet entrant vers le niveau Web et un [équilibreur de charge interne][load-balancer-internal] pour distribuer le trafic réseau du niveau Web vers le niveau Business.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-121">Use an [Internet-facing load balancer][load-balancer-external] to distribute incoming Internet traffic to the web tier, and an [internal load balancer][load-balancer-internal] to distribute network traffic from the web tier to the business tier.</span></span>
* <span data-ttu-id="bf4b7-122">**Azure DNS**.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-122">**Azure DNS**.</span></span> <span data-ttu-id="bf4b7-123">[Azure DNS][azure-dns] est un service d’hébergement pour les domaines DNS qui offre une résolution de noms à l’aide de l’infrastructure Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-123">[Azure DNS][azure-dns] is a hosting service for DNS domains, providing name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="bf4b7-124">En hébergeant vos domaines dans Azure, vous pouvez gérer vos enregistrements DNS avec les mêmes informations d’identification, les mêmes API, les mêmes outils et la même facturation que vos autres services Azure.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-124">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>
* <span data-ttu-id="bf4b7-125">**Serveur de rebond (jumpbox).**</span><span class="sxs-lookup"><span data-stu-id="bf4b7-125">**Jumpbox.**</span></span> <span data-ttu-id="bf4b7-126">Également appelée [hôte bastion].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-126">Also called a [bastion host].</span></span> <span data-ttu-id="bf4b7-127">Machine virtuelle sécurisée sur le réseau, utilisée par les administrateurs pour se connecter aux autres machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-127">A secure VM on the network that administrators use to connect to the other VMs.</span></span> <span data-ttu-id="bf4b7-128">Le serveur de rebond a un groupe de sécurité réseau qui autorise le trafic distant provenant uniquement d’adresses IP publiques figurant sur une liste verte.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-128">The jumpbox has an NSG that allows remote traffic only from public IP addresses on a safe list.</span></span> <span data-ttu-id="bf4b7-129">Le groupe de sécurité réseau doit autoriser le trafic SSH (Secure Shell).</span><span class="sxs-lookup"><span data-stu-id="bf4b7-129">The NSG should permit secure shell (SSH) traffic.</span></span>
* <span data-ttu-id="bf4b7-130">**Surveillance.**</span><span class="sxs-lookup"><span data-stu-id="bf4b7-130">**Monitoring.**</span></span> <span data-ttu-id="bf4b7-131">Des logiciels de surveillance tels que [Nagios], [Zabbix] ou [Icinga] peuvent vous donner une idée du temps de réponse, du temps de fonctionnement de machine virtuelle et de l’intégrité globale de votre système.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-131">Monitoring software such as [Nagios], [Zabbix], or [Icinga] can give you insight into response time, VM uptime, and the overall health of your system.</span></span> <span data-ttu-id="bf4b7-132">Installez le logiciel de surveillance sur une machine virtuelle placée sur un sous-réseau de gestion distinct.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-132">Install the monitoring software on a VM that's placed in a separate management subnet.</span></span>
* <span data-ttu-id="bf4b7-133"><strong>Groupes de sécurité réseau.</strong></span><span class="sxs-lookup"><span data-stu-id="bf4b7-133"><strong>NSGs.</strong></span></span> <span data-ttu-id="bf4b7-134">Utilisez des [groupes de sécurité réseau][nsg] pour limiter le trafic réseau au sein du réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-134">Use [network security groups][nsg] (NSGs) to restrict network traffic within the VNet.</span></span> <span data-ttu-id="bf4b7-135">Par exemple, dans l’architecture à 3 niveaux illustrée ici, le niveau base de données n’accepte pas le trafic en provenance du frontend web, mais uniquement du niveau Business et du sous-réseau de gestion.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-135">For example, in the 3-tier architecture shown here, the database tier does not accept traffic from the web front end, only from the business tier and the management subnet.</span></span>
* <span data-ttu-id="bf4b7-136">**Base de données Apache Cassandra**.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-136">**Apache Cassandra database**.</span></span> <span data-ttu-id="bf4b7-137">Fournit une haute disponibilité du niveau Données, en activant la réplication et le basculement.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-137">Provides high availability at the data tier, by enabling replication and failover.</span></span>

## <a name="recommendations"></a><span data-ttu-id="bf4b7-138">Recommandations</span><span class="sxs-lookup"><span data-stu-id="bf4b7-138">Recommendations</span></span>

<span data-ttu-id="bf4b7-139">Vos exigences peuvent différer de celles de l’architecture décrite ici.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-139">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="bf4b7-140">Utilisez ces recommandations comme point de départ.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-140">Use these recommendations as a starting point.</span></span> 

### <a name="vnet--subnets"></a><span data-ttu-id="bf4b7-141">Réseau virtuel / sous-réseaux</span><span class="sxs-lookup"><span data-stu-id="bf4b7-141">VNet / Subnets</span></span>

<span data-ttu-id="bf4b7-142">Quand vous créez le réseau virtuel, déterminez le nombre d’adresses IP dont vos ressources sur chaque sous-réseau ont besoin.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-142">When you create the VNet, determine how many IP addresses your resources in each subnet require.</span></span> <span data-ttu-id="bf4b7-143">Spécifiez un masque de sous-réseau et une plage d’adresses de réseau virtuel suffisamment large pour les adresse IP requises à l’aide de la notation [CIDR].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-143">Specify a subnet mask and a VNet address range large enough for the required IP addresses using [CIDR] notation.</span></span> <span data-ttu-id="bf4b7-144">Utilisez un espace d’adressage qui se trouve dans les [blocs d’adresses IP privées][private-ip-space] standard, à savoir 10.0.0.0/8, 172.16.0.0/12 et 192.168.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-144">Use an address space that falls within the standard [private IP address blocks][private-ip-space], which are 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16.</span></span>

<span data-ttu-id="bf4b7-145">Choisissez une plage d’adresses qui ne chevauche pas votre réseau local, au cas où vous devriez configurer ultérieurement une passerelle entre le réseau virtuel et votre réseau local.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-145">Choose an address range that does not overlap with your on-premises network, in case you need to set up a gateway between the VNet and your on-premises network later.</span></span> <span data-ttu-id="bf4b7-146">Une fois le réseau virtuel créé, vous ne pouvez plus modifier la plage d’adresses.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-146">Once you create the VNet, you can't change the address range.</span></span>

<span data-ttu-id="bf4b7-147">Concevez les sous-réseaux en tenant compte des exigences en matière de sécurité et de fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-147">Design subnets with functionality and security requirements in mind.</span></span> <span data-ttu-id="bf4b7-148">Toutes les machines virtuelles du même niveau ou rôle doivent être placées sur le même sous-réseau, qui peut constituer une limite de sécurité.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-148">All VMs within the same tier or role should go into the same subnet, which can be a security boundary.</span></span> <span data-ttu-id="bf4b7-149">Pour plus d’informations sur la conception des réseaux virtuels et des sous-réseaux, consultez [Planifier et concevoir des réseaux virtuels Azure][plan-network].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-149">For more information about designing VNets and subnets, see [Plan and design Azure Virtual Networks][plan-network].</span></span>

<span data-ttu-id="bf4b7-150">Pour chaque sous-réseau, spécifiez l’espace d’adressage du sous-réseau d’après la notation CIDR.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-150">For each subnet, specify the address space for the subnet in CIDR notation.</span></span> <span data-ttu-id="bf4b7-151">Par exemple, « 10.0.0.0/24 » crée une plage de 256 adresses IP.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-151">For example, '10.0.0.0/24' creates a range of 256 IP addresses.</span></span> <span data-ttu-id="bf4b7-152">Les machines virtuelles peuvent en utiliser 251, tandis que cinq sont réservées.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-152">VMs can use 251 of these; five are reserved.</span></span> <span data-ttu-id="bf4b7-153">Vérifiez que les plages d’adresses ne chevauchent pas plusieurs sous-réseaux.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-153">Make sure the address ranges don't overlap across subnets.</span></span> <span data-ttu-id="bf4b7-154">Voir le [FAQ sur les réseaux virtuels][vnet faq].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-154">See the [Virtual Network FAQ][vnet faq].</span></span>

### <a name="network-security-groups"></a><span data-ttu-id="bf4b7-155">Groupes de sécurité réseau</span><span class="sxs-lookup"><span data-stu-id="bf4b7-155">Network security groups</span></span>

<span data-ttu-id="bf4b7-156">Utilisez des règles de groupe de sécurité réseau pour limiter le trafic entre les niveaux.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-156">Use NSG rules to restrict traffic between tiers.</span></span> <span data-ttu-id="bf4b7-157">Par exemple, dans l’architecture à 3 niveaux ci-dessus, le niveau Web ne communique pas directement avec le niveau Base de données.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-157">For example, in the 3-tier architecture shown above, the web tier does not communicate directly with the database tier.</span></span> <span data-ttu-id="bf4b7-158">Pour appliquer cette recommandation, le niveau Base de données doit bloquer le trafic entrant provenant du sous-réseau du niveau Web.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-158">To enforce this, the database tier should block incoming traffic from the web tier subnet.</span></span>  

1. <span data-ttu-id="bf4b7-159">Créez un groupe de sécurité réseau et associez-le au sous-réseau du niveau Base de données.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-159">Create an NSG and associate it to the database tier subnet.</span></span>
2. <span data-ttu-id="bf4b7-160">Ajoutez une règle qui interdit tout le trafic entrant provenant du réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-160">Add a rule that denies all inbound traffic from the VNet.</span></span> <span data-ttu-id="bf4b7-161">(Utilisez la balise `VIRTUAL_NETWORK` dans la règle.)</span><span class="sxs-lookup"><span data-stu-id="bf4b7-161">(Use the `VIRTUAL_NETWORK` tag in the rule.)</span></span> 
3. <span data-ttu-id="bf4b7-162">Ajoutez une règle avec une priorité plus élevée qui autorise le trafic entrant provenant du sous-réseau du niveau Business.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-162">Add a rule with a higher priority that allows inbound traffic from the business tier subnet.</span></span> <span data-ttu-id="bf4b7-163">Cette règle remplace la règle précédente, et permet au niveau Business de communiquer avec le niveau Base de données.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-163">This rule overrides the previous rule, and allows the business tier to talk to the database tier.</span></span>
4. <span data-ttu-id="bf4b7-164">Ajoutez une règle qui autorise le trafic entrant provenant du sous-réseau du niveau Base de données.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-164">Add a rule that allows inbound traffic from within the database tier subnet itself.</span></span> <span data-ttu-id="bf4b7-165">Cette règle autorise la communication entre les machines virtuelles du niveau Base de données, qui est nécessaire pour la réplication de base de données et le basculement.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-165">This rule allows communication between VMs in the database tier, which is needed for database replication and failover.</span></span>
5. <span data-ttu-id="bf4b7-166">Ajoutez une règle qui autorise le trafic SSH à partir du sous-réseau du serveur de rebond.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-166">Add a rule that allows SSH traffic from the jumpbox subnet.</span></span> <span data-ttu-id="bf4b7-167">Cette règle permet aux administrateurs de se connecter au niveau Base de données à partir du serveur de rebond.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-167">This rule lets administrators connect to the database tier from the jumpbox.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="bf4b7-168">Un groupe de sécurité réseau a des [règles par défaut][nsg-rules] qui autorisent tout le trafic entrant provenant du réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-168">An NSG has [default rules][nsg-rules] that allow any inbound traffic from within the VNet.</span></span> <span data-ttu-id="bf4b7-169">Vous ne pouvez pas supprimer ces règles, mais vous pouvez les remplacer en créant des règles de priorité plus élevée.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-169">These rules can't be deleted, but you can override them by creating higher-priority rules.</span></span>
   > 
   > 

### <a name="load-balancers"></a><span data-ttu-id="bf4b7-170">Équilibreurs de charge</span><span class="sxs-lookup"><span data-stu-id="bf4b7-170">Load balancers</span></span>

<span data-ttu-id="bf4b7-171">L’équilibreur de charge externe distribue le trafic Internet vers le niveau Web.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-171">The external load balancer distributes Internet traffic to the web tier.</span></span> <span data-ttu-id="bf4b7-172">Créez une adresse IP publique pour cet équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-172">Create a public IP address for this load balancer.</span></span> <span data-ttu-id="bf4b7-173">Voir [Création d’un équilibreur de charge accessible sur Internet][lb-external-create].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-173">See [Creating an Internet-facing load balancer][lb-external-create].</span></span>

<span data-ttu-id="bf4b7-174">L’équilibreur de charge interne distribue le trafic réseau du niveau Web vers le niveau Business.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-174">The internal load balancer distributes network traffic from the web tier to the business tier.</span></span> <span data-ttu-id="bf4b7-175">Pour attribuer une adresse IP privée à cet équilibreur de charge, créez une configuration IP frontend et associez-la au sous-réseau du niveau Business.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-175">To give this load balancer a private IP address, create a frontend IP configuration and associate it with the subnet for the business tier.</span></span> <span data-ttu-id="bf4b7-176">Voir [Bien démarrer avec la création d’un équilibreur de charge interne][lb-internal-create].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-176">See [Get started creating an Internal load balancer][lb-internal-create].</span></span>

### <a name="cassandra"></a><span data-ttu-id="bf4b7-177">Cassandra</span><span class="sxs-lookup"><span data-stu-id="bf4b7-177">Cassandra</span></span>

<span data-ttu-id="bf4b7-178">Nous vous recommandons d’utiliser [DataStax Enterprise][datastax] pour la production, mais ces recommandations s’appliquent à toute édition de Cassandra.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-178">We recommend [DataStax Enterprise][datastax] for production use, but these recommendations apply to any Cassandra edition.</span></span> <span data-ttu-id="bf4b7-179">Pour plus d’informations sur l’exécution de DataStax dans Azure, consultez le [Guide de déploiement de DataStax Enterprise pour Azure][cassandra-in-azure].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-179">For more information on running DataStax in Azure, see [DataStax Enterprise Deployment Guide for Azure][cassandra-in-azure].</span></span> 

<span data-ttu-id="bf4b7-180">Placez les machines virtuelles pour un cluster Cassandra dans un groupe à haute disponibilité afin de vous assurer que les réplicas Cassandra sont répartis parmi plusieurs domaines d’erreur et domaines de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-180">Put the VMs for a Cassandra cluster in an availability set to ensure that the Cassandra replicas are distributed across multiple fault domains and upgrade domains.</span></span> <span data-ttu-id="bf4b7-181">Pour plus d’informations sur les domaines d’erreur et les domaines de mise à niveau, consultez [Gérer la disponibilité des machines virtuelles][azure-availability-sets].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-181">For more information about fault domains and upgrade domains, see [Manage the availability of virtual machines][azure-availability-sets].</span></span> 

<span data-ttu-id="bf4b7-182">Configurez trois domaines d’erreur (le maximum) et 18 domaines de mise à niveau par groupe à haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-182">Configure three fault domains (the maximum) per availability set and 18 upgrade domains per availability set.</span></span> <span data-ttu-id="bf4b7-183">Cela fournit le nombre maximal de domaines de mise à niveau qui peuvent être répartis uniformément entre les domaines d’erreur.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-183">This provides the maximum number of upgrade domains that can still be distributed evenly across the fault domains.</span></span>   

<span data-ttu-id="bf4b7-184">Configurez les nœuds en mode rack.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-184">Configure nodes in rack-aware mode.</span></span> <span data-ttu-id="bf4b7-185">Mappez les domaines d’erreur à des racks dans le fichier `cassandra-rackdc.properties`.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-185">Map fault domains to racks in the `cassandra-rackdc.properties` file.</span></span>

<span data-ttu-id="bf4b7-186">Vous n’avez pas besoin d’équilibreur de charge devant le cluster.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-186">You don't need a load balancer in front of the cluster.</span></span> <span data-ttu-id="bf4b7-187">Le client se connecte directement à un nœud dans le cluster.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-187">The client connects directly to a node in the cluster.</span></span>

### <a name="jumpbox"></a><span data-ttu-id="bf4b7-188">Serveur de rebond</span><span class="sxs-lookup"><span data-stu-id="bf4b7-188">Jumpbox</span></span>

<span data-ttu-id="bf4b7-189">Le serveur de rebond ayant des exigences de performances minimales, sélectionnez une petite taille de machine virtuelle telle que A1 Standard.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-189">The jumpbox will have minimal performance requirements, so select a small VM size for the jumpbox such as Standard A1.</span></span> 

<span data-ttu-id="bf4b7-190">Créez-lui une [adresse IP publique].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-190">Create a [public IP address] for the jumpbox.</span></span> <span data-ttu-id="bf4b7-191">Placez-le sur le même réseau virtuel que les autres machines virtuelles, mais sur un sous-réseau de gestion distinct.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-191">Place the jumpbox in the same VNet as the other VMs, but in a separate management subnet.</span></span>

<span data-ttu-id="bf4b7-192">N’autorisez pas l’accès SSH à partir de l’Internet public vers les machines virtuelles qui exécutent la charge de travail d’application.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-192">Do not allow SSH access from the public Internet to the VMs that run the application workload.</span></span> <span data-ttu-id="bf4b7-193">Au lieu de cela, tout l’accès SSH à ces machines virtuelles doit transiter par le serveur de rebond.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-193">Instead, all SSH access to these VMs must come through the jumpbox.</span></span> <span data-ttu-id="bf4b7-194">Un administrateur se connecte au serveur de rebond, puis se connecte à l’autre machine virtuelle à partir du serveur de rebond.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-194">An administrator logs into the jumpbox, and then logs into the other VM from the jumpbox.</span></span> <span data-ttu-id="bf4b7-195">Le serveur de rebond autorise le trafic SSH à partir d’Internet, mais uniquement à partir d’adresses IP connues et sûres.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-195">The jumpbox allows SSH traffic from the Internet, but only from known, safe IP addresses.</span></span>

<span data-ttu-id="bf4b7-196">Pour sécuriser le serveur de rebond, créez un groupe de sécurité réseau et appliquez-le au sous-réseau du serveur de rebond.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-196">To secure the jumpbox, create an NSG and apply it to the jumpbox subnet.</span></span> <span data-ttu-id="bf4b7-197">Ajoutez une règle de groupe de sécurité réseau qui autorise les connexions SSH provenant uniquement d’un ensemble sûr d’adresses IP publiques.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-197">Add an NSG rule that allows SSH connections only from a safe set of public IP addresses.</span></span> <span data-ttu-id="bf4b7-198">Le groupe de sécurité réseau peut être attaché au sous-réseau ou à la carte réseau du serveur de rebond.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-198">The NSG can be attached either to the subnet or to the jumpbox NIC.</span></span> <span data-ttu-id="bf4b7-199">Dans le cas présent, nous vous recommandons de l’attacher à la carte réseau, afin que le trafic SSH soit autorisé uniquement vers le serveur de rebond, même si vous ajoutez d’autres machines virtuelles au même sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-199">In this case, we recommend attaching it to the NIC, so SSH traffic is permitted only to the jumpbox, even if you add other VMs to the same subnet.</span></span>

<span data-ttu-id="bf4b7-200">Configurez les groupes de sécurité réseau pour les autres sous-réseaux de façon à autoriser le trafic SSH provenant du sous-réseau de gestion.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-200">Configure the NSGs for the other subnets to allow SSH traffic from the management subnet.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="bf4b7-201">Considérations relatives à la disponibilité</span><span class="sxs-lookup"><span data-stu-id="bf4b7-201">Availability considerations</span></span>

<span data-ttu-id="bf4b7-202">Placez chaque niveau ou rôle de machine virtuelle dans un groupe à haute disponibilité distinct.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-202">Put each tier or VM role into a separate availability set.</span></span> 

<span data-ttu-id="bf4b7-203">Au niveau Base de données, le fait d’avoir plusieurs machines virtuelles ne se traduit pas automatiquement par une base de données hautement disponible.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-203">At the database tier, having multiple VMs does not automatically translate into a highly available database.</span></span> <span data-ttu-id="bf4b7-204">Pour une base de données relationnelle, vous devez généralement utiliser la réplication et le basculement pour obtenir une haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-204">For a relational database, you will typically need to use replication and failover to achieve high availability.</span></span>  

<span data-ttu-id="bf4b7-205">Si vous avez besoin d’une disponibilité plus élevée que celle fournie par le [contrat SLA Azure pour les machines virtuelles][vm-sla], répliquez l’application entre deux régions et utilisez Azure Traffic Manager pour le basculement.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-205">If you need higher availability than the [Azure SLA for VMs][vm-sla] provides, replicate the application across two regions and use Azure Traffic Manager for failover.</span></span> <span data-ttu-id="bf4b7-206">Pour plus d’informations, consultez [Exécuter des machines virtuelles Linux dans plusieurs régions à des fins de haute disponibilité][multi-dc].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-206">For more information, see [Run Linux VMs in multiple regions for high availability][multi-dc].</span></span>  

## <a name="security-considerations"></a><span data-ttu-id="bf4b7-207">Considérations relatives à la sécurité</span><span class="sxs-lookup"><span data-stu-id="bf4b7-207">Security considerations</span></span>

<span data-ttu-id="bf4b7-208">Ajoutez une appliance virtuelle réseau (NVA) pour créer un réseau de périmètre (DMZ) entre l’Internet public et le réseau virtuel Azure.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-208">Consider adding a network virtual appliance (NVA) to create a DMZ between the public Internet and the Azure virtual network.</span></span> <span data-ttu-id="bf4b7-209">NVA est un terme générique décrivant une appliance virtuelle qui peut effectuer des tâches liées au réseau, telles que pare-feu, inspection des paquets, audit et routage personnalisé.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-209">NVA is a generic term for a virtual appliance that can perform network-related tasks such as firewall, packet inspection, auditing, and custom routing.</span></span> <span data-ttu-id="bf4b7-210">Pour plus d’informations, consultez [Implémentation d’une zone DMZ entre Azure et Internet][dmz].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-210">For more information, see [Implementing a DMZ between Azure and the Internet][dmz].</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="bf4b7-211">Considérations relatives à l’extensibilité</span><span class="sxs-lookup"><span data-stu-id="bf4b7-211">Scalability considerations</span></span>

<span data-ttu-id="bf4b7-212">Les équilibreurs de charge distribuent le trafic réseau vers les niveaux Web et Business.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-212">The load balancers distribute network traffic to the web and business tiers.</span></span> <span data-ttu-id="bf4b7-213">Mettez à l’échelle votre solution horizontalement en ajoutant de nouvelles instances de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-213">Scale horizontally by adding new VM instances.</span></span> <span data-ttu-id="bf4b7-214">Notez que vous pouvez mettre à l’échelle les niveaux Web et Business indépendamment, en fonction de la charge.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-214">Note that you can scale the web and business tiers independently, based on load.</span></span> <span data-ttu-id="bf4b7-215">Pour réduire les complications possibles dues à la nécessité de conserver l’affinité du client, les machines virtuelles du niveau Web doivent être sans état.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-215">To reduce possible complications caused by the need to maintain client affinity, the VMs in the web tier should be stateless.</span></span> <span data-ttu-id="bf4b7-216">Les machines virtuelles qui hébergent la logique métier doivent également être sans état.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-216">The VMs hosting the business logic should also be stateless.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="bf4b7-217">Considérations relatives à la facilité de gestion</span><span class="sxs-lookup"><span data-stu-id="bf4b7-217">Manageability considerations</span></span>

<span data-ttu-id="bf4b7-218">Simplifiez la gestion de l’ensemble du système en utilisant des outils d’administration centralisée tels que [Azure Automation][azure-administration], [Microsoft Operations Management Suite][operations-management-suite], [Chef][chef] ou [Puppet][puppet].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-218">Simplify management of the entire system by using centralized administration tools such as [Azure Automation][azure-administration], [Microsoft Operations Management Suite][operations-management-suite], [Chef][chef], or [Puppet][puppet].</span></span> <span data-ttu-id="bf4b7-219">Ces outils peuvent consolider des informations de diagnostic et de contrôle d’intégrité capturées à partir de plusieurs machines virtuelles, afin de fournir une vue d’ensemble du système.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-219">These tools can consolidate diagnostic and health information captured from multiple VMs to provide an overall view of the system.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="bf4b7-220">Déployer la solution</span><span class="sxs-lookup"><span data-stu-id="bf4b7-220">Deploy the solution</span></span>

<span data-ttu-id="bf4b7-221">Un déploiement pour cette architecture de référence est disponible sur [GitHub][github-folder].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-221">A deployment for this reference architecture is available on [GitHub][github-folder].</span></span> 

### <a name="prerequisites"></a><span data-ttu-id="bf4b7-222">Prérequis
</span><span class="sxs-lookup"><span data-stu-id="bf4b7-222">Prerequisites</span></span>

<span data-ttu-id="bf4b7-223">Avant de pouvoir déployer l’architecture de référence sur votre propre abonnement, vous devez effectuer les étapes suivantes.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-223">Before you can deploy the reference architecture to your own subscription, you must perform the following steps.</span></span>

1. <span data-ttu-id="bf4b7-224">Clonez, dupliquez ou téléchargez le fichier zip pour le référentiel GitHub des [architectures de référence][ref-arch-repo].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-224">Clone, fork, or download the zip file for the [reference architectures][ref-arch-repo] GitHub repository.</span></span>

2. <span data-ttu-id="bf4b7-225">Vérifiez qu’Azure CLI 2.0 est installé sur votre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-225">Make sure you have the Azure CLI 2.0 installed on your computer.</span></span> <span data-ttu-id="bf4b7-226">Pour installer l’interface CLI, suivez les instructions fournies dans [Installer Azure CLI 2.0][azure-cli-2].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-226">To install the CLI, follow the instructions in [Install Azure CLI 2.0][azure-cli-2].</span></span>

3. <span data-ttu-id="bf4b7-227">Installez le package npm des [modules Azure][azbb].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-227">Install the [Azure building blocks][azbb] npm package.</span></span>

   ```bash
   npm install -g @mspnp/azure-building-blocks
   ```

4. <span data-ttu-id="bf4b7-228">À partir d’une invite de commandes, d’une invite bash ou de l’invite de commandes PowerShell, connectez-vous à votre compte Azure à l’aide de l’une des commandes ci-dessous et suivez les invites.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-228">From a command prompt, bash prompt, or PowerShell prompt, login to your Azure account by using one of the commands below, and follow the prompts.</span></span>

   ```bash
   az login
   ```

### <a name="deploy-the-solution-using-azbb"></a><span data-ttu-id="bf4b7-229">Déployer la solution à l’aide d’azbb</span><span class="sxs-lookup"><span data-stu-id="bf4b7-229">Deploy the solution using azbb</span></span>

<span data-ttu-id="bf4b7-230">Pour déployer les machines virtuelles Linux pour une architecture de référence d’application multiniveau, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="bf4b7-230">To deploy the Linux VMs for an N-tier application reference architecture, follow these steps:</span></span>

1. <span data-ttu-id="bf4b7-231">Accédez au dossier `virtual-machines\n-tier-linux` pour rechercher le référentiel que vous avez cloné à l’étape 1 des conditions préalables ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-231">Navigate to the `virtual-machines\n-tier-linux` folder for the repository you cloned in step 1 of the pre-requisites above.</span></span>

2. <span data-ttu-id="bf4b7-232">Le fichier de paramètres spécifie un nom d’utilisateur et un mot de passe administrateur par défaut pour chaque machine virtuelle dans le déploiement.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-232">The parameter file specifies a default adminstrator user name and password for each VM in the deployment.</span></span> <span data-ttu-id="bf4b7-233">Vous devez les modifier avant de déployer l’architecture de référence.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-233">You must change these before you deploy the reference architecture.</span></span> <span data-ttu-id="bf4b7-234">Ouvrez le fichier `n-tier-linux.json` et remplacez chaque champ **adminUsername** et **adminPassword** par vos nouveaux paramètres.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-234">Open the `n-tier-linux.json` file and replace each **adminUsername** and **adminPassword** field with your new settings.</span></span>   <span data-ttu-id="bf4b7-235">Enregistrez le fichier .</span><span class="sxs-lookup"><span data-stu-id="bf4b7-235">Save the file.</span></span>

3. <span data-ttu-id="bf4b7-236">Déployez l’architecture de référence à l’aide de l’outil de ligne de commande **azbb**, comme indiqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="bf4b7-236">Deploy the reference architecture using the **azbb** command line tool as shown below.</span></span>

   ```bash
   azbb -s <your subscription_id> -g <your resource_group_name> -l <azure region> -p n-tier-linux.json --deploy
   ```

<span data-ttu-id="bf4b7-237">Pour plus d’informations sur le déploiement de cet exemple d’architecture de référence à l’aide des blocs de construction Azure, visitez notre [référentiel GitHub][git].</span><span class="sxs-lookup"><span data-stu-id="bf4b7-237">For more information on deploying this sample reference architecture using Azure Building Blocks, visit the [GitHub repository][git].</span></span>

<!-- links -->
[multi-dc]: multi-region-application.md
[dmz]: ../dmz/secure-vnet-dmz.md
[multi-vm]: ./multi-vm.md
[naming conventions]: /azure/guidance/guidance-naming-conventions
[azbb]: https://github.com/mspnp/template-building-blocks/wiki/Install-Azure-Building-Blocks
[azure-administration]: /azure/automation/automation-intro
[azure-availability-sets]: /azure/virtual-machines/virtual-machines-linux-manage-availability
[azure-cli-2]: https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest
[azure-dns]: /azure/dns/dns-overview
[hôte bastion]: https://en.wikipedia.org/wiki/Bastion_host
[bastion host]: https://en.wikipedia.org/wiki/Bastion_host
[cassandra-in-azure]: https://docs.datastax.com/en/datastax_enterprise/4.5/datastax_enterprise/install/installAzure.html
[cidr]: https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing
[chef]: https://www.chef.io/solutions/azure/
[datastax]: http://www.datastax.com/products/datastax-enterprise
[git]: https://github.com/mspnp/template-building-blocks
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/n-tier-linux
[lb-external-create]: /azure/load-balancer/load-balancer-get-started-internet-portal
[lb-internal-create]: /azure/load-balancer/load-balancer-get-started-ilb-arm-portal
[load-balancer-external]: /azure/load-balancer/load-balancer-internet-overview
[load-balancer-internal]: /azure/load-balancer/load-balancer-internal-overview
[nsg]: /azure/virtual-network/virtual-networks-nsg
[nsg-rules]: /azure/azure-resource-manager/best-practices-resource-manager-security#network-security-groups
[operations-management-suite]: https://www.microsoft.com/server-cloud/operations-management-suite/overview.aspx
[plan-network]: /azure/virtual-network/virtual-network-vnet-plan-design-arm
[private-ip-space]: https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces
[adresse IP publique]: /azure/virtual-network/virtual-network-ip-addresses-overview-arm
[public IP address]: /azure/virtual-network/virtual-network-ip-addresses-overview-arm
[puppet]: https://puppetlabs.com/blog/managing-azure-virtual-machines-puppet
[ref-arch-repo]: https://github.com/mspnp/reference-architectures
[vm-sla]: https://azure.microsoft.com/support/legal/sla/virtual-machines
[vnet faq]: /azure/virtual-network/virtual-networks-faq
[visio-download]: https://archcenter.blob.core.windows.net/cdn/vm-reference-architectures.vsdx
[Nagios]: https://www.nagios.org/
[Zabbix]: http://www.zabbix.com/
[Icinga]: http://www.icinga.org/
[0]: ./images/n-tier-diagram.png "Architecture multiniveau à l’aide de Microsoft Azure"

