---
title: Penser la conception des applications pour la réparation spontanée
titleSuffix: Azure Application Architecture Guide
description: Les applications résilientes peuvent opérer une récupération après un échec sans intervention manuelle.
author: MikeWasson
ms.date: 08/30/2018
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seojan19
ms.openlocfilehash: 5e5af0be41fa892e490d556ef4286d5367144fd9
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/23/2019
ms.locfileid: "54483936"
---
# <a name="design-for-self-healing"></a><span data-ttu-id="6dba3-103">Penser la conception des applications pour la réparation spontanée</span><span class="sxs-lookup"><span data-stu-id="6dba3-103">Design for self healing</span></span>

## <a name="design-your-application-to-be-self-healing-when-failures-occur"></a><span data-ttu-id="6dba3-104">Concevez votre application pour qu’elle se répare spontanément en cas de défaillance</span><span class="sxs-lookup"><span data-stu-id="6dba3-104">Design your application to be self healing when failures occur</span></span>

<span data-ttu-id="6dba3-105">Dans un système distribué, des défaillances peuvent se produire.</span><span class="sxs-lookup"><span data-stu-id="6dba3-105">In a distributed system, failures happen.</span></span> <span data-ttu-id="6dba3-106">Le matériel peut être défaillant.</span><span class="sxs-lookup"><span data-stu-id="6dba3-106">Hardware can fail.</span></span> <span data-ttu-id="6dba3-107">Le réseau peut subir des échecs temporaires.</span><span class="sxs-lookup"><span data-stu-id="6dba3-107">The network can have transient failures.</span></span> <span data-ttu-id="6dba3-108">Exceptionnellement, un service ou une région entiers peuvent rencontrer des interruptions, mais même ces dernières doivent être planifiées.</span><span class="sxs-lookup"><span data-stu-id="6dba3-108">Rarely, an entire service or region may experience a disruption, but even those must be planned for.</span></span>

<span data-ttu-id="6dba3-109">Il est donc essentiel de concevoir votre application pour qu’elle se répare spontanément en cas de défaillance.</span><span class="sxs-lookup"><span data-stu-id="6dba3-109">Therefore, design an application to be self healing when failures occur.</span></span> <span data-ttu-id="6dba3-110">Cela nécessite une approche en trois étapes :</span><span class="sxs-lookup"><span data-stu-id="6dba3-110">This requires a three-pronged approach:</span></span>

- <span data-ttu-id="6dba3-111">Détecter les défaillances.</span><span class="sxs-lookup"><span data-stu-id="6dba3-111">Detect failures.</span></span>
- <span data-ttu-id="6dba3-112">Répondre aux défaillances de manière appropriée.</span><span class="sxs-lookup"><span data-stu-id="6dba3-112">Respond to failures gracefully.</span></span>
- <span data-ttu-id="6dba3-113">Enregistrer et analyser les défaillances afin de bénéficier d’informations exploitables.</span><span class="sxs-lookup"><span data-stu-id="6dba3-113">Log and monitor failures, to give operational insight.</span></span>

<span data-ttu-id="6dba3-114">La manière dont vous répondez à un type particulier de défaillance peut dépendre des exigences de disponibilité de votre application.</span><span class="sxs-lookup"><span data-stu-id="6dba3-114">How you respond to a particular type of failure may depend on your application's availability requirements.</span></span> <span data-ttu-id="6dba3-115">Par exemple, si vous avez besoin d’une très haute disponibilité, vous pouvez effectuer un basculement automatique dans une région secondaire en cas de panne régionale.</span><span class="sxs-lookup"><span data-stu-id="6dba3-115">For example, if you require very high availability, you might automatically fail over to a secondary region during a regional outage.</span></span> <span data-ttu-id="6dba3-116">Toutefois, cela implique un coût plus élevé qu’un déploiement dans une seule région.</span><span class="sxs-lookup"><span data-stu-id="6dba3-116">However, that will incur a higher cost than a single-region deployment.</span></span>

<span data-ttu-id="6dba3-117">En outre, ne pensez pas uniquement aux événements importants tels que les pannes de courant régionales qui sont généralement rares.</span><span class="sxs-lookup"><span data-stu-id="6dba3-117">Also, don't just consider big events like regional outages, which are generally rare.</span></span> <span data-ttu-id="6dba3-118">Vous devez vous focaliser tout autant, voire davantage, sur la gestion des défaillances locales et de courte durée, telles que les défaillances de connectivité réseau ou les échecs de connexion aux bases de données.</span><span class="sxs-lookup"><span data-stu-id="6dba3-118">You should focus as much, if not more, on handling local, short-lived failures, such as network connectivity failures or failed database connections.</span></span>

## <a name="recommendations"></a><span data-ttu-id="6dba3-119">Recommandations</span><span class="sxs-lookup"><span data-stu-id="6dba3-119">Recommendations</span></span>

<span data-ttu-id="6dba3-120">**Relance des opérations ayant échoué**.</span><span class="sxs-lookup"><span data-stu-id="6dba3-120">**Retry failed operations**.</span></span> <span data-ttu-id="6dba3-121">Les échecs temporaires peuvent se produire en raison d’une perte momentanée de la connectivité réseau, d’une connexion à une base de données interrompue ou d’un délai d’attente lorsqu’un service est occupé.</span><span class="sxs-lookup"><span data-stu-id="6dba3-121">Transient failures may occur due to momentary loss of network connectivity, a dropped database connection, or a timeout when a service is busy.</span></span> <span data-ttu-id="6dba3-122">Intégrez une logique de relance à votre application pour gérer les défaillances temporaires.</span><span class="sxs-lookup"><span data-stu-id="6dba3-122">Build retry logic into your application to handle transient failures.</span></span> <span data-ttu-id="6dba3-123">Pour de nombreux services Azure, le Kit de développement logiciel client implémente de nouvelles tentatives automatiques.</span><span class="sxs-lookup"><span data-stu-id="6dba3-123">For many Azure services, the client SDK implements automatic retries.</span></span> <span data-ttu-id="6dba3-124">Pour plus d’informations, consultez [Gestion des erreurs temporaires][transient-fault-handling] et le [Modèle Nouvelle tentative][retry].</span><span class="sxs-lookup"><span data-stu-id="6dba3-124">For more information, see [Transient fault handling][transient-fault-handling] and the [Retry pattern][retry].</span></span>

<span data-ttu-id="6dba3-125">**Protéger les services distants ayant échoué (Disjoncteur)**.</span><span class="sxs-lookup"><span data-stu-id="6dba3-125">**Protect failing remote services (Circuit Breaker)**.</span></span> <span data-ttu-id="6dba3-126">Il est judicieux de lancer de nouvelles tentatives après une défaillance temporaire, mais si le problème persiste, vous pouvez vous retrouver avec un trop grand nombre d’appels vers le service défectueux.</span><span class="sxs-lookup"><span data-stu-id="6dba3-126">It's good to retry after a transient failure, but if the failure persists, you can end up with too many callers hammering a failing service.</span></span> <span data-ttu-id="6dba3-127">Cela peut entraîner des échecs en cascade à mesure que les requêtes sont sauvegardées.</span><span class="sxs-lookup"><span data-stu-id="6dba3-127">This can lead to cascading failures, as requests back up.</span></span> <span data-ttu-id="6dba3-128">Utilisez le [modèle Disjoncteur][circuit-breaker] pour effectuer un Fail-fast (sans effectuer l’appel distant) quand l’échec d’une opération est susceptible de se produire.</span><span class="sxs-lookup"><span data-stu-id="6dba3-128">Use the [Circuit Breaker pattern][circuit-breaker] to fail fast (without making the remote call) when an operation is likely to fail.</span></span>

<span data-ttu-id="6dba3-129">**Isoler les ressources critiques (Cloisonnement)**.</span><span class="sxs-lookup"><span data-stu-id="6dba3-129">**Isolate critical resources (Bulkhead)**.</span></span> <span data-ttu-id="6dba3-130">Un sous-système peut parfois être victime de défaillances en cascade.</span><span class="sxs-lookup"><span data-stu-id="6dba3-130">Failures in one subsystem can sometimes cascade.</span></span> <span data-ttu-id="6dba3-131">Cela peut se produire si une défaillance empêche que certaines ressources, telles que des threads ou des sockets, ne soient libérées en temps voulu, menant à un épuisement des ressources.</span><span class="sxs-lookup"><span data-stu-id="6dba3-131">This can happen if a failure causes some resources, such as threads or sockets, not to get freed in a timely manner, leading to resource exhaustion.</span></span> <span data-ttu-id="6dba3-132">Pour éviter ce problème, partitionnez un système en groupes isolés, de manière à ce qu’une défaillance présente dans une partition ne détériore pas l’ensemble du système.</span><span class="sxs-lookup"><span data-stu-id="6dba3-132">To avoid this, partition a system into isolated groups, so that a failure in one partition does not bring down the entire system.</span></span>

<span data-ttu-id="6dba3-133">**Effectuer un nivellement de la charge**.</span><span class="sxs-lookup"><span data-stu-id="6dba3-133">**Perform load leveling**.</span></span> <span data-ttu-id="6dba3-134">Les applications peuvent rencontrer des pics soudains dans le trafic qui peuvent surcharger les services sur le serveur principal.</span><span class="sxs-lookup"><span data-stu-id="6dba3-134">Applications may experience sudden spikes in traffic that can overwhelm services on the backend.</span></span> <span data-ttu-id="6dba3-135">Pour éviter cela, utilisez le [Modèle de nivellement de charge basé sur une file d’attente][load-level] afin de mettre en file d’attente les éléments de travail pour qu’ils s’exécutent de manière asynchrone.</span><span class="sxs-lookup"><span data-stu-id="6dba3-135">To avoid this, use the [Queue-Based Load Leveling pattern][load-level] to queue work items to run asynchronously.</span></span> <span data-ttu-id="6dba3-136">La file d’attente agit comme une mémoire tampon qui lisse des pics de charge.</span><span class="sxs-lookup"><span data-stu-id="6dba3-136">The queue acts as a buffer that smooths out peaks in the load.</span></span>

<span data-ttu-id="6dba3-137">**Effectuer un basculement**.</span><span class="sxs-lookup"><span data-stu-id="6dba3-137">**Fail over**.</span></span> <span data-ttu-id="6dba3-138">Si une instance ne peut pas être atteinte, effectuez un basculement vers une autre instance.</span><span class="sxs-lookup"><span data-stu-id="6dba3-138">If an instance can't be reached, fail over to another instance.</span></span> <span data-ttu-id="6dba3-139">Pour les éléments sans état, tels qu’un serveur web, placez plusieurs instances derrière un équilibreur de charge ou un gestionnaire de trafic.</span><span class="sxs-lookup"><span data-stu-id="6dba3-139">For things that are stateless, like a web server, put several instances behind a load balancer or traffic manager.</span></span> <span data-ttu-id="6dba3-140">Pour les éléments avec état, tels qu’une base de données, utilisez des réplicas et le basculement.</span><span class="sxs-lookup"><span data-stu-id="6dba3-140">For things that store state, like a database, use replicas and fail over.</span></span> <span data-ttu-id="6dba3-141">Selon la banque de données et la manière dont elle est répliquée, l’application peut avoir besoin de mettre en place la cohérence éventuelle.</span><span class="sxs-lookup"><span data-stu-id="6dba3-141">Depending on the data store and how it replicates, this may require the application to deal with eventual consistency.</span></span>

<span data-ttu-id="6dba3-142">**Compenser les transactions qui ont échoué**.</span><span class="sxs-lookup"><span data-stu-id="6dba3-142">**Compensate failed transactions**.</span></span> <span data-ttu-id="6dba3-143">En règle générale, évitez les transactions distribuées, car elles requièrent une coordination entre les services et les ressources.</span><span class="sxs-lookup"><span data-stu-id="6dba3-143">In general, avoid distributed transactions, as they require coordination across services and resources.</span></span> <span data-ttu-id="6dba3-144">Au lieu de cela, concevez une opération à partir de transactions individuelles de plus petite taille.</span><span class="sxs-lookup"><span data-stu-id="6dba3-144">Instead, compose an operation from smaller individual transactions.</span></span> <span data-ttu-id="6dba3-145">Si l’opération échoue en cours de traitement, utilisez des [transactions de compensation][compensating-transactions] pour annuler les étapes qui ont déjà été effectuées.</span><span class="sxs-lookup"><span data-stu-id="6dba3-145">If the operation fails midway through, use [Compensating Transactions][compensating-transactions] to undo any step that already completed.</span></span>

<span data-ttu-id="6dba3-146">**Créer des points de contrôle pour les transactions de longue durée**.</span><span class="sxs-lookup"><span data-stu-id="6dba3-146">**Checkpoint long-running transactions**.</span></span> <span data-ttu-id="6dba3-147">Les points de contrôle peuvent fournir la résilience en cas d’échec d’une opération longue.</span><span class="sxs-lookup"><span data-stu-id="6dba3-147">Checkpoints can provide resiliency if a long-running operation fails.</span></span> <span data-ttu-id="6dba3-148">Lors du redémarrage de l’opération (par exemple si elle est récupérée par une autre machine virtuelle), elle peut être reprise à partir du dernier point de contrôle.</span><span class="sxs-lookup"><span data-stu-id="6dba3-148">When the operation restarts (for example, it is picked up by another VM), it can be resumed from the last checkpoint.</span></span>

<span data-ttu-id="6dba3-149">**Appliquer une dégradation normale**.</span><span class="sxs-lookup"><span data-stu-id="6dba3-149">**Degrade gracefully**.</span></span> <span data-ttu-id="6dba3-150">Parfois, vous ne pouvez pas résoudre le problème, mais vous pouvez fournir des fonctionnalités réduites qui s’avèrent toujours utiles.</span><span class="sxs-lookup"><span data-stu-id="6dba3-150">Sometimes you can't work around a problem, but you can provide reduced functionality that is still useful.</span></span> <span data-ttu-id="6dba3-151">Imaginez une application qui propose un catalogue de livres.</span><span class="sxs-lookup"><span data-stu-id="6dba3-151">Consider an application that shows a catalog of books.</span></span> <span data-ttu-id="6dba3-152">Si l’application ne peut pas récupérer l’image miniature de la couverture, elle affichera une image de substitution.</span><span class="sxs-lookup"><span data-stu-id="6dba3-152">If the application can't retrieve the thumbnail image for the cover, it might show a placeholder image.</span></span> <span data-ttu-id="6dba3-153">Des sous-systèmes entiers peuvent s’avérer non critiques pour l’application.</span><span class="sxs-lookup"><span data-stu-id="6dba3-153">Entire subsystems might be noncritical for the application.</span></span> <span data-ttu-id="6dba3-154">Par exemple, dans le cas d’un site de commerce en ligne, l’affichage des recommandations de produits est probablement moins important que le traitement des commandes.</span><span class="sxs-lookup"><span data-stu-id="6dba3-154">For example, in an e-commerce site, showing product recommendations is probably less critical than processing orders.</span></span>

<span data-ttu-id="6dba3-155">**Limiter les clients**.</span><span class="sxs-lookup"><span data-stu-id="6dba3-155">**Throttle clients**.</span></span> <span data-ttu-id="6dba3-156">Parfois, seuls quelques utilisateurs créent une charge excessive, ce qui peut réduire la disponibilité de votre application pour les autres utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="6dba3-156">Sometimes a small number of users create excessive load, which can reduce your application's availability for other users.</span></span> <span data-ttu-id="6dba3-157">Dans ce cas, limitez le client pendant un certain temps.</span><span class="sxs-lookup"><span data-stu-id="6dba3-157">In this situation, throttle the client for a certain period of time.</span></span> <span data-ttu-id="6dba3-158">Consultez le [Modèle de limitation][throttle].</span><span class="sxs-lookup"><span data-stu-id="6dba3-158">See the [Throttling pattern][throttle].</span></span>

<span data-ttu-id="6dba3-159">**Bloquer les acteurs malveillants**.</span><span class="sxs-lookup"><span data-stu-id="6dba3-159">**Block bad actors**.</span></span> <span data-ttu-id="6dba3-160">Le fait de limiter un client ne signifie pas que celui-ci agissait de façon malveillante.</span><span class="sxs-lookup"><span data-stu-id="6dba3-160">Just because you throttle a client, it doesn't mean client was acting maliciously.</span></span> <span data-ttu-id="6dba3-161">Cela signifie simplement que le client a dépassé son quota de service.</span><span class="sxs-lookup"><span data-stu-id="6dba3-161">It just means the client exceeded their service quota.</span></span> <span data-ttu-id="6dba3-162">Mais si un client dépasse constamment son quota ou se comporte de manière incorrecte, vous pouvez le bloquer.</span><span class="sxs-lookup"><span data-stu-id="6dba3-162">But if a client consistently exceeds their quota or otherwise behaves badly, you might block them.</span></span> <span data-ttu-id="6dba3-163">Définissez un processus hors-bande pour que l’utilisateur puisse demander à être débloqué.</span><span class="sxs-lookup"><span data-stu-id="6dba3-163">Define an out-of-band process for user to request getting unblocked.</span></span>

<span data-ttu-id="6dba3-164">**Utiliser la fonction d’élection du responsable**.</span><span class="sxs-lookup"><span data-stu-id="6dba3-164">**Use leader election**.</span></span> <span data-ttu-id="6dba3-165">Lorsque vous avez besoin de coordonner une tâche, utilisez la fonction [Élection du responsable][leader-election] pour sélectionner un coordinateur.</span><span class="sxs-lookup"><span data-stu-id="6dba3-165">When you need to coordinate a task, use [Leader Election][leader-election] to select a coordinator.</span></span> <span data-ttu-id="6dba3-166">De cette façon, le coordinateur ne constitue pas un point de défaillance unique.</span><span class="sxs-lookup"><span data-stu-id="6dba3-166">That way, the coordinator is not a single point of failure.</span></span> <span data-ttu-id="6dba3-167">Si le coordinateur échoue, un autre est sélectionné.</span><span class="sxs-lookup"><span data-stu-id="6dba3-167">If the coordinator fails, a new one is selected.</span></span> <span data-ttu-id="6dba3-168">Au lieu d’implémenter vous-même un algorithme d’élection du responsable, envisagez d’adopter une solution prête à l’emploi telle que Zookeeper.</span><span class="sxs-lookup"><span data-stu-id="6dba3-168">Rather than implement a leader election algorithm from scratch, consider an off-the-shelf solution such as Zookeeper.</span></span>

<span data-ttu-id="6dba3-169">**Procéder à des tests avec injection d’erreurs**.</span><span class="sxs-lookup"><span data-stu-id="6dba3-169">**Test with fault injection**.</span></span> <span data-ttu-id="6dba3-170">Trop souvent, on teste le chemin d’accès en cas de réussite mais pas celui en cas d’échec.</span><span class="sxs-lookup"><span data-stu-id="6dba3-170">All too often, the success path is well tested but not the failure path.</span></span> <span data-ttu-id="6dba3-171">Un système peut s’exécuter en mode de production pendant longtemps avant qu’un chemin d’échec ne soit utilisé.</span><span class="sxs-lookup"><span data-stu-id="6dba3-171">A system could run in production for a long time before a failure path is exercised.</span></span> <span data-ttu-id="6dba3-172">Utilisez l’injection d’erreurs pour tester la résilience du système lors de pannes, en déclenchant des échecs réels ou simulés.</span><span class="sxs-lookup"><span data-stu-id="6dba3-172">Use fault injection to test the resiliency of the system to failures, either by triggering actual failures or by simulating them.</span></span>

<span data-ttu-id="6dba3-173">**Adopter l’ingénierie du chaos**.</span><span class="sxs-lookup"><span data-stu-id="6dba3-173">**Embrace chaos engineering**.</span></span> <span data-ttu-id="6dba3-174">L’ingénierie du chaos étend la notion d’injection d’erreurs en injectant de manière aléatoire des défaillances ou des conditions anormales dans les instances de production.</span><span class="sxs-lookup"><span data-stu-id="6dba3-174">Chaos engineering extends the notion of fault injection, by randomly injecting failures or abnormal conditions into production instances.</span></span>

<span data-ttu-id="6dba3-175">Pour mettre en place une approche structurée permettant la réparation spontanée de vos applications, consultez l’article [Conception d’applications résilientes pour Azure][resiliency-overview].</span><span class="sxs-lookup"><span data-stu-id="6dba3-175">For a structured approach to making your applications self healing, see [Design resilient applications for Azure][resiliency-overview].</span></span>

<!-- links -->

[circuit-breaker]: ../../patterns/circuit-breaker.md
[compensating-transactions]: ../../patterns/compensating-transaction.md
[leader-election]: ../../patterns/leader-election.md
[load-level]: ../../patterns/queue-based-load-leveling.md
[resiliency-overview]: ../../resiliency/index.md
[retry]: ../../patterns/retry.md
[throttle]: ../../patterns/throttling.md
[transient-fault-handling]: ../../best-practices/transient-faults.md
