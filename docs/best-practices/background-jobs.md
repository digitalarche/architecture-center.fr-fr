---
title: "Conseils sur les travaux en arrière-plan"
description: "Conseils portant sur l’exécution de tâches en arrière-plan indépendamment de l’interface utilisateur."
author: dragon119
ms.date: 05/24/2017
pnp.series.title: Best Practices
ms.openlocfilehash: d8c1d4dfe12208b72fd6991def805f90a830b5f0
ms.sourcegitcommit: a8453c4bc7c870fa1a12bb3c02e3b310db87530c
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/29/2017
---
# <a name="background-jobs"></a><span data-ttu-id="2e787-103">Travaux en arrière-plan</span><span class="sxs-lookup"><span data-stu-id="2e787-103">Background jobs</span></span>
[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="2e787-104">Plusieurs types d’applications requièrent des tâches en arrière-plan qui s’exécutent indépendamment de l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2e787-104">Many types of applications require background tasks that run independently of the user interface (UI).</span></span> <span data-ttu-id="2e787-105">Citons, par exemple, les traitements par lots, les tâches de traitement intensif et les processus de longue durée, comme les workflows.</span><span class="sxs-lookup"><span data-stu-id="2e787-105">Examples include batch jobs, intensive processing tasks, and long-running processes such as workflows.</span></span> <span data-ttu-id="2e787-106">Les travaux en arrière-plan peuvent être exécutés sans nécessiter l’intervention de l’utilisateur. L’application peut démarrer le travail et continuer à traiter les demandes interactives des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="2e787-106">Background jobs can be executed without requiring user interaction--the application can start the job and then continue to process interactive requests from users.</span></span> <span data-ttu-id="2e787-107">Ce processus peut favoriser la réduction de la charge sur l’interface utilisateur de l’application, ce qui peut améliorer la disponibilité et limiter les temps de réponse interactifs.</span><span class="sxs-lookup"><span data-stu-id="2e787-107">This can help to minimize the load on the application UI, which can improve availability and reduce interactive response times.</span></span>

<span data-ttu-id="2e787-108">Par exemple, si une application doit générer des images miniatures chargées par les utilisateurs, elle peut effectuer ce travail en arrière-plan et enregistrer les miniatures dans le stockage une fois le travail terminé, sans que l’utilisateur ait besoin d’attendre la fin du processus.</span><span class="sxs-lookup"><span data-stu-id="2e787-108">For example, if an application is required to generate thumbnails of images that are uploaded by users, it can do this as a background job and save the thumbnail to storage when it is complete--without the user needing to wait for the process to be completed.</span></span> <span data-ttu-id="2e787-109">De même, un utilisateur qui lance une commande peut lancer un workflow en arrière-plan pour traiter cette dernière, tandis que l’interface utilisateur permet à l’utilisateur de continuer à parcourir l’application web.</span><span class="sxs-lookup"><span data-stu-id="2e787-109">In the same way, a user placing an order can initiate a background workflow that processes the order, while the UI allows the user to continue browsing the web app.</span></span> <span data-ttu-id="2e787-110">Une fois le travail en arrière-plan terminé, le système peut mettre à jour la commande stockée et envoyer un e-mail de confirmation de la commande à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2e787-110">When the background job is complete, it can update the stored orders data and send an email to the user that confirms the order.</span></span>

<span data-ttu-id="2e787-111">Si vous envisagez d’implémenter une tâche en tant que travail en arrière-plan, vous devez en premier lieu savoir si cette tâche peut s’exécuter sans intervention de l’utilisateur et sans que l’interface utilisateur ait besoin d’attendre la fin du travail.</span><span class="sxs-lookup"><span data-stu-id="2e787-111">When you consider whether to implement a task as a background job, the main criteria is whether the task can run without user interaction and without the UI needing to wait for the job to be completed.</span></span> <span data-ttu-id="2e787-112">En effet, il n’est pas recommandé d’exécuter en arrière-plan des tâches qui obligent l’utilisateur ou l’interface utilisateur à attendre la fin de leur exécution.</span><span class="sxs-lookup"><span data-stu-id="2e787-112">Tasks that require the user or the UI to wait while they are completed might not be appropriate as background jobs.</span></span>

## <a name="types-of-background-jobs"></a><span data-ttu-id="2e787-113">Types de travaux en arrière-plan</span><span class="sxs-lookup"><span data-stu-id="2e787-113">Types of background jobs</span></span>
<span data-ttu-id="2e787-114">Les travaux en arrière-plan incluent généralement un ou plusieurs des types de travaux suivants :</span><span class="sxs-lookup"><span data-stu-id="2e787-114">Background jobs typically include one or more of the following types of jobs:</span></span>

* <span data-ttu-id="2e787-115">Travaux nécessitant beaucoup de ressources processeur, comme les calculs mathématiques, les analyses de modèles structurels, etc.</span><span class="sxs-lookup"><span data-stu-id="2e787-115">CPU-intensive jobs, such as mathematical calculations or structural model analysis.</span></span>
* <span data-ttu-id="2e787-116">Travaux nécessitant un grand nombre d’E/S, comme l’exécution d’une suite de transactions de stockage ou l’indexation de fichiers.</span><span class="sxs-lookup"><span data-stu-id="2e787-116">I/O-intensive jobs, such as executing a series of storage transactions or indexing files.</span></span>
* <span data-ttu-id="2e787-117">Travaux de traitement par lots, comme les opérations de traitement planifiées ou les mises à jour de données exécutées la nuit.</span><span class="sxs-lookup"><span data-stu-id="2e787-117">Batch jobs, such as nightly data updates or scheduled processing.</span></span>
* <span data-ttu-id="2e787-118">Workflows de longue durée, comme le traitement de commandes ou l’approvisionnement de services et systèmes.</span><span class="sxs-lookup"><span data-stu-id="2e787-118">Long-running workflows, such as order fulfillment, or provisioning services and systems.</span></span>
* <span data-ttu-id="2e787-119">Tâches de traitement de données sensibles, qui nécessitent d’être déplacées vers un emplacement plus sécurisé pour être traitées.</span><span class="sxs-lookup"><span data-stu-id="2e787-119">Sensitive-data processing where the task is handed off to a more secure location for processing.</span></span> <span data-ttu-id="2e787-120">Par exemple, vous devez éviter de traiter des données sensibles dans une application web.</span><span class="sxs-lookup"><span data-stu-id="2e787-120">For example, you might not want to process sensitive data within a web app.</span></span> <span data-ttu-id="2e787-121">À la place, utilisez un modèle de type [opérateur de contrôle d’appels](http://msdn.microsoft.com/library/dn589793.aspx) pour transférer les données à un processus en arrière-plan isolé, qui peut accéder au stockage protégé.</span><span class="sxs-lookup"><span data-stu-id="2e787-121">Instead, you might use a pattern such as [Gatekeeper](http://msdn.microsoft.com/library/dn589793.aspx) to transfer the data to an isolated background process that has access to protected storage.</span></span>

## <a name="triggers"></a><span data-ttu-id="2e787-122">Déclencheurs</span><span class="sxs-lookup"><span data-stu-id="2e787-122">Triggers</span></span>
<span data-ttu-id="2e787-123">Vous pouvez lancer un travail en arrière-plan de différentes manières.</span><span class="sxs-lookup"><span data-stu-id="2e787-123">Background jobs can be initiated in several different ways.</span></span> <span data-ttu-id="2e787-124">Ces tâches appartiennent toutes à l’une des catégories suivantes :</span><span class="sxs-lookup"><span data-stu-id="2e787-124">They fall into one of the following categories:</span></span>

* <span data-ttu-id="2e787-125">[**Déclencheurs pilotés par les événements**](#event-driven-triggers).</span><span class="sxs-lookup"><span data-stu-id="2e787-125">[**Event-driven triggers**](#event-driven-triggers).</span></span> <span data-ttu-id="2e787-126">La tâche est lancée suite à un événement, généralement une action effectuée par un utilisateur ou une étape d’un workflow.</span><span class="sxs-lookup"><span data-stu-id="2e787-126">The task is started in response to an event, typically an action taken by a user or a step in a workflow.</span></span>
* <span data-ttu-id="2e787-127">[**Déclencheurs pilotés par les planifications**](#schedule-driven-triggers).</span><span class="sxs-lookup"><span data-stu-id="2e787-127">[**Schedule-driven triggers**](#schedule-driven-triggers).</span></span> <span data-ttu-id="2e787-128">La tâche est appelée sur la base d’une planification basée sur un minuteur.</span><span class="sxs-lookup"><span data-stu-id="2e787-128">The task is invoked on a schedule based on a timer.</span></span> <span data-ttu-id="2e787-129">Il peut s’agir d’une planification périodique ou d’un appel unique prévu pour une date ultérieure.</span><span class="sxs-lookup"><span data-stu-id="2e787-129">This might be a recurring schedule or a one-off invocation that is specified for a later time.</span></span>

### <a name="event-driven-triggers"></a><span data-ttu-id="2e787-130">Déclencheurs pilotés par les événements</span><span class="sxs-lookup"><span data-stu-id="2e787-130">Event-driven triggers</span></span>
<span data-ttu-id="2e787-131">Lors d’un appel piloté par un événement, un déclencheur est utilisé pour démarrer la tâche en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-131">Event-driven invocation uses a trigger to start the background task.</span></span> <span data-ttu-id="2e787-132">Voici quelques exemples d’utilisation de déclencheurs pilotés par les événements :</span><span class="sxs-lookup"><span data-stu-id="2e787-132">Examples of using event-driven triggers include:</span></span>

* <span data-ttu-id="2e787-133">L’interface utilisateur, ou un autre travail, place un message dans une file d’attente.</span><span class="sxs-lookup"><span data-stu-id="2e787-133">The UI or another job places a message in a queue.</span></span> <span data-ttu-id="2e787-134">Ce message contient des données relatives à une action qui a eu lieu, comme une commande passée par un utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2e787-134">The message contains data about an action that has taken place, such as the user placing an order.</span></span> <span data-ttu-id="2e787-135">La tâche en arrière-plan est à l’écoute sur cette file d’attente et détecte l’arrivée d’un nouveau message.</span><span class="sxs-lookup"><span data-stu-id="2e787-135">The background task listens on this queue and detects the arrival of a new message.</span></span> <span data-ttu-id="2e787-136">Elle le lit et utilise les données qu’il inclut en tant qu’entrée pour le travail en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-136">It reads the message and uses the data in it as the input to the background job.</span></span>
* <span data-ttu-id="2e787-137">L’interface utilisateur, ou l’autre travail, enregistre ou met à jour une valeur dans le stockage.</span><span class="sxs-lookup"><span data-stu-id="2e787-137">The UI or another job saves or updates a value in storage.</span></span> <span data-ttu-id="2e787-138">La tâche en arrière-plan surveille le stockage et détecte les modifications éventuelles.</span><span class="sxs-lookup"><span data-stu-id="2e787-138">The background task monitors the storage and detects changes.</span></span> <span data-ttu-id="2e787-139">Elle lit les données et les utilise en tant qu’entrée pour le travail en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-139">It reads the data and uses it as the input to the background job.</span></span>
* <span data-ttu-id="2e787-140">L’interface utilisateur, ou l’autre travail, envoie une demande à un point de terminaison, tel qu’un URI HTTPS, ou à une API exposée en tant que service web.</span><span class="sxs-lookup"><span data-stu-id="2e787-140">The UI or another job makes a request to an endpoint, such as an HTTPS URI, or an API that is exposed as a web service.</span></span> <span data-ttu-id="2e787-141">Elle transmet les données nécessaires pour terminer la tâche en arrière-plan dans le cadre de la demande.</span><span class="sxs-lookup"><span data-stu-id="2e787-141">It passes the data that is required to complete the background task as part of the request.</span></span> <span data-ttu-id="2e787-142">Le point de terminaison ou le service web appelle la tâche en arrière-plan, qui utilise les données en tant qu’entrée.</span><span class="sxs-lookup"><span data-stu-id="2e787-142">The endpoint or web service invokes the background task, which uses the data as its input.</span></span>

<span data-ttu-id="2e787-143">L’appel piloté par un événement est adapté à plusieurs types de tâches, comme le traitement d’images, les workflows, l’envoi d’informations à des services distants, l’envoi d’e-mails et l’attribution de nouveaux utilisateurs dans des applications multilocataires.</span><span class="sxs-lookup"><span data-stu-id="2e787-143">Typical examples of tasks that are suited to event-driven invocation include image processing, workflows, sending information to remote services, sending email messages, and provisioning new users in multitenant applications.</span></span>

### <a name="schedule-driven-triggers"></a><span data-ttu-id="2e787-144">Déclencheurs pilotés par les planifications</span><span class="sxs-lookup"><span data-stu-id="2e787-144">Schedule-driven triggers</span></span>
<span data-ttu-id="2e787-145">Lors d’un appel piloté par une planification, un minuteur est utilisé pour démarrer la tâche en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-145">Schedule-driven invocation uses a timer to start the background task.</span></span> <span data-ttu-id="2e787-146">Voici quelques exemples d’utilisation de déclencheurs pilotés par des planifications :</span><span class="sxs-lookup"><span data-stu-id="2e787-146">Examples of using schedule-driven triggers include:</span></span>

* <span data-ttu-id="2e787-147">Un minuteur exécuté en local dans l’application ou en tant qu’élément du système d’exploitation de l’application appelle une tâche en arrière-plan de manière régulière.</span><span class="sxs-lookup"><span data-stu-id="2e787-147">A timer that is running locally within the application or as part of the application’s operating system invokes a background task on a regular basis.</span></span>
* <span data-ttu-id="2e787-148">Un minuteur exécuté dans une autre application, ou un service de minuteur comme Azure Scheduler, envoie régulièrement une demande à un service web ou à une API.</span><span class="sxs-lookup"><span data-stu-id="2e787-148">A timer that is running in a different application, or a timer service such as Azure Scheduler, sends a request to an API or web service on a regular basis.</span></span> <span data-ttu-id="2e787-149">Le service web ou l’API appelle la tâche en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-149">The API or web service invokes the background task.</span></span>
* <span data-ttu-id="2e787-150">Une application ou un processus distincts démarrent un minuteur, qui déclenche l’appel de la tâche en arrière-plan après un certain délai, ou à une heure spécifique.</span><span class="sxs-lookup"><span data-stu-id="2e787-150">A separate process or application starts a timer that causes the background task to be invoked once after a specified time delay, or at a specific time.</span></span>

<span data-ttu-id="2e787-151">L’appel piloté par une planification est adapté pour plusieurs types de tâches, comme les routines de traitement par lots (par exemple, mise à jour des listes de produits associés sur la base du comportement récent des utilisateurs), les tâches de traitement des données de routine (comme la mise à jour d’index ou la génération de résultats cumulés), l’analyse des données pour les rapports quotidiens, le nettoyage des données de rétention et la vérification de la cohérence des données.</span><span class="sxs-lookup"><span data-stu-id="2e787-151">Typical examples of tasks that are suited to schedule-driven invocation include batch-processing routines (such as updating related-products lists for users based on their recent behavior), routine data processing tasks (such as updating indexes or generating accumulated results), data analysis for daily reports, data retention cleanup, and data consistency checks.</span></span>

<span data-ttu-id="2e787-152">Si vous utilisez une tâche pilotée par une planification qui doit s’exécuter en tant qu’instance unique, tenez compte de ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="2e787-152">If you use a schedule-driven task that must run as a single instance, be aware of the following:</span></span>

* <span data-ttu-id="2e787-153">Si l’instance de calcul qui exécute le planificateur (par exemple, une machine virtuelle utilisant des tâches Windows planifiées) est mise à l’échelle, plusieurs instances du planificateur peuvent s’exécuter.</span><span class="sxs-lookup"><span data-stu-id="2e787-153">If the compute instance that is running the scheduler (such as a virtual machine using Windows scheduled tasks) is scaled, you will have multiple instances of the scheduler running.</span></span> <span data-ttu-id="2e787-154">Ces instances peuvent alors démarrer plusieurs instances de la tâche.</span><span class="sxs-lookup"><span data-stu-id="2e787-154">These could start multiple instances of the task.</span></span>
* <span data-ttu-id="2e787-155">Si les tâches s’exécutent plus longtemps que la période séparant deux événements du planificateur, le planificateur peut démarrer une autre instance de la tâche alors que l’instance précédente est toujours en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="2e787-155">If tasks run for longer than the period between scheduler events, the scheduler may start another instance of the task while the previous one is still running.</span></span>

## <a name="returning-results"></a><span data-ttu-id="2e787-156">Renvoi de résultats</span><span class="sxs-lookup"><span data-stu-id="2e787-156">Returning results</span></span>
<span data-ttu-id="2e787-157">Les travaux en arrière-plan s’exécutent de façon asynchrone dans un processus distinct, voire à un autre emplacement, à partir de l’interface utilisateur ou du processus qui a appelé la tâche en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-157">Background jobs execute asynchronously in a separate process, or even in a separate location, from the UI or the process that invoked the background task.</span></span> <span data-ttu-id="2e787-158">Dans l’idéal, les tâches en arrière-plan sont des opérations de type « Fire and Forget » ; la progression de leur exécution n’a aucun impact sur l’interface utilisateur ou le processus appelant.</span><span class="sxs-lookup"><span data-stu-id="2e787-158">Ideally, background tasks are “fire and forget” operations, and their execution progress has no impact on the UI or the calling process.</span></span> <span data-ttu-id="2e787-159">Cela signifie que le processus appelant n’attend pas la fin des tâches.</span><span class="sxs-lookup"><span data-stu-id="2e787-159">This means that the calling process does not wait for completion of the tasks.</span></span> <span data-ttu-id="2e787-160">Il ne peut donc pas déterminer automatiquement quand la tâche est terminée.</span><span class="sxs-lookup"><span data-stu-id="2e787-160">Therefore, it cannot automatically detect when the task ends.</span></span>

<span data-ttu-id="2e787-161">Si vous avez besoin qu’une tâche en arrière-plan communique avec la tâche appelante pour indiquer sa progression ou sa fin, vous devez implémenter un mécanisme à cette fin.</span><span class="sxs-lookup"><span data-stu-id="2e787-161">If you require a background task to communicate with the calling task to indicate progress or completion, you must implement a mechanism for this.</span></span> <span data-ttu-id="2e787-162">Voici quelques exemples :</span><span class="sxs-lookup"><span data-stu-id="2e787-162">Some examples are:</span></span>

* <span data-ttu-id="2e787-163">Écriture de la valeur d’un indicateur d’état dans l’espace de stockage accessible à l’interface utilisateur ou à la tache appelante, qui peut surveiller ou vérifier cette valeur, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="2e787-163">Write a status indicator value to storage that is accessible to the UI or caller task, which can monitor or check this value when required.</span></span> <span data-ttu-id="2e787-164">Les autres données que la tâche en arrière-plan doit renvoyer à la tâche appelante peuvent être placées dans le même espace de stockage.</span><span class="sxs-lookup"><span data-stu-id="2e787-164">Other data that the background task must return to the caller can be placed into the same storage.</span></span>
* <span data-ttu-id="2e787-165">Établissement d’une file d’attente de réponse, que l’interface utilisateur ou la tâche appelante écoute.</span><span class="sxs-lookup"><span data-stu-id="2e787-165">Establish a reply queue that the UI or caller listens on.</span></span> <span data-ttu-id="2e787-166">La tâche en arrière-plan peut envoyer des messages à la file d’attente, indiquant l’état et la fin du processus.</span><span class="sxs-lookup"><span data-stu-id="2e787-166">The background task can send messages to the queue that indicate status and completion.</span></span> <span data-ttu-id="2e787-167">Les données que la tâche en arrière-plan doit renvoyer à la tâche appelante peuvent être placées dans ces messages.</span><span class="sxs-lookup"><span data-stu-id="2e787-167">Data that the background task must return to the caller can be placed into the messages.</span></span> <span data-ttu-id="2e787-168">Si vous utilisez Microsoft Azure Service Bus, vous pouvez utiliser les propriétés **ReplyTo** et **CorrelationId** pour implémenter cette fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="2e787-168">If you are using Azure Service Bus, you can use the **ReplyTo** and **CorrelationId** properties to implement this capability.</span></span> <span data-ttu-id="2e787-169">Pour en savoir plus, voir [Correlation in Service Bus Brokered Messaging](http://www.cloudcasts.net/devguide/Default.aspx?id=13029).</span><span class="sxs-lookup"><span data-stu-id="2e787-169">For more information, see [Correlation in Service Bus Brokered Messaging](http://www.cloudcasts.net/devguide/Default.aspx?id=13029).</span></span>
* <span data-ttu-id="2e787-170">Exposition d’une API ou d’un point de terminaison à partir de la tâche en arrière-plan, à laquelle l’interface utilisateur ou la tâche appelante peut accéder pour obtenir des informations sur l’état.</span><span class="sxs-lookup"><span data-stu-id="2e787-170">Expose an API or endpoint from the background task that the UI or caller can access to obtain status information.</span></span> <span data-ttu-id="2e787-171">Les données que la tâche en arrière-plan doit renvoyer à la tâche appelante peuvent être incluses dans la réponse.</span><span class="sxs-lookup"><span data-stu-id="2e787-171">Data that the background task must return to the caller can be included in the response.</span></span>
* <span data-ttu-id="2e787-172">Rappel de la tâche en arrière-plan vers l’interface utilisateur ou la tâche appelante, via une API, pour indiquer l’état à différents points prédéfinis ou lors de l’achèvement.</span><span class="sxs-lookup"><span data-stu-id="2e787-172">Have the background task call back to the UI or caller through an API to indicate status at predefined points or on completion.</span></span> <span data-ttu-id="2e787-173">Cette opération peut être pilotée par des événements déclenchés en local, ou par un mécanisme de publication et d’abonnement.</span><span class="sxs-lookup"><span data-stu-id="2e787-173">This might be through events raised locally or through a publish-and-subscribe mechanism.</span></span> <span data-ttu-id="2e787-174">Les données que la tâche en arrière-plan doit renvoyer à la tâche appelante peuvent être incluses dans la charge utile de l’événement ou de la demande.</span><span class="sxs-lookup"><span data-stu-id="2e787-174">Data that the background task must return to the caller can be included in the request or event payload.</span></span>

## <a name="hosting-environment"></a><span data-ttu-id="2e787-175">Environnement d’hébergement</span><span class="sxs-lookup"><span data-stu-id="2e787-175">Hosting environment</span></span>
<span data-ttu-id="2e787-176">Vous pouvez héberger des tâches en arrière-plan à l’aide de différents services de plateforme Microsoft Azure :</span><span class="sxs-lookup"><span data-stu-id="2e787-176">You can host background tasks by using a range of different Azure platform services:</span></span>

* <span data-ttu-id="2e787-177">[**Azure Web Apps et WebJobs**](#azure-web-apps-and-webjobs).</span><span class="sxs-lookup"><span data-stu-id="2e787-177">[**Azure Web Apps and WebJobs**](#azure-web-apps-and-webjobs).</span></span> <span data-ttu-id="2e787-178">Vous pouvez utiliser WebJobs pour exécuter des tâches personnalisées basées sur différents types de scripts ou de programmes exécutables dans le contexte de l’application web.</span><span class="sxs-lookup"><span data-stu-id="2e787-178">You can use WebJobs to execute custom jobs based on a range of different types of scripts or executable programs within the context of a web app.</span></span>
* <span data-ttu-id="2e787-179">[**Azure Virtual Machines**](#azure-virtual-machines).</span><span class="sxs-lookup"><span data-stu-id="2e787-179">[**Azure Virtual Machines**](#azure-virtual-machines).</span></span> <span data-ttu-id="2e787-180">Si vous utilisez un service Windows ou souhaitez utiliser le Planificateur de tâches de Windows, une pratique courante consiste à héberger les tâches en arrière-plan sur une machine virtuelle dédiée.</span><span class="sxs-lookup"><span data-stu-id="2e787-180">If you have a Windows service or want to use the Windows Task Scheduler, it is common to host your background tasks within a dedicated virtual machine.</span></span>
* <span data-ttu-id="2e787-181">[**Azure Batch**](#azure-batch).</span><span class="sxs-lookup"><span data-stu-id="2e787-181">[**Azure Batch**](#azure-batch).</span></span> <span data-ttu-id="2e787-182">Batch est un service de plateforme qui planifie l’exécution des travaux nécessitant beaucoup de ressources système sur une collection gérée de machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="2e787-182">Batch is a platform service that schedules compute-intensive work to run on a managed collection of virtual machines.</span></span> <span data-ttu-id="2e787-183">Il peut automatiquement mettre à l’échelle les ressources de calcul.</span><span class="sxs-lookup"><span data-stu-id="2e787-183">It can automatically scale compute resources.</span></span>
* <span data-ttu-id="2e787-184">[**Azure Container Service**](#azure-container-service).</span><span class="sxs-lookup"><span data-stu-id="2e787-184">[**Azure Container Service**](#azure-container-service).</span></span> <span data-ttu-id="2e787-185">Azure Container Service fournit un environnement d’hébergement de conteneurs sur Azure.</span><span class="sxs-lookup"><span data-stu-id="2e787-185">Azure Container Service provides a container hosting environment on Azure.</span></span> 
* <span data-ttu-id="2e787-186">[**Azure Cloud Services**](#azure-cloud-services).</span><span class="sxs-lookup"><span data-stu-id="2e787-186">[**Azure Cloud Services**](#azure-cloud-services).</span></span> <span data-ttu-id="2e787-187">Vous pouvez écrire du code dans un rôle qui s’exécute en tant que tâche en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-187">You can write code within a role that executes as a background task.</span></span>

<span data-ttu-id="2e787-188">Les sections suivantes décrivent chacune de ces options plus en détail, en ajoutant des informations qui vous permettront de choisir l’action la plus appropriée.</span><span class="sxs-lookup"><span data-stu-id="2e787-188">The following sections describe each of these options in more detail, and include considerations to help you choose the appropriate option.</span></span>

### <a name="azure-web-apps-and-webjobs"></a><span data-ttu-id="2e787-189">Azure Web Apps et WebJobs</span><span class="sxs-lookup"><span data-stu-id="2e787-189">Azure Web Apps and WebJobs</span></span>

<span data-ttu-id="2e787-190">Vous pouvez utiliser Azure WebJobs pour exécuter des travaux personnalisés comme tâches en arrière-plan dans une application web Azure.</span><span class="sxs-lookup"><span data-stu-id="2e787-190">You can use Azure WebJobs to execute custom jobs as background tasks within an Azure Web App.</span></span> <span data-ttu-id="2e787-191">Les tâches web s’exécutent dans le contexte de votre application web en tant que processus continu.</span><span class="sxs-lookup"><span data-stu-id="2e787-191">WebJobs run within the context of your web app as a continuous process.</span></span> <span data-ttu-id="2e787-192">Les tâches web s’exécutent également en réponse à un événement déclencheur d’Azure Scheduler ou à des facteurs externes, tels que des modifications apportées aux objets blob de stockage et aux files d’attente de messages.</span><span class="sxs-lookup"><span data-stu-id="2e787-192">WebJobs also run in response to a trigger event from Azure Scheduler or external factors, such as changes to storage blobs and message queues.</span></span> <span data-ttu-id="2e787-193">Les travaux peuvent être démarrés et arrêtés à la demande, et arrêtés normalement.</span><span class="sxs-lookup"><span data-stu-id="2e787-193">Jobs can be started and stopped on demand, and shut down gracefully.</span></span> <span data-ttu-id="2e787-194">Si une tâche web exécutée en continu échoue, elle est redémarrée automatiquement.</span><span class="sxs-lookup"><span data-stu-id="2e787-194">If a continuously running WebJob fails, it is automatically restarted.</span></span> <span data-ttu-id="2e787-195">Les actions liées aux nouvelles tentatives et aux erreurs sont configurables.</span><span class="sxs-lookup"><span data-stu-id="2e787-195">Retry and error actions are configurable.</span></span>

<span data-ttu-id="2e787-196">Quand vous configurez une tâche web :</span><span class="sxs-lookup"><span data-stu-id="2e787-196">When you configure a WebJob:</span></span>

* <span data-ttu-id="2e787-197">Si vous souhaitez que la tâche réponde à un déclencheur piloté par les événements, configurez-la avec l’option **Exécuter en continu**.</span><span class="sxs-lookup"><span data-stu-id="2e787-197">If you want the job to respond to an event-driven trigger, you should configure it as **Run continuously**.</span></span> <span data-ttu-id="2e787-198">Le script ou programme est stocké dans le dossier nommé site/wwwroot/app_data/jobs/continuous.</span><span class="sxs-lookup"><span data-stu-id="2e787-198">The script or program is stored in the folder named site/wwwroot/app_data/jobs/continuous.</span></span>
* <span data-ttu-id="2e787-199">Si vous souhaitez que la tâche réponde à un déclencheur piloté par les planifications, configurez-la avec l’option **Exécuter selon une planification**.</span><span class="sxs-lookup"><span data-stu-id="2e787-199">If you want the job to respond to a schedule-driven trigger, you should configure it as **Run on a schedule**.</span></span> <span data-ttu-id="2e787-200">Le script ou programme est stocké dans le dossier nommé site/wwwroot/app_data/jobs/triggered.</span><span class="sxs-lookup"><span data-stu-id="2e787-200">The script or program is stored in the folder named site/wwwroot/app_data/jobs/triggered.</span></span>
* <span data-ttu-id="2e787-201">Si vous choisissez l’option **Exécuter à la demande** lorsque vous configurez un travail, ce dernier exécute le même code qu’avec l’option **Exécuter selon une planification**.</span><span class="sxs-lookup"><span data-stu-id="2e787-201">If you choose the **Run on demand** option when you configure a job, it will execute the same code as the **Run on a schedule** option when you start it.</span></span>

<span data-ttu-id="2e787-202">Les tâches web Azure s’exécutent dans le bac à sable (sandbox) de l’application web.</span><span class="sxs-lookup"><span data-stu-id="2e787-202">Azure WebJobs run within the sandbox of the web app.</span></span> <span data-ttu-id="2e787-203">Cela signifie qu’elles peuvent accéder aux variables d’environnement et partager des informations, telles que les chaînes de connexion, avec l’application web.</span><span class="sxs-lookup"><span data-stu-id="2e787-203">This means that they can access environment variables and share information, such as connection strings, with the web app.</span></span> <span data-ttu-id="2e787-204">Le travail peut accéder à l’identificateur unique de la machine qui l’exécute.</span><span class="sxs-lookup"><span data-stu-id="2e787-204">The job has access to the unique identifier of the machine that is running the job.</span></span> <span data-ttu-id="2e787-205">La chaîne de connexion **AzureWebJobsStorage** fournit l’accès aux files d’attente, objets blob et tables de stockage Azure pour les données d’application, et à Service Bus pour la messagerie et les communications.</span><span class="sxs-lookup"><span data-stu-id="2e787-205">The connection string named **AzureWebJobsStorage** provides access to Azure storage queues, blobs, and tables for application data, and access to Service Bus for messaging and communication.</span></span> <span data-ttu-id="2e787-206">La chaîne de connexion **AzureWebJobsDashboard** fournit l’accès aux fichiers journaux d’actions des tâches.</span><span class="sxs-lookup"><span data-stu-id="2e787-206">The connection string named **AzureWebJobsDashboard** provides access to the job action log files.</span></span>

<span data-ttu-id="2e787-207">Les tâches web Azure présentent les caractéristiques suivantes :</span><span class="sxs-lookup"><span data-stu-id="2e787-207">Azure WebJobs have the following characteristics:</span></span>

* <span data-ttu-id="2e787-208">**Sécurité**: les tâches web sont protégées par les informations d’identification sur le déploiement de l’application web.</span><span class="sxs-lookup"><span data-stu-id="2e787-208">**Security**: WebJobs are protected by the deployment credentials of the web app.</span></span>
* <span data-ttu-id="2e787-209">**Types de fichiers pris en charge**: vous pouvez définir les tâches web avec des scripts de commande (.cmd), des fichiers de commandes (.bat), des scripts PowerShell (.ps1), des scripts Shell bash (.sh), des scripts PHP (.php), des scripts Python (.py), du code JavaScript (.js) ou des programmes exécutables (.exe, .jar, etc.).</span><span class="sxs-lookup"><span data-stu-id="2e787-209">**Supported file types**: You can define WebJobs by using command scripts (.cmd), batch files (.bat), PowerShell scripts (.ps1), bash shell scripts (.sh), PHP scripts (.php), Python scripts (.py), JavaScript code (.js), and executable programs (.exe, .jar, and more).</span></span>
* <span data-ttu-id="2e787-210">**Déploiement** : vous pouvez déployer les scripts et exécutables à l’aide du [portail Azure](/azure/app-service-web/web-sites-create-web-jobs), de [Visual Studio](/azure/app-service-web/websites-dotnet-deploy-webjobs) ou du [Kit de développement logiciel (SDK) Azure WebJobs](/azure/azure-webjobs-sdk), ou en les copiant directement aux emplacements suivants :</span><span class="sxs-lookup"><span data-stu-id="2e787-210">**Deployment**: You can deploy scripts and executables by using the [Azure portal](/azure/app-service-web/web-sites-create-web-jobs), by using [Visual Studio](/azure/app-service-web/websites-dotnet-deploy-webjobs), by using the [Azure WebJobs SDK](/azure/azure-webjobs-sdk), or by copying them directly to the following locations:</span></span>
  * <span data-ttu-id="2e787-211">Pour une exécution déclenchée : site/wwwroot/app_data/jobs/triggered/{job name}</span><span class="sxs-lookup"><span data-stu-id="2e787-211">For triggered execution: site/wwwroot/app_data/jobs/triggered/{job name}</span></span>
  * <span data-ttu-id="2e787-212">Pour une exécution en continu : site/wwwroot/app_data/jobs/continuous/{job name}</span><span class="sxs-lookup"><span data-stu-id="2e787-212">For continuous execution: site/wwwroot/app_data/jobs/continuous/{job name}</span></span>
* <span data-ttu-id="2e787-213">**Journalisation**: la commande Console.Out est traitée (marquée) comme étant de type INFO.</span><span class="sxs-lookup"><span data-stu-id="2e787-213">**Logging**: Console.Out is treated (marked) as INFO.</span></span> <span data-ttu-id="2e787-214">La commande Console.Error est traitée comme étant de type ERROR.</span><span class="sxs-lookup"><span data-stu-id="2e787-214">Console.Error is treated as ERROR.</span></span> <span data-ttu-id="2e787-215">Vous pouvez accéder aux données de surveillance et de diagnostic à l’aide du portail Azure.</span><span class="sxs-lookup"><span data-stu-id="2e787-215">You can access monitoring and diagnostics information by using the Azure portal.</span></span> <span data-ttu-id="2e787-216">Vous pouvez télécharger les fichiers journaux directement à partir du site.</span><span class="sxs-lookup"><span data-stu-id="2e787-216">You can download log files directly from the site.</span></span> <span data-ttu-id="2e787-217">Ces éléments sont sauvegardés aux emplacements suivants :</span><span class="sxs-lookup"><span data-stu-id="2e787-217">They are saved in the following locations:</span></span>
  * <span data-ttu-id="2e787-218">Pour une exécution déclenchée : Vfs/data/jobs/triggered/jobName</span><span class="sxs-lookup"><span data-stu-id="2e787-218">For triggered execution: Vfs/data/jobs/triggered/jobName</span></span>
  * <span data-ttu-id="2e787-219">Pour une exécution en continu : Vfs/data/jobs/continuous/jobName</span><span class="sxs-lookup"><span data-stu-id="2e787-219">For continuous execution: Vfs/data/jobs/continuous/jobName</span></span>
* <span data-ttu-id="2e787-220">**Configuration**: vous pouvez configurer des tâches web à l’aide du portail, de l’API REST et de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="2e787-220">**Configuration**: You can configure WebJobs by using the portal, the REST API, and PowerShell.</span></span> <span data-ttu-id="2e787-221">Utilisez un fichier de configuration nommé settings.job, situé dans le même répertoire racine que le script de travail, pour fournir des informations sur la configuration d’un travail.</span><span class="sxs-lookup"><span data-stu-id="2e787-221">You can use a configuration file named settings.job in the same root directory as the job script to provide configuration information for a job.</span></span> <span data-ttu-id="2e787-222">Par exemple : </span><span class="sxs-lookup"><span data-stu-id="2e787-222">For example:</span></span>
  * <span data-ttu-id="2e787-223">{ "stopping_wait_time": 60 }</span><span class="sxs-lookup"><span data-stu-id="2e787-223">{ "stopping_wait_time": 60 }</span></span>
  * <span data-ttu-id="2e787-224">{ "is_singleton": true }</span><span class="sxs-lookup"><span data-stu-id="2e787-224">{ "is_singleton": true }</span></span>

#### <a name="considerations"></a><span data-ttu-id="2e787-225">Considérations</span><span class="sxs-lookup"><span data-stu-id="2e787-225">Considerations</span></span>

* <span data-ttu-id="2e787-226">Par défaut, WebJobs est mis à l’échelle par rapport à l’application web.</span><span class="sxs-lookup"><span data-stu-id="2e787-226">By default, WebJobs scale with the web app.</span></span> <span data-ttu-id="2e787-227">Toutefois, vous pouvez configurer les tâches pour qu’elles s’exécutent sur une instance unique, en définissant la propriété de configuration **is_singleton** sur la valeur **true**.</span><span class="sxs-lookup"><span data-stu-id="2e787-227">However, you can configure jobs to run on single instance by setting the **is_singleton** configuration property to **true**.</span></span> <span data-ttu-id="2e787-228">Les tâches web d’une instance unique sont utiles pour les tâches que vous ne voulez pas mettre à l’échelle ou exécuter en tant qu’instances multiples simultanées (par exemple, la réindexation, l’analyse des données et autres tâches similaires).</span><span class="sxs-lookup"><span data-stu-id="2e787-228">Single instance WebJobs are useful for tasks that you do not want to scale or run as simultaneous multiple instances, such as reindexing, data analysis, and similar tasks.</span></span>
* <span data-ttu-id="2e787-229">Pour réduire l’impact des travaux sur les performances de l’application web, envisagez de créer une instance vide de l’application web Azure dans un nouveau plan de service d’application, pour y héberger les tâches web de longue durée ou nécessitant beaucoup de ressources.</span><span class="sxs-lookup"><span data-stu-id="2e787-229">To minimize the impact of jobs on the performance of the web app, consider creating an empty Azure Web App instance in a new App Service plan to host WebJobs that may be long running or resource intensive.</span></span>

### <a name="more-information"></a><span data-ttu-id="2e787-230">Plus d’informations</span><span class="sxs-lookup"><span data-stu-id="2e787-230">More information</span></span>
* <span data-ttu-id="2e787-231">[Ressources recommandées pour Azure WebJobs](/azure/app-service-web/websites-webjobs-resources) répertorie un grand nombre de ressources, d’éléments à télécharger et d’exemples utiles pour WebJobs.</span><span class="sxs-lookup"><span data-stu-id="2e787-231">[Azure WebJobs recommended resources](/azure/app-service-web/websites-webjobs-resources) lists the many useful resources, downloads, and samples for WebJobs.</span></span>

### <a name="azure-virtual-machines"></a><span data-ttu-id="2e787-232">Machines virtuelles Azure</span><span class="sxs-lookup"><span data-stu-id="2e787-232">Azure Virtual Machines</span></span>
<span data-ttu-id="2e787-233">Vous pouvez implémenter des tâches en arrière-plan pour ne pas qu’elles soient déployées sur Azure Web Apps ou Cloud Services, ou parce que ce n’est peut-être pas pratique.</span><span class="sxs-lookup"><span data-stu-id="2e787-233">Background tasks might be implemented in a way that prevents them from being deployed to Azure Web Apps or Cloud Services, or these options might not be convenient.</span></span> <span data-ttu-id="2e787-234">Les services Windows, ainsi que les utilitaires et programmes exécutables tiers, en sont des exemples typiques.</span><span class="sxs-lookup"><span data-stu-id="2e787-234">Typical examples are Windows services, and third-party utilities and executable programs.</span></span> <span data-ttu-id="2e787-235">Il peut également s’agir des programmes écrits pour un environnement d’exécution différent de celui qui héberge l’application.</span><span class="sxs-lookup"><span data-stu-id="2e787-235">Another example might be programs written for an execution environment that is different than that hosting the application.</span></span> <span data-ttu-id="2e787-236">C’est, par exemple, un programme Unix ou Linux que vous souhaitez exécuter à partir d’une application Windows ou .NET Vous avez le choix entre plusieurs systèmes d’exploitation pour une machine virtuelle Azure.</span><span class="sxs-lookup"><span data-stu-id="2e787-236">For example, it might be a Unix or Linux program that you want to execute from a Windows or .NET application.</span></span> <span data-ttu-id="2e787-237">Vous pouvez ensuite exécuter votre service ou programme exécutable sur cette machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="2e787-237">You can choose from a range of operating systems for an Azure virtual machine, and run your service or executable on that virtual machine.</span></span>

<span data-ttu-id="2e787-238">Pour savoir quand utiliser Virtual Machines, consultez [Comparaison entre Azure App Service, Azure Cloud Services et Azure Virtual Machines](/azure/app-service-web/choose-web-site-cloud-service-vm/).</span><span class="sxs-lookup"><span data-stu-id="2e787-238">To help you choose when to use Virtual Machines, see [Azure App Services, Cloud Services and Virtual Machines comparison](/azure/app-service-web/choose-web-site-cloud-service-vm/).</span></span> <span data-ttu-id="2e787-239">Pour plus d’informations sur les options disponibles pour Virtual Machines, consultez [Tailles de machines virtuelles et de services cloud pour Azure](http://msdn.microsoft.com/library/azure/dn197896.aspx).</span><span class="sxs-lookup"><span data-stu-id="2e787-239">For information about the options for Virtual Machines, see [Virtual Machine and Cloud Service sizes for Azure](http://msdn.microsoft.com/library/azure/dn197896.aspx).</span></span> <span data-ttu-id="2e787-240">Pour plus d’informations sur les systèmes d’exploitation et les images préconfigurées disponibles pour Virtual Machines, consultez le [Marketplace de machines virtuelles Azure](https://azure.microsoft.com/gallery/virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="2e787-240">For more information about the operating systems and prebuilt images that are available for Virtual Machines, see [Azure Virtual Machines Marketplace](https://azure.microsoft.com/gallery/virtual-machines/).</span></span>

<span data-ttu-id="2e787-241">Pour lancer la tâche en arrière-plan dans un ordinateur virtuel distinct, vous disposez d’un éventail d’options :</span><span class="sxs-lookup"><span data-stu-id="2e787-241">To initiate the background task in a separate virtual machine, you have a range of options:</span></span>

* <span data-ttu-id="2e787-242">Vous pouvez exécuter la tâche à la demande directement à partir de votre application, en envoyant une demande à un point de terminaison exposé par la tâche.</span><span class="sxs-lookup"><span data-stu-id="2e787-242">You can execute the task on demand directly from your application by sending a request to an endpoint that the task exposes.</span></span> <span data-ttu-id="2e787-243">Cette action transmet toutes les données dont la tâche a besoin.</span><span class="sxs-lookup"><span data-stu-id="2e787-243">This passes in any data that the task requires.</span></span> <span data-ttu-id="2e787-244">Le point de terminaison appelle la tâche.</span><span class="sxs-lookup"><span data-stu-id="2e787-244">This endpoint invokes the task.</span></span>
* <span data-ttu-id="2e787-245">Vous pouvez configurer la tâche pour qu’elle s’exécute selon une planification précise, à l’aide d’un planificateur ou d’un minuteur fourni par le système d’exploitation choisi.</span><span class="sxs-lookup"><span data-stu-id="2e787-245">You can configure the task to run on a schedule by using a scheduler or timer that is available in your chosen operating system.</span></span> <span data-ttu-id="2e787-246">Par exemple, sur Windows, utilisez le Planificateur de tâches de Windows pour exécuter des scripts et des tâches.</span><span class="sxs-lookup"><span data-stu-id="2e787-246">For example, on Windows you can use Windows Task Scheduler to execute scripts and tasks.</span></span> <span data-ttu-id="2e787-247">Ou, si vous avez installé SQL Server sur la machine virtuelle, utilisez SQL Server Agent pour faire la même opération.</span><span class="sxs-lookup"><span data-stu-id="2e787-247">Or, if you have SQL Server installed on the virtual machine, you can use the SQL Server Agent to execute scripts and tasks.</span></span>
* <span data-ttu-id="2e787-248">Vous pouvez utiliser Microsoft Azure Scheduler pour lancer la tâche en ajoutant un message à une file d’attente sur laquelle la tâche est à l’écoute, ou en envoyant une requête à une API exposée par la tâche.</span><span class="sxs-lookup"><span data-stu-id="2e787-248">You can use Azure Scheduler to initiate the task by adding a message to a queue that the task listens on, or by sending a request to an API that the task exposes.</span></span>

<span data-ttu-id="2e787-249">Consultez la section relative aux [déclencheurs](#triggers) (ci-dessus) pour en savoir plus sur le lancement de tâches en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-249">See the earlier section [Triggers](#triggers) for more information about how you can initiate background tasks.</span></span>  

#### <a name="considerations"></a><span data-ttu-id="2e787-250">Considérations</span><span class="sxs-lookup"><span data-stu-id="2e787-250">Considerations</span></span>
<span data-ttu-id="2e787-251">Si vous envisagez de déployer des tâches en arrière-plan sur une machine virtuelle Azure, tenez compte des points suivants :</span><span class="sxs-lookup"><span data-stu-id="2e787-251">Consider the following points when you are deciding whether to deploy background tasks in an Azure virtual machine:</span></span>

* <span data-ttu-id="2e787-252">L’hébergement de tâches en arrière-plan sur une machine virtuelle Azure distincte vous permet une certaine flexibilité et vous offre un contrôle précis sur l’initiation, l’exécution, la planification et l’allocation des ressources.</span><span class="sxs-lookup"><span data-stu-id="2e787-252">Hosting background tasks in a separate Azure virtual machine provides flexibility and allows precise control over initiation, execution, scheduling, and resource allocation.</span></span> <span data-ttu-id="2e787-253">Toutefois, cela augmente le coût d’exécution si un ordinateur virtuel doit être déployé uniquement pour exécuter des tâches en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-253">However, it will increase runtime cost if a virtual machine must be deployed just to run background tasks.</span></span>
* <span data-ttu-id="2e787-254">Il n’existe pas d’outil de suivi des tâches dans le portail Azure, ni de fonctionnalité de redémarrage automatique des tâches ayant échoué, mais vous pouvez surveiller l’état de base de la machine virtuelle et le gérer au moyen des [applets de commande Azure Resource Manager](https://msdn.microsoft.com/library/mt125356.aspx).</span><span class="sxs-lookup"><span data-stu-id="2e787-254">There is no facility to monitor the tasks in the Azure portal and no automated restart capability for failed tasks--although you can monitor the basic status of the virtual machine and manage it by using the  [Azure Resource Manager Cmdlets](https://msdn.microsoft.com/library/mt125356.aspx).</span></span> <span data-ttu-id="2e787-255">Toutefois, il n’existe aucune fonction permettant de contrôler les processus et threads dans les nœuds de calcul.</span><span class="sxs-lookup"><span data-stu-id="2e787-255">However, there are no facilities to control processes and threads in compute nodes.</span></span> <span data-ttu-id="2e787-256">En règle générale, l’utilisation d’une machine virtuelle nécessite des efforts supplémentaires pour implémenter un mécanisme afin de collecter des données d’instrumentation dans la tâche et de rassembler les données du système d’exploitation sur l’ordinateur virtuel.</span><span class="sxs-lookup"><span data-stu-id="2e787-256">Typically, using a virtual machine will require additional effort to implement a mechanism that collects data from instrumentation in the task, and from the operating system in the virtual machine.</span></span> <span data-ttu-id="2e787-257">Pour ce faire, essayez d’utiliser le composant [System Center Management Pack pour Azure](https://www.microsoft.com/download/details.aspx?id=50013).</span><span class="sxs-lookup"><span data-stu-id="2e787-257">One solution that might be appropriate is to use the [System Center Management Pack for Azure](https://www.microsoft.com/download/details.aspx?id=50013).</span></span>
* <span data-ttu-id="2e787-258">Vous pouvez envisager de créer des sondes de surveillance exposées via des points de terminaison HTTP.</span><span class="sxs-lookup"><span data-stu-id="2e787-258">You might consider creating monitoring probes that are exposed through HTTP endpoints.</span></span> <span data-ttu-id="2e787-259">Le code de ces sondes peut effectuer des contrôles d’intégrité, collecter des statistiques et des informations opérationnelles ou collecter les informations sur les erreurs et les renvoyer à une application de gestion.</span><span class="sxs-lookup"><span data-stu-id="2e787-259">The code for these probes could perform health checks, collect operational information and statistics--or collate error information and return it to a management application.</span></span> <span data-ttu-id="2e787-260">Pour en savoir plus, voir [Modèle de surveillance de point de terminaison d’intégrité](http://msdn.microsoft.com/library/dn589789.aspx).</span><span class="sxs-lookup"><span data-stu-id="2e787-260">For more information, see [Health Endpoint Monitoring Pattern](http://msdn.microsoft.com/library/dn589789.aspx).</span></span>

#### <a name="more-information"></a><span data-ttu-id="2e787-261">Plus d’informations</span><span class="sxs-lookup"><span data-stu-id="2e787-261">More information</span></span>
* <span data-ttu-id="2e787-262">[Machines virtuelles](https://azure.microsoft.com/services/virtual-machines/) sur Azure</span><span class="sxs-lookup"><span data-stu-id="2e787-262">[Virtual Machines](https://azure.microsoft.com/services/virtual-machines/) on Azure</span></span>
* [<span data-ttu-id="2e787-263">FAQ sur les machines virtuelles Azure</span><span class="sxs-lookup"><span data-stu-id="2e787-263">Azure Virtual Machines FAQ</span></span>](/azure/virtual-machines/virtual-machines-linux-classic-faq?toc=%2fazure%2fvirtual-machines%2flinux%2fclassic%2ftoc.json)

### <a name="azure-batch"></a><span data-ttu-id="2e787-264">Azure Batch</span><span class="sxs-lookup"><span data-stu-id="2e787-264">Azure Batch</span></span> 

<span data-ttu-id="2e787-265">Envisagez d’utiliser [Azure Batch](/azure/batch/) si vous devez exécuter d’importantes charges de travail de calcul haute performance parallèles sur des dizaines, des centaines ou des milliers de machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="2e787-265">Consider [Azure Batch](/azure/batch/) if you need to run large, parallel high-performance computing (HPC) workloads across tens, hundreds, or thousands of VMs.</span></span>  

<span data-ttu-id="2e787-266">Le service Batch approvisionne les machines virtuelles, leur affecte des tâches, puis exécute ces dernières et surveille l’état d’avancement de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="2e787-266">The Batch service provisions the VMs, assign tasks to the VMs, runs the tasks, and monitors the progress.</span></span> <span data-ttu-id="2e787-267">Batch peut également augmenter automatiquement la taille des machines virtuelles afin de traiter la charge de travail.</span><span class="sxs-lookup"><span data-stu-id="2e787-267">Batch can automatically scale out the VMs in response to the workload.</span></span> <span data-ttu-id="2e787-268">Enfin, Batch offre une fonctionnalité de planification des travaux.</span><span class="sxs-lookup"><span data-stu-id="2e787-268">Batch also provides job scheduling.</span></span> <span data-ttu-id="2e787-269">Azure Batch prend en charge les machines virtuelles Linux et Windows.</span><span class="sxs-lookup"><span data-stu-id="2e787-269">Azure Batch supports both Linux and Windows VMs.</span></span>

#### <a name="considerations"></a><span data-ttu-id="2e787-270">Considérations</span><span class="sxs-lookup"><span data-stu-id="2e787-270">Considerations</span></span> 

<span data-ttu-id="2e787-271">Le service Batch offre de bons résultats avec les charges de travail intrinsèquement parallèles.</span><span class="sxs-lookup"><span data-stu-id="2e787-271">Batch works well with intrinsically parallel workloads.</span></span> <span data-ttu-id="2e787-272">Il peut également effectuer des calculs parallèles avec une opération de réduction à la fin, ou exécuter des [applications MPI (Message Passing Interface)](/azure/batch/batch-mpi) pour les tâches parallèles qui nécessitent une transmission de messages entre les nœuds.</span><span class="sxs-lookup"><span data-stu-id="2e787-272">It can also perform parallel calculations with a reduce step at the end, or run [Message Passing Interface (MPI) applications](/azure/batch/batch-mpi) for parallel tasks that require message passing between nodes.</span></span> 

<span data-ttu-id="2e787-273">Un travail Azure Batch s’exécute sur un pool de nœuds (machines virtuelles).</span><span class="sxs-lookup"><span data-stu-id="2e787-273">An Azure Batch job runs on a pool of nodes (VMs).</span></span> <span data-ttu-id="2e787-274">Une approche possible consiste à allouer un pool uniquement lorsque cela se révèle nécessaire, puis à le supprimer une fois le travail terminé.</span><span class="sxs-lookup"><span data-stu-id="2e787-274">One approach is to allocate a pool only when needed and then delete it after the job completes.</span></span> <span data-ttu-id="2e787-275">Cette approche optimise l’utilisation, car les nœuds ne sont pas inactifs, mais le travail doit attendre que des nœuds soient alloués.</span><span class="sxs-lookup"><span data-stu-id="2e787-275">This maximizes utilization, because nodes are not idle, but the job must wait for nodes to be allocated.</span></span> <span data-ttu-id="2e787-276">Une autre possibilité consiste à créer un pool à l’avance.</span><span class="sxs-lookup"><span data-stu-id="2e787-276">Alternatively, you can create a pool ahead of time.</span></span> <span data-ttu-id="2e787-277">Cette approche réduit le temps nécessaire au démarrage d’un travail, mais peut entraîner l’existence de nœuds inactifs.</span><span class="sxs-lookup"><span data-stu-id="2e787-277">That approach minimizes the time that it takes for a job to start, but can result in having nodes that sit idle.</span></span> <span data-ttu-id="2e787-278">Pour plus d’informations, consultez la section [Durée de vie de nœud de pool et de calcul](/azure/batch/batch-api-basics#pool-and-compute-node-lifetime).</span><span class="sxs-lookup"><span data-stu-id="2e787-278">For more information, see [Pool and compute node lifetime](/azure/batch/batch-api-basics#pool-and-compute-node-lifetime).</span></span>

#### <a name="more-information"></a><span data-ttu-id="2e787-279">Plus d’informations</span><span class="sxs-lookup"><span data-stu-id="2e787-279">More information</span></span> 

* [<span data-ttu-id="2e787-280">Exécuter des charges de travail intrinsèquement parallèles avec Batch</span><span class="sxs-lookup"><span data-stu-id="2e787-280">Run intrinsically parallel workloads with Batch</span></span>](/azure/batch/batch-technical-overview) 
* [<span data-ttu-id="2e787-281">Développer des solutions de calcul parallèles à grande échelle avec Batch</span><span class="sxs-lookup"><span data-stu-id="2e787-281">Develop large-scale parallel compute solutions with Batch</span></span>](/azure/batch/batch-api-basics) 
* [<span data-ttu-id="2e787-282">Solutions Batch et HPC pour les charges de travail de calcul à grande échelle</span><span class="sxs-lookup"><span data-stu-id="2e787-282">Batch and HPC solutions for large-scale computing workloads</span></span>](/azure/batch/batch-hpc-solutions)

### <a name="azure-container-service"></a><span data-ttu-id="2e787-283">Azure Container Service</span><span class="sxs-lookup"><span data-stu-id="2e787-283">Azure Container Service</span></span> 

<span data-ttu-id="2e787-284">Azure Container Service vous permet de configurer et gérer un cluster de machines virtuelles dans Azure pour l’exécution d’applications en conteneur.</span><span class="sxs-lookup"><span data-stu-id="2e787-284">Azure Container Service lets you configure and manage a cluster of VMs in Azure to run containerized applications.</span></span> <span data-ttu-id="2e787-285">Il propose un choix entre Docker Swarm, DC/OS et Kubernetes pour l’orchestration.</span><span class="sxs-lookup"><span data-stu-id="2e787-285">It provides a choice of Docker Swarm, DC/OS, or Kubernetes for orchestration.</span></span> 

<span data-ttu-id="2e787-286">Les conteneurs peuvent se révéler utiles pour l’exécution de travaux en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-286">Containers can be useful for running background jobs.</span></span> <span data-ttu-id="2e787-287">Voici certains des avantages obtenus :</span><span class="sxs-lookup"><span data-stu-id="2e787-287">Some of the benefits include:</span></span> 

- <span data-ttu-id="2e787-288">Les conteneurs prennent en charge l’hébergement haute densité.</span><span class="sxs-lookup"><span data-stu-id="2e787-288">Containers support high-density hosting.</span></span> <span data-ttu-id="2e787-289">Vous pouvez isoler une tâche en arrière-plan dans un conteneur, tout en plaçant plusieurs conteneurs dans chaque machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="2e787-289">You can isolate a background task in a container, while placing multiple containers in each VM.</span></span>
- <span data-ttu-id="2e787-290">L’orchestrateur de conteneurs gère l’équilibrage de charge interne, la configuration du réseau interne et d’autres tâches de configuration.</span><span class="sxs-lookup"><span data-stu-id="2e787-290">The container orchestrator handles internal load balancing, configuring the internal network, and other configuration tasks.</span></span>
- <span data-ttu-id="2e787-291">Les conteneurs peuvent être démarrés et arrêtés selon les besoins.</span><span class="sxs-lookup"><span data-stu-id="2e787-291">Containers can be started and stopped as needed.</span></span> 
- <span data-ttu-id="2e787-292">Le service Azure Container Registry vous permet d’inscrire vos conteneurs à l’intérieur des limites d’Azure.</span><span class="sxs-lookup"><span data-stu-id="2e787-292">Azure Container Registry allows you to register your containers inside Azure boundaries.</span></span> <span data-ttu-id="2e787-293">Il offre des avantages en matière de sécurité, de confidentialité et de proximité.</span><span class="sxs-lookup"><span data-stu-id="2e787-293">This comes with security, privacy, and proximity benefits.</span></span> 

#### <a name="considerations"></a><span data-ttu-id="2e787-294">Considérations</span><span class="sxs-lookup"><span data-stu-id="2e787-294">Considerations</span></span>

- <span data-ttu-id="2e787-295">Cette approche nécessite une bonne compréhension de la procédure d’utilisation d’un orchestrateur de conteneurs.</span><span class="sxs-lookup"><span data-stu-id="2e787-295">Requires an understanding of how to use a container orchestrator.</span></span> <span data-ttu-id="2e787-296">Selon les compétences dont dispose votre équipe DevOps, ceci peut ou non constituer un problème.</span><span class="sxs-lookup"><span data-stu-id="2e787-296">Depending on the skillset of your DevOps team, this may or may not be an issue.</span></span>  
- <span data-ttu-id="2e787-297">Container Service s’exécute dans un environnement IaaS.</span><span class="sxs-lookup"><span data-stu-id="2e787-297">Container Service runs in an IaaS environment.</span></span> <span data-ttu-id="2e787-298">Il approvisionne un cluster de machines virtuelles dans un réseau virtuel dédié.</span><span class="sxs-lookup"><span data-stu-id="2e787-298">It provisions a cluster of VMs inside a dedicated VNet.</span></span> 

#### <a name="more-information"></a><span data-ttu-id="2e787-299">Plus d’informations</span><span class="sxs-lookup"><span data-stu-id="2e787-299">More information</span></span> 

* [<span data-ttu-id="2e787-300">Introduction aux solutions d’hébergement de conteneur Docker avec Azure Container Service</span><span class="sxs-lookup"><span data-stu-id="2e787-300">Introduction to Docker container hosting solutions with Azure Container Service</span></span>](/azure/container-service/container-service-intro) 
* [<span data-ttu-id="2e787-301">Présentation des registres de conteneurs Docker privés</span><span class="sxs-lookup"><span data-stu-id="2e787-301">Introduction to private Docker container registries</span></span>](/azure/container-registry/container-registry-intro) 

### <a name="azure-cloud-services"></a><span data-ttu-id="2e787-302">Services cloud Azure</span><span class="sxs-lookup"><span data-stu-id="2e787-302">Azure Cloud Services</span></span> 
<span data-ttu-id="2e787-303">Vous pouvez exécuter des tâches en arrière-plan dans un rôle web ou dans un rôle de travail distinct.</span><span class="sxs-lookup"><span data-stu-id="2e787-303">You can execute background tasks within a web role or in a separate worker role.</span></span> <span data-ttu-id="2e787-304">Si vous envisagez d’utiliser un rôle de travail, prenez en compte les éléments suivants : les exigences en matière d’extensibilité et d’élasticité, la durée de vie des tâches, la cadence de publication, la sécurité, la tolérance de panne, la contention, la complexité et l’architecture logique.</span><span class="sxs-lookup"><span data-stu-id="2e787-304">When you are deciding whether to use a worker role, consider scalability and elasticity requirements, task lifetime, release cadence, security, fault tolerance, contention, complexity, and the logical architecture.</span></span> <span data-ttu-id="2e787-305">Pour en savoir plus, voir [Modèle de consolidation des ressources de calcul](http://msdn.microsoft.com/library/dn589778.aspx).</span><span class="sxs-lookup"><span data-stu-id="2e787-305">For more information, see [Compute Resource Consolidation Pattern](http://msdn.microsoft.com/library/dn589778.aspx).</span></span>

<span data-ttu-id="2e787-306">Vous pouvez implémenter des tâches en arrière-plan dans un rôle Cloud Services de différentes manières :</span><span class="sxs-lookup"><span data-stu-id="2e787-306">There are several ways to implement background tasks within a Cloud Services role:</span></span>

* <span data-ttu-id="2e787-307">Créez une implémentation de la classe **RoleEntryPoint** dans le rôle et utilisez ses méthodes pour exécuter des tâches en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-307">Create an implementation of the **RoleEntryPoint** class in the role and use its methods to execute background tasks.</span></span> <span data-ttu-id="2e787-308">Les tâches s’exécutent dans le contexte de WaIISHost.exe.</span><span class="sxs-lookup"><span data-stu-id="2e787-308">The tasks run in the context of WaIISHost.exe.</span></span> <span data-ttu-id="2e787-309">Elles peuvent utiliser la méthode **GetSetting** de la classe **CloudConfigurationManager** pour charger les paramètres de configuration.</span><span class="sxs-lookup"><span data-stu-id="2e787-309">They can use the **GetSetting** method of the **CloudConfigurationManager** class to load configuration settings.</span></span> <span data-ttu-id="2e787-310">Pour en savoir plus, consultez [Cycle de vie](#lifecycle).</span><span class="sxs-lookup"><span data-stu-id="2e787-310">For more information, see [Lifecycle](#lifecycle).</span></span>
* <span data-ttu-id="2e787-311">Utilisez les tâches de démarrage pour exécuter des tâches en arrière-plan lorsque l’application démarre.</span><span class="sxs-lookup"><span data-stu-id="2e787-311">Use startup tasks to execute background tasks when the application starts.</span></span> <span data-ttu-id="2e787-312">Pour forcer les tâches à continuer leur exécution en arrière-plan, définissez la propriété **taskType** sur **background** (sinon, le processus de démarrage de l’application s’arrête et attend la fin de la tâche).</span><span class="sxs-lookup"><span data-stu-id="2e787-312">To force the tasks to continue to run in the background, set the **taskType** property to **background** (if you do not do this, the application startup process will halt and wait for the task to finish).</span></span> <span data-ttu-id="2e787-313">Pour plus d’informations, consultez [Exécuter des tâches de démarrage dans Azure](/azure/cloud-services/cloud-services-startup-tasks).</span><span class="sxs-lookup"><span data-stu-id="2e787-313">For more information, see [Run startup tasks in Azure](/azure/cloud-services/cloud-services-startup-tasks).</span></span>
* <span data-ttu-id="2e787-314">Utilisez le Kit de développement logiciel (SDK) WebJobs pour implémenter des tâches en arrière-plan, telles que des tâches web lancées comme une tâche de démarrage.</span><span class="sxs-lookup"><span data-stu-id="2e787-314">Use the WebJobs SDK to implement background tasks such as WebJobs that are initiated as a startup task.</span></span> <span data-ttu-id="2e787-315">Pour plus d’informations, consultez l’article [Créer une tâche web .NET dans Azure App Service](/azure/app-service-web/websites-dotnet-webjobs-sdk-get-started).</span><span class="sxs-lookup"><span data-stu-id="2e787-315">For more information, see [Create a .NET WebJob in Azure App Service](/azure/app-service-web/websites-dotnet-webjobs-sdk-get-started).</span></span>
* <span data-ttu-id="2e787-316">Utilisez une tâche de démarrage pour installer un service Windows qui exécute une ou plusieurs tâches en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-316">Use a startup task to install a Windows service that executes one or more background tasks.</span></span> <span data-ttu-id="2e787-317">Vous devez définir la propriété **taskType** sur **background**, afin que le service s’exécute en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-317">You must set the **taskType** property to **background** so that the service executes in the background.</span></span> <span data-ttu-id="2e787-318">Pour plus d’informations, consultez [Exécuter des tâches de démarrage dans Azure](/azure/cloud-services/cloud-services-startup-tasks).</span><span class="sxs-lookup"><span data-stu-id="2e787-318">For more information, see [Run startup tasks in Azure](/azure/cloud-services/cloud-services-startup-tasks).</span></span>

<span data-ttu-id="2e787-319">Le principal avantage lié à l’exécution des tâches en arrière-plan dans le rôle web est la réduction des coûts d’hébergement, car il n’est pas nécessaire de déployer des rôles supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="2e787-319">The main advantage of running background tasks in the web role is the saving in hosting costs because there is no requirement to deploy additional roles.</span></span>

<span data-ttu-id="2e787-320">Le fait d’exécuter des tâches en arrière-plan dans un rôle de travail présente plusieurs avantages :</span><span class="sxs-lookup"><span data-stu-id="2e787-320">Running background tasks in a worker role has several advantages:</span></span>

* <span data-ttu-id="2e787-321">Cela vous permet de gérer la mise à l’échelle de chaque type de rôle, de manière séparée.</span><span class="sxs-lookup"><span data-stu-id="2e787-321">It allows you to manage scaling separately for each type of role.</span></span> <span data-ttu-id="2e787-322">Par exemple, vous aurez peut-être besoin d’un plus grand nombre d’instances du rôle web pour gérer la charge actuelle, mais d’un nombre moins important d’instances du rôle de travail qui exécute les tâches en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-322">For example, you might need more instances of a web role to support the current load, but fewer instances of the worker role that executes background tasks.</span></span> <span data-ttu-id="2e787-323">En effectuant une mise à l’échelle des instances de calcul des tâches en arrière-plan séparément des rôles de l’interface utilisateur, vous diminuez les coûts d’hébergement, tout en garantissant des performances acceptables.</span><span class="sxs-lookup"><span data-stu-id="2e787-323">By scaling background task compute instances separately from the UI roles, you can reduce hosting costs, while maintaining acceptable performance.</span></span>
* <span data-ttu-id="2e787-324">Cela permet de décharger la charge de traitement des tâches en arrière-plan du rôle web.</span><span class="sxs-lookup"><span data-stu-id="2e787-324">It offloads the processing overhead for background tasks from the web role.</span></span> <span data-ttu-id="2e787-325">Le rôle web qui fournit l’interface utilisateur peut rester réactif, ce qui peut se traduire par un nombre moins important d’instances requises pour gérer un volume donné de demandes de la part des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="2e787-325">The web role that provides the UI can remain responsive, and it may mean fewer instances are required to support a given volume of requests from users.</span></span>
* <span data-ttu-id="2e787-326">Cela vous permet d’implémenter la séparation des intérêts.</span><span class="sxs-lookup"><span data-stu-id="2e787-326">It allows you to implement separation of concerns.</span></span> <span data-ttu-id="2e787-327">Chaque type de rôle peut implémenter un ensemble spécifique de tâches clairement définies et associées.</span><span class="sxs-lookup"><span data-stu-id="2e787-327">Each role type can implement a specific set of clearly defined and related tasks.</span></span> <span data-ttu-id="2e787-328">Ainsi, la conception et la gestion du code sont plus simples, car l’interdépendance entre le code et les fonctionnalités est moins appuyée entre les rôles.</span><span class="sxs-lookup"><span data-stu-id="2e787-328">This makes designing and maintaining the code easier because there is less interdependence of code and functionality between each role.</span></span>
* <span data-ttu-id="2e787-329">Cela peut faciliter l’isolation des données et processus sensibles.</span><span class="sxs-lookup"><span data-stu-id="2e787-329">It can help to isolate sensitive processes and data.</span></span> <span data-ttu-id="2e787-330">Par exemple, les rôles web qui implémentent l’interface utilisateur n’ont pas nécessairement besoin d’un accès aux données gérées et contrôlées par un rôle de travail.</span><span class="sxs-lookup"><span data-stu-id="2e787-330">For example, web roles that implement the UI do not need to have access to data that is managed and controlled by a worker role.</span></span> <span data-ttu-id="2e787-331">Cela peut contribuer à renforcer la sécurité, notamment quand vous utilisez un modèle tel que le [modèle d’opérateur de contrôle d’appels](http://msdn.microsoft.com/library/dn589793.aspx).</span><span class="sxs-lookup"><span data-stu-id="2e787-331">This can be useful in strengthening security, especially when you use a pattern such as the [Gatekeeper Pattern](http://msdn.microsoft.com/library/dn589793.aspx).</span></span>  

#### <a name="considerations"></a><span data-ttu-id="2e787-332">Considérations</span><span class="sxs-lookup"><span data-stu-id="2e787-332">Considerations</span></span>
<span data-ttu-id="2e787-333">Tenez compte des points suivants lorsque vous choisissez la méthode et l’emplacement de déploiement des tâches en arrière-plan via l’utilisation des rôles de travail et web de Cloud Services :</span><span class="sxs-lookup"><span data-stu-id="2e787-333">Consider the following points when choosing how and where to deploy background tasks when using Cloud Services web and worker roles:</span></span>

* <span data-ttu-id="2e787-334">L’hébergement des tâches en arrière-plan dans un rôle web existant peut permettre d’éviter les coûts liés à l’exécution d’un rôle de travail distinct pour ces seules tâches.</span><span class="sxs-lookup"><span data-stu-id="2e787-334">Hosting background tasks in an existing web role can save the cost of running a separate worker role just for these tasks.</span></span> <span data-ttu-id="2e787-335">Toutefois, cette méthode risque de diminuer les performances et la disponibilité de l’application en cas de contention du traitement et d’autres ressources.</span><span class="sxs-lookup"><span data-stu-id="2e787-335">However, it is likely to affect the performance and availability of the application if there is contention for processing and other resources.</span></span> <span data-ttu-id="2e787-336">L’utilisation d’un rôle de travail distinct protège le rôle web des effets de l’exécution de tâches en arrière-plan de longue durée ou nécessitant beaucoup de ressources.</span><span class="sxs-lookup"><span data-stu-id="2e787-336">Using a separate worker role protects the web role from the impact of long-running or resource-intensive background tasks.</span></span>
* <span data-ttu-id="2e787-337">Si vous hébergez des tâches en arrière-plan à l’aide de la classe **RoleEntryPoint** , vous pouvez facilement déplacer cette classe vers un autre rôle.</span><span class="sxs-lookup"><span data-stu-id="2e787-337">If you host background tasks by using the **RoleEntryPoint** class, you can easily move this to another role.</span></span> <span data-ttu-id="2e787-338">Par exemple, si vous créez la classe dans un rôle web, puis choisissez ensuite d’exécuter les tâches dans un rôle de travail, déplacez l’implémentation de la classe **RoleEntryPoint** vers le rôle de travail.</span><span class="sxs-lookup"><span data-stu-id="2e787-338">For example, if you create the class in a web role and later decide that you need to run the tasks in a worker role, you can move the **RoleEntryPoint** class implementation into the worker role.</span></span>
* <span data-ttu-id="2e787-339">Les tâches de démarrage sont conçues pour exécuter un programme ou un script.</span><span class="sxs-lookup"><span data-stu-id="2e787-339">Startup tasks are designed to execute a program or a script.</span></span> <span data-ttu-id="2e787-340">Le déploiement d’un travail en arrière-plan en tant que programme exécutable peut être plus compliqué à faire, surtout si cela implique aussi de déployer des assemblys dépendants.</span><span class="sxs-lookup"><span data-stu-id="2e787-340">Deploying a background job as an executable program might be more difficult, especially if it also requires deployment of dependent assemblies.</span></span> <span data-ttu-id="2e787-341">Quand vous utilisez des tâches de démarrage, il est souvent plus simple de déployer et d’utiliser un script pour définir un travail en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-341">It might be easier to deploy and use a script to define a background job when you use startup tasks.</span></span>
* <span data-ttu-id="2e787-342">Les exceptions qui provoquent l’échec d’une tâche en arrière-plan ont un impact variable selon leur mode d’hébergement :</span><span class="sxs-lookup"><span data-stu-id="2e787-342">Exceptions that cause a background task to fail have a different impact, depending on the way that they are hosted:</span></span>
  * <span data-ttu-id="2e787-343">Si vous utilisez la méthode reposant sur la classe **RoleEntryPoint** , l’échec d’une tâche entraîne le redémarrage du rôle ; la tâche redémarre automatiquement.</span><span class="sxs-lookup"><span data-stu-id="2e787-343">If you use the **RoleEntryPoint** class approach, a failed task will cause the role to restart so that the task automatically restarts.</span></span> <span data-ttu-id="2e787-344">Cela peut affecter la disponibilité de l’application.</span><span class="sxs-lookup"><span data-stu-id="2e787-344">This can affect availability of the application.</span></span> <span data-ttu-id="2e787-345">Pour éviter ce problème, veillez à inclure une fonction robuste de gestion des exceptions dans la classe **RoleEntryPoint** et dans toutes les tâches en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-345">To prevent this, ensure that you include robust exception handling within the **RoleEntryPoint** class and all the background tasks.</span></span> <span data-ttu-id="2e787-346">Utilisez du code pour redémarrer des tâches ayant échoué lorsque cela s’applique, et lancez l’exception pour redémarrer le rôle uniquement si vous ne pouvez effectuer une récupération normale suite à l’échec dans votre code.</span><span class="sxs-lookup"><span data-stu-id="2e787-346">Use code to restart tasks that fail where this is appropriate, and throw the exception to restart the role only if you cannot gracefully recover from the failure within your code.</span></span>
  * <span data-ttu-id="2e787-347">Si vous utilisez des tâches de démarrage, vous êtes chargé de gérer l’exécution des tâches et de vérifier si elles échouent.</span><span class="sxs-lookup"><span data-stu-id="2e787-347">If you use startup tasks, you are responsible for managing the task execution and checking if it fails.</span></span>
* <span data-ttu-id="2e787-348">Dans ce cas, les opérations de gestion et de surveillance des tâches de démarrage s’avèrent plus complexes qu’au moyen de la classe **RoleEntryPoint** .</span><span class="sxs-lookup"><span data-stu-id="2e787-348">Managing and monitoring startup tasks is more difficult than using the **RoleEntryPoint** class approach.</span></span> <span data-ttu-id="2e787-349">Toutefois, le Kit de développement logiciel (SDK) Azure WebJobs inclut un tableau de bord pour faciliter la gestion de tâches web que vous lancez via des tâches de démarrage.</span><span class="sxs-lookup"><span data-stu-id="2e787-349">However, the Azure WebJobs SDK includes a dashboard to make it easier to manage WebJobs that you initiate through startup tasks.</span></span>

#### <a name="lifecycle"></a><span data-ttu-id="2e787-350">Cycle de vie</span><span class="sxs-lookup"><span data-stu-id="2e787-350">Lifecycle</span></span> 
 <span data-ttu-id="2e787-351">Si vous décidez d’implémenter des travaux en arrière-plan pour les applications Cloud Services utilisant des rôles web ou de travail en recourant à la classe **RoleEntryPoint** , vous devez être capable d’appréhender le cycle de vie de cette classe, afin de pouvoir l’utiliser correctement.</span><span class="sxs-lookup"><span data-stu-id="2e787-351">If you decide to implement background jobs for Cloud Services applications that use web and worker roles by using the **RoleEntryPoint** class, it is important to understand the lifecycle of this class in order to use it correctly.</span></span>

<span data-ttu-id="2e787-352">Les rôles web et de travail passent par un ensemble de phases distinctes lorsqu’elles démarrent, s’exécutent et s’arrêtent.</span><span class="sxs-lookup"><span data-stu-id="2e787-352">Web and worker roles go through a set of distinct phases as they start, run, and stop.</span></span> <span data-ttu-id="2e787-353">La classe **RoleEntryPoint** expose une série d’événements qui indiquent que ces phases sont en cours.</span><span class="sxs-lookup"><span data-stu-id="2e787-353">The **RoleEntryPoint** class exposes a series of events that indicate when these stages are occurring.</span></span> <span data-ttu-id="2e787-354">Vous les utilisez pour lancer, exécuter et arrêter vos tâches en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-354">You use these to initialize, run, and stop your custom background tasks.</span></span> <span data-ttu-id="2e787-355">Voici le cycle complet :</span><span class="sxs-lookup"><span data-stu-id="2e787-355">The complete cycle is:</span></span>

* <span data-ttu-id="2e787-356">Azure charge l’assembly de rôle et effectue une recherche portant sur une classe dérivée de la classe **RoleEntryPoint**dans cet assembly.</span><span class="sxs-lookup"><span data-stu-id="2e787-356">Azure loads the role assembly and searches it for a class that derives from **RoleEntryPoint**.</span></span>
* <span data-ttu-id="2e787-357">S’il la trouve, il appelle la méthode **RoleEntryPoint.OnStart()**.</span><span class="sxs-lookup"><span data-stu-id="2e787-357">If it finds this class, it calls **RoleEntryPoint.OnStart()**.</span></span> <span data-ttu-id="2e787-358">Vous substituez cette méthode pour lancer vos tâches en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-358">You override this method to initialize your background tasks.</span></span>
* <span data-ttu-id="2e787-359">Une fois la méthode **OnStart** exécutée, Azure appelle la méthode **Application_Start()** dans le fichier global de l’application, s’il est présent (par exemple, le fichier Global.asax dans un rôle web exécutant ASP.NET).</span><span class="sxs-lookup"><span data-stu-id="2e787-359">After the **OnStart** method has completed, Azure calls **Application_Start()** in the application’s Global file if this is present (for example, Global.asax in a web role running ASP.NET).</span></span>
* <span data-ttu-id="2e787-360">Microsoft Azure appelle la méthode **RoleEntryPoint.Run()** sur un nouveau thread au premier plan qui s’exécute en parallèle avec la méthode **OnStart()**.</span><span class="sxs-lookup"><span data-stu-id="2e787-360">Azure calls **RoleEntryPoint.Run()** on a new foreground thread that executes in parallel with **OnStart()**.</span></span> <span data-ttu-id="2e787-361">Vous substituez cette méthode pour démarrer vos tâches en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-361">You override this method to start your background tasks.</span></span>
* <span data-ttu-id="2e787-362">Lorsque la méthode Run termine son exécution, Azure commence par appeler la méthode **Application_End()** dans le fichier global de l’application (s’il est présent), puis appelle la méthode **RoleEntryPoint.OnStop()**.</span><span class="sxs-lookup"><span data-stu-id="2e787-362">When the Run method ends, Azure first calls **Application_End()** in the application’s Global file if this is present, and then calls **RoleEntryPoint.OnStop()**.</span></span> <span data-ttu-id="2e787-363">Vous substituez la méthode **OnStop** pour arrêter vos tâches en arrière-plan, nettoyer les ressources, supprimer les objets et fermer les connexions que les tâches sont susceptibles d’avoir utilisées.</span><span class="sxs-lookup"><span data-stu-id="2e787-363">You override the **OnStop** method to stop your background tasks, clean up resources, dispose of objects, and close connections that the tasks may have used.</span></span>
* <span data-ttu-id="2e787-364">Le processus hôte du rôle de travail Azure est arrêté.</span><span class="sxs-lookup"><span data-stu-id="2e787-364">The Azure worker role host process is stopped.</span></span> <span data-ttu-id="2e787-365">À ce stade, ce rôle est recyclé et redémarre.</span><span class="sxs-lookup"><span data-stu-id="2e787-365">At this point, the role will be recycled and will restart.</span></span>

<span data-ttu-id="2e787-366">Pour en savoir plus et consulter un exemple d’utilisation des méthodes de la classe **RoleEntryPoint** , voir [Modèle de consolidation des ressources de calcul](http://msdn.microsoft.com/library/dn589778.aspx).</span><span class="sxs-lookup"><span data-stu-id="2e787-366">For more details and an example of using the methods of the **RoleEntryPoint** class, see [Compute Resource Consolidation Pattern](http://msdn.microsoft.com/library/dn589778.aspx).</span></span>

#### <a name="implementation-considerations"></a><span data-ttu-id="2e787-367">Considérations relatives à l'implémentation</span><span class="sxs-lookup"><span data-stu-id="2e787-367">Implementation considerations</span></span>

<span data-ttu-id="2e787-368">Si vous implémentez des tâches en arrière-plan dans un rôle Web ou de travail, tenez compte des points suivants :</span><span class="sxs-lookup"><span data-stu-id="2e787-368">Consider the following points if you are implementing background tasks in a web or worker role:</span></span>

* <span data-ttu-id="2e787-369">L’implémentation par défaut de la méthode **Run** dans la classe **RoleEntryPoint** contient un appel à l’élément **Thread.Sleep(Timeout.Infinite)** qui permet au rôle de rester actif indéfiniment.</span><span class="sxs-lookup"><span data-stu-id="2e787-369">The default **Run** method implementation in the **RoleEntryPoint** class contains a call to **Thread.Sleep(Timeout.Infinite)** that keeps the role alive indefinitely.</span></span> <span data-ttu-id="2e787-370">Si vous remplacez la méthode **Run** (qui est généralement nécessaire pour exécuter des tâches en arrière-plan), vous ne devez pas autoriser votre code à quitter cette méthode, sauf si vous voulez recycler l’instance du rôle.</span><span class="sxs-lookup"><span data-stu-id="2e787-370">If you override the **Run** method (which is typically necessary to execute background tasks), you must not allow your code to exit from the method unless you want to recycle the role instance.</span></span>
* <span data-ttu-id="2e787-371">Une implémentation classique de la méthode **Run** inclut du code pour démarrer chaque tâche en arrière-plan, ainsi qu’une construction en boucle qui vérifie périodiquement l’état de toutes les tâches en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-371">A typical implementation of the **Run** method includes code to start each of the background tasks and a loop construct that periodically checks the state of all the background tasks.</span></span> <span data-ttu-id="2e787-372">Elle peut redémarrer toute tâche en échec ou détecter la présence de jetons d’annulation qui signalent les travaux terminés.</span><span class="sxs-lookup"><span data-stu-id="2e787-372">It can restart any that fail or monitor for cancellation tokens that indicate that jobs have completed.</span></span>
* <span data-ttu-id="2e787-373">Si une tâche en arrière-plan lève une exception non gérée, cette tâche doit être recyclée alors que toutes les autres tâches en arrière-plan du rôle doivent être autorisées à se poursuivre.</span><span class="sxs-lookup"><span data-stu-id="2e787-373">If a background task throws an unhandled exception, that task should be recycled while allowing any other background tasks in the role to continue running.</span></span> <span data-ttu-id="2e787-374">Toutefois, si l’exception est provoquée par l’endommagement d’objets en dehors de la tâche, tels que le stockage partagé, cette exception doit être gérée par votre classe **RoleEntryPoint**, toutes les tâches doivent être annulées et la méthode **Run** doit être autorisée à se terminer.</span><span class="sxs-lookup"><span data-stu-id="2e787-374">However, if the exception is caused by corruption of objects outside the task, such as shared storage, the exception should be handled by your **RoleEntryPoint** class, all tasks should be cancelled, and the **Run** method should be allowed to end.</span></span> <span data-ttu-id="2e787-375">Ensuite, Microsoft Azure redémarre le rôle.</span><span class="sxs-lookup"><span data-stu-id="2e787-375">Azure will then restart the role.</span></span>
* <span data-ttu-id="2e787-376">Utilisez la méthode **OnStop** pour suspendre ou arrêter les tâches en arrière-plan et nettoyer les ressources.</span><span class="sxs-lookup"><span data-stu-id="2e787-376">Use the **OnStop** method to pause or kill background tasks and clean up resources.</span></span> <span data-ttu-id="2e787-377">Cela peut impliquer l’arrêt des tâches de longue durée ou à plusieurs étapes.</span><span class="sxs-lookup"><span data-stu-id="2e787-377">This might involve stopping long-running or multistep tasks.</span></span> <span data-ttu-id="2e787-378">Il est essentiel de savoir comment y parvenir sans entraîner d’incohérence des données.</span><span class="sxs-lookup"><span data-stu-id="2e787-378">It is vital to consider how this can be done to avoid data inconsistencies.</span></span> <span data-ttu-id="2e787-379">Si une instance de rôle s’arrête pour une raison quelconque (autre qu’un arrêt initié par l’utilisateur), le code exécutant la méthode **OnStop** doit se terminer dans les cinq minutes. Autrement, son arrêt est forcé.</span><span class="sxs-lookup"><span data-stu-id="2e787-379">If a role instance stops for any reason other than a user-initiated shutdown, the code running in the **OnStop** method must be completed within five minutes before it is forcibly terminated.</span></span> <span data-ttu-id="2e787-380">Assurez-vous que votre code peut s’exécuter dans le délai prévu ou qu’il accepte d’être arrêté avant la fin de son exécution.</span><span class="sxs-lookup"><span data-stu-id="2e787-380">Ensure that your code can be completed in that time or can tolerate not running to completion.</span></span>  
* <span data-ttu-id="2e787-381">L’équilibreur de charge Azure commence à diriger le trafic vers l’instance de rôle quand la méthode **RoleEntryPoint.OnStart** renvoie la valeur **true**.</span><span class="sxs-lookup"><span data-stu-id="2e787-381">The Azure load balancer starts directing traffic to the role instance when the **RoleEntryPoint.OnStart** method returns the value **true**.</span></span> <span data-ttu-id="2e787-382">Par conséquent, vous pouvez envisager de placer l’ensemble de votre code d’initialisation dans la méthode **OnStart** , afin que les instances de rôle qui ne s’initialisent pas correctement ne reçoivent aucun trafic.</span><span class="sxs-lookup"><span data-stu-id="2e787-382">Therefore, consider putting all your initialization code in the **OnStart** method so that role instances that do not successfully initialize will not receive any traffic.</span></span>
* <span data-ttu-id="2e787-383">Vous pouvez utiliser des tâches de démarrage en plus des méthodes de la classe **RoleEntryPoint** .</span><span class="sxs-lookup"><span data-stu-id="2e787-383">You can use startup tasks in addition to the methods of the **RoleEntryPoint** class.</span></span> <span data-ttu-id="2e787-384">Pour initialiser des paramètres à modifier dans l’équilibreur de charge Azure, utilisez des tâches de démarrage, car ces tâches sont exécutées avant que le rôle reçoive une demande.</span><span class="sxs-lookup"><span data-stu-id="2e787-384">You should use startup tasks to initialize any settings that you need to change in the Azure load balancer because these tasks will execute before the role receives any requests.</span></span> <span data-ttu-id="2e787-385">Pour plus d’informations, consultez [Exécuter des tâches de démarrage dans Azure](/azure/cloud-services/cloud-services-startup-tasks/).</span><span class="sxs-lookup"><span data-stu-id="2e787-385">For more information, see [Run startup tasks in Azure](/azure/cloud-services/cloud-services-startup-tasks/).</span></span>
* <span data-ttu-id="2e787-386">Si une tâche de démarrage contient une erreur, cela peut obliger le rôle à redémarrer continuellement.</span><span class="sxs-lookup"><span data-stu-id="2e787-386">If there is an error in a startup task, it might force the role to continually restart.</span></span> <span data-ttu-id="2e787-387">Vous ne pourrez alors peut-être pas faire un échange d’adresses virtuelles IP (VIP) vers une version intermédiaire précédente, car l’échange nécessite un accès exclusif au rôle,</span><span class="sxs-lookup"><span data-stu-id="2e787-387">This can prevent you from performing a virtual IP (VIP) address swap back to a previously staged version because the swap requires exclusive access to the role.</span></span> <span data-ttu-id="2e787-388">ce qui est impossible pendant le redémarrage du rôle.</span><span class="sxs-lookup"><span data-stu-id="2e787-388">This cannot be obtained while the role is restarting.</span></span> <span data-ttu-id="2e787-389">Pour résoudre ce problème :</span><span class="sxs-lookup"><span data-stu-id="2e787-389">To resolve this:</span></span>
  
  * <span data-ttu-id="2e787-390">Ajoutez le code suivant au début des méthodes **OnStart** et **Run**, dans votre rôle :</span><span class="sxs-lookup"><span data-stu-id="2e787-390">Add the following code to the beginning of the **OnStart** and **Run** methods in your role:</span></span>
    
    ```C#
    var freeze = CloudConfigurationManager.GetSetting("Freeze");
    if (freeze != null)
    {
     if (Boolean.Parse(freeze))
       {
         Thread.Sleep(System.Threading.Timeout.Infinite);
     }
    }
    ```
    
    * <span data-ttu-id="2e787-391">Ajoutez la définition du paramètre **Freeze** en tant que valeur booléenne dans les fichiers ServiceDefinition.csdef et ServiceConfiguration.\*.cscfg du rôle, puis définissez ce paramètre sur la valeur **false**.</span><span class="sxs-lookup"><span data-stu-id="2e787-391">Add the definition of the **Freeze** setting as a Boolean value to the ServiceDefinition.csdef and ServiceConfiguration.\*.cscfg files for the role and set it to **false**.</span></span> <span data-ttu-id="2e787-392">Si le rôle entre dans un mode de redémarrage répété, vous pouvez redéfinir ce paramètre sur la valeur **true** pour geler l’exécution du rôle et permettre son échange avec une version précédente.</span><span class="sxs-lookup"><span data-stu-id="2e787-392">If the role goes into a repeated restart mode, you can change the setting to **true** to freeze role execution and allow it to be swapped with a previous version.</span></span>

#### <a name="more-information"></a><span data-ttu-id="2e787-393">Plus d’informations</span><span class="sxs-lookup"><span data-stu-id="2e787-393">More information</span></span>
* [<span data-ttu-id="2e787-394">Modèle de consolidation des ressources de calcul</span><span class="sxs-lookup"><span data-stu-id="2e787-394">Compute Resource Consolidation Pattern</span></span>](http://msdn.microsoft.com/library/dn589778.aspx)
* [<span data-ttu-id="2e787-395">Prise en main du Kit de développement logiciel (SDK) Azure WebJobs</span><span class="sxs-lookup"><span data-stu-id="2e787-395">Get started with the Azure WebJobs SDK</span></span>](/azure/app-service-web/websites-dotnet-webjobs-sdk-get-started/)


## <a name="partitioning"></a><span data-ttu-id="2e787-396">Partitionnement</span><span class="sxs-lookup"><span data-stu-id="2e787-396">Partitioning</span></span>
<span data-ttu-id="2e787-397">Si vous décidez d’inclure des tâches en arrière-plan dans une instance de calcul existante (par exemple, une application web, un rôle web, un rôle de travail existant ou une machine virtuelle), vous devez déterminer l’effet de cette opération sur les attributs de qualité de l’instance de calcul et de la tâche en arrière-plan elle-même.</span><span class="sxs-lookup"><span data-stu-id="2e787-397">If you decide to include background tasks within an existing compute instance (such as a web app, web role, existing worker role, or virtual machine), you must consider how this will affect the quality attributes of the compute instance and the background task itself.</span></span> <span data-ttu-id="2e787-398">Ces facteurs vous aident à décider s’il faut colocaliser les tâches avec l’instance de calcul existante, ou les séparer dans une instance de calcul distincte :</span><span class="sxs-lookup"><span data-stu-id="2e787-398">These factors will help you to decide whether to colocate the tasks with the existing compute instance or separate them out into a separate compute instance:</span></span>

* <span data-ttu-id="2e787-399">**Disponibilité**: les tâches en arrière-plan n’ont pas nécessairement besoin du même niveau de disponibilité que d’autres parties de l’application, comme c’est le cas pour l’interface utilisateur et d’autres composants intervenant directement dans les interactions des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="2e787-399">**Availability**: Background tasks might not need to have the same level of availability as other parts of the application, in particular the UI and other parts that are directly involved in user interaction.</span></span> <span data-ttu-id="2e787-400">Par ailleurs, les tâches en arrière-plan peuvent être plus tolérantes envers un problème de latence ou l’échec d’une nouvelle tentative de connexion, voire d’autres facteurs affectant la disponibilité, car les opérations peuvent être mises en file d’attente.</span><span class="sxs-lookup"><span data-stu-id="2e787-400">Background tasks might be more tolerant of latency, retried connection failures, and other factors that affect availability because the operations can be queued.</span></span> <span data-ttu-id="2e787-401">Toutefois, la capacité doit être suffisante pour empêcher la sauvegarde de demandes susceptibles de bloquer les files d’attente et d’affecter l’application dans son ensemble.</span><span class="sxs-lookup"><span data-stu-id="2e787-401">However, there must be sufficient capacity to prevent the backup of requests that could block queues and affect the application as a whole.</span></span>
* <span data-ttu-id="2e787-402">**Extensibilité** : les tâches en arrière-plan n’ont souvent pas les mêmes exigences d’extensibilité que l’interface utilisateur et les éléments interactifs de l’application.</span><span class="sxs-lookup"><span data-stu-id="2e787-402">**Scalability**: Background tasks are likely to have a different scalability requirement than the UI and the interactive parts of the application.</span></span> <span data-ttu-id="2e787-403">Il peut être nécessaire de mettre l’interface utilisateur à l’échelle pour qu’elle puisse gérer les pics de demande. Les tâches en arrière-plan en attente peuvent alors être exécutées pendant les périodes moins chargées par un nombre plus réduit d’instances de calcul.</span><span class="sxs-lookup"><span data-stu-id="2e787-403">Scaling the UI might be necessary to meet peaks in demand, while outstanding background tasks might be completed during less busy times by a fewer number of compute instances.</span></span>
* <span data-ttu-id="2e787-404">**Résilience**: l’échec d’une instance de calcul qui héberge simplement des tâches en arrière-plan peut ne pas affecter l’application dans son ensemble s’il est possible de mettre en file d’attente ou de reporter les demandes relatives à ces tâches jusqu’à ce que la tâche soit redevenue disponible.</span><span class="sxs-lookup"><span data-stu-id="2e787-404">**Resiliency**: Failure of a compute instance that just hosts background tasks might not fatally affect the application as a whole if the requests for these tasks can be queued or postponed until the task is available again.</span></span> <span data-ttu-id="2e787-405">Si l’instance de calcul et/ou les tâches peuvent être redémarrées dans un intervalle approprié, l’échec peut être transparent pour les utilisateurs de l’application.</span><span class="sxs-lookup"><span data-stu-id="2e787-405">If the compute instance and/or tasks can be restarted within an appropriate interval, users of the application might not be affected.</span></span>
* <span data-ttu-id="2e787-406">**Sécurité**: les tâches en arrière-plan peuvent avoir des restrictions ou exigences de sécurité différentes par rapport à l’interface utilisateur ou à d’autres éléments de l’application.</span><span class="sxs-lookup"><span data-stu-id="2e787-406">**Security**: Background tasks might have different security requirements or restrictions than the UI or other parts of the application.</span></span> <span data-ttu-id="2e787-407">En utilisant une instance de calcul distincte, vous pouvez spécifier un environnement de sécurité différent pour les tâches.</span><span class="sxs-lookup"><span data-stu-id="2e787-407">By using a separate compute instance, you can specify a different security environment for the tasks.</span></span> <span data-ttu-id="2e787-408">Vous pouvez également utiliser des modèles comme celui de l’opérateur de contrôle d’appels pour isoler les instances de calcul en arrière-plan de l’interface utilisateur, afin d’optimiser la sécurité et la séparation.</span><span class="sxs-lookup"><span data-stu-id="2e787-408">You can also use patterns such as Gatekeeper to isolate the background compute instances from the UI in order to maximize security and separation.</span></span>
* <span data-ttu-id="2e787-409">**Performances**: vous pouvez choisir le type d’instance de calcul des tâches en arrière-plan de façon qu’il réponde précisément aux exigences de ces tâches en termes de performances.</span><span class="sxs-lookup"><span data-stu-id="2e787-409">**Performance**: You can choose the type of compute instance for background tasks to specifically match the performance requirements of the tasks.</span></span> <span data-ttu-id="2e787-410">Cela peut se traduire par l’utilisation d’une option de calcul moins coûteuse si les tâches ne nécessitent pas les mêmes fonctions de traitement que l’interface utilisateur, ou d’une instance plus volumineuse s’il leur faut davantage de capacité et de ressources.</span><span class="sxs-lookup"><span data-stu-id="2e787-410">This might mean using a less expensive compute option if the tasks do not require the same processing capabilities as the UI, or a larger instance if they require additional capacity and resources.</span></span>
* <span data-ttu-id="2e787-411">**Gestion**: les tâches en arrière-plan ne suivent pas forcément le même rythme de développement et de déploiement que celui du code de l’application principale ou de l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2e787-411">**Manageability**: Background tasks might have a different development and deployment rhythm from the main application code or the UI.</span></span> <span data-ttu-id="2e787-412">Le fait de déployer une instance de calcul distincte peut permettre de simplifier les mises à jour et le contrôle de version.</span><span class="sxs-lookup"><span data-stu-id="2e787-412">Deploying them to a separate compute instance can simplify updates and versioning.</span></span>
* <span data-ttu-id="2e787-413">**Coût**: l’ajout d’instances de calcul pour exécuter des tâches en arrière-plan augmente les coûts d’hébergement.</span><span class="sxs-lookup"><span data-stu-id="2e787-413">**Cost**: Adding compute instances to execute background tasks increases hosting costs.</span></span> <span data-ttu-id="2e787-414">Vous devez déterminer soigneusement l’équilibre entre l’ajout de capacité additionnelle et ces coûts supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="2e787-414">You should carefully consider the trade-off between additional capacity and these extra costs.</span></span>

<span data-ttu-id="2e787-415">Pour plus d’informations, consultez [Leader Election Pattern](http://msdn.microsoft.com/library/dn568104.aspx) (Modèle de choix de l’instance responsable) et [Competing Consumers Pattern](http://msdn.microsoft.com/library/dn568101.aspx) (Modèle de consommateurs concurrents).</span><span class="sxs-lookup"><span data-stu-id="2e787-415">For more information, see [Leader Election Pattern](http://msdn.microsoft.com/library/dn568104.aspx) and [Competing Consumers Pattern](http://msdn.microsoft.com/library/dn568101.aspx).</span></span>

## <a name="conflicts"></a><span data-ttu-id="2e787-416">Conflits</span><span class="sxs-lookup"><span data-stu-id="2e787-416">Conflicts</span></span>
<span data-ttu-id="2e787-417">Si vous avez plusieurs instances d’un travail en arrière-plan, il est possible qu’elles soient en concurrence pour l’accès aux ressources et aux services (les bases de données et le stockage, par exemple).</span><span class="sxs-lookup"><span data-stu-id="2e787-417">If you have multiple instances of a background job, it is possible that they will compete for access to resources and services, such as databases and storage.</span></span> <span data-ttu-id="2e787-418">Cet accès simultané peut provoquer une contention des ressources et compromettre alors la disponibilité des services et l’intégrité des données dans le stockage.</span><span class="sxs-lookup"><span data-stu-id="2e787-418">This concurrent access can result in resource contention, which might cause conflicts in availability of the services and in the integrity of data in storage.</span></span> <span data-ttu-id="2e787-419">Vous pouvez résoudre une contention de ressources par une approche de verrouillage pessimiste.</span><span class="sxs-lookup"><span data-stu-id="2e787-419">You can resolve resource contention by using a pessimistic locking approach.</span></span> <span data-ttu-id="2e787-420">Cela empêche les instances concurrentes d’une tâche d’accéder simultanément à un service ou d’endommager les données.</span><span class="sxs-lookup"><span data-stu-id="2e787-420">This prevents competing instances of a task from concurrently accessing a service or corrupting data.</span></span>

<span data-ttu-id="2e787-421">Vous pouvez aussi définir des tâches en arrière-plan en tant que singletons, afin qu’une seule instance s’exécute à la fois.</span><span class="sxs-lookup"><span data-stu-id="2e787-421">Another approach to resolve conflicts is to define background tasks as a singleton, so that there is only ever one instance running.</span></span> <span data-ttu-id="2e787-422">Toutefois, si vous choisissez cette solution, vous perdez les avantages d’une configuration à plusieurs instances en termes de fiabilité et de performances.</span><span class="sxs-lookup"><span data-stu-id="2e787-422">However, this eliminates the reliability and performance benefits that a multiple-instance configuration can provide.</span></span> <span data-ttu-id="2e787-423">Cela est particulièrement vrai si l’interface utilisateur est capable de garantir l’activité d’au moins une tâche en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-423">This is especially true if the UI can supply sufficient work to keep more than one background task busy.</span></span>

<span data-ttu-id="2e787-424">Vous devez impérativement vous assurer que la tâche en arrière-plan peut redémarrer automatiquement et qu’elle a une capacité suffisante pour répondre aux pics de demande.</span><span class="sxs-lookup"><span data-stu-id="2e787-424">It is vital to ensure that the background task can automatically restart and that it has sufficient capacity to cope with peaks in demand.</span></span> <span data-ttu-id="2e787-425">Pour cela, allouez une instance de calcul avec un nombre de ressources suffisant et/ou implémentez un mécanisme de mise en file d’attente capable de stocker les demandes à exécuter ultérieurement (quand la demande sera moins forte).</span><span class="sxs-lookup"><span data-stu-id="2e787-425">You can achieve this by allocating a compute instance with sufficient resources, by implementing a queueing mechanism that can store requests for later execution when demand decreases, or by using a combination of these techniques.</span></span>

## <a name="coordination"></a><span data-ttu-id="2e787-426">Coordination</span><span class="sxs-lookup"><span data-stu-id="2e787-426">Coordination</span></span>
<span data-ttu-id="2e787-427">Les tâches en arrière-plan peuvent être complexes et nécessiter le lancement de plusieurs tâches individuelles pour produire un résultat ou remplir toutes les exigences.</span><span class="sxs-lookup"><span data-stu-id="2e787-427">The background tasks might be complex and might require multiple individual tasks to execute to produce a result or to fulfil all the requirements.</span></span> <span data-ttu-id="2e787-428">Dans ces scénarios, on divise souvent la tâche en sous-tâches ou étapes discrètes de plus petite taille, qui peuvent être exécutées par plusieurs consommateurs.</span><span class="sxs-lookup"><span data-stu-id="2e787-428">It is common in these scenarios to divide the task into smaller discreet steps or subtasks that can be executed by multiple consumers.</span></span> <span data-ttu-id="2e787-429">Les travaux à plusieurs étapes peuvent être plus performants et plus flexibles, car chaque étape est réutilisable dans plusieurs travaux.</span><span class="sxs-lookup"><span data-stu-id="2e787-429">Multistep jobs can be more efficient and more flexible because individual steps might be reusable in multiple jobs.</span></span> <span data-ttu-id="2e787-430">Il est également aisé d’ajouter, de supprimer ou de modifier l’ordre de ces étapes.</span><span class="sxs-lookup"><span data-stu-id="2e787-430">It is also easy to add, remove, or modify the order of the steps.</span></span>

<span data-ttu-id="2e787-431">La coordination de plusieurs étapes ou tâches peut s’avérer délicate, mais vous pouvez vous aider de trois modèles courants pour implémenter une solution :</span><span class="sxs-lookup"><span data-stu-id="2e787-431">Coordinating multiple tasks and steps can be challenging, but there are three common patterns that you can use to guide your implementation of a solution:</span></span>

* <span data-ttu-id="2e787-432">**Décomposition d’une tâche en plusieurs étapes réutilisables**.</span><span class="sxs-lookup"><span data-stu-id="2e787-432">**Decomposing a task into multiple reusable steps**.</span></span> <span data-ttu-id="2e787-433">Une application a parfois besoin d’exécuter une série de tâches plus ou moins complexes sur les informations qu’elle traite.</span><span class="sxs-lookup"><span data-stu-id="2e787-433">An application might be required to perform a variety of tasks of varying complexity on the information that it processes.</span></span> <span data-ttu-id="2e787-434">Il existe une approche simple, mais assez rigide, permettant d’implémenter cette application. Elle consiste à effectuer ce traitement comme un module monolithique.</span><span class="sxs-lookup"><span data-stu-id="2e787-434">A straightforward but inflexible approach to implementing this application might be to perform this processing as a monolithic module.</span></span> <span data-ttu-id="2e787-435">Toutefois, cette approche est susceptible de réduire les opportunités de refactorisation, d’optimisation ou de réutilisation du code, si certaines parties du même processus de traitement doivent être utilisées à un autre emplacement de l’application.</span><span class="sxs-lookup"><span data-stu-id="2e787-435">However, this approach is likely to reduce the opportunities for refactoring the code, optimizing it, or reusing it if parts of the same processing are required elsewhere within the application.</span></span> <span data-ttu-id="2e787-436">Pour en savoir plus, voir [Modèle des canaux et filtres](http://msdn.microsoft.com/library/dn568100.aspx).</span><span class="sxs-lookup"><span data-stu-id="2e787-436">For more information, see [Pipes and Filters Pattern](http://msdn.microsoft.com/library/dn568100.aspx).</span></span>
* <span data-ttu-id="2e787-437">**Gestion de l’exécution des étapes d’une tâche**.</span><span class="sxs-lookup"><span data-stu-id="2e787-437">**Managing execution of the steps for a task**.</span></span> <span data-ttu-id="2e787-438">Une application peut effectuer des tâches comprenant plusieurs étapes, dont certaines nécessitent l’utilisation de services distants ou l’accès à des ressources distantes.</span><span class="sxs-lookup"><span data-stu-id="2e787-438">An application might perform tasks that comprise a number of steps (some of which might invoke remote services or access remote resources).</span></span> <span data-ttu-id="2e787-439">Les étapes peuvent être indépendantes les unes des autres, mais elles restent orchestrées par la logique d’application qui implémente la tâche.</span><span class="sxs-lookup"><span data-stu-id="2e787-439">The individual steps might be independent of each other, but they are orchestrated by the application logic that implements the task.</span></span> <span data-ttu-id="2e787-440">Pour en savoir plus, voir [Modèle de superviseur de l’agent du planificateur](http://msdn.microsoft.com/library/dn589780.aspx).</span><span class="sxs-lookup"><span data-stu-id="2e787-440">For more information, see [Scheduler Agent Supervisor Pattern](http://msdn.microsoft.com/library/dn589780.aspx).</span></span>
* <span data-ttu-id="2e787-441">**Gestion de la récupération des étapes en échec d’une tâche**.</span><span class="sxs-lookup"><span data-stu-id="2e787-441">**Managing recovery for task steps that fail**.</span></span> <span data-ttu-id="2e787-442">Une application peut avoir besoin d’annuler le travail effectué par une série d’étapes (qui définissent une opération cohérente au final) si une ou plusieurs de ces étapes échouent.</span><span class="sxs-lookup"><span data-stu-id="2e787-442">An application might need to undo the work that is performed by a series of steps (which together define an eventually consistent operation) if one or more of the steps fail.</span></span> <span data-ttu-id="2e787-443">Pour en savoir plus, voir [Modèle de transaction de compensation](http://msdn.microsoft.com/library/dn589804.aspx).</span><span class="sxs-lookup"><span data-stu-id="2e787-443">For more information, see [Compensating Transaction Pattern](http://msdn.microsoft.com/library/dn589804.aspx).</span></span>


## <a name="resiliency-considerations"></a><span data-ttu-id="2e787-444">Remarques relatives à la résilience</span><span class="sxs-lookup"><span data-stu-id="2e787-444">Resiliency considerations</span></span>
<span data-ttu-id="2e787-445">Les tâches en arrière-plan doivent être assez résilientes pour pouvoir fournir des services fiables à l’application.</span><span class="sxs-lookup"><span data-stu-id="2e787-445">Background tasks must be resilient in order to provide reliable services to the application.</span></span> <span data-ttu-id="2e787-446">Quand vous planifiez et créez des tâches en arrière-plan, tenez compte des points suivants :</span><span class="sxs-lookup"><span data-stu-id="2e787-446">When you are planning and designing background tasks, consider the following points:</span></span>

* <span data-ttu-id="2e787-447">Les tâches en arrière-plan doivent être en mesure de gérer correctement le redémarrage d’un rôle ou d’un service, sans corrompre les données ni introduire d’incohérences dans l’application.</span><span class="sxs-lookup"><span data-stu-id="2e787-447">Background tasks must be able to gracefully handle role or service restarts without corrupting data or introducing inconsistency into the application.</span></span> <span data-ttu-id="2e787-448">Pour les tâches de longue durée ou à plusieurs étapes, envisagez d’utiliser des *points de contrôle*, en enregistrant l’état des travaux dans le stockage persistant ou en tant que messages dans une file d’attente, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="2e787-448">For long-running or multistep tasks, consider using *check pointing* by saving the state of jobs in persistent storage, or as messages in a queue if this is appropriate.</span></span> <span data-ttu-id="2e787-449">Par exemple, vous pouvez conserver les informations d’état dans un message placé en file d’attente, et mettre à jour ces informations de manière incrémentielle en parallèle avec la progression de la tâche. Cette tâche peut ainsi être traitée à partir du dernier point de contrôle au lieu d’être réexécutée depuis le début.</span><span class="sxs-lookup"><span data-stu-id="2e787-449">For example, you can persist state information in a message in a queue and incrementally update this state information with the task progress so that the task can be processed from the last known good checkpoint--instead of restarting from the beginning.</span></span> <span data-ttu-id="2e787-450">Lorsque vous utilisez des files d’attente Azure Service Bus, vous pouvez recourir à des sessions de messages pour activer le même scénario.</span><span class="sxs-lookup"><span data-stu-id="2e787-450">When using Azure Service Bus queues, you can use message sessions to enable the same scenario.</span></span> <span data-ttu-id="2e787-451">Les sessions vous permettent d’enregistrer et de récupérer l’état de traitement de l’application (à l’aide des méthodes [SetState](https://docs.microsoft.com/dotnet/api/microsoft.servicebus.messaging.messagesession.setstate?view=azureservicebus-4.0.0) et [GetState](https://docs.microsoft.com/dotnet/api/microsoft.servicebus.messaging.messagesession.getstate?view=azureservicebus-4.0.0)).</span><span class="sxs-lookup"><span data-stu-id="2e787-451">Sessions allow you to save and retrieve the application processing state by using the [SetState](https://docs.microsoft.com/dotnet/api/microsoft.servicebus.messaging.messagesession.setstate?view=azureservicebus-4.0.0) and [GetState](https://docs.microsoft.com/dotnet/api/microsoft.servicebus.messaging.messagesession.getstate?view=azureservicebus-4.0.0) methods.</span></span> <span data-ttu-id="2e787-452">Pour plus d’informations sur la conception de processus et workflows à plusieurs étapes fiables, consultez [Scheduler Agent Supervisor Pattern](http://msdn.microsoft.com/library/dn589780.aspx) (Modèle de superviseur de l’agent du planificateur).</span><span class="sxs-lookup"><span data-stu-id="2e787-452">For more information about designing reliable multistep processes and workflows, see [Scheduler Agent Supervisor Pattern](http://msdn.microsoft.com/library/dn589780.aspx).</span></span>
* <span data-ttu-id="2e787-453">Quand vous utilisez des rôles web ou de travail pour héberger plusieurs tâches en arrière-plan, concevez le remplacement de la méthode **Run** pour effectuer le suivi des tâches interrompues ou en échec, et les redémarrer.</span><span class="sxs-lookup"><span data-stu-id="2e787-453">When you use web or worker roles to host multiple background tasks, design your override of the **Run** method to monitor for failed or stalled tasks, and restart them.</span></span> <span data-ttu-id="2e787-454">Si cette opération n’est pas pratique, et si vous utilisez un rôle de travail, obligez ce dernier à redémarrer en quittant la méthode **Run** .</span><span class="sxs-lookup"><span data-stu-id="2e787-454">Where this is not practical, and you are using a worker role, force the worker role to restart by exiting from the **Run** method.</span></span>
* <span data-ttu-id="2e787-455">Quand vous utilisez des files d’attente pour communiquer avec les tâches en arrière-plan, ces files peuvent jouer le rôle de mémoire tampon pour stocker les demandes qui sont envoyées aux tâches à un moment où l’application connaît une surcharge.</span><span class="sxs-lookup"><span data-stu-id="2e787-455">When you use queues to communicate with background tasks, the queues can act as a buffer to store requests that are sent to the tasks while the application is under higher than usual load.</span></span> <span data-ttu-id="2e787-456">Ainsi, les tâches peuvent se mettre au même niveau que l’interface utilisateur lorsque l’activité baisse.</span><span class="sxs-lookup"><span data-stu-id="2e787-456">This allows the tasks to catch up with the UI during less busy periods.</span></span> <span data-ttu-id="2e787-457">Cela signifie également que le recyclage du rôle ne bloquera pas l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2e787-457">It also means that recycling the role will not block the UI.</span></span> <span data-ttu-id="2e787-458">Pour en savoir plus, voir [Modèle de nivellement de la charge basé sur une file d’attente](http://msdn.microsoft.com/library/dn589783.aspx).</span><span class="sxs-lookup"><span data-stu-id="2e787-458">For more information, see [Queue-Based Load Leveling Pattern](http://msdn.microsoft.com/library/dn589783.aspx).</span></span> <span data-ttu-id="2e787-459">Si certaines tâches sont plus importantes que d’autres, vous pouvez envisager d’implémenter le [modèle de file d’attente prioritaire](http://msdn.microsoft.com/library/dn589794.aspx) pour vous assurer que ces tâches s’exécutent avant les autres.</span><span class="sxs-lookup"><span data-stu-id="2e787-459">If some tasks are more important than others, consider implementing the [Priority Queue Pattern](http://msdn.microsoft.com/library/dn589794.aspx) to ensure that these tasks run before less important ones.</span></span>
* <span data-ttu-id="2e787-460">Les tâches en arrière-plan qui sont lancées par des messages ou qui traitent des messages doivent être conçues pour gérer les incohérences, comme les messages qui arrivent dans le désordre, les messages qui entraînent une erreur de manière récurrente (souvent appelés *messages incohérents*) et les messages qui sont remis plusieurs fois.</span><span class="sxs-lookup"><span data-stu-id="2e787-460">Background tasks that are initiated by messages or process messages must be designed to handle inconsistencies, such as messages arriving out of order, messages that repeatedly cause an error (often referred to as *poison messages*), and messages that are delivered more than once.</span></span> <span data-ttu-id="2e787-461">Tenez compte des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="2e787-461">Consider the following:</span></span>
  * <span data-ttu-id="2e787-462">Les messages devant être traités dans un ordre spécifique, comme ceux qui modifient les données sur la base de la valeur des données existante (par exemple, en ajoutant une valeur à une valeur existante), risquent de ne pas arriver dans le même ordre que lors de leur envoi.</span><span class="sxs-lookup"><span data-stu-id="2e787-462">Messages that must be processed in a specific order, such as those that change data based on the existing data value (for example, adding a value to an existing value), might not arrive in the original order in which they were sent.</span></span> <span data-ttu-id="2e787-463">Ils peuvent aussi être gérés par différentes instances d’une tâche en arrière-plan et selon un ordre différent en raison des charges variables sur chaque instance.</span><span class="sxs-lookup"><span data-stu-id="2e787-463">Alternatively, they might be handled by different instances of a background task in a different order due to varying loads on each instance.</span></span> <span data-ttu-id="2e787-464">Les messages devant être traités dans un ordre spécifique doivent inclure un numéro, une clé ou tout autre indicateur de séquence que les tâches en arrière-plan peuvent utiliser pour garantir leur traitement dans l’ordre adéquat.</span><span class="sxs-lookup"><span data-stu-id="2e787-464">Messages that must be processed in a specific order should include a sequence number, key, or some other indicator that background tasks can use to ensure that they are processed in the correct order.</span></span> <span data-ttu-id="2e787-465">Si vous utilisez Microsoft Azure Service Bus, vous pouvez utiliser des sessions de messagerie afin de garantir un ordre de livraison adéquat.</span><span class="sxs-lookup"><span data-stu-id="2e787-465">If you are using Azure Service Bus, you can use message sessions to guarantee the order of delivery.</span></span> <span data-ttu-id="2e787-466">Toutefois, la conception d’un processus ne tenant pas compte de l’ordre des messages, quand cela possible, est généralement plus efficace.</span><span class="sxs-lookup"><span data-stu-id="2e787-466">However, it is usually more efficient, where possible, to design the process so that the message order is not important.</span></span>
  * <span data-ttu-id="2e787-467">En règle générale, une tâche en arrière-plan obtient un aperçu des messages de la file d’attente, ce qui les masque aux autres consommateurs de messages pendant un temps.</span><span class="sxs-lookup"><span data-stu-id="2e787-467">Typically, a background task will peek at messages in the queue, which temporarily hides them from other message consumers.</span></span> <span data-ttu-id="2e787-468">Elle supprime ensuite les messages dont le traitement est terminé.</span><span class="sxs-lookup"><span data-stu-id="2e787-468">Then it deletes the messages after they have been successfully processed.</span></span> <span data-ttu-id="2e787-469">Si une tâche en arrière-plan échoue à traiter un message, ce dernier réapparaît dans la file d’attente après expiration du délai de l’aperçu.</span><span class="sxs-lookup"><span data-stu-id="2e787-469">If a background task fails when processing a message, that message will reappear on the queue after the peek time-out expires.</span></span> <span data-ttu-id="2e787-470">Le message sera traité par une autre instance de la tâche ou lors du prochain cycle de traitement de cette instance.</span><span class="sxs-lookup"><span data-stu-id="2e787-470">It will be processed by another instance of the task or during the next processing cycle of this instance.</span></span> <span data-ttu-id="2e787-471">Si ce message provoque une erreur répétée dans le consommateur, il bloque la tâche, la file d’attente, voire l’application elle-même lorsque la file d’attente est saturée.</span><span class="sxs-lookup"><span data-stu-id="2e787-471">If the message consistently causes an error in the consumer, it will block the task, the queue, and eventually the application itself when the queue becomes full.</span></span> <span data-ttu-id="2e787-472">Pour cette raison, il est essentiel de détecter et de supprimer les messages incohérents de la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="2e787-472">Therefore, it is vital to detect and remove poison messages from the queue.</span></span> <span data-ttu-id="2e787-473">Si vous utilisez Microsoft Azure Service Bus, vous pouvez déplacer les messages entraînant une erreur (manuellement ou automatiquement) vers une file d’attente de lettres mortes associée.</span><span class="sxs-lookup"><span data-stu-id="2e787-473">If you are using Azure Service Bus, messages that cause an error can be moved automatically or manually to an associated dead letter queue.</span></span>
  * <span data-ttu-id="2e787-474">Les files d’attente bénéficient nécessairement *d’au moins un* mécanisme de livraison, mais elles peuvent remettre le même message plusieurs fois.</span><span class="sxs-lookup"><span data-stu-id="2e787-474">Queues are guaranteed at *least once* delivery mechanisms, but they might deliver the same message more than once.</span></span> <span data-ttu-id="2e787-475">En outre, si une tâche en arrière-plan échoue après avoir traité un message, mais avant de l’avoir supprimé de la file d’attente, ce message pourra à nouveau être traité.</span><span class="sxs-lookup"><span data-stu-id="2e787-475">In addition, if a background task fails after processing a message but before deleting it from the queue, the message will become available for processing again.</span></span> <span data-ttu-id="2e787-476">Les tâches en arrière-plan doivent être idempotentes : cela signifie que le traitement d’un même message plusieurs fois n’entraîne aucune erreur ni aucune incohérence dans les données de l’application.</span><span class="sxs-lookup"><span data-stu-id="2e787-476">Background tasks should be idempotent, which means that processing the same message more than once does not cause an error or inconsistency in the application’s data.</span></span> <span data-ttu-id="2e787-477">Par nature, certaines opérations sont idempotentes (comme la définition d’une valeur stockée sur une nouvelle valeur spécifique).</span><span class="sxs-lookup"><span data-stu-id="2e787-477">Some operations are naturally idempotent, such as setting a stored value to a specific new value.</span></span> <span data-ttu-id="2e787-478">Toutefois, si, par exemple, vous ajoutez une valeur à une valeur stockée existante sans vérifier que cette dernière n’a pas été modifiée depuis le moment où le message a été envoyé pour la première fois, des incohérences apparaîtront.</span><span class="sxs-lookup"><span data-stu-id="2e787-478">However, operations such as adding a value to an existing stored value without checking that the stored value is still the same as when the message was originally sent will cause inconsistencies.</span></span> <span data-ttu-id="2e787-479">Les files d’attente Microsoft Azure Service Bus peuvent être configurées pour supprimer automatiquement les messages en double.</span><span class="sxs-lookup"><span data-stu-id="2e787-479">Azure Service Bus queues can be configured to automatically remove duplicated messages.</span></span>
  * <span data-ttu-id="2e787-480">Certains systèmes de messagerie, comme les files d’attente de stockage Microsoft Azure et les files Azure Service Bus, prennent en charge une propriété « de-queue count », qui indique le nombre de lectures d’un message depuis la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="2e787-480">Some messaging systems, such as Azure storage queues and Azure Service Bus queues, support a de-queue count property that indicates the number of times a message has been read from the queue.</span></span> <span data-ttu-id="2e787-481">Cette propriété peut être utile lors du traitement de messages incohérents et répétés.</span><span class="sxs-lookup"><span data-stu-id="2e787-481">This can be useful in handling repeated and poison messages.</span></span> <span data-ttu-id="2e787-482">Pour en savoir plus, voir [Primer de messagerie asynchrone](http://msdn.microsoft.com/library/dn589781.aspx) et [Modèles d’idempotence](http://blog.jonathanoliver.com/2010/04/idempotency-patterns/).</span><span class="sxs-lookup"><span data-stu-id="2e787-482">For more information, see [Asynchronous Messaging Primer](http://msdn.microsoft.com/library/dn589781.aspx) and [Idempotency Patterns](http://blog.jonathanoliver.com/2010/04/idempotency-patterns/).</span></span>

## <a name="scaling-and-performance-considerations"></a><span data-ttu-id="2e787-483">Remarques relatives à la mise à l’échelle et aux performances</span><span class="sxs-lookup"><span data-stu-id="2e787-483">Scaling and performance considerations</span></span>
<span data-ttu-id="2e787-484">Les tâches en arrière-plan doivent offrir des performances suffisantes pour éviter de bloquer l’application ou entraîner des incohérences, suite à une opération en retard lorsque le système est soumis à une charge.</span><span class="sxs-lookup"><span data-stu-id="2e787-484">Background tasks must offer sufficient performance to ensure they do not block the application, or cause inconsistencies due to delayed operation when the system is under load.</span></span> <span data-ttu-id="2e787-485">En général, vous améliorez les performances lorsque vous mettez à l’échelle les instances de calcul qui hébergent les tâches en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-485">Typically, performance is improved by scaling the compute instances that host the background tasks.</span></span> <span data-ttu-id="2e787-486">Quand vous planifiez et créez des tâches en arrière-plan, tenez compte des points suivants en matière de performances et d’extensibilité :</span><span class="sxs-lookup"><span data-stu-id="2e787-486">When you are planning and designing background tasks, consider the following points around scalability and performance:</span></span>

* <span data-ttu-id="2e787-487">Azure prend en charge la mise à l’échelle automatique (augmentation et diminution de la taille des instances) en fonction de la demande et de la charge actuelles, ou selon une planification prédéfinie, aussi bien pour Web Apps, les rôles de travail et web Cloud Services, et les déploiements hébergés par les machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="2e787-487">Azure supports autoscaling (both scaling out and scaling back in) based on current demand and load--or on a predefined schedule, for Web Apps, Cloud Services web and worker roles, and Virtual Machines hosted deployments.</span></span> <span data-ttu-id="2e787-488">Cette fonctionnalité permet de garantir que l’application dans son ensemble offre des performances acceptables, tout en réduisant les coûts d’exécution.</span><span class="sxs-lookup"><span data-stu-id="2e787-488">Use this feature to ensure that the application as a whole has sufficient performance capabilities while minimizing runtime costs.</span></span>
* <span data-ttu-id="2e787-489">Si les tâches en arrière-plan présentent des performances différentes de celles d’autres éléments de l’application Cloud Services (par exemple, l’interface utilisateur ou des composants comme la couche d’accès aux données), l’hébergement des tâches en arrière-plan dans un rôle de travail distinct permet aux rôles des tâches en arrière-plan et de l’interface utilisateur d’être mis à l’échelle de manière indépendante, afin de gérer la charge.</span><span class="sxs-lookup"><span data-stu-id="2e787-489">Where background tasks have a different performance capability from the other parts of a Cloud Services application (for example, the UI or components such as the data access layer), hosting the background tasks together in a separate worker role allows the UI and background task roles to scale independently to manage the load.</span></span> <span data-ttu-id="2e787-490">Si plusieurs tâches en arrière-plan présentent des performances très différentes, envisagez de les séparer dans des rôles de travail distincts et de mettre chaque type de rôle à l’échelle de manière indépendante.</span><span class="sxs-lookup"><span data-stu-id="2e787-490">If multiple background tasks have significantly different performance capabilities from each other, consider dividing them into separate worker roles and scaling each role type independently.</span></span> <span data-ttu-id="2e787-491">Notez toutefois que cette approche peut s’avérer plus coûteuse que la combinaison de l’ensemble des tâches dans un nombre plus réduit de rôles.</span><span class="sxs-lookup"><span data-stu-id="2e787-491">However, note that this might increase runtime costs compared to combining all the tasks into fewer roles.</span></span>
* <span data-ttu-id="2e787-492">Une simple mise à l’échelle des rôles peut être insuffisante pour empêcher une baisse des performances en cas de charge élevée.</span><span class="sxs-lookup"><span data-stu-id="2e787-492">Simply scaling the roles might not be sufficient to prevent loss of performance under load.</span></span> <span data-ttu-id="2e787-493">Vous devrez peut-être aussi mettre à l’échelle les files d’attente de stockage et d’autres ressources pour empêcher la formation d’un goulot d’étranglement au niveau d’un point donné de la chaîne de traitement.</span><span class="sxs-lookup"><span data-stu-id="2e787-493">You might also need to scale storage queues and other resources to prevent a single point of the overall processing chain from becoming a bottleneck.</span></span> <span data-ttu-id="2e787-494">Tenez également compte d’autres limitations comme le débit maximal du stockage et d’autres services sur lesquels reposent l’application et les tâches en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="2e787-494">Also, consider other limitations, such as the maximum throughput of storage and other services that the application and the background tasks rely on.</span></span>
* <span data-ttu-id="2e787-495">La conception des tâches en arrière-plan doit prévoir une mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="2e787-495">Background tasks must be designed for scaling.</span></span> <span data-ttu-id="2e787-496">Ainsi, elles doivent être en mesure de détecter, de manière dynamique, le nombre de files d’attente de stockage utilisées, afin de pouvoir écouter ou envoyer les messages à la file d’attente appropriée.</span><span class="sxs-lookup"><span data-stu-id="2e787-496">For example, they must be able to dynamically detect the number of storage queues in use in order to listen on or send messages to the appropriate queue.</span></span>
* <span data-ttu-id="2e787-497">Par défaut, les tâches web sont mises à l’échelle en fonction de l’instance d’application web Azure associée.</span><span class="sxs-lookup"><span data-stu-id="2e787-497">By default, WebJobs scale with their associated Azure Web Apps instance.</span></span> <span data-ttu-id="2e787-498">Cependant, si vous souhaitez qu’une tâche web s’exécute uniquement en tant qu’instance unique, vous pouvez créer un fichier Settings.job qui contient les données JSON **{ "is_singleton": true }**.</span><span class="sxs-lookup"><span data-stu-id="2e787-498">However, if you want a WebJob to run as only a single instance, you can create a Settings.job file that contains the JSON data **{ "is_singleton": true }**.</span></span> <span data-ttu-id="2e787-499">Cela oblige Azure à exécuter une seule instance de la tâche web, même s’il existe plusieurs instances de l’application web associée.</span><span class="sxs-lookup"><span data-stu-id="2e787-499">This forces Azure to only run one instance of the WebJob, even if there are multiple instances of the associated web app.</span></span> <span data-ttu-id="2e787-500">Cela peut être utile pour les tâches planifiées devant s’exécuter en tant qu’instances uniques.</span><span class="sxs-lookup"><span data-stu-id="2e787-500">This can be a useful technique for scheduled jobs that must run as only a single instance.</span></span>

## <a name="related-patterns"></a><span data-ttu-id="2e787-501">Modèles associés</span><span class="sxs-lookup"><span data-stu-id="2e787-501">Related patterns</span></span>
* [<span data-ttu-id="2e787-502">Primer de messagerie asynchrone</span><span class="sxs-lookup"><span data-stu-id="2e787-502">Asynchronous Messaging Primer</span></span>](http://msdn.microsoft.com/library/dn589781.aspx)
* [<span data-ttu-id="2e787-503">Recommandations en matière de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="2e787-503">Autoscaling Guidance</span></span>](http://msdn.microsoft.com/library/dn589774.aspx)
* [<span data-ttu-id="2e787-504">Modèle de transaction de compensation</span><span class="sxs-lookup"><span data-stu-id="2e787-504">Compensating Transaction Pattern</span></span>](http://msdn.microsoft.com/library/dn589804.aspx)
* [<span data-ttu-id="2e787-505">Modèle des consommateurs récurrents</span><span class="sxs-lookup"><span data-stu-id="2e787-505">Competing Consumers Pattern</span></span>](http://msdn.microsoft.com/library/dn568101.aspx)
* [<span data-ttu-id="2e787-506">Recommandations en matière de partitionnement du calcul</span><span class="sxs-lookup"><span data-stu-id="2e787-506">Compute Partitioning Guidance</span></span>](http://msdn.microsoft.com/library/dn589773.aspx)
* [<span data-ttu-id="2e787-507">Modèle de consolidation des ressources de calcul</span><span class="sxs-lookup"><span data-stu-id="2e787-507">Compute Resource Consolidation Pattern</span></span>](http://msdn.microsoft.com/library/dn589778.aspx)
* [<span data-ttu-id="2e787-508">Modèle d’opérateur de contrôle d’appels</span><span class="sxs-lookup"><span data-stu-id="2e787-508">Gatekeeper Pattern</span></span>](http://msdn.microsoft.com/library/dn589793.aspx)
* [<span data-ttu-id="2e787-509">Modèle de choix de l’instance responsable</span><span class="sxs-lookup"><span data-stu-id="2e787-509">Leader Election Pattern</span></span>](http://msdn.microsoft.com/library/dn568104.aspx)
* [<span data-ttu-id="2e787-510">Modèle des canaux et filtres</span><span class="sxs-lookup"><span data-stu-id="2e787-510">Pipes and Filters Pattern</span></span>](http://msdn.microsoft.com/library/dn568100.aspx)
* [<span data-ttu-id="2e787-511">Modèle de file d’attente prioritaire</span><span class="sxs-lookup"><span data-stu-id="2e787-511">Priority Queue Pattern</span></span>](http://msdn.microsoft.com/library/dn589794.aspx)
* [<span data-ttu-id="2e787-512">Modèle de nivellement de la charge basé sur une file d’attente</span><span class="sxs-lookup"><span data-stu-id="2e787-512">Queue-based Load Leveling Pattern</span></span>](http://msdn.microsoft.com/library/dn589783.aspx)
* [<span data-ttu-id="2e787-513">Modèle de superviseur de l’agent du planificateur</span><span class="sxs-lookup"><span data-stu-id="2e787-513">Scheduler Agent Supervisor Pattern</span></span>](http://msdn.microsoft.com/library/dn589780.aspx)

## <a name="more-information"></a><span data-ttu-id="2e787-514">Plus d’informations</span><span class="sxs-lookup"><span data-stu-id="2e787-514">More information</span></span>
* [<span data-ttu-id="2e787-515">Mise à l’échelle d’applications Azure avec des rôles de travail</span><span class="sxs-lookup"><span data-stu-id="2e787-515">Scaling Azure Applications with Worker Roles</span></span>](http://msdn.microsoft.com/library/hh534484.aspx#sec8)
* [<span data-ttu-id="2e787-516">Exécution de tâches en arrière-plan</span><span class="sxs-lookup"><span data-stu-id="2e787-516">Executing Background Tasks</span></span>](http://msdn.microsoft.com/library/ff803365.aspx)
* <span data-ttu-id="2e787-517">[Azure Role Startup Life Cycle](http://blog.syntaxc4.net/post/2011/04/13/windows-azure-role-startup-life-cycle.aspx) (billet de blog)</span><span class="sxs-lookup"><span data-stu-id="2e787-517">[Azure Role Startup Life Cycle](http://blog.syntaxc4.net/post/2011/04/13/windows-azure-role-startup-life-cycle.aspx) (blog post)</span></span>
* <span data-ttu-id="2e787-518">[Azure Cloud Services Role Lifecycle](http://channel9.msdn.com/Series/Windows-Azure-Cloud-Services-Tutorials/Windows-Azure-Cloud-Services-Role-Lifecycle) (vidéo)</span><span class="sxs-lookup"><span data-stu-id="2e787-518">[Azure Cloud Services Role Lifecycle](http://channel9.msdn.com/Series/Windows-Azure-Cloud-Services-Tutorials/Windows-Azure-Cloud-Services-Role-Lifecycle) (video)</span></span>
* [<span data-ttu-id="2e787-519">Présentation du Kit de développement logiciel (SDK) Azure WebJobs</span><span class="sxs-lookup"><span data-stu-id="2e787-519">What is the Azure WebJobs SDK</span></span>](https://docs.microsoft.com/azure/app-service-web/websites-dotnet-webjobs-sdk)
* [<span data-ttu-id="2e787-520">Exécuter des tâches en arrière-plan avec WebJobs</span><span class="sxs-lookup"><span data-stu-id="2e787-520">Run Background tasks with WebJobs</span></span>](https://docs.microsoft.com/azure/app-service-web/web-sites-create-web-jobs)
* [<span data-ttu-id="2e787-521">Files d’attente Azure et files d’attente Service Bus - comparaison et différences</span><span class="sxs-lookup"><span data-stu-id="2e787-521">Azure Queues and Service Bus Queues - Compared and Contrasted</span></span>](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted)
* [<span data-ttu-id="2e787-522">Activation des diagnostics dans un service cloud</span><span class="sxs-lookup"><span data-stu-id="2e787-522">How to Enable Diagnostics in a Cloud Service</span></span>](https://docs.microsoft.com/azure/cloud-services/cloud-services-dotnet-diagnostics)

