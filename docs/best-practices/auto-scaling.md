---
title: "Recommandations en matière de mise à l’échelle automatique"
description: "Recommandations sur le processus de mise à l’échelle automatique nécessaire pour l’allocation dynamique des ressources requises par une application."
author: dragon119
ms.date: 05/17/2017
pnp.series.title: Best Practices
ms.openlocfilehash: a8489aaabab2b8523fbc9f026f4f435bb6d1ad29
ms.sourcegitcommit: 3d9ee03e2dda23753661a80c7106d1789f5223bb
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/23/2018
---
# <a name="autoscaling"></a>Mise à l’échelle automatique
[!INCLUDE [header](../_includes/header.md)]

La mise à l’échelle automatique désigne le processus d’allocation dynamique de ressources destiné à répondre aux besoins en matière de performances. À mesure que le volume de travail augmente, une application peut nécessiter des ressources supplémentaires afin de garantir les niveaux de performances souhaités et de respecter les contrats de niveau de service (SLA). Lorsque la demande diminue et que les ressources supplémentaires ne sont plus requises, il est possible de libérer ces dernières pour minimiser les coûts.

La mise à l’échelle automatique tire parti de l’élasticité des environnements hébergés dans le cloud tout en allégeant les contraintes de gestion. Elle réduit la nécessité de recourir à un opérateur dédié à la surveillance continue des performances d’un système, ainsi qu’à l’ajout et au retrait des ressources.

La mise à l’échelle d’une application peut s’effectuer de deux manières : 

* La **mise à l’échelle verticale**, également appelée montée ou descente en puissance, consiste à modifier la capacité d’une ressource. Par exemple, vous pouvez déplacer une application vers une machine virtuelle de taille supérieure. La mise à l’échelle verticale implique fréquemment l’inaccessibilité momentanée du système lors de son redéploiement. Il est donc plus inhabituel d’automatiser la mise à l’échelle verticale.
* La **mise à l’échelle horizontale**, également appelée augmentation ou diminution de la taille des instances, consiste à ajouter ou supprimer des instances d’une ressource. Pendant que de nouvelles ressources sont approvisionnées, l’application continue à s’exécuter sans interruption. Une fois le processus d’approvisionnement terminé, la solution est déployée sur ces ressources supplémentaires. Si la demande diminue, les ressources supplémentaires peuvent être correctement arrêtées et libérées. 

De nombreux systèmes basés sur le cloud, notamment Microsoft Azure, prennent en charge la mise à l’échelle horizontale automatique. Le reste de cet article se concentre sur la mise à l’échelle horizontale.

> [!NOTE]
> La mise à l’échelle automatique s’applique principalement aux ressources de calcul. Bien qu’il soit possible de procéder à la mise à l’échelle horizontale d’une base de données ou d’une file d’attente de messages, cette opération implique habituellement un [partitionnement des données][data-partitioning], lequel n’est généralement pas automatisé.
>

## <a name="overview"></a>Vue d'ensemble

Une stratégie de mise à l’échelle automatique implique les éléments suivants :

* Systèmes de surveillance et d’instrumentation au niveau de l’application, des services et de l’infrastructure. Ces systèmes capturent des mesures clés, telles que le temps de réponse, les longueurs des files d’attente, l’utilisation du processeur et l’utilisation de la mémoire.
* Logique de prise de décision qui évalue ces métriques par rapport aux planifications ou aux seuils prédéfinis et détermine si une mise à l’échelle est ou non nécessaire.
* Composants procédant à la mise à l’échelle du système.
* le test, la surveillance et le réglage de la stratégie de mise à l’échelle automatique, afin de garantir son bon fonctionnement.

Azure intègre des mécanismes de mise à l’échelle automatique qui sont adaptés aux scénarios courants. Si un service ou une technologie spécifiques n’intègrent pas de fonctionnalités de mise à l’échelle automatique, ou que certaines de vos exigences de mise à l’échelle dépassent leurs capacités, vous pouvez envisager une implémentation personnalisée. Une implémentation personnalisée peut collecter des métriques opérationnelles et système, analyser ces métriques, puis mettre à l’échelle les ressources en conséquence.

## <a name="configure-autoscaling-for-an-azure-solution"></a>Configurer la mise à l’échelle automatique pour une solution Azure

Azure intègre une mise à l’échelle automatique pour la plupart des options de calcul.

* L’offre **Machines virtuelles** prend en charge la mise à l’échelle automatique par l’intermédiaire de la ressource [VM Scale Sets][vm-scale-sets], qui permet de gérer un ensemble de machines virtuelles Azure en tant que groupe. Consultez l’article [Mise à l’échelle automatique et groupes identiques de machines virtuelles][vm-scale-sets-autoscale].

* La plateforme **Service Fabric** prend également en charge la mise à l’échelle automatique par l’intermédiaire de VM Scale Sets. Chaque type de nœud d’un cluster Service Fabric est configuré sous la forme d’un groupe de machines virtuelles identiques. Ceci permet de diminuer ou d’augmenter la taille des instances de chaque type de nœud indépendamment. Consultez l’article [Augmenter ou diminuer la taille des instances d’un cluster Service Fabric à l’aide de règles de mise à l’échelle automatique][service-fabric-autoscale].

* L’offre **Azure App Service** intègre une mise à l’échelle automatique. Les paramètres de mise à l’échelle automatique s’appliquent à toutes les applications d’un service App Service. Consultez l’article [Mise à l’échelle manuelle ou automatique du nombre d’instances][app-service-autoscale].

* L’offre **Azure Cloud Services** intègre une mise à l’échelle automatique au niveau du rôle. Consultez l’article [Configuration de la mise à l’échelle automatique d’un service cloud dans le portail][cloud-services-autoscale].

Ces options de calcul utilisent toutes la [mise à l’échelle automatique Azure Monitor][monitoring] afin de fournir un ensemble commun de fonctionnalités de mise à l’échelle automatique.

* La solution **Azure Functions** diffère des options de calcul précédentes, car elle ne nécessite pas la configuration de règles de mise à l’échelle automatique. À la place, Azure Functions alloue automatiquement une puissance de calcul lorsque votre code s’exécute, et augmente la taille des instances selon les besoins pour gérer la charge. Pour plus d’informations, consultez l’article [Choisir le plan d’hébergement approprié pour Azure Functions][functions-scale].

Enfin, une solution de mise à l’échelle automatique personnalisée peut parfois se révéler utile. Par exemple, vous pouvez utiliser les diagnostics et les métriques Azure basées sur l’application, ainsi qu’un code personnalisé pour surveiller et exporter les métriques d’application. Vous pouvez ensuite définir des règles personnalisées reposant sur ces métriques, et utiliser les API REST Resource Manager pour déclencher la mise à l’échelle automatique. Toutefois, une solution personnalisée n’est pas simple à implémenter et doit être envisagée uniquement si aucune des approches précédentes ne peut répondre à vos exigences.

Utilisez les fonctionnalités de mise à l’échelle automatique intégrées de la plateforme, si elles répondent à vos exigences. Sinon, étudiez soigneusement l’opportunité de recourir à des fonctionnalités de mise à l’échelle plus complexes. Une granularité de contrôle supérieure, différents moyens de détection des événements déclencheurs de la mise à l’échelle automatique, la mise à l’échelle entre les abonnements et la mise à l’échelle d’autres types de ressources constituent quelques exemples d’exigences supplémentaires.

## <a name="use-azure-monitor-autoscale"></a>Utiliser la mise à l’échelle Azure Monitor

La [mise à l’échelle Azure Monitor][monitoring] offre un ensemble commun de fonctionnalités de mise à l’échelle automatique pour VM Scale Sets, Azure App Service et Azure Cloud Service. La mise à l’échelle peut être planifiée ou basée sur une métrique collectée au moment de l’exécution, telle que l’utilisation de l’UC ou de la mémoire. Exemples :

- Élevez le nombre d’instances à 10 pendant les jours ouvrables, et abaissez ce nombre à 4 pour les samedis et dimanches. 
- Ajoutez une instance supplémentaire si l’utilisation moyenne de l’UC dépasse 70 %, et retirez une instance si l’utilisation de l’UC tombe en deçà de 50 %.
- Ajoutez une instance si le nombre de messages d’une file d’attente excède un certain seuil.

Pour obtenir la liste des métriques intégrées, consultez l’article [Métriques courantes pour la mise à l’échelle automatique d’Azure Monitor][autoscale-metrics]. Vous pouvez également implémenter des métriques personnalisées à l’aide d’Application Insights. 

Vous pouvez configurer la mise à l’échelle automatique à l’aide de PowerShell, de l’interface de ligne de commande Azure, d’un modèle Azure Resource Manager ou du portail Azure. Pour bénéficier d’un contrôle plus précis, utilisez [l’API REST Azure Resource Manager](https://msdn.microsoft.com//library/azure/dn790568.aspx). Les bibliothèques [Azure Monitoring Service Management Library](http://www.nuget.org/packages/Microsoft.WindowsAzure.Management.Monitoring) et [Microsoft Insights Library](https://www.nuget.org/packages/Microsoft.Azure.Insights/) (en version préliminaire) sont des Kits de développement logiciel qui permettent de recueillir des mesures à partir de différentes ressources et d’effectuer une mise à l’échelle automatique avec les API REST. Pour les ressources où la prise en charge d’Azure Resource Manager n’est pas disponible, ou si vous utilisez Azure Cloud Services, vous pouvez utiliser l’API REST Azure Service Management pour la mise à l’échelle automatique. Dans tous les autres cas, utilisez Azure Resource Manager.

Lorsque vous utilisez la mise à l’échelle automatique Azure, tenez compte des points suivants :

* Évaluez si vous pouvez anticiper la charge sur l’application de façon suffisamment précise pour utiliser la mise à l’échelle automatique planifiée en ajoutant et retirant des instances afin de répondre aux pics de demande anticipés. Si ce n’est pas possible, utilisez la mise à l’échelle automatique réactive basée sur les métriques collectées au moment de l’exécution afin de gérer les changements de demande imprévus. En règle générale, vous pouvez combiner ces approches. Par exemple, élaborez une stratégie qui ajoute des ressources en fonction d’un calendrier répertoriant les périodes de pic d’activité de l’application. Cela permet de garantir la disponibilité de la capacité au moment voulu, sans le délai associé au démarrage des nouvelles instances. Pour chaque règle planifiée, définissez des métriques qui prennent en charge la mise à l’échelle automatique réactive durant cette période afin de garantir que l’application peut gérer les pics de demande soutenus mais imprévus.
* Il est souvent difficile d’appréhender la relation entre les mesures et les exigences de capacité, en particulier lors du déploiement initial d’une application. Approvisionnez dès le début une capacité légèrement supplémentaire, puis surveillez et adaptez les règles de mise à l’échelle automatique afin de faire correspondre la capacité avec la charge réelle.
* Configurez les règles de mise à l’échelle automatique, puis surveillez les performances de votre application au fil du temps. Utilisez les résultats de cette surveillance pour définir le mode de mise à l’échelle du système, si nécessaire. Toutefois, gardez à l’esprit que la mise à l’échelle n’est pas un processus instantané. La réaction à une mesure telle que le dépassement du seuil d’utilisation moyenne du processeur prend du temps.
* Les règles de mise à l’échelle automatique qui utilisent un mécanisme de détection basé sur un attribut de déclenchement mesuré (par exemple utilisation du processeur ou longueur de file d’attente) utilisent une valeur agrégée au fil du temps, et non des valeurs instantanées, pour déclencher une action de mise à l’échelle automatique. Par défaut, cette valeur agrégée correspond à une moyenne de valeurs. Cette configuration empêche toute réaction prématurée du système, et prévient toute oscillation rapide. Elle laisse également le temps aux nouvelles instances démarrées automatiquement d’adopter le mode d’exécution, empêchant l’application des actions supplémentaires de mise à l’échelle automatique durant le démarrage des nouvelles instances. Pour Azure Cloud Services et Azure Virtual Machines, la période par défaut associée à l’agrégation est de 45 minutes. Dès lors, il vous faudra éventuellement attendre ce délai pour constater le déclenchement, par la mesure, de la mise à l’échelle automatique en réponse aux pics de demande. Vous pouvez modifier la période d’agrégation à l’aide du kit de développement logiciel (SDK), mais n’oubliez pas que les périodes inférieures à 25 minutes peuvent entraîner des résultats imprévisibles (pour plus d’informations, consultez la rubrique [Mise à l’échelle automatique de Cloud Services en fonction du pourcentage UC à l’aide de la bibliothèque de gestion Microsoft Azure Monitoring Services](http://rickrainey.com/2013/12/15/auto-scaling-cloud-services-on-cpu-percentage-with-the-windows-azure-monitoring-services-management-library/)). Pour Web Apps, la période moyenne est beaucoup plus courte. Les nouvelles instances sont disponibles environ cinq minutes après une modification de la mesure de déclenchement.
* Si vous configurez la mise à l’échelle automatique à l’aide du Kit de développement logiciel (SDK) plutôt que par l’intermédiaire du portail, vous pouvez spécifier une planification plus détaillée de la période d’activité des règles. Vous pouvez également créer vos propres mesures et les utiliser avec ou sans les éléments existants dans vos règles de mise à l’échelle automatique. Par exemple, vous pouvez opter pour l’utilisation de compteurs alternatifs, comme le nombre de requêtes par seconde ou la disponibilité moyenne de la mémoire, ou de compteurs personnalisés dédiés à des processus d’entreprise spécifiques.
* Lors de la mise à l’échelle automatique de Service Fabric, les types de nœuds de votre cluster sont constitués de groupes de machines virtuelles identiques sur le serveur principal ; vous devez donc configurer des règles de mise à l’échelle automatique pour chaque type de nœud. Tenez compte du nombre de nœuds dont vous devez disposer avant de configurer la mise à l’échelle automatique. Le nombre de nœuds minimal dont vous devez disposer pour le type de nœud principal est déterminé par le niveau de fiabilité que vous avez choisi. Pour plus d’informations, consultez l’article [Augmenter ou diminuer la taille des instances d’un cluster Service Fabric à l’aide de règles de mise à l’échelle automatique](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-scale-up-down).
* Vous pouvez utiliser le portail pour lier des ressources telles que des files d’attente et des instances SQL Database à une instance de service cloud. Cela vous permet d’accéder plus facilement aux options de configuration de mise à l’échelle automatiques et manuelles de chacune des ressources liées. Pour plus d’informations, consultez la section [Liaison d’une ressource à un service cloud](/azure/cloud-services/cloud-services-how-to-manage).
* Quand vous configurez plusieurs stratégies et règles, elles peuvent entrer en conflit les unes avec les autres. La mise à l’échelle automatique utilise les règles de résolution de conflits suivantes pour s’assurer qu’un nombre suffisant d’instances est toujours en cours d’exécution :
  * Les opérations de montée en puissance priment toujours sur les opérations inverses.
  * Lorsqu’un conflit entre opérations fait l’objet d’une montée en puissance, la règle à l’origine de l’augmentation la plus importante du nombre d’instances prime.
  * Lorsqu’un conflit entre opérations fait l’objet d’une baisse en puissance, la règle à l’origine de la diminution la plus faible du nombre d’instances prime.
* Dans un environnement App Service, vous pouvez utiliser toutes les métriques de pool de Workers ou de serveur frontal pour définir des règles de mise à l’échelle automatique. Pour plus d’informations, consultez l’article [Mise à l’échelle automatique et environnement App Service](/azure/app-service/app-service-environment-auto-scale).

## <a name="application-design-considerations"></a>Considérations relatives à la conception d’applications
La mise à l’échelle automatique ne constitue pas une solution instantanée. Le simple ajout de ressources à un système ou l’exécution d’un nombre plus important d’instances de processus ne vous garantit pas l’amélioration des performances du système. Lors de l’élaboration d’une stratégie de mise à l’échelle automatique, tenez compte des points suivants :

* Le système peut être mis à l’échelle horizontalement. Évitez de formuler des hypothèses relatives à l’affinité des instances ; ne concevez pas de solutions qui nécessitent l’exécution permanente du code dans une instance spécifique de processus. Lors de la mise à l’échelle horizontale d’un service cloud ou d’un site web, ne partez pas du principe que l’ensemble des requêtes d’une même source seront dirigées vers la même instance. Pour la même raison, concevez les services sans état, afin d’éviter que l’ensemble des requêtes d’une application soient dirigées vers la même instance d’un service. Quand vous concevez un service qui lit les messages d’une file d’attente avant de les traiter, n’anticipez pas l’identité de l’instance du service qui traite un message spécifique. La mise à l’échelle automatique peut démarrer des instances supplémentaires d’un service à mesure que la taille de la file d’attente augmente. L’article [Modèle des consommateurs concurrents][competing-consumers] explique comment gérer ce scénario.
* Si la solution implémente une longue tâche, configurez-la pour qu’elle prenne en charge à la fois l’augmentation et la réduction. Sans la prudence requise, une tâche de ce type pourrait empêcher la fermeture appropriée d’une instance de processus lors d’une mise à l’échelle horizontale du système, ou l’instance pourrait perdre des données en cas d’arrêt forcé du processus. Dans l’idéal, refactorisez une tâche longue et divisez le traitement exécuté en bloc plus petits, discrets. L’article [Modèle des canaux et filtres][pipes-and-filters] fournit un exemple de la procédure à suivre.
* Sinon, vous pouvez implémenter un mécanisme de point de contrôle qui enregistre les informations d’état de la tâche à des intervalles réguliers et enregistre cet état dans un espace de stockage durable accessible par l’ensemble des instances du processus exécutant la tâche. De cette manière, si le processus est arrêté, la tâche qu’il exécutait peut être poursuivie à partir du dernier point de contrôle à l’aide d’une instance différente.
* Quand les tâches d’arrière-plan s’exécutent sur des instances de calcul séparées, telles que les rôles de travail d’une application hébergée par des services cloud, vous devrez peut-être appliquer des stratégies distinctes de mise à l’échelle à différentes parties de l’application. Par exemple, vous devrez peut-être déployer des instances de calcul supplémentaires d’interface utilisateur sans augmenter le nombre d’instances de calcul d’arrière-plan, ou inversement. Si vous proposez différents niveaux de services (comme des packages de services de base ou de niveau Premium), il vous faudra éventuellement faire monter en puissance les ressources de calcul associées aux packages de services Premium de manière plus importante que celles dédiées aux packages de services de base afin de répondre aux exigences des contrats de niveau de service.
* Vous pouvez utiliser la longueur de la file d’attente sur laquelle communiquent les instances de calcul d’arrière-plan et d’interface utilisateur en tant que critère de votre stratégie de mise à l’échelle automatique. Cette valeur est le meilleur indicateur de déséquilibre ou d’écart entre la charge actuelle et la capacité de traitement de la tâche d’arrière-plan.
* Si vous basez votre stratégie de mise à l’échelle automatique sur des compteurs de processus d’entreprise, tels que le nombre de commandes transmises par heure ou la durée d’exécution moyenne d’une transaction complexe, veillez à comprendre parfaitement la relation entre les résultats issus de ces types de compteurs et les exigences réelles en matière de capacité de calcul. Il peut être nécessaire de mettre à l’échelle plusieurs composants ou unités de calcul afin de vous adapter aux modifications transmises par les compteurs d’entreprise.  
* Pour empêcher un système de procéder à une montée en puissance excessive et éviter les coûts associés à l’exécution de plusieurs milliers d’instances, envisagez de limiter le nombre d’instances pouvant être automatiquement ajoutées. La plupart des mécanismes de mise à l’échelle automatique prennent en charge la définition des nombres minimal et maximal d’instances associées à une règle. De plus, vous pouvez dégrader de manière appropriée la fonctionnalité fournie par le système si le nombre maximal d’instances a été déployé et que le système est toujours surchargé.
* N’oubliez pas que la mise à l’échelle automatique n’est pas forcément le mécanisme le mieux adapté à la gestion d’un pic imprévu de charge de travail. L’approvisionnement et le démarrage des nouvelles instances d’un service et l’ajout des ressources à un système étant des opérations qui demandent du temps, il se peut que le pic de demandes soit passé quand les nouveaux éléments sont disponibles. Dans ce scénario, il peut être préférable de limiter le service. Pour plus d’informations, consultez l’article [Modèle de limitation][throttling].
* À l’inverse, si vous avez besoin que la capacité disponible traite l’ensemble des requêtes lors des fluctuations brutales du volume et que la contrainte financière n’est pas un obstacle majeur, vous pouvez appliquer une stratégie poussée de mise à l’échelle automatique qui démarre plus rapidement les instances supplémentaires. Vous pouvez également utiliser une stratégie planifiée qui démarre un nombre suffisant d’instances pour satisfaire de manière anticipée la charge maximale.
* Le mécanisme de mise à l’échelle automatique doit surveiller le processus et consigner les détails de chacun des événements de mise à l’échelle automatique (éléments déclencheurs, ressources ajoutées ou retirées, et à quel moment). Si vous créez un mécanisme personnalisé de mise à l’échelle automatique, veillez à intégrer cette fonctionnalité. Analysez les informations pour aider à mesurer l’efficacité de la stratégie de mise à l’échelle automatique et ajustez-la si nécessaire. Vous pouvez effectuer un réglage à la fois à court terme, à mesure que les modèles d’utilisation deviennent plus évidents, et à long terme, à mesure que l’entreprise se développe ou que les exigences de l’application évoluent. Si une application atteint la limite supérieure définie pour la mise à l’échelle automatique, le mécanisme peut alerter un opérateur susceptible de démarrer manuellement des ressources supplémentaires si nécessaire. Si cette situation se présente, l’opérateur est également chargé de retirer ces ressources une fois que la charge est revenue à la normale.

## <a name="related-patterns-and-guidance"></a>Conseils et modèles connexes
Les modèles et les conseils suivants peuvent également être pertinents lors de l’implémentation de la mise à l’échelle automatique :

* [Modèle de limitation][throttling]. Ce modèle décrit comment une application peut continuer à fonctionner et à satisfaire aux contrats de niveau de service quand une augmentation de la demande place une charge conséquente sur les ressources. Vous pouvez associer un modèle de limitation à la mise à l’échelle automatique afin d’éviter de surcharger un système soumis à une opération d’évolutivité horizontale.
* [Modèle des consommateurs concurrents][competing-consumers]. Ce modèle explique comment implémenter un pool d’instances de services pouvant traiter les messages d’une instance d’application. La mise à l’échelle automatique sert éventuellement à démarrer et arrêter les instances de services afin de satisfaire les charges de travail anticipées. Grâce à cette approche, un système peut traiter simultanément plusieurs messages afin d’optimiser le débit, améliorer l’évolutivité et la disponibilité, et équilibrer la charge de travail.
* [Surveillance et diagnostics](./monitoring.md). L’instrumentation et la télémétrie sont essentielles pour collecter les informations pouvant être utilisées dans le cadre du processus de mise à l’échelle automatique.


<!-- links -->

[monitoring]: /azure/monitoring-and-diagnostics/monitoring-overview-autoscale
[app-service-autoscale]: /azure/monitoring-and-diagnostics/insights-how-to-scale?toc=%2fazure%2fapp-service-web%2ftoc.json#scaling-based-on-a-pre-set-metric
[app-service-plan]: /azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview
[autoscale-metrics]: /azure/monitoring-and-diagnostics/insights-autoscale-common-metrics
[cloud-services-autoscale]: /azure/cloud-services/cloud-services-how-to-scale-portal
[competing-consumers]: ../patterns/competing-consumers.md
[data-partitioning]: ./data-partitioning.md
[functions-scale]: /azure/azure-functions/functions-scale
[link-resource-to-cloud-service]: /azure/cloud-services/cloud-services-how-to-manage#how-to-link-a-resource-to-a-cloud-service
[pipes-and-filters]: ../patterns/pipes-and-filters.md
[service-fabric-autoscale]: /azure/service-fabric/service-fabric-cluster-scale-up-down
[throttling]: ../patterns/throttling.md
[vm-scale-sets]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
[vm-scale-sets-autoscale]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview
