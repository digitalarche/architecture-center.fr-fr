---
title: Intégration et livraison continues pour les microservices
description: Intégration continue et livraison continue pour les microservices.
author: MikeWasson
ms.date: 03/27/2019
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: microservices
ms.openlocfilehash: c52ff3d0a330f564e5f7e9b0b07f0ba84c328c8b
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/17/2019
ms.locfileid: "59639781"
---
# <a name="cicd-for-microservices-architectures"></a><span data-ttu-id="3fcf0-103">CI/CD pour les architectures de microservices</span><span class="sxs-lookup"><span data-stu-id="3fcf0-103">CI/CD for microservices architectures</span></span>

<span data-ttu-id="3fcf0-104">Les cycles de mise en production plus rapides sont un des principaux avantages des architectures de microservices.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-104">Faster release cycles are one of the major advantages of microservices architectures.</span></span> <span data-ttu-id="3fcf0-105">Mais sans un bon processus CI/CD, vous n’atteindrez pas l’agilité qui promettent de microservices.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-105">But without a good CI/CD process, you won't achieve the agility that microservices promise.</span></span> <span data-ttu-id="3fcf0-106">Cet article décrit ces obstacles et recommande certaines stratégies pour le problème.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-106">This article describes the challenges and recommends some approaches to the problem.</span></span>

## <a name="what-is-cicd"></a><span data-ttu-id="3fcf0-107">Qu’est CI/CD ?</span><span class="sxs-lookup"><span data-stu-id="3fcf0-107">What is CI/CD?</span></span>

<span data-ttu-id="3fcf0-108">Lorsque nous parlons de CI/CD, nous parlons vraiment plusieurs processus associés : intégration continue, livraison continue et déploiement continu.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-108">When we talk about CI/CD, we're really talking about several related processes: Continuous integration, continuous delivery, and continuous deployment.</span></span>

- <span data-ttu-id="3fcf0-109">**Intégration continue**.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-109">**Continuous integration**.</span></span> <span data-ttu-id="3fcf0-110">Modifications du code sont fréquemment fusionnées dans la branche principale.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-110">Code changes are frequently merged into the main branch.</span></span> <span data-ttu-id="3fcf0-111">Automatisée de build et le processus de test vous assurer que le code dans la branche principale est toujours de qualité production.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-111">Automated build and test processes ensure that code in the main branch is always production-quality.</span></span>

- <span data-ttu-id="3fcf0-112">**Livraison continue**.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-112">**Continuous delivery**.</span></span> <span data-ttu-id="3fcf0-113">Modification du code qui passent le processus d’intégration continue est automatiquement publiées dans un environnement de type production.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-113">Any code changes that pass the CI process are automatically published to a production-like environment.</span></span> <span data-ttu-id="3fcf0-114">Si le déploiement au sein de l’environnement de production réelle peut nécessiter une approbation manuelle, il est automatisé.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-114">Deployment into the live production environment may require manual approval, but is otherwise automated.</span></span> <span data-ttu-id="3fcf0-115">L’objectif est de toujours disposer d’un code *prêt* à être déployé en production.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-115">The goal is that your code should always be *ready* to deploy into production.</span></span>

- <span data-ttu-id="3fcf0-116">**Déploiement continu**.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-116">**Continuous deployment**.</span></span> <span data-ttu-id="3fcf0-117">Modifications du code qui passent les deux étapes précédentes sont déployés automatiquement *en production*.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-117">Code changes that pass the previous two steps are automatically deployed *into production*.</span></span>

<span data-ttu-id="3fcf0-118">Voici certains objectifs d’un processus CI/CD robuste pour une architecture de microservices :</span><span class="sxs-lookup"><span data-stu-id="3fcf0-118">Here are some goals of a robust CI/CD process for a microservices architecture:</span></span>

- <span data-ttu-id="3fcf0-119">Chaque équipe peut générer et déployer ses propres services de manière indépendante, sans affecter ou interrompre d’autres équipes.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-119">Each team can build and deploy the services that it owns independently, without affecting or disrupting other teams.</span></span>

- <span data-ttu-id="3fcf0-120">Avant d’être déployée en production, une nouvelle version d’un service est déployée sur les environnements de développement/test/assurance qualité à des fins de validation.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-120">Before a new version of a service is deployed to production, it gets deployed to dev/test/QA environments for validation.</span></span> <span data-ttu-id="3fcf0-121">Des critères de qualité sont appliqués à chaque étape.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-121">Quality gates are enforced at each stage.</span></span>

- <span data-ttu-id="3fcf0-122">Une nouvelle version d’un service peut être déployée côte à côte avec la version précédente.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-122">A new version of a service can be deployed side by side with the previous version.</span></span>

- <span data-ttu-id="3fcf0-123">Des stratégies de contrôle d’accès suffisantes sont en place.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-123">Sufficient access control policies are in place.</span></span>

- <span data-ttu-id="3fcf0-124">Pour les charges de travail, vous pouvez approuver les images de conteneur qui sont déployés en production.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-124">For containerized workloads, you can trust the container images that are deployed to production.</span></span>

## <a name="why-a-robust-cicd-pipeline-matters"></a><span data-ttu-id="3fcf0-125">Importance d’un pipeline CI/CD robust</span><span class="sxs-lookup"><span data-stu-id="3fcf0-125">Why a robust CI/CD pipeline matters</span></span>

<span data-ttu-id="3fcf0-126">Dans une application monolithique traditionnelle, il existe un pipeline de build unique dont la sortie est l’exécutable de l’application.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-126">In a traditional monolithic application, there is a single build pipeline whose output is the application executable.</span></span> <span data-ttu-id="3fcf0-127">L’ensemble des tâches de développement alimentent ce pipeline.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-127">All development work feeds into this pipeline.</span></span> <span data-ttu-id="3fcf0-128">Si un bogue de priorité élevée est identifié, un correctif doit être intégré, testé puis publié, ce qui peut retarder la sortie des nouvelles fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-128">If a high-priority bug is found, a fix must be integrated, tested, and published, which can delay the release of new features.</span></span> <span data-ttu-id="3fcf0-129">Vous pouvez atténuer ces problèmes en ayant des modules bien factorisées et à l’aide des branches de fonctionnalité pour minimiser l’impact des modifications du code.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-129">You can mitigate these problems by having well-factored modules and using feature branches to minimize the impact of code changes.</span></span> <span data-ttu-id="3fcf0-130">Toutefois, à mesure que l’application devient plus complexe, en parallèle de l’ajout des fonctionnalités, le processus de publication d’un monolithe a tendance à se fragiliser et présente des risques de rupture.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-130">But as the application grows more complex, and more features are added, the release process for a monolith tends to become more brittle and likely to break.</span></span>

<span data-ttu-id="3fcf0-131">Si une approche de microservices est suivie, vous ne déplorez jamais une longue chaîne de publication au sein de laquelle les équipes interviennent tour à tour.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-131">Following the microservices philosophy, there should never be a long release train where every team has to get in line.</span></span> <span data-ttu-id="3fcf0-132">L’équipe qui développe le service « A » peut publier une mise à jour à tout moment, sans attendre que les modifications de l’équipe du service « B » soient fusionnées, testées et déployées.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-132">The team that builds service "A" can release an update at any time, without waiting for changes in service "B" to be merged, tested, and deployed.</span></span>

![Diagramme d’un monolithe CI/CD](./images/cicd-monolith.png)

<span data-ttu-id="3fcf0-134">Pour obtenir une grande rapidité de diffusion, votre pipeline de versions doit être automatisé et hautement fiable, afin de minimiser les risques.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-134">To achieve a high release velocity, your release pipeline must be automated and highly reliable, to minimize risk.</span></span> <span data-ttu-id="3fcf0-135">Si vous libérez en production tous les jours ou plusieurs fois par jour, les régressions ou les interruptions de service doivent être très rares.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-135">If you release to production daily or multiple times a day, regressions or service disruptions must be very rare.</span></span> <span data-ttu-id="3fcf0-136">En même temps, en cas de déploiement d’une mauvaise mise à jour, vous devez disposer d’un moyen fiable pour revenir vers une version antérieure du service.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-136">At the same time, if a bad update does get deployed, you must have a reliable way to quickly roll back or roll forward to a previous version of a service.</span></span>

## <a name="challenges"></a><span data-ttu-id="3fcf0-137">Défis</span><span class="sxs-lookup"><span data-stu-id="3fcf0-137">Challenges</span></span>

- <span data-ttu-id="3fcf0-138">**De nombreuses bases de code indépendantes et réduites**.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-138">**Many small independent code bases**.</span></span> <span data-ttu-id="3fcf0-139">Chaque équipe est responsable de la création de son propre service, associé à un pipeline de génération spécifique.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-139">Each team is responsible for building its own service, with its own build pipeline.</span></span> <span data-ttu-id="3fcf0-140">Dans certaines organisations, les équipes peuvent utiliser des référentiels de code séparés.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-140">In some organizations, teams may use separate code repositories.</span></span> <span data-ttu-id="3fcf0-141">Dépôts distincts peuvent entraîner une situation où la base de connaissances de la génération du système est réparti entre les équipes et quiconque au sein de l’organisation sait comment déployer l’application entière.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-141">Separate repositories can lead to a situation where the knowledge of how to build the system is spread across teams, and nobody in the organization knows how to deploy the entire application.</span></span> <span data-ttu-id="3fcf0-142">Par exemple, que se passe-t-il en cas de récupération d’urgence, si vous devez déployer rapidement vers un nouveau cluster ?</span><span class="sxs-lookup"><span data-stu-id="3fcf0-142">For example, what happens in a disaster recovery scenario, if you need to quickly deploy to a new cluster?</span></span>

    <span data-ttu-id="3fcf0-143">**Atténuation** : Disposez d’un pipeline unifié et automatisé pour générer et déployer des services, afin que cette base de connaissances n’est pas « masqué » au sein de chaque équipe.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-143">**Mitigation**: Have a unified and automated pipeline to build and deploy services, so that this knowledge is not "hidden" within each team.</span></span>

- <span data-ttu-id="3fcf0-144">**Langues et infrastructures multiples**.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-144">**Multiple languages and frameworks**.</span></span> <span data-ttu-id="3fcf0-145">Si chaque équipe utilise sa propre combinaison de technologies, il peut s’avérer difficile de créer un processus de génération unique fonctionnant dans tous les services de l’organisation.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-145">With each team using its own mix of technologies, it can be difficult to create a single build process that works across the organization.</span></span> <span data-ttu-id="3fcf0-146">Le processus de génération doit être suffisamment souple pour que chaque équipe puisse opter pour la langue ou l’infrastructure de son choix.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-146">The build process must be flexible enough that every team can adapt it for their choice of language or framework.</span></span>

    <span data-ttu-id="3fcf0-147">**Atténuation** : Mettre en conteneur le processus de génération pour chaque service.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-147">**Mitigation**: Containerize the build process for each service.</span></span> <span data-ttu-id="3fcf0-148">De cette façon, le système de génération uniquement doit être en mesure d’exécuter les conteneurs.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-148">That way, the build system just needs to be able to run the containers.</span></span>

- <span data-ttu-id="3fcf0-149">**Intégration et test de charge**.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-149">**Integration and load testing**.</span></span> <span data-ttu-id="3fcf0-150">Chaque équipe publiant les mises à jour à son propre rythme, la mise en œuvre d’une approche de test robuste de bout en bout peut présenter des difficultés, plus particulièrement quand des interdépendances entre services sont identifiées.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-150">With teams releasing updates at their own pace, it can be challenging to design robust end-to-end testing, especially when services have dependencies on other services.</span></span> <span data-ttu-id="3fcf0-151">En outre, un cluster de production complet en cours d’exécution peut être coûteuse, il est peu probable que chaque équipe s’exécutera son propre cluster complet à des échelles de production, juste pour le test.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-151">Moreover, running a full production cluster can be expensive, so it's unlikely that every team will run its own full cluster at production scales, just for testing.</span></span>

- <span data-ttu-id="3fcf0-152">**Gestion des mises en production**.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-152">**Release management**.</span></span> <span data-ttu-id="3fcf0-153">Chaque équipe doit être en mesure de déployer une mise à jour en production.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-153">Every team should be able to deploy an update to production.</span></span> <span data-ttu-id="3fcf0-154">Cela ne signifie pas que tous les membres doivent être autorisés à le faire.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-154">That doesn't mean that every team member has permissions to do so.</span></span> <span data-ttu-id="3fcf0-155">Cependant, une organisation disposant d’un rôle centralisé de gestionnaire des versions peut constater un ralentissement de ses déploiements.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-155">But having a centralized Release Manager role can reduce the velocity of deployments.</span></span>

    <span data-ttu-id="3fcf0-156">**Atténuation** : Plus le processus d’intégration et de livraison continue est automatisé et fiable, moins la nécessité d’une autorité centrale se fait sentir.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-156">**Mitigation**: The more that your CI/CD process is automated and reliable, the less there should be a need for a central authority.</span></span> <span data-ttu-id="3fcf0-157">Ceci dit, vous pouvez avoir plusieurs stratégies, adaptées à la fois à la publication des modifications majeures de fonctionnalités et des correctifs mineurs.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-157">That said, you might have different policies for releasing major feature updates versus minor bug fixes.</span></span> <span data-ttu-id="3fcf0-158">La décentralisation ne signifie pas aucune trace de gouvernance.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-158">Being decentralized doesn't mean zero governance.</span></span>

- <span data-ttu-id="3fcf0-159">**Mises à jour de service**.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-159">**Service updates**.</span></span> <span data-ttu-id="3fcf0-160">Lorsque vous mettez à jour un service vers une nouvelle version, il ne doit pas perturber les autres services qui en dépendent.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-160">When you update a service to a new version, it shouldn't break other services that depend on it.</span></span>

    <span data-ttu-id="3fcf0-161">**Atténuation** : Utiliser des techniques de déploiement telles que la mise en production bleu-vert ou contrôle de validité pour des modifications sans rupture.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-161">**Mitigation**: Use deployment techniques such as blue-green or canary release for non-breaking changes.</span></span> <span data-ttu-id="3fcf0-162">Les dernières modifications de l’API, déployez la nouvelle version côte à côte avec la version précédente.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-162">For breaking API changes, deploy the new version side by side with the previous version.</span></span> <span data-ttu-id="3fcf0-163">De cette façon, les services qui utilisent l’API précédente peuvent être mis à jour et testés pour la nouvelle API.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-163">That way, services that consume the previous API can be updated and tested for the new API.</span></span> <span data-ttu-id="3fcf0-164">Consultez [mise à jour des services](#updating-services), ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-164">See [Updating services](#updating-services), below.</span></span>

## <a name="monorepo-vs-multi-repo"></a><span data-ttu-id="3fcf0-165">Plusieurs dépôts de Monorepo vs</span><span class="sxs-lookup"><span data-stu-id="3fcf0-165">Monorepo vs multi-repo</span></span>

<span data-ttu-id="3fcf0-166">Avant de créer un workflow CI/CD, vous devez savoir comment la base de code est structurée et gérée.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-166">Before creating a CI/CD workflow, you must know how the code base will be structured and managed.</span></span>

- <span data-ttu-id="3fcf0-167">Équipes fonctionnent dans les référentiels séparés ou dans un monorepo (référentiel unique) ?</span><span class="sxs-lookup"><span data-stu-id="3fcf0-167">Do teams work in separate repositories or in a monorepo (single repository)?</span></span>
- <span data-ttu-id="3fcf0-168">Quelle est votre stratégie de création de branche ?</span><span class="sxs-lookup"><span data-stu-id="3fcf0-168">What is your branching strategy?</span></span>
- <span data-ttu-id="3fcf0-169">Qui peut envoyer (push) du code en production ?</span><span class="sxs-lookup"><span data-stu-id="3fcf0-169">Who can push code to production?</span></span> <span data-ttu-id="3fcf0-170">Existe-t-il un rôle de gestionnaire de mise en production ?</span><span class="sxs-lookup"><span data-stu-id="3fcf0-170">Is there a release manager role?</span></span>

<span data-ttu-id="3fcf0-171">L’approche « dépôt unique » est de plus en plus utilisée, mais les deux approches ont des avantages et des inconvénients.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-171">The monorepo approach has been gaining favor but there are advantages and disadvantages to both.</span></span>

| &nbsp; | <span data-ttu-id="3fcf0-172">Dépôt unique</span><span class="sxs-lookup"><span data-stu-id="3fcf0-172">Monorepo</span></span> | <span data-ttu-id="3fcf0-173">Dépôts multiples</span><span class="sxs-lookup"><span data-stu-id="3fcf0-173">Multiple repos</span></span> |
|--------|----------|----------------|
| <span data-ttu-id="3fcf0-174">**Avantages**</span><span class="sxs-lookup"><span data-stu-id="3fcf0-174">**Advantages**</span></span> | <span data-ttu-id="3fcf0-175">Partage du code</span><span class="sxs-lookup"><span data-stu-id="3fcf0-175">Code sharing</span></span><br/><span data-ttu-id="3fcf0-176">Code et outils plus faciles à standardiser</span><span class="sxs-lookup"><span data-stu-id="3fcf0-176">Easier to standardize code and tooling</span></span><br/><span data-ttu-id="3fcf0-177">Code plus facile à refactoriser</span><span class="sxs-lookup"><span data-stu-id="3fcf0-177">Easier to refactor code</span></span><br/><span data-ttu-id="3fcf0-178">Découvrabilité - une même vue du code</span><span class="sxs-lookup"><span data-stu-id="3fcf0-178">Discoverability - single view of the code</span></span><br/> | <span data-ttu-id="3fcf0-179">Propriété clairement établie par équipe</span><span class="sxs-lookup"><span data-stu-id="3fcf0-179">Clear ownership per team</span></span><br/><span data-ttu-id="3fcf0-180">Potentiellement moins de conflits de fusion</span><span class="sxs-lookup"><span data-stu-id="3fcf0-180">Potentially fewer merge conflicts</span></span><br/><span data-ttu-id="3fcf0-181">Aide à appliquer le découplage des microservices</span><span class="sxs-lookup"><span data-stu-id="3fcf0-181">Helps to enforce decoupling of microservices</span></span> |
| <span data-ttu-id="3fcf0-182">**Défis**</span><span class="sxs-lookup"><span data-stu-id="3fcf0-182">**Challenges**</span></span> | <span data-ttu-id="3fcf0-183">Les modifications apportées au code partagé peuvent affecter plusieurs microservices</span><span class="sxs-lookup"><span data-stu-id="3fcf0-183">Changes to shared code can affect multiple microservices</span></span><br/><span data-ttu-id="3fcf0-184">Plus grand risque de conflits de fusion</span><span class="sxs-lookup"><span data-stu-id="3fcf0-184">Greater potential for merge conflicts</span></span><br/><span data-ttu-id="3fcf0-185">Les outils doivent être adaptés pour une grande base de code</span><span class="sxs-lookup"><span data-stu-id="3fcf0-185">Tooling must scale to a large code base</span></span><br/><span data-ttu-id="3fcf0-186">Contrôle d’accès</span><span class="sxs-lookup"><span data-stu-id="3fcf0-186">Access control</span></span><br/><span data-ttu-id="3fcf0-187">Processus de déploiement plus complexe</span><span class="sxs-lookup"><span data-stu-id="3fcf0-187">More complex deployment process</span></span> | <span data-ttu-id="3fcf0-188">Partage du code plus difficile</span><span class="sxs-lookup"><span data-stu-id="3fcf0-188">Harder to share code</span></span><br/><span data-ttu-id="3fcf0-189">Standards de codage plus difficiles à appliquer</span><span class="sxs-lookup"><span data-stu-id="3fcf0-189">Harder to enforce coding standards</span></span><br/><span data-ttu-id="3fcf0-190">Gestion des dépendances</span><span class="sxs-lookup"><span data-stu-id="3fcf0-190">Dependency management</span></span><br/><span data-ttu-id="3fcf0-191">Base de code diffuse, découvrabilité faible</span><span class="sxs-lookup"><span data-stu-id="3fcf0-191">Diffuse code base, poor discoverability</span></span><br/><span data-ttu-id="3fcf0-192">Manque d’infrastructure partagée</span><span class="sxs-lookup"><span data-stu-id="3fcf0-192">Lack of shared infrastructure</span></span>

## <a name="updating-services"></a><span data-ttu-id="3fcf0-193">Mise à jour des services</span><span class="sxs-lookup"><span data-stu-id="3fcf0-193">Updating services</span></span>

<span data-ttu-id="3fcf0-194">Il existe différentes stratégies de mise à jour d’un service déjà en production.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-194">There are various strategies for updating a service that's already in production.</span></span> <span data-ttu-id="3fcf0-195">Nous présentons ici trois options courantes : mise à jour propagée, déploiement bleu-vert et contrôle de la validité de la mise en production.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-195">Here we discuss three common options: Rolling update, blue-green deployment, and canary release.</span></span>

### <a name="rolling-updates"></a><span data-ttu-id="3fcf0-196">Mises à jour propagées</span><span class="sxs-lookup"><span data-stu-id="3fcf0-196">Rolling updates</span></span>

<span data-ttu-id="3fcf0-197">Dans une mise à jour propagée, vous déployez de nouvelles instances d’un service ; ces nouvelles instances reçoivent immédiatement les requêtes.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-197">In a rolling update, you deploy new instances of a service, and the new instances start receiving requests right away.</span></span> <span data-ttu-id="3fcf0-198">À mesure que les nouvelles instances arrivent, les anciennes instances sont supprimées.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-198">As the new instances come up, the previous instances are removed.</span></span>

<span data-ttu-id="3fcf0-199">**Exemple.**</span><span class="sxs-lookup"><span data-stu-id="3fcf0-199">**Example.**</span></span> <span data-ttu-id="3fcf0-200">Dans Kubernetes, les mises à jour propagées sont le comportement par défaut lorsque vous mettez à jour les spécifications des PODS pour un déploiement.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-200">In Kubernetes, rolling updates are the default behavior when you update the pod spec for a Deployment.</span></span> <span data-ttu-id="3fcf0-201">Le contrôleur de déploiement crée un nouveau jeu de réplicas pour les pods mis à jour.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-201">The Deployment controller creates a new ReplicaSet for the updated pods.</span></span> <span data-ttu-id="3fcf0-202">Ensuite, il promeut le nouveau jeu en rétrogradant l’ancien, ceci pour garantir le maintien d’un nombre souhaité de réplicas.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-202">Then it scales up the new ReplicaSet while scaling down the old one, to maintain the desired replica count.</span></span> <span data-ttu-id="3fcf0-203">Les anciens pods ne sont pas supprimés avant que les nouveaux ne soient prêts.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-203">It doesn't delete old pods until the new ones are ready.</span></span> <span data-ttu-id="3fcf0-204">Kubernetes conserve un historique de la mise à jour, donc vous pouvez restaurer une mise à jour si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-204">Kubernetes keeps a history of the update, so you can roll back an update if needed.</span></span>

<span data-ttu-id="3fcf0-205">L’une des difficultés liées aux mises à jour propagées est la confusion régnant durant le processus de mise à jour. À ce stade, une combinaison de versions anciennes et nouvelles exécute et reçoit le trafic.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-205">One challenge of rolling updates is that during the update process, a mix of old and new versions are running and receiving traffic.</span></span> <span data-ttu-id="3fcf0-206">Pendant cette période, une requête peut être dirigée vers l’une ou l’autre des versions.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-206">During this period, any request could get routed to either of the two versions.</span></span>

<span data-ttu-id="3fcf0-207">Les dernières modifications de l’API, une bonne pratique est de prendre en charge les deux versions côte à côte, jusqu'à ce que tous les clients de la version précédente sont mis à jour.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-207">For breaking API changes, a good practice is to support both versions side by side, until all clients of the previous version are updated.</span></span> <span data-ttu-id="3fcf0-208">Consultez [version de l’API](./design/api-design.md#api-versioning).</span><span class="sxs-lookup"><span data-stu-id="3fcf0-208">See [API versioning](./design/api-design.md#api-versioning).</span></span>

### <a name="blue-green-deployment"></a><span data-ttu-id="3fcf0-209">Déploiement bleu-vert</span><span class="sxs-lookup"><span data-stu-id="3fcf0-209">Blue-green deployment</span></span>

<span data-ttu-id="3fcf0-210">Dans un déploiement bleu-vert, il est possible de déployer la nouvelle version en parallèle de la version précédente.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-210">In a blue-green deployment, you deploy the new version alongside the previous version.</span></span> <span data-ttu-id="3fcf0-211">Une fois la nouvelle version validée, vous basculez simultanément l’ensemble du trafic de l’ancienne version vers la nouvelle.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-211">After you validate the new version, you switch all traffic at once from the previous version to the new version.</span></span> <span data-ttu-id="3fcf0-212">Après le basculement, vous vérifiez l’absence de problèmes dans l’application.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-212">After the switch, you monitor the application for any problems.</span></span> <span data-ttu-id="3fcf0-213">Si une erreur survient, vous pouvez revenir à l’ancienne version.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-213">If something goes wrong, you can swap back to the old version.</span></span> <span data-ttu-id="3fcf0-214">En supposant qu’il n’existe aucun problème, vous pouvez supprimer l’ancienne version.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-214">Assuming there are no problems, you can delete the old version.</span></span>

<span data-ttu-id="3fcf0-215">Avec une application monolithique ou multiniveau plus traditionnelle, un déploiement bleu-vert est généralement synonyme d’approvisionnement de deux environnements identiques.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-215">With a more traditional monolithic or N-tier application, blue-green deployment generally meant provisioning two identical environments.</span></span> <span data-ttu-id="3fcf0-216">Vous déployez alors la nouvelle version dans un environnement intermédiaire, avant de rediriger le trafic client vers l’environnement intermédiaire, par exemple, en échangeant les adresses IP virtuelles.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-216">You would deploy the new version to a staging environment, then redirect client traffic to the staging environment &mdash; for example, by swapping VIP addresses.</span></span> <span data-ttu-id="3fcf0-217">Dans une architecture de microservices, les mises à jour se produisent au niveau du microservice, qui serait généralement déployer la mise à jour dans le même environnement et d’utiliser un mécanisme de découverte de service pour le remplacement.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-217">In a microservices architecture, updates happen at the microservice level, so you would typically deploy the update into the same environment and use a service discovery mechanism to swap.</span></span>

<span data-ttu-id="3fcf0-218">**Exemple**.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-218">**Example**.</span></span> <span data-ttu-id="3fcf0-219">Dans Kubernetes, il n’est pas nécessaire d’approvisionner un cluster distinct pour procéder à des déploiements bleu-vert.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-219">In Kubernetes, you don't need to provision a separate cluster to do blue-green deployments.</span></span> <span data-ttu-id="3fcf0-220">Ici, vous pouvez valoriser des sélecteurs.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-220">Instead, you can take advantage of selectors.</span></span> <span data-ttu-id="3fcf0-221">Créez une nouvelle ressource de déploiement avec une nouvelle spécification de pods et un jeu différent d’étiquettes.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-221">Create a new Deployment resource with a new pod spec and a different set of labels.</span></span> <span data-ttu-id="3fcf0-222">Créez ce déploiement, sans supprimer le déploiement précédent ni modifier le service pointant vers lui.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-222">Create this deployment, without deleting the previous deployment or modifying the service that points to it.</span></span> <span data-ttu-id="3fcf0-223">Une fois que les nouveaux pods sont exécutés, vous pouvez mettre à jour le sélecteur du service en fonction du nouveau déploiement.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-223">Once the new pods are running, you can update the service's selector to match the new deployment.</span></span>

<span data-ttu-id="3fcf0-224">L’inconvénient du déploiement bleu-vert est pendant la mise à jour, vous devez exécuter deux fois plus pods pour le service (actuel et suivant).</span><span class="sxs-lookup"><span data-stu-id="3fcf0-224">One drawback of blue-green deployment is that during the update, you are running twice as many pods for the service (current and next).</span></span> <span data-ttu-id="3fcf0-225">Si les pods nécessitent un volume important d’UC ou de ressources de mémoire, il vous faudra éventuellement augmenter temporairement la taille du cluster pour prendre en charge efficacement la consommation de ressources.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-225">If the pods require a lot of CPU or memory resources, you may need to scale out the cluster temporarily to handle the resource consumption.</span></span>

### <a name="canary-release"></a><span data-ttu-id="3fcf0-226">Contrôle la validité de la mise en production</span><span class="sxs-lookup"><span data-stu-id="3fcf0-226">Canary release</span></span>

<span data-ttu-id="3fcf0-227">Durant un contrôle de la validité de la mise en production, vous déployez une version mise à jour à un nombre réduit de clients.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-227">In a canary release, you roll out an updated version to a small number of clients.</span></span> <span data-ttu-id="3fcf0-228">Ensuite, vous analysez le comportement du nouveau service avant de procéder à un déploiement plus large vers l’ensemble des clients.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-228">Then you monitor the behavior of the new service before rolling it out to all clients.</span></span> <span data-ttu-id="3fcf0-229">Ainsi, vous contrôlez la mise en œuvre progressive du processus, observez les données réelles et identifiez les problèmes avant que l’ensemble des clients ne soient affectés.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-229">This lets you do a slow rollout in a controlled fashion, observe real data, and spot problems before all customers are affected.</span></span>

<span data-ttu-id="3fcf0-230">La gestion de cette version est plus complexe que celle des versions bleu-vert et propagée, dans la mesure où vous devez diriger dynamiquement les requêtes vers différentes versions du service.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-230">A canary release is more complex to manage than either blue-green or rolling update, because you must dynamically route requests to different versions of the service.</span></span>

<span data-ttu-id="3fcf0-231">**Exemple**.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-231">**Example**.</span></span> <span data-ttu-id="3fcf0-232">Dans Kubernetes, vous pouvez configurer un service pour une prise en charge de deux jeux de réplicas (un pour chaque version), avant de modifier manuellement au besoin la quantité de réplicas.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-232">In Kubernetes, you can configure a Service to span two replica sets (one for each version) and adjust the replica counts manually.</span></span> <span data-ttu-id="3fcf0-233">Toutefois, cette approche présente une granularité plutôt grossière, en raison de la manière dont la charge de Kubernetes s’équilibre entre les pods.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-233">However, this approach is rather coarse-grained, because of the way Kubernetes load balances across pods.</span></span> <span data-ttu-id="3fcf0-234">Par exemple, si vous avez un total de 10 réplicas, vous pouvez décaler uniquement le trafic en incréments de 10 %.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-234">For example, if you have a total of 10 replicas, you can only shift traffic in 10% increments.</span></span> <span data-ttu-id="3fcf0-235">Si vous avez recours à une maille de service, vous pouvez solliciter les règles d’acheminement dédiées pour implémenter une stratégie de publication plus sophistiquée.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-235">If you are using a service mesh, you can use the service mesh routing rules to implement a more sophisticated canary release strategy.</span></span>

## <a name="next-steps"></a><span data-ttu-id="3fcf0-236">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="3fcf0-236">Next steps</span></span>

<span data-ttu-id="3fcf0-237">Découvrez les pratiques de CI/CD spécifiques pour les microservices s’exécutant sur Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="3fcf0-237">Learn specific CI/CD practices for microservices running on Kubernetes.</span></span>

- [<span data-ttu-id="3fcf0-238">CI/CD pour les microservices sur Kubernetes</span><span class="sxs-lookup"><span data-stu-id="3fcf0-238">CI/CD for microservices on Kubernetes</span></span>](./ci-cd-kubernetes.md)