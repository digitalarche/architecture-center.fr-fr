---
title: Conseils généraux sur les nouvelles tentatives
description: Conseils sur les nouvelles tentatives dans le cadre de la gestion des erreurs temporaires.
author: dragon119
ms.date: 07/13/2016
pnp.series.title: Best Practices
ms.openlocfilehash: 85264faa89e827821a71544f1bf8dc8e0619ef24
ms.sourcegitcommit: 94d50043db63416c4d00cebe927a0c88f78c3219
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/28/2018
ms.locfileid: "47429245"
---
# <a name="transient-fault-handling"></a><span data-ttu-id="c31a7-103">Gestion des erreurs temporaires</span><span class="sxs-lookup"><span data-stu-id="c31a7-103">Transient fault handling</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="c31a7-104">Toutes les applications qui communiquent avec des services à distance ou des ressources distantes doivent être sensibles aux erreurs temporaires.</span><span class="sxs-lookup"><span data-stu-id="c31a7-104">All applications that communicate with remote services and resources must be sensitive to transient faults.</span></span> <span data-ttu-id="c31a7-105">Cela est particulièrement vrai pour les applications exécutées dans le cloud, où la nature de l’environnement et la connectivité via Internet augmentent le risque de rencontrer ce type d’erreurs.</span><span class="sxs-lookup"><span data-stu-id="c31a7-105">This is especially the case for applications that run in the cloud, where the nature of the environment and connectivity over the Internet means these types of faults are likely to be encountered more often.</span></span> <span data-ttu-id="c31a7-106">Les erreurs temporaires incluent la perte momentanée de la connectivité réseau aux composants et aux services, l’indisponibilité passagère d’un service ou les expirations de délai qui surviennent lorsqu’un service est occupé.</span><span class="sxs-lookup"><span data-stu-id="c31a7-106">Transient faults include the momentary loss of network connectivity to components and services, the temporary unavailability of a service, or timeouts that arise when a service is busy.</span></span> <span data-ttu-id="c31a7-107">Ces erreurs se corrigent souvent d’elles-mêmes, et si l’action est répétée après un délai approprié, il est probable qu’elle aboutisse.</span><span class="sxs-lookup"><span data-stu-id="c31a7-107">These faults are often self-correcting, and if the action is repeated after a suitable delay it is likely succeed.</span></span>

<span data-ttu-id="c31a7-108">Ce document présente des conseils généraux pour la gestion des erreurs temporaires.</span><span class="sxs-lookup"><span data-stu-id="c31a7-108">This document covers general guidance for transient fault handling.</span></span> <span data-ttu-id="c31a7-109">Pour plus d’informations sur la gestion des erreurs temporaires dans le cadre de l’utilisation des services Microsoft Azure, consultez [Instructions relatives aux nouvelles tentatives pour les services Azure](./retry-service-specific.md).</span><span class="sxs-lookup"><span data-stu-id="c31a7-109">For information about handling transient faults when using Microsoft Azure services, see [Azure service-specific retry guidelines](./retry-service-specific.md).</span></span>

## <a name="why-do-transient-faults-occur-in-the-cloud"></a><span data-ttu-id="c31a7-110">Pourquoi des erreurs temporaires se produisent-elles dans le cloud ?</span><span class="sxs-lookup"><span data-stu-id="c31a7-110">Why do transient faults occur in the cloud?</span></span>
<span data-ttu-id="c31a7-111">Les erreurs temporaires peuvent se produire dans n’importe quel environnement, sur n’importe quel système d’exploitation ou plateforme et dans n’importe quel type d’application.</span><span class="sxs-lookup"><span data-stu-id="c31a7-111">Transient faults can occur in any environment, on any platform or operating system, and in any kind of application.</span></span> <span data-ttu-id="c31a7-112">Dans le cas de solutions exécutées sur une infrastructure locale, les performances et la disponibilité de l’application et de ses composants sont généralement garanties à travers une redondance matérielle coûteuse et souvent sous-exploitée, et les ressources et les composants sont situés à proximité les uns des autres.</span><span class="sxs-lookup"><span data-stu-id="c31a7-112">In solutions that run on local, on-premises infrastructure, performance and availability of the application and its components is typically maintained through expensive and often under-used hardware redundancy, and components and resources are located close to each another.</span></span> <span data-ttu-id="c31a7-113">Bien que cette configuration réduise les risques de défaillance, elle peut toujours entraîner des erreurs temporaires, voire une panne suite à des événements imprévus tels que des problèmes d’alimentation externe ou de réseau, ou d’autres scénarios menant à l’arrêt de l’activité.</span><span class="sxs-lookup"><span data-stu-id="c31a7-113">While this makes a failure less likely, it can still result in transient faults - and even an outage through unforeseen events such as external power supply or network issues, or other disaster scenarios.</span></span>

<span data-ttu-id="c31a7-114">L’hébergement cloud, y compris les systèmes de cloud privé, peut offrir une disponibilité globale supérieure en s’appuyant sur des ressources partagées, la redondance, le basculement automatique et l’allocation dynamique des ressources entre un très grand nombre de nœuds de calcul de base.</span><span class="sxs-lookup"><span data-stu-id="c31a7-114">Cloud hosting, including private cloud systems, can offer a higher overall availability by using shared resources, redundancy, automatic failover, and dynamic resource allocation across a huge number of commodity compute nodes.</span></span> <span data-ttu-id="c31a7-115">Cependant, la nature de ces environnements est susceptible d’accroître le risque de survenue d’erreurs temporaires.</span><span class="sxs-lookup"><span data-stu-id="c31a7-115">However, the nature of these environments can mean that transient faults are more likely to occur.</span></span> <span data-ttu-id="c31a7-116">Il existe plusieurs raisons à cela :</span><span class="sxs-lookup"><span data-stu-id="c31a7-116">There are several reasons for this:</span></span>

* <span data-ttu-id="c31a7-117">Dans un environnement de cloud, beaucoup de ressources sont partagées et l’accès à ces ressources fait l’objet d’une limitation afin de protéger ces dernières.</span><span class="sxs-lookup"><span data-stu-id="c31a7-117">Many resources in a cloud environment are shared, and access to these resources is subject to throttling in order to protect the resource.</span></span> <span data-ttu-id="c31a7-118">Certains services refusent les connexions lorsque la charge s’élève à un niveau spécifique ou qu’un débit maximal est atteint afin de permettre le traitement des demandes existantes et de garantir un niveau de performances optimal du service pour tous les utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="c31a7-118">Some services will refuse connections when the load rises to a specific level, or a maximum throughput rate is reached, in order to allow processing of existing requests and to maintain performance of the service for all users.</span></span> <span data-ttu-id="c31a7-119">Cette limitation contribue à maintenir la qualité de service pour les voisins et les autres clients utilisant les ressources partagées.</span><span class="sxs-lookup"><span data-stu-id="c31a7-119">Throttling helps to maintain the quality of service for neighbors and other tenants using the shared resource.</span></span>
* <span data-ttu-id="c31a7-120">Les environnements de cloud sont créés à l’aide de très nombreuses unités matérielles de base.</span><span class="sxs-lookup"><span data-stu-id="c31a7-120">Cloud environments are built using vast numbers of commodity hardware units.</span></span> <span data-ttu-id="c31a7-121">Ils doivent leurs performances à la répartition dynamique de la charge entre plusieurs unités de calcul et composants d’infrastructure et leur fiabilité au recyclage ou au remplacement automatique des unités défaillantes.</span><span class="sxs-lookup"><span data-stu-id="c31a7-121">They deliver performance by dynamically distributing the load across multiple computing units and infrastructure components, and deliver reliability by automatically recycling or replacing failed units.</span></span> <span data-ttu-id="c31a7-122">Cette nature dynamique peut entraîner occasionnellement des échecs de connexion et des erreurs temporaires.</span><span class="sxs-lookup"><span data-stu-id="c31a7-122">This dynamic nature means that transient faults and temporary connection failures may occasionally occur.</span></span>
* <span data-ttu-id="c31a7-123">Il y a souvent plus de composants matériels, notamment des composants d’infrastructure réseau tels que des routeurs et des équilibreurs de charge, entre l’application et les ressources et services qu’elle utilise.</span><span class="sxs-lookup"><span data-stu-id="c31a7-123">There are often more hardware components, including network infrastructure such as routers and load balancers, between the application and the resources and services it uses.</span></span> <span data-ttu-id="c31a7-124">Cette infrastructure en plus peut parfois introduire une latence et des erreurs de connexion temporaires supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="c31a7-124">This additional infrastructure can occasionally introduce additional connection latency and transient connection faults.</span></span>
* <span data-ttu-id="c31a7-125">Les conditions réseau entre le client et le serveur peuvent être variables, tout particulièrement lorsque les communications franchissent Internet.</span><span class="sxs-lookup"><span data-stu-id="c31a7-125">Network conditions between the client and the server may be variable, especially when communication crosses the Internet.</span></span> <span data-ttu-id="c31a7-126">Même dans des emplacements locaux, les charges de trafic très importantes peuvent ralentir les communications et entraîner des échecs de connexion intermittents.</span><span class="sxs-lookup"><span data-stu-id="c31a7-126">Even in on-premises locations, very heavy traffic loads may slow communication and cause intermittent connection failures.</span></span>

## <a name="challenges"></a><span data-ttu-id="c31a7-127">Défis</span><span class="sxs-lookup"><span data-stu-id="c31a7-127">Challenges</span></span>
<span data-ttu-id="c31a7-128">Les erreurs temporaires peuvent avoir un impact considérable sur la perception de la disponibilité d’une application, même si cette dernière a été testée de manière approfondie dans toutes les circonstances prévisibles.</span><span class="sxs-lookup"><span data-stu-id="c31a7-128">Transient faults can have a huge impact on the perceived availability of an application, even if it has been thoroughly tested under all foreseeable circumstances.</span></span> <span data-ttu-id="c31a7-129">Pour fonctionner de façon fiable, les applications hébergées sur le cloud doivent être capables de répondre aux défis suivants :</span><span class="sxs-lookup"><span data-stu-id="c31a7-129">To ensure that cloud-hosted applications operate reliably, they must be able to respond to the following challenges:</span></span>

* <span data-ttu-id="c31a7-130">L’application doit être en mesure de détecter les erreurs lorsqu’elles se produisent et de déterminer si ces erreurs sont susceptibles d’être temporaires, de plus longue durée ou s’il s’agit de défaillances irréversibles.</span><span class="sxs-lookup"><span data-stu-id="c31a7-130">The application must be able to detect faults when they occur, and determine if these faults are likely to be transient, more long-lasting, or are terminal failures.</span></span> <span data-ttu-id="c31a7-131">Les différentes ressources renvoient généralement des réponses différentes lorsqu’une erreur se produit, et ces réponses peuvent également varier selon le contexte de l’opération ; par exemple, la réponse à une erreur survenant lors de l’accès en lecture au stockage peut différer de la réponse à une erreur survenant lors de l’écriture dans le stockage.</span><span class="sxs-lookup"><span data-stu-id="c31a7-131">Different resources are likely to return different responses when a fault occurs, and these responses may also vary depending on the context of the operation; for example, the response for an error when reading from storage may be different from response for an error when writing to storage.</span></span> <span data-ttu-id="c31a7-132">Des contrats bien documentés concernant les erreurs temporaires sont disponibles pour un grand nombre de ressources et de services.</span><span class="sxs-lookup"><span data-stu-id="c31a7-132">Many resources and services have well-documented transient failure contracts.</span></span> <span data-ttu-id="c31a7-133">Cependant, en l’absence de telles informations, il peut s’avérer difficile de découvrir la nature de l’erreur et si cette dernière est susceptible d’être temporaire.</span><span class="sxs-lookup"><span data-stu-id="c31a7-133">However, where such information is not available, it may be difficult to discover the nature of the fault and whether it is likely to be transient.</span></span>
* <span data-ttu-id="c31a7-134">Si l’application détermine que l’erreur est susceptible d’être temporaire, elle doit être en mesure de retenter l’opération et de suivre le nombre de tentatives effectuées.</span><span class="sxs-lookup"><span data-stu-id="c31a7-134">The application must be able to retry the operation if it determines that the fault is likely to be transient and keep track of the number of times the operation was retried.</span></span>
* <span data-ttu-id="c31a7-135">L’application doit s’appuyer sur une stratégie appropriée pour les nouvelles tentatives.</span><span class="sxs-lookup"><span data-stu-id="c31a7-135">The application must use an appropriate strategy for the retries.</span></span> <span data-ttu-id="c31a7-136">Cette stratégie spécifie le nombre de nouvelles tentatives requises, le délai entre chaque tentative et les mesures à prendre après une tentative infructueuse.</span><span class="sxs-lookup"><span data-stu-id="c31a7-136">This strategy specifies the number of times it should retry, the delay between each attempt, and the actions to take after a failed attempt.</span></span> <span data-ttu-id="c31a7-137">Le nombre approprié de tentatives et le délai entre chacune d’elle sont souvent difficiles à déterminer et varient en fonction du type de ressource, mais également des conditions de fonctionnement actuelles de la ressource et de l’application elle-même.</span><span class="sxs-lookup"><span data-stu-id="c31a7-137">The appropriate number of attempts and the delay between each one are often difficult to determine, and vary based on the type of resource as well as the current operating conditions of the resource and the application itself.</span></span>

## <a name="general-guidelines"></a><span data-ttu-id="c31a7-138">Recommandations générales</span><span class="sxs-lookup"><span data-stu-id="c31a7-138">General guidelines</span></span>
<span data-ttu-id="c31a7-139">Les recommandations suivantes vous aideront à concevoir un mécanisme de gestion des erreurs temporaires approprié pour vos applications :</span><span class="sxs-lookup"><span data-stu-id="c31a7-139">The following guidelines will help you to design a suitable transient fault handing mechanism for your applications:</span></span>

* <span data-ttu-id="c31a7-140">**Déterminez s’il existe un mécanisme de nouvelle tentative intégré :**</span><span class="sxs-lookup"><span data-stu-id="c31a7-140">**Determine if there is a built-in retry mechanism:**</span></span>
  * <span data-ttu-id="c31a7-141">De nombreux services fournissent un kit de développement logiciel (SDK) ou une bibliothèque cliente contenant un mécanisme de gestion des erreurs temporaires intégré.</span><span class="sxs-lookup"><span data-stu-id="c31a7-141">Many services provide an SDK or client library that contains a transient fault handling mechanism.</span></span> <span data-ttu-id="c31a7-142">La politique de nouvelle tentative utilisée est généralement adaptée à la nature et aux exigences du service cible.</span><span class="sxs-lookup"><span data-stu-id="c31a7-142">The retry policy it uses is typically tailored to the nature and requirements of the target service.</span></span> <span data-ttu-id="c31a7-143">Les interfaces REST pour les services peuvent également renvoyer des informations utiles pour déterminer si une nouvelle tentative est appropriée et combien de temps attendre avant la tentative suivante.</span><span class="sxs-lookup"><span data-stu-id="c31a7-143">Alternatively, REST interfaces for services may return information that is useful in determining whether a retry is appropriate, and how long to wait before the next retry attempt.</span></span>
  * <span data-ttu-id="c31a7-144">Le cas échéant, utilisez le mécanisme de nouvelle tentative intégré, sauf si vous avez des besoins spécifiques et bien définis pour lesquels un comportement de nouvelle tentative différent serait plus approprié.</span><span class="sxs-lookup"><span data-stu-id="c31a7-144">Use the built-in retry mechanism where one is available unless you have specific and well-understood requirements that mean a different retry behavior is more appropriate.</span></span>
* <span data-ttu-id="c31a7-145">**Déterminez si l’opération est adaptée à de nouvelles tentatives**:</span><span class="sxs-lookup"><span data-stu-id="c31a7-145">**Determine if the operation is suitable for retrying**:</span></span>
  * <span data-ttu-id="c31a7-146">Vous devez uniquement retenter les opérations où les erreurs sont temporaires (ce que révèle généralement la nature de l’erreur) et si l’opération a des chances d’aboutir en cas de nouvelle tentative.</span><span class="sxs-lookup"><span data-stu-id="c31a7-146">You should only retry operations where the faults are transient (typically indicated by the nature of the error), and if there is at least some likelihood that the operation will succeed when reattempted.</span></span> <span data-ttu-id="c31a7-147">Il est inutile de retenter des opérations qui indiquent une opération non valide, telle qu’une mise à jour de base de données pour un élément inexistant ou les demandes adressées à un service ou une ressource qui a subi une erreur irrécupérable.</span><span class="sxs-lookup"><span data-stu-id="c31a7-147">There is no point in reattempting operations that indicate an invalid operation such as a database update to an item that does not exist, or requests to a service or resource that has suffered a fatal error</span></span>
  * <span data-ttu-id="c31a7-148">En général, vous devez implémenter les nouvelles tentatives uniquement lorsque vous pouvez en déterminer le plein impact et que les conditions sont bien comprises et peuvent être validées.</span><span class="sxs-lookup"><span data-stu-id="c31a7-148">In general, you should implement retries only where the full impact of this can be determined, and the conditions are well understood and can be validated.</span></span> <span data-ttu-id="c31a7-149">Si ce n’est pas le cas, laissez le code appelant implémenter les nouvelles tentatives.</span><span class="sxs-lookup"><span data-stu-id="c31a7-149">If not, leave it to the calling code to implement retries.</span></span> <span data-ttu-id="c31a7-150">Gardez à l’esprit que les erreurs renvoyées par des ressources et des services que vous ne contrôlez pas peuvent évoluer au fil du temps, et qu’il vous faudra peut-être revoir votre logique de détection des erreurs temporaires.</span><span class="sxs-lookup"><span data-stu-id="c31a7-150">Remember that the errors returned from resources and services outside your control may evolve over time, and you may need to revisit your transient fault detection logic.</span></span>
  * <span data-ttu-id="c31a7-151">Lorsque vous créez des services ou des composants, envisagez d’implémenter des codes d’erreur et des messages qui aideront les clients à déterminer s’ils doivent retenter des opérations ayant échoué.</span><span class="sxs-lookup"><span data-stu-id="c31a7-151">When you create services or components, consider implementing error codes and messages that will help clients determine whether they should retry failed operations.</span></span> <span data-ttu-id="c31a7-152">Plus particulièrement, indiquez si le client doit retenter l’opération (par exemple en renvoyant une valeur **isTransient** ) et suggérez un délai approprié avant la tentative suivante.</span><span class="sxs-lookup"><span data-stu-id="c31a7-152">In particular, indicate if the client should retry the operation (perhaps by returning an **isTransient** value) and suggest a suitable delay before the next retry attempt.</span></span> <span data-ttu-id="c31a7-153">Si vous créez un service web, envisagez de renvoyer des erreurs personnalisées définies dans les contrats de service.</span><span class="sxs-lookup"><span data-stu-id="c31a7-153">If you build a web service, consider returning custom errors defined within your service contracts.</span></span> <span data-ttu-id="c31a7-154">Même s’il se peut que les clients génériques ne soient pas en mesure de les lire, elles seront utiles pour la création de clients personnalisés.</span><span class="sxs-lookup"><span data-stu-id="c31a7-154">Even though generic clients may not be able to read these, they will be useful when building custom clients.</span></span>
* <span data-ttu-id="c31a7-155">**Déterminez un nombre de nouvelles tentatives et un intervalle appropriés :**</span><span class="sxs-lookup"><span data-stu-id="c31a7-155">**Determine an appropriate retry count and interval:**</span></span>
  * <span data-ttu-id="c31a7-156">Il est essentiel d’optimiser le nombre de nouvelles tentatives et l’intervalle pour le type de cas d’utilisation.</span><span class="sxs-lookup"><span data-stu-id="c31a7-156">It is vital to optimize the retry count and the interval to the type of use case.</span></span> <span data-ttu-id="c31a7-157">Si le nombre de nouvelles tentatives est insuffisant, l’application ne pourra pas terminer l’opération et risque de connaître une défaillance.</span><span class="sxs-lookup"><span data-stu-id="c31a7-157">If you do not retry a sufficient number of times, the application will be unable to complete the operation and is likely to experience a failure.</span></span> <span data-ttu-id="c31a7-158">Si le nombre de nouvelles tentatives est excessif ou l’intervalle entre elles trop court, l’application est susceptible de bloquer les ressources telles que les threads, les connexions et la mémoire pendant de longues périodes, ce qui nuira à l’intégrité de l’application.</span><span class="sxs-lookup"><span data-stu-id="c31a7-158">If you retry too many times, or with too short an interval between tries, the application can potentially hold resources such as threads, connections, and memory for long periods, which will adversely affect the health of the application.</span></span>
  * <span data-ttu-id="c31a7-159">Les valeurs appropriées pour l’intervalle de temps et le nombre de nouvelles tentatives dépendent du type d’opération concerné.</span><span class="sxs-lookup"><span data-stu-id="c31a7-159">The appropriate values for the time interval and the number of retry attempts depend on the type of operation being attempted.</span></span> <span data-ttu-id="c31a7-160">Par exemple, si l’opération fait partie d’une interaction utilisateur, l’intervalle doit être court et quelques nouvelles tentatives seulement doivent être effectuées pour éviter de faire attendre une réponse aux utilisateurs (ce qui maintient les connexions ouvertes et peut réduire la disponibilité pour les autres utilisateurs).</span><span class="sxs-lookup"><span data-stu-id="c31a7-160">For example, if the operation is part of a user interaction, the interval should be short and only a few retries attempted to avoid making users wait for a response (which holds open connections and can reduce availability for other users).</span></span> <span data-ttu-id="c31a7-161">Si l’opération fait partie d’un workflow de longue durée ou critique, pour lequel il serait onéreux ou fastidieux d’annuler et de redémarrer le processus, il convient d’attendre plus longtemps entre les tentatives et d’effectuer un plus grand nombre de nouvelles tentatives.</span><span class="sxs-lookup"><span data-stu-id="c31a7-161">If the operation is part of a long running or critical workflow, where cancelling and restarting the process is expensive or time-consuming, it is appropriate to wait longer between attempts and retry more times.</span></span>
  * <span data-ttu-id="c31a7-162">Déterminer l’intervalle approprié entre les nouvelles tentatives est l’étape la plus difficile de la conception d’une stratégie efficace.</span><span class="sxs-lookup"><span data-stu-id="c31a7-162">Determining the appropriate intervals between retries is the most difficult part of designing a successful strategy.</span></span> <span data-ttu-id="c31a7-163">Les stratégies classiques utilisent les types suivants d’intervalles avant nouvelle tentative :</span><span class="sxs-lookup"><span data-stu-id="c31a7-163">Typical strategies use the following types of retry interval:</span></span>
    * <span data-ttu-id="c31a7-164">**Temporisation exponentielle**.</span><span class="sxs-lookup"><span data-stu-id="c31a7-164">**Exponential back-off**.</span></span> <span data-ttu-id="c31a7-165">L’application attend un court délai avant la première nouvelle tentative, puis augmente l’intervalle de façon exponentielle entre chaque tentative suivante.</span><span class="sxs-lookup"><span data-stu-id="c31a7-165">The application waits a short time before the first retry, and then exponentially increasing times between each subsequent retry.</span></span> <span data-ttu-id="c31a7-166">Par exemple, elle peut retenter l’opération après 3 secondes, 12 secondes, 30 secondes et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="c31a7-166">For example, it may retry the operation after 3 seconds, 12 seconds, 30 seconds, and so on.</span></span>
    * <span data-ttu-id="c31a7-167">**Intervalles incrémentiels**.</span><span class="sxs-lookup"><span data-stu-id="c31a7-167">**Incremental intervals**.</span></span> <span data-ttu-id="c31a7-168">L’application attend un court délai avant la première nouvelle tentative, puis augmente l’intervalle de façon incrémentielle entre chaque tentative suivante.</span><span class="sxs-lookup"><span data-stu-id="c31a7-168">The application waits a short time before the first retry, and then incrementally increasing times between each subsequent retry.</span></span> <span data-ttu-id="c31a7-169">Par exemple, elle peut retenter l’opération après 3 secondes, 7 secondes, 13 secondes et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="c31a7-169">For example, it may retry the operation after 3 seconds, 7 seconds, 13 seconds, and so on.</span></span>
    * <span data-ttu-id="c31a7-170">**Intervalles réguliers**.</span><span class="sxs-lookup"><span data-stu-id="c31a7-170">**Regular intervals**.</span></span> <span data-ttu-id="c31a7-171">L’application attend le même laps de temps entre chaque tentative.</span><span class="sxs-lookup"><span data-stu-id="c31a7-171">The application waits for the same period of time between each attempt.</span></span> <span data-ttu-id="c31a7-172">Par exemple, elle peut retenter l’opération toutes les 3 secondes.</span><span class="sxs-lookup"><span data-stu-id="c31a7-172">For example, it may retry the operation every 3 seconds.</span></span>
    * <span data-ttu-id="c31a7-173">**Nouvelle tentative immédiate**.</span><span class="sxs-lookup"><span data-stu-id="c31a7-173">**Immediate retry**.</span></span> <span data-ttu-id="c31a7-174">Une erreur temporaire peut être très courte, par exemple lorsqu’elle est causée par un événement tel qu’une collision de paquets réseau ou un pic dans un composant matériel.</span><span class="sxs-lookup"><span data-stu-id="c31a7-174">Sometimes a transient fault is extremely short, perhaps caused by an event such as a network packet collision or a spike in a hardware component.</span></span> <span data-ttu-id="c31a7-175">Dans ce cas, il est opportun de retenter l’opération immédiatement, car celle-ci peut aboutir si l’erreur a disparu le temps que l’application assemble et envoie la demande suivante.</span><span class="sxs-lookup"><span data-stu-id="c31a7-175">In this case, retrying the operation immediately is appropriate because it may succeed if the fault has cleared in the time it takes the application to assemble and send the next request.</span></span> <span data-ttu-id="c31a7-176">Cependant, il ne doit jamais y avoir plus d’une nouvelle tentative immédiate, et vous devez implémenter d’autres stratégies, telles que la temporisation exponentielle ou les actions de secours, en cas d’échec de la nouvelle tentative immédiate.</span><span class="sxs-lookup"><span data-stu-id="c31a7-176">However, there should never be more than one immediate retry attempt, and you should switch to alternative strategies, such as such as exponential back-off or fallback actions, if the immediate retry fails.</span></span>
    * <span data-ttu-id="c31a7-177">**Répartition aléatoire**.</span><span class="sxs-lookup"><span data-stu-id="c31a7-177">**Randomization**.</span></span> <span data-ttu-id="c31a7-178">Toutes les stratégies de nouvelle tentative répertoriées ci-dessus peuvent inclure une répartition aléatoire pour éviter que plusieurs instances du client effectuent les tentatives suivantes en même temps.</span><span class="sxs-lookup"><span data-stu-id="c31a7-178">Any of the retry strategies listed above may include a randomization to prevent multiple instances of the client sending subsequent retry attempts at the same time.</span></span> <span data-ttu-id="c31a7-179">Par exemple, une instance peut retenter l’opération après 3 secondes, 11 secondes, 28 secondes et ainsi de suite, tandis qu’une autre instance peut retenter l’opération après 4 secondes, 12 secondes, 26 secondes et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="c31a7-179">For example, one instance may retry the operation after 3 seconds, 11 seconds, 28 seconds, and so on while another instance may retry the operation after 4 seconds, 12 seconds, 26 seconds, and so on.</span></span> <span data-ttu-id="c31a7-180">La répartition aléatoire est une technique utile qui peut être associée à d’autres stratégies.</span><span class="sxs-lookup"><span data-stu-id="c31a7-180">Randomization is a useful technique that may be combined with other strategies.</span></span>  
  * <span data-ttu-id="c31a7-181">En règle générale, utilisez une stratégie de temporisation exponentielle pour les opérations d’arrière-plan et des stratégies de nouvelle tentative immédiate ou à intervalles réguliers pour les opérations interactives.</span><span class="sxs-lookup"><span data-stu-id="c31a7-181">As a general guideline, use an exponential back-off strategy for background operations, and immediate or regular interval retry strategies for interactive operations.</span></span> <span data-ttu-id="c31a7-182">Dans les deux cas, vous devez choisir le délai et le nombre de nouvelles tentatives de sorte que la latence maximale pour toutes les nouvelles tentatives soit comprise dans la plage de latence de bout en bout requise.</span><span class="sxs-lookup"><span data-stu-id="c31a7-182">In both cases, you should choose the delay and the retry count so that the maximum latency for all retry attempts is within the required end-to-end latency requirement.</span></span>
  * <span data-ttu-id="c31a7-183">Prenez en compte la combinaison de tous les facteurs qui contribuent au délai d’expiration maximal global pour une opération retentée.</span><span class="sxs-lookup"><span data-stu-id="c31a7-183">Take into account the combination of all the factors that contribute to the overall maximum timeout for a retried operation.</span></span> <span data-ttu-id="c31a7-184">Ces facteurs incluent le temps mis par une connexion ayant échoué pour produire une réponse (généralement défini par une valeur de délai d’expiration dans le client), ainsi que le délai entre les nouvelles tentatives et le nombre maximal de nouvelles tentatives.</span><span class="sxs-lookup"><span data-stu-id="c31a7-184">These factors include the time taken for a failed connection to produce a response (typically set by a timeout value in the client) as well as the delay between retry attempts and the maximum number of retries.</span></span> <span data-ttu-id="c31a7-185">La somme de tous ces délais peut entraîner des durées d’opération globales très importantes, en particulier lors de l’utilisation d’une stratégie de délai exponentiel où l’intervalle entre les nouvelles tentatives augmente rapidement après chaque échec.</span><span class="sxs-lookup"><span data-stu-id="c31a7-185">The total of all these times can result in very large overall operation times, especially when using an exponential delay strategy where the interval between retries grows rapidly after each failure.</span></span> <span data-ttu-id="c31a7-186">Si un processus doit satisfaire un contrat de niveau de service (SLA) spécifique, la durée d’opération globale, y compris tous les délais d’expiration et autres, doit être comprise dans la plage définie dans le contrat SLA.</span><span class="sxs-lookup"><span data-stu-id="c31a7-186">If a process must meet a specific service level agreement (SLA), the overall operation time, including all timeouts and delays, must be within that defined in the SLA</span></span>
  * <span data-ttu-id="c31a7-187">Les stratégies de nouvelle tentative trop agressives, qui présentent des intervalles trop courts ou un trop grand nombre de nouvelles tentatives, peuvent avoir un impact négatif sur la ressource ou le service cible.</span><span class="sxs-lookup"><span data-stu-id="c31a7-187">Over-aggressive retry strategies, which have too short intervals or too may retries, can have an adverse effect on the target resource or service.</span></span> <span data-ttu-id="c31a7-188">Cela peut empêcher la ressource ou le service de récupérer de son état de surcharge, et les demandes continueront à être bloquées ou rejetées.</span><span class="sxs-lookup"><span data-stu-id="c31a7-188">This may prevent the resource or service from recovering from its overloaded state, and it will continue to block or refuse requests.</span></span> <span data-ttu-id="c31a7-189">Il en résulte un cercle vicieux où des demandes toujours plus nombreuses sont envoyées à la ressource ou au service, réduisant de plus en plus sa capacité de récupération.</span><span class="sxs-lookup"><span data-stu-id="c31a7-189">This results in a vicious circle where more and more requests are sent to the resource or service, and consequently its ability to recover is further reduced.</span></span>
  * <span data-ttu-id="c31a7-190">Prenez en compte le délai d’expiration des opérations lorsque vous choisissez les intervalles pour éviter de lancer une nouvelle tentative immédiatement (par exemple, si le délai d’expiration est similaire à l’intervalle avant nouvelle tentative).</span><span class="sxs-lookup"><span data-stu-id="c31a7-190">Take into account the timeout of the operations when choosing the retry intervals to avoid launching a subsequent attempt immediately (for example, if the timeout period is similar to the retry interval).</span></span> <span data-ttu-id="c31a7-191">Demandez-vous également si vous devez maintenir la période totale possible (le délai d’expiration plus les intervalles avant nouvelle tentative) en dessous d’une durée totale spécifique.</span><span class="sxs-lookup"><span data-stu-id="c31a7-191">Also consider if you need to keep the total possible period (the timeout plus the retry intervals) to below a specific total time.</span></span> <span data-ttu-id="c31a7-192">Les opérations ayant des délais d’expiration exceptionnellement courts ou très longs peuvent avoir une influence sur le délai d’attente et la fréquence à laquelle retenter l’opération.</span><span class="sxs-lookup"><span data-stu-id="c31a7-192">Operations that have unusually short or very long timeouts may influence how long to wait, and how often to retry the operation.</span></span>
  * <span data-ttu-id="c31a7-193">Utilisez le type de l’exception et les données qu’il contient ou les codes d’erreur et les messages renvoyés par le service afin d’optimiser l’intervalle et le nombre de nouvelles tentatives.</span><span class="sxs-lookup"><span data-stu-id="c31a7-193">Use the type of the exception and any data it contains, or the error codes and messages returned from the service, to optimize the interval and the number of retries.</span></span> <span data-ttu-id="c31a7-194">Par exemple, un certain nombre d’exceptions ou de codes d’erreur (tels que le code HTTP 503 Service indisponible avec un en-tête Retry-After dans la réponse) peuvent indiquer la durée potentielle de l’erreur ou que le service a échoué et ne répondra pas aux nouvelles tentatives.</span><span class="sxs-lookup"><span data-stu-id="c31a7-194">For example, some exceptions or error codes (such as the HTTP code 503 Service Unavailable with a Retry-After header in the response) may indicate how long the error might last, or that the service has failed and will not respond to any subsequent attempt.</span></span>
* <span data-ttu-id="c31a7-195">**Évitez les anti-modèles**:</span><span class="sxs-lookup"><span data-stu-id="c31a7-195">**Avoid anti-patterns**:</span></span>
  * <span data-ttu-id="c31a7-196">Dans la plupart des cas, vous devez éviter des implémentations qui incluent des couches dupliquées de code de nouvelle tentative.</span><span class="sxs-lookup"><span data-stu-id="c31a7-196">In the vast majority of cases, you should avoid implementations that include duplicated layers of retry code.</span></span> <span data-ttu-id="c31a7-197">Évitez les conceptions qui incluent des mécanismes de nouvelle tentative en cascade ou qui implémentent la nouvelle tentative à chaque étape d’une opération impliquant une hiérarchie de demandes, sauf si vous avez des besoins spécifiques qui l’exigent.</span><span class="sxs-lookup"><span data-stu-id="c31a7-197">Avoid designs that include cascading retry mechanisms, or that implement retry at every stage of an operation that involves a hierarchy of requests, unless you have specific requirements that demand this.</span></span> <span data-ttu-id="c31a7-198">Dans ces circonstances exceptionnelles, utilisez des politiques qui empêchent un nombre de nouvelles tentatives et des délais excessifs, et assurez-vous que vous comprenez les répercussions.</span><span class="sxs-lookup"><span data-stu-id="c31a7-198">In these exceptional circumstances, use policies that prevent excessive numbers of retries and delay periods, and make sure you understand the consequences.</span></span> <span data-ttu-id="c31a7-199">Par exemple, si un composant effectue une demande à un autre composant, qui accède ensuite au service cible, et que vous implémentez les nouvelles tentatives au nombre de trois pour les deux appels, il y aura neuf tentatives au total pour le service.</span><span class="sxs-lookup"><span data-stu-id="c31a7-199">For example, if one component makes a request to another, which then accesses the target service, and you implement retry with a count of three on both calls there will be nine retry attempts in total against the service.</span></span> <span data-ttu-id="c31a7-200">Un grand nombre de services et de ressources implémentent un mécanisme de nouvelle tentative intégré et vous devez examiner comment désactiver ou modifier celui-ci si vous avez besoin d’implémenter de nouvelles tentatives à un niveau supérieur.</span><span class="sxs-lookup"><span data-stu-id="c31a7-200">Many services and resources implement a built-in retry mechanism and you should investigate how you can disable or modify this if you need to implement retries at a higher level.</span></span>
  * <span data-ttu-id="c31a7-201">N’implémentez jamais de mécanisme de nouvelle tentative infini.</span><span class="sxs-lookup"><span data-stu-id="c31a7-201">Never implement an endless retry mechanism.</span></span> <span data-ttu-id="c31a7-202">Vous risqueriez d’empêcher la ressource ou le service de récupérer des situations de surcharge, et de prolonger la limitation et le rejet des connexions.</span><span class="sxs-lookup"><span data-stu-id="c31a7-202">This is likely to prevent the resource or service recovering from overload situations, and cause throttling and refused connections to continue for a longer period.</span></span> <span data-ttu-id="c31a7-203">Utilisez un nombre fini de nouvelles tentatives ou implémentez un modèle tel que [Disjoncteur](../patterns/circuit-breaker.md) pour permettre au service de récupérer.</span><span class="sxs-lookup"><span data-stu-id="c31a7-203">Use a finite number or retries, or implement a pattern such as [Circuit Breaker](../patterns/circuit-breaker.md) to allow the service to recover.</span></span>
  * <span data-ttu-id="c31a7-204">N’effectuez jamais plus d’une nouvelle tentative immédiate.</span><span class="sxs-lookup"><span data-stu-id="c31a7-204">Never perform an immediate retry more than once.</span></span>
  * <span data-ttu-id="c31a7-205">Évitez d’utiliser un intervalle avant nouvelle tentative régulier, en particulier avec un nombre important de nouvelles tentatives, pour l’accès aux services et aux ressources dans Azure.</span><span class="sxs-lookup"><span data-stu-id="c31a7-205">Avoid using a regular retry interval, especially when you have a large number of retry attempts, when accessing services and resources in Azure.</span></span> <span data-ttu-id="c31a7-206">L’approche optimale pour ce scénario consiste à utiliser une stratégie de temporisation exponentielle avec une capacité de disjoncteur.</span><span class="sxs-lookup"><span data-stu-id="c31a7-206">The optimum approach is this scenario is an exponential back-off strategy with a circuit-breaking capability.</span></span>
  * <span data-ttu-id="c31a7-207">Empêchez plusieurs instances du même client ou plusieurs instances de clients différents d’effectuer de nouvelles tentatives au même moment.</span><span class="sxs-lookup"><span data-stu-id="c31a7-207">Prevent multiple instances of the same client, or multiple instances of different clients, from sending retries at the same times.</span></span> <span data-ttu-id="c31a7-208">Si cela risque de se produire, introduisez la répartition aléatoire dans les intervalles avant nouvelle tentative.</span><span class="sxs-lookup"><span data-stu-id="c31a7-208">If this is likely to occur, introduce randomization into the retry intervals.</span></span>
* <span data-ttu-id="c31a7-209">**Testez votre stratégie de nouvelle tentative et son implémentation :**</span><span class="sxs-lookup"><span data-stu-id="c31a7-209">**Test your retry strategy and implementation:**</span></span>
  * <span data-ttu-id="c31a7-210">Veillez à tester entièrement l’implémentation de votre stratégie de nouvelle tentative dans un éventail de circonstances aussi large que possible, en particulier lorsque l’application et les ressources ou services cibles qu’elle utilise sont soumis à une charge extrême.</span><span class="sxs-lookup"><span data-stu-id="c31a7-210">Ensure you fully test your retry strategy implementation under as wide a set of circumstances as possible, especially when both the application and the target resources or services it uses are under extreme load.</span></span> <span data-ttu-id="c31a7-211">Pour vérifier le comportement pendant le test, vous pouvez :</span><span class="sxs-lookup"><span data-stu-id="c31a7-211">To check behavior during testing, you can:</span></span>
    * <span data-ttu-id="c31a7-212">Injecter des erreurs temporaires et non temporaires dans le service.</span><span class="sxs-lookup"><span data-stu-id="c31a7-212">Inject transient and non-transient faults into the service.</span></span> <span data-ttu-id="c31a7-213">Par exemple, envoyez des demandes non valides ou ajoutez du code qui détecte les requêtes test et répond avec différents types d’erreurs.</span><span class="sxs-lookup"><span data-stu-id="c31a7-213">For example, send invalid requests or add code that detects test requests and responds with different types of errors.</span></span> <span data-ttu-id="c31a7-214">Pour un exemple d’utilisation de TestApi, consultez les articles [Test d’injection d’erreurs avec TestApi](https://msdn.microsoft.com/magazine/ff898404.aspx) et [Présentation de TestApi - Partie 5 : API d’injection d’erreurs dans du code managé](https://blogs.msdn.microsoft.com/ivo_manolov/2009/11/25/introduction-to-testapi-part-5-managed-code-fault-injection-apis/).</span><span class="sxs-lookup"><span data-stu-id="c31a7-214">For an example using TestApi, see [Fault Injection Testing with TestApi](https://msdn.microsoft.com/magazine/ff898404.aspx) and [Introduction to TestApi – Part 5: Managed Code Fault Injection APIs](https://blogs.msdn.microsoft.com/ivo_manolov/2009/11/25/introduction-to-testapi-part-5-managed-code-fault-injection-apis/).</span></span>
    * <span data-ttu-id="c31a7-215">Créer une ressource ou un service fictif renvoyant une plage d’erreurs que le service réel peut renvoyer.</span><span class="sxs-lookup"><span data-stu-id="c31a7-215">Create a mock of the resource or service that returns a range of errors that the real service may return.</span></span> <span data-ttu-id="c31a7-216">Veillez à couvrir tous les types d’erreurs pour la détection desquels votre stratégie de nouvelle tentative est conçue.</span><span class="sxs-lookup"><span data-stu-id="c31a7-216">Ensure you cover all the types of error that your retry strategy is designed to detect.</span></span>
    * <span data-ttu-id="c31a7-217">Forcer la survenue d’erreurs temporaires en désactivant ou en surchargeant temporairement le service s’il s’agit d’un service personnalisé que vous avez créé et déployé (vous ne devez pas, bien entendu, essayer de surcharger les ressources ou services partagés dans Azure).</span><span class="sxs-lookup"><span data-stu-id="c31a7-217">Force transient errors to occur by temporarily disabling or overloading the service if it is a custom service that you created and deployed (you should not, of course, attempt to overload any shared resources or shared services within Azure).</span></span>
    * <span data-ttu-id="c31a7-218">Pour les API HTTP, envisagez d’utiliser la bibliothèque FiddlerCore dans vos tests automatisés pour modifier le résultat des demandes HTTP, soit en ajoutant des temps d’aller-retour supplémentaires, soit en modifiant la réponse (par exemple, le code d’état, les en-têtes et le corps HTTP ou d’autres facteurs).</span><span class="sxs-lookup"><span data-stu-id="c31a7-218">For HTTP-based APIs, consider using the FiddlerCore library in your automated tests to change the outcome of HTTP requests, either by adding extra roundtrip times or by changing the response (such as the HTTP status code, headers, body, or other factors).</span></span> <span data-ttu-id="c31a7-219">Cela permet de tester de manière déterministe un sous-ensemble de conditions d’échec, qu’il s’agisse d’erreurs temporaires ou d’autres types de défaillances.</span><span class="sxs-lookup"><span data-stu-id="c31a7-219">This enables deterministic testing of a subset of the failure conditions, whether transient faults or other types of failure.</span></span> <span data-ttu-id="c31a7-220">Pour plus d’informations, consultez la page [FiddlerCore](https://www.telerik.com/fiddler/fiddlercore).</span><span class="sxs-lookup"><span data-stu-id="c31a7-220">For more information, see [FiddlerCore](https://www.telerik.com/fiddler/fiddlercore).</span></span> <span data-ttu-id="c31a7-221">Pour obtenir des exemples d’utilisation de la bibliothèque, en particulier la classe **HttpMangler** , examinez le [code source pour le Kit de développement logiciel (SDK) Azure Storage](https://github.com/Azure/azure-storage-net/tree/master/Test).</span><span class="sxs-lookup"><span data-stu-id="c31a7-221">For examples of how to use the library, particularly the **HttpMangler** class, examine the [source code for the Azure Storage SDK](https://github.com/Azure/azure-storage-net/tree/master/Test).</span></span>
    * <span data-ttu-id="c31a7-222">Effectuer des tests de facteur de charge élevé et des tests simultanés pour vous assurer que le mécanisme et la stratégie de nouvelle tentative fonctionnent correctement dans ces conditions et n’ont pas un impact négatif sur le fonctionnement du client ou n’entraînent pas de contamination croisée entre les demandes.</span><span class="sxs-lookup"><span data-stu-id="c31a7-222">Perform high load factor and concurrent tests to ensure that the retry mechanism and strategy works correctly under these conditions, and does not have an adverse effect on the operation of the client or cause cross-contamination between requests.</span></span>
* <span data-ttu-id="c31a7-223">**Gérez les configurations de politique de nouvelle tentative :**</span><span class="sxs-lookup"><span data-stu-id="c31a7-223">**Manage retry policy configurations:**</span></span>
  * <span data-ttu-id="c31a7-224">Une *politique de nouvelle tentative* associe tous les éléments de votre stratégie de nouvelle tentative.</span><span class="sxs-lookup"><span data-stu-id="c31a7-224">A *retry policy* is a combination of all of the elements of your retry strategy.</span></span> <span data-ttu-id="c31a7-225">Elle définit le mécanisme de détection qui détermine si une erreur est susceptible d’être temporaire, le type d’intervalle à utiliser (régulier, temporisation exponentielle, répartition aléatoire, etc.), les valeurs d’intervalle réelles et le nombre de nouvelles tentatives à effectuer.</span><span class="sxs-lookup"><span data-stu-id="c31a7-225">It defines the detection mechanism that determines whether a fault is likely to be transient, the type of interval to use (such as regular, exponential back-off, and randomization), the actual interval value(s), and the number of times to retry.</span></span>
  * <span data-ttu-id="c31a7-226">Les nouvelles tentatives doivent être implémentées à de nombreux endroits, même pour la plus simple des applications, et dans chaque couche des applications plus complexes.</span><span class="sxs-lookup"><span data-stu-id="c31a7-226">Retries must be implemented in many places within even the simplest application, and in every layer of more complex applications.</span></span> <span data-ttu-id="c31a7-227">Au lieu de coder en dur les éléments de chaque politique à plusieurs emplacements, envisagez d’utiliser un point central pour stocker l’ensemble des politiques.</span><span class="sxs-lookup"><span data-stu-id="c31a7-227">Rather than hard-coding the elements of each policy at multiple locations, consider using a central point for storing all the policies.</span></span> <span data-ttu-id="c31a7-228">Par exemple, stockez les valeurs telles que l’intervalle et le nombre de tentatives dans les fichiers de configuration de l’application, lisez ces derniers à l’exécution et créez les politiques de nouvelle tentative par programme.</span><span class="sxs-lookup"><span data-stu-id="c31a7-228">For example, store the values such as the interval and retry count in application configuration files, read them at runtime, and programmatically build the retry policies.</span></span> <span data-ttu-id="c31a7-229">Cela facilite la gestion des paramètres, ainsi que la modification et l’ajustement des valeurs afin de répondre à l’évolution des besoins et des scénarios.</span><span class="sxs-lookup"><span data-stu-id="c31a7-229">This makes it easier to manage the settings, and to modify and fine tune the values in order to respond to changing requirements and scenarios.</span></span> <span data-ttu-id="c31a7-230">Cependant, concevez le système de sorte qu’il stocke les valeurs plutôt que de relire un fichier de configuration à chaque fois et assurez-vous que des valeurs par défaut appropriées sont utilisées si les valeurs ne peuvent pas être obtenues à partir de la configuration.</span><span class="sxs-lookup"><span data-stu-id="c31a7-230">However, design the system to store the values rather than rereading a configuration file every time, and ensure suitable defaults are used if the values cannot be obtained from configuration.</span></span>
  * <span data-ttu-id="c31a7-231">Dans une application Azure Cloud Services, envisagez de stocker les valeurs qui sont utilisées pour créer les politiques de nouvelle tentative à l’exécution dans le fichier de configuration de service afin qu’elles puissent être modifiées sans avoir à redémarrer l’application.</span><span class="sxs-lookup"><span data-stu-id="c31a7-231">In an Azure Cloud Services application, consider storing the values that are used to build the retry policies at runtime in the service configuration file so that they can be changed without needing to restart the application.</span></span>
  * <span data-ttu-id="c31a7-232">Tirez parti des stratégies de nouvelle tentative intégrées ou par défaut disponibles dans les API clientes que vous utilisez, mais uniquement lorsqu’elles sont adaptées à votre scénario.</span><span class="sxs-lookup"><span data-stu-id="c31a7-232">Take advantage of built-in or default retry strategies available in the client APIs you use, but only where they are appropriate for your scenario.</span></span> <span data-ttu-id="c31a7-233">Ces stratégies sont généralement conçues pour un usage général.</span><span class="sxs-lookup"><span data-stu-id="c31a7-233">These strategies are typically general-purpose.</span></span> <span data-ttu-id="c31a7-234">Elles peuvent suffire à satisfaire l’ensemble des exigences de certains scénarios, mais pour d’autres, il se peut qu’elles n’offrent pas toutes les options nécessaires pour répondre à vos besoins spécifiques.</span><span class="sxs-lookup"><span data-stu-id="c31a7-234">In some scenarios they may be all that is required, but in other scenarios they may not offer the full range of options to suit your specific requirements.</span></span> <span data-ttu-id="c31a7-235">Vous devez comprendre comment les paramètres affecteront votre application à l’aide de tests afin de déterminer les valeurs les plus appropriées.</span><span class="sxs-lookup"><span data-stu-id="c31a7-235">You must understand how the settings will affect your application through testing to determine the most appropriate values.</span></span>
* <span data-ttu-id="c31a7-236">**Consignez et suivez les erreurs temporaires et non temporaires :**</span><span class="sxs-lookup"><span data-stu-id="c31a7-236">**Log and track transient and non-transient faults:**</span></span>
  * <span data-ttu-id="c31a7-237">Dans le cadre de votre stratégie de nouvelle tentative, incluez la gestion des exceptions et d’autres systèmes d’instrumentation permettant de consigner chaque nouvelle tentative.</span><span class="sxs-lookup"><span data-stu-id="c31a7-237">As part of your retry strategy, include exception handling and other instrumentation that logs when retry attempts are made.</span></span> <span data-ttu-id="c31a7-238">Bien que des erreurs temporaires et de nouvelles tentatives occasionnelles soient à prévoir et ne soient pas symptomatiques d’un problème, de nouvelles tentatives régulières et de plus en plus nombreuses sont souvent le signe d’un problème pouvant entraîner une défaillance ou affectant actuellement les performances et la disponibilité de l’application.</span><span class="sxs-lookup"><span data-stu-id="c31a7-238">While an occasional transient failure and retry are to be expected, and do not indicate a problem, regular and increasing numbers of retries are often an indicator of an issue that may cause a failure, or is currently impacting application performance and availability.</span></span>
  * <span data-ttu-id="c31a7-239">Consignez les erreurs temporaires en tant qu’avertissements plutôt qu’en tant qu’erreurs afin que les systèmes de surveillance ne les détectent pas comme des erreurs d’application susceptibles de déclencher de fausses alertes.</span><span class="sxs-lookup"><span data-stu-id="c31a7-239">Log transient faults as Warning entries rather than Error entries so that monitoring systems do not detect them as application errors that may trigger false alerts.</span></span>
  * <span data-ttu-id="c31a7-240">Envisagez de stocker dans vos entrées de journal une valeur qui indique si les nouvelles tentatives ont été provoquées par une limitation dans le service ou par d’autres types d’erreurs, tels que des échecs de connexion, afin de pouvoir les distinguer lors de l’analyse des données.</span><span class="sxs-lookup"><span data-stu-id="c31a7-240">Consider storing a value in your log entries that indicates if the retries were caused by throttling in the service, or by other types of faults such as connection failures, so that you can differentiate them during analysis of the data.</span></span> <span data-ttu-id="c31a7-241">Une augmentation du nombre d’erreurs de limitation est souvent révélatrice d’un défaut de conception de l’application ou de la nécessité de passer à un service Premium qui offre du matériel dédié.</span><span class="sxs-lookup"><span data-stu-id="c31a7-241">An increase in the number of throttling errors is often an indicator of a design flaw in the application or the need to switch to a premium service that offers dedicated hardware.</span></span>  
  * <span data-ttu-id="c31a7-242">Envisagez de mesurer et de consigner le temps total nécessaire aux opérations qui incluent un mécanisme de nouvelle tentative.</span><span class="sxs-lookup"><span data-stu-id="c31a7-242">Consider measuring and logging the overall time taken for operations that include a retry mechanism.</span></span> <span data-ttu-id="c31a7-243">C’est un bon indicateur de l’effet global des erreurs temporaires sur les temps de réponse pour l’utilisateur, la latence des processus et l’efficacité des cas d’utilisation de l’application.</span><span class="sxs-lookup"><span data-stu-id="c31a7-243">This is a good indicator of the overall effect of transient faults on user response times, process latency, and the efficiency of the application use cases.</span></span> <span data-ttu-id="c31a7-244">Consignez également le nombre de tentatives effectuées pour comprendre les facteurs qui ont contribué au temps de réponse.</span><span class="sxs-lookup"><span data-stu-id="c31a7-244">Also log the number of retries occurred in order to understand the factors that contributed to the response time.</span></span>
  * <span data-ttu-id="c31a7-245">Envisagez d’implémenter un système de télémétrie et de surveillance capable de déclencher des alertes lorsque le nombre et le taux de défaillances, le nombre moyen de nouvelles tentatives ou le temps total que mettent les opérations pour aboutir augmentent.</span><span class="sxs-lookup"><span data-stu-id="c31a7-245">Consider implementing a telemetry and monitoring system that can raise alerts when the number and rate of failures, the average number of retries, or the overall times taken for operations to succeed, is increasing.</span></span>
* <span data-ttu-id="c31a7-246">**Gérez les opérations qui échouent continuellement :**</span><span class="sxs-lookup"><span data-stu-id="c31a7-246">**Manage operations that continually fail:**</span></span>
  
  * <span data-ttu-id="c31a7-247">Dans certains cas, il se peut que l’opération échoue à chaque tentative, et il est indispensable de réfléchir à la façon dont vous gérerez cette situation :</span><span class="sxs-lookup"><span data-stu-id="c31a7-247">There will be circumstances where the operation continues to fail at every attempt, and it is vital to consider how you will handle this situation:</span></span>
    * <span data-ttu-id="c31a7-248">Bien qu’une stratégie de nouvelle tentative définisse le nombre maximal de fois qu’une opération doit être retentée, elle n’empêche pas ensuite l’application de répéter l’opération avec le même nombre de nouvelles tentatives.</span><span class="sxs-lookup"><span data-stu-id="c31a7-248">Although a retry strategy will define the maximum number of times that an operation should be retried, it does not prevent the application repeating the operation again, with the same number of retries.</span></span> <span data-ttu-id="c31a7-249">Par exemple, si un service de traitement des commandes échoue avec une erreur irrécupérable qui le met définitivement en défaut, la stratégie de nouvelle tentative peut détecter une expiration du délai de connexion et considérer cet événement comme une erreur temporaire.</span><span class="sxs-lookup"><span data-stu-id="c31a7-249">For example, if an order processing service fails with a fatal error that puts it out of action permanently, the retry strategy may detect a connection timeout and consider it to be a transient fault.</span></span> <span data-ttu-id="c31a7-250">Le code retentera l’opération un nombre spécifié de fois avant d’abandonner.</span><span class="sxs-lookup"><span data-stu-id="c31a7-250">The code will retry the operation a specified number of times and then give up.</span></span> <span data-ttu-id="c31a7-251">Cependant, lorsqu’un autre client passe une commande, l’opération sera tentée à nouveau, même si elle est vouée à l’échec à chaque fois.</span><span class="sxs-lookup"><span data-stu-id="c31a7-251">However, when another customer places an order, the operation will be attempted again - even though it is sure to fail every time.</span></span>
    * <span data-ttu-id="c31a7-252">Pour empêcher la poursuite des nouvelles tentatives pour les opérations qui échouent continuellement, envisagez d’implémenter le [modèle Disjoncteur](../patterns/circuit-breaker.md).</span><span class="sxs-lookup"><span data-stu-id="c31a7-252">To prevent continual retries for operations that continually fail, consider implementing the [Circuit Breaker pattern](../patterns/circuit-breaker.md).</span></span> <span data-ttu-id="c31a7-253">Dans ce modèle, si le nombre d’échecs dans un délai spécifié dépasse la limite autorisée, les demandes sont immédiatement renvoyées à l’appelant comme des erreurs, sans tenter d’accéder à la ressource ou au service qui a échoué.</span><span class="sxs-lookup"><span data-stu-id="c31a7-253">In this pattern, if the number of failures within a specified time window exceeds the threshold, requests are returned to the caller immediately as errors, without attempting to access the failed resource or service.</span></span>
    * <span data-ttu-id="c31a7-254">L’application peut tester régulièrement le service, par intermittence et avec de très longs intervalles entre les demandes, pour détecter le moment où il redevient disponible.</span><span class="sxs-lookup"><span data-stu-id="c31a7-254">The application can periodically test the service, on an intermittent basis and with very long intervals between requests, to detect when it becomes available.</span></span> <span data-ttu-id="c31a7-255">L’intervalle approprié dépend du scénario, par exemple de l’importance de l’opération et de la nature du service, et peut être compris entre quelques minutes et plusieurs heures.</span><span class="sxs-lookup"><span data-stu-id="c31a7-255">An appropriate interval will depend on the scenario, such as the criticality of the operation and the nature of the service, and might be anything between a few minutes and several hours.</span></span> <span data-ttu-id="c31a7-256">Lorsque le test réussit, l’application peut reprendre un fonctionnement normal et transmettre les demandes au service qui vient d’être restauré.</span><span class="sxs-lookup"><span data-stu-id="c31a7-256">At the point where the test succeeds, the application can resume normal operations and pass requests to the newly recovered service.</span></span>
    * <span data-ttu-id="c31a7-257">En attendant, vous pouvez avoir recours à une autre instance du service (par exemple dans un autre centre de données ou une autre application), utiliser un service similaire qui offre des fonctionnalités compatibles (peut-être plus simples) ou effectuer d’autres opérations en espérant que le service sera de nouveau disponible bientôt.</span><span class="sxs-lookup"><span data-stu-id="c31a7-257">In the meantime, it may be possible to fall back to another instance of the service (perhaps in a different datacenter or application), use a similar service that offers compatible (perhaps simpler) functionality, or perform some alternative operations in the hope that the service will become available soon.</span></span> <span data-ttu-id="c31a7-258">Par exemple, il peut être judicieux de stocker les demandes liées au service dans une file d’attente ou un magasin de données et de les relire ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="c31a7-258">For example, it may be appropriate to store requests for the service in a queue or data store and replay them later.</span></span> <span data-ttu-id="c31a7-259">Sinon, vous pourrez peut-être rediriger l’utilisateur vers une autre instance de l’application, dégrader les performances de l’application tout en continuant à offrir des fonctionnalités acceptables ou renvoyer simplement un message à l’utilisateur indiquant que l’application est actuellement indisponible.</span><span class="sxs-lookup"><span data-stu-id="c31a7-259">Otherwise you might be able to redirect the user to an alternative instance of the application, degrade the performance of the application but still offer acceptable functionality, or just return a message to the user indicating that the application is not available at present.</span></span>
* <span data-ttu-id="c31a7-260">**Autres points à considérer**</span><span class="sxs-lookup"><span data-stu-id="c31a7-260">**Other considerations**</span></span>
  
  * <span data-ttu-id="c31a7-261">Lorsque vous choisissez les valeurs pour le nombre de nouvelles tentatives et les intervalles avant nouvelle tentative d’une politique, demandez-vous si l’opération à effectuer sur le service ou la ressource fait partie d’une opération de longue durée ou à plusieurs étapes.</span><span class="sxs-lookup"><span data-stu-id="c31a7-261">When deciding on the values for the number of retries and the retry intervals for a policy, consider if the operation on the service or resource is part of a long-running or multi-step operation.</span></span> <span data-ttu-id="c31a7-262">Lorsqu’une étape opérationnelle échoue, il peut être difficile ou coûteux de compenser toutes les autres ayant déjà abouti.</span><span class="sxs-lookup"><span data-stu-id="c31a7-262">It may be difficult or expensive to compensate all the other operational steps that have already succeeded when one fails.</span></span> <span data-ttu-id="c31a7-263">Dans ce cas, un intervalle très long et un grand nombre de nouvelles tentatives peuvent être acceptables à condition que les autres opérations ne soient pas bloquées par la mise en attente ou le verrouillage de ressources rares.</span><span class="sxs-lookup"><span data-stu-id="c31a7-263">In this case, a very long interval and a large number of retries may be acceptable as long as it does not block other operations by holding or locking scarce resources.</span></span>
  * <span data-ttu-id="c31a7-264">Demandez-vous si une nouvelle tentative pour la même opération peut donner lieu à des incohérences dans les données.</span><span class="sxs-lookup"><span data-stu-id="c31a7-264">Consider if retrying the same operation may cause inconsistencies in data.</span></span> <span data-ttu-id="c31a7-265">Si certaines parties d’un processus à plusieurs étapes sont répétées et que les opérations ne sont pas idempotentes, cela risque d’entraîner une incohérence.</span><span class="sxs-lookup"><span data-stu-id="c31a7-265">If some parts of a multi-step process are repeated, and the operations are not idempotent, it may result in an inconsistency.</span></span> <span data-ttu-id="c31a7-266">Par exemple, si une opération qui incrémente une valeur est répétée, elle produira un résultat non valide.</span><span class="sxs-lookup"><span data-stu-id="c31a7-266">For example, an operation that increments a value, if repeated, will produce an invalid result.</span></span> <span data-ttu-id="c31a7-267">La répétition d’une opération qui envoie un message à une file d’attente peut entraîner une incohérence dans le consommateur de message si celui-ci ne prend pas en charge la détection des messages en double.</span><span class="sxs-lookup"><span data-stu-id="c31a7-267">Repeating an operation that sends a message to a queue may cause an inconsistency in the message consumer if it cannot detect duplicate messages.</span></span> <span data-ttu-id="c31a7-268">Pour éviter ce problème, veillez à concevoir chaque étape comme une opération idempotente.</span><span class="sxs-lookup"><span data-stu-id="c31a7-268">To prevent this, ensure that you design each step as an idempotent operation.</span></span> <span data-ttu-id="c31a7-269">Pour plus d’informations sur l’idempotence, consultez l’article [Modèles d’idempotence][idempotency-patterns].</span><span class="sxs-lookup"><span data-stu-id="c31a7-269">For more information about idempotency, see [Idempotency Patterns][idempotency-patterns].</span></span>
  * <span data-ttu-id="c31a7-270">Réfléchissez à la portée des opérations qui vont être retentées.</span><span class="sxs-lookup"><span data-stu-id="c31a7-270">Consider the scope of the operations that will be retried.</span></span> <span data-ttu-id="c31a7-271">Par exemple, il peut s’avérer plus simple d’implémenter du code de nouvelle tentative à un niveau qui englobe plusieurs opérations et de toutes les retenter en cas de défaillance de l’une d’elles.</span><span class="sxs-lookup"><span data-stu-id="c31a7-271">For example, it may be easier to implement retry code at a level that encompasses several operations, and retry them all if one fails.</span></span> <span data-ttu-id="c31a7-272">Cependant, cela peut donner lieu à des problèmes d’idempotence ou à des opérations de restauration inutiles.</span><span class="sxs-lookup"><span data-stu-id="c31a7-272">However, doing this may result in idempotency issues or unnecessary rollback operations.</span></span>
  * <span data-ttu-id="c31a7-273">Si vous choisissez une portée de nouvelle tentative qui englobe plusieurs opérations, prenez en compte la latence totale de toutes ces opérations pour déterminer les intervalles avant nouvelle tentative et surveiller le temps nécessaire, ou avant de déclencher des alertes pour des défaillances.</span><span class="sxs-lookup"><span data-stu-id="c31a7-273">If you choose a retry scope that encompasses several operations, take into account the total latency of all of them when determining the retry intervals, when monitoring the time taken, and before raising alerts for failures.</span></span>
  * <span data-ttu-id="c31a7-274">Réfléchissez à l’impact que votre stratégie de nouvelle tentative peut avoir sur les voisins et les autres clients au sein d’une application partagée ou lors de l’utilisation de ressources et de services partagés.</span><span class="sxs-lookup"><span data-stu-id="c31a7-274">Consider how your retry strategy may affect neighbors and other tenants in a shared application, or when using shared resources and services.</span></span> <span data-ttu-id="c31a7-275">Les politiques de nouvelle tentative agressives peuvent augmenter le nombre d’erreurs temporaires pour ces autres utilisateurs et pour les applications qui partagent les ressources et les services.</span><span class="sxs-lookup"><span data-stu-id="c31a7-275">Aggressive retry policies can cause an increasing number of transient faults to occur for these other users and for applications that share the resources and services.</span></span> <span data-ttu-id="c31a7-276">De même, votre application peut être affectée par les politiques de nouvelle tentative implémentées par les autres utilisateurs des ressources et des services.</span><span class="sxs-lookup"><span data-stu-id="c31a7-276">Likewise, your application may be affected by the retry policies implemented by other users of the resources and services.</span></span> <span data-ttu-id="c31a7-277">Pour les applications stratégiques, vous pouvez décider d’utiliser des services Premium qui ne sont pas partagés.</span><span class="sxs-lookup"><span data-stu-id="c31a7-277">For mission-critical applications, you may decide to use premium services that are not shared.</span></span> <span data-ttu-id="c31a7-278">Vous bénéficierez ainsi d’un contrôle considérablement accru sur la charge de ces ressources et services et sur la limitation qui en découle, ce qui peut contribuer à justifier le coût supplémentaire de ces services.</span><span class="sxs-lookup"><span data-stu-id="c31a7-278">This provides you with much more control over the load and consequent throttling of these resources and services, which can help to justify the additional cost.</span></span>

## <a name="more-information"></a><span data-ttu-id="c31a7-279">Plus d’informations</span><span class="sxs-lookup"><span data-stu-id="c31a7-279">More information</span></span>
* [<span data-ttu-id="c31a7-280">Instructions relatives aux nouvelles tentatives pour les services Azure</span><span class="sxs-lookup"><span data-stu-id="c31a7-280">Azure service-specific retry guidelines</span></span>](./retry-service-specific.md)
* [<span data-ttu-id="c31a7-281">Modèle Disjoncteur</span><span class="sxs-lookup"><span data-stu-id="c31a7-281">Circuit Breaker Pattern</span></span>](../patterns/circuit-breaker.md)
* [<span data-ttu-id="c31a7-282">Modèle de transaction de compensation</span><span class="sxs-lookup"><span data-stu-id="c31a7-282">Compensating Transaction Pattern</span></span>](../patterns/compensating-transaction.md)
* <span data-ttu-id="c31a7-283">[Modèles d’idempotence][idempotency-patterns]</span><span class="sxs-lookup"><span data-stu-id="c31a7-283">[Idempotency Patterns][idempotency-patterns]</span></span>

[idempotency-patterns]: https://blog.jonathanoliver.com/idempotency-patterns/

